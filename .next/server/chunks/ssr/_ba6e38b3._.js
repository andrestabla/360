module.exports=[29505,(a,b,c)=>{"use strict";b.exports=function(){}},72668,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(35112),e=a.i(98263),f=a.i(78134),g=a.i(82665),h=a.i(10158),i=a.i(8798),j=a.i(60144),k=a.i(27488),l=a.i(90823),m=a.i(61275),n=a.i(33986),o=a.i(60217);let p=new Map([["bold",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28Zm-4,24v92H179.31a19.86,19.86,0,0,0-14.14,5.86L147,168H109L90.83,149.86A19.86,19.86,0,0,0,76.69,144H52V52ZM52,204V168H75l18.14,18.14A19.86,19.86,0,0,0,107.31,192h41.38a19.86,19.86,0,0,0,14.14-5.86L181,168h23v36Z"}))],["duotone",c.createElement(c.Fragment,null,c.createElement("path",{d:"M216,48V160H179.31a8,8,0,0,0-5.66,2.34l-19.31,19.32a8,8,0,0,1-5.66,2.34H107.31a8,8,0,0,1-5.66-2.34L82.34,162.34A8,8,0,0,0,76.68,160H40V48a8,8,0,0,1,8-8H208A8,8,0,0,1,216,48Z",opacity:"0.2"}),c.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,16V152h-28.7A15.86,15.86,0,0,0,168,156.69L148.69,176H107.31L88,156.68A15.89,15.89,0,0,0,76.69,152H48V48Zm0,160H48V168H76.69L96,187.32A15.89,15.89,0,0,0,107.31,192h41.38A15.86,15.86,0,0,0,160,187.31L179.31,168H208v40Z"}))],["fill",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,176H48V168H76.69L96,187.32A15.89,15.89,0,0,0,107.31,192h41.38A15.86,15.86,0,0,0,160,187.31L179.31,168H208v40Z"}))],["light",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,34H48A14,14,0,0,0,34,48V208a14,14,0,0,0,14,14H208a14,14,0,0,0,14-14V48A14,14,0,0,0,208,34ZM48,46H208a2,2,0,0,1,2,2V154H179.31a13.94,13.94,0,0,0-9.9,4.1L150.1,177.41a2,2,0,0,1-1.41.59H107.31a2,2,0,0,1-1.41-.58L86.59,158.1a13.94,13.94,0,0,0-9.9-4.1H46V48A2,2,0,0,1,48,46ZM208,210H48a2,2,0,0,1-2-2V166H76.69a2,2,0,0,1,1.41.58L97.41,185.9a13.94,13.94,0,0,0,9.9,4.1h41.38a13.94,13.94,0,0,0,9.9-4.1l19.31-19.31a2,2,0,0,1,1.41-.59H210v42A2,2,0,0,1,208,210Z"}))],["regular",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,16V152h-28.7A15.86,15.86,0,0,0,168,156.69L148.69,176H107.31L88,156.69A15.86,15.86,0,0,0,76.69,152H48V48Zm0,160H48V168H76.69L96,187.31A15.86,15.86,0,0,0,107.31,192h41.38A15.86,15.86,0,0,0,160,187.31L179.31,168H208v40Z"}))],["thin",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,36H48A12,12,0,0,0,36,48V208a12,12,0,0,0,12,12H208a12,12,0,0,0,12-12V48A12,12,0,0,0,208,36ZM48,44H208a4,4,0,0,1,4,4V156H179.31a12,12,0,0,0-8.48,3.51l-19.32,19.32a4,4,0,0,1-2.82,1.17H107.31a4,4,0,0,1-2.82-1.17L85.17,159.51A12,12,0,0,0,76.69,156H44V48A4,4,0,0,1,48,44ZM208,212H48a4,4,0,0,1-4-4V164H76.69a4,4,0,0,1,2.82,1.17l19.32,19.32a12,12,0,0,0,8.48,3.51h41.38a12,12,0,0,0,8.48-3.51l19.32-19.32a4,4,0,0,1,2.82-1.17H212v44A4,4,0,0,1,208,212Z"}))]]),q=c.forwardRef((a,b)=>c.createElement(o.default,{ref:b,...a,weights:p}));q.displayName="TrayIcon";var r=a.i(94048),s=a.i(63144),t=a.i(24454),u=a.i(72129),v=a.i(58533),w=a.i(76799),x=a.i(27964),y=a.i(69540),z=a.i(54069),A=a.i(39577),B=a.i(64714),C=a.i(11614),D=a.i(17981),E=a.i(82770);let F=new Map([["bold",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,52H182.42L170,33.34A12,12,0,0,0,160,28H96a12,12,0,0,0-10,5.34L73.57,52H48A28,28,0,0,0,20,80V192a28,28,0,0,0,28,28H208a28,28,0,0,0,28-28V80A28,28,0,0,0,208,52Zm4,140a4,4,0,0,1-4,4H48a4,4,0,0,1-4-4V80a4,4,0,0,1,4-4H80a12,12,0,0,0,10-5.34L102.42,52h51.15L166,70.66A12,12,0,0,0,176,76h32a4,4,0,0,1,4,4ZM128,84a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,84Zm0,72a24,24,0,1,1,24-24A24,24,0,0,1,128,156Z"}))],["duotone",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,64H176L160,40H96L80,64H48A16,16,0,0,0,32,80V192a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V80A16,16,0,0,0,208,64ZM128,168a36,36,0,1,1,36-36A36,36,0,0,1,128,168Z",opacity:"0.2"}),c.createElement("path",{d:"M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm8,136a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H80a8,8,0,0,0,6.66-3.56L100.28,48h55.43l13.63,20.44A8,8,0,0,0,176,72h32a8,8,0,0,1,8,8ZM128,88a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,88Zm0,72a28,28,0,1,1,28-28A28,28,0,0,1,128,160Z"}))],["fill",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm-44,76a36,36,0,1,1-36-36A36,36,0,0,1,164,132Z"}))],["light",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,58H179.21L165,36.67A6,6,0,0,0,160,34H96a6,6,0,0,0-5,2.67L76.78,58H48A22,22,0,0,0,26,80V192a22,22,0,0,0,22,22H208a22,22,0,0,0,22-22V80A22,22,0,0,0,208,58Zm10,134a10,10,0,0,1-10,10H48a10,10,0,0,1-10-10V80A10,10,0,0,1,48,70H80a6,6,0,0,0,5-2.67L99.21,46h57.57L171,67.33A6,6,0,0,0,176,70h32a10,10,0,0,1,10,10ZM128,90a42,42,0,1,0,42,42A42,42,0,0,0,128,90Zm0,72a30,30,0,1,1,30-30A30,30,0,0,1,128,162Z"}))],["regular",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm8,136a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H80a8,8,0,0,0,6.66-3.56L100.28,48h55.43l13.63,20.44A8,8,0,0,0,176,72h32a8,8,0,0,1,8,8ZM128,88a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,88Zm0,72a28,28,0,1,1,28-28A28,28,0,0,1,128,160Z"}))],["thin",c.createElement(c.Fragment,null,c.createElement("path",{d:"M208,60H178.13L163.32,37.78A4,4,0,0,0,160,36H96a4,4,0,0,0-3.32,1.78L77.85,60H48A20,20,0,0,0,28,80V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V80A20,20,0,0,0,208,60Zm12,132a12,12,0,0,1-12,12H48a12,12,0,0,1-12-12V80A12,12,0,0,1,48,68H80a4,4,0,0,0,3.33-1.78L98.13,44h59.72l14.82,22.22A4,4,0,0,0,176,68h32a12,12,0,0,1,12,12ZM128,92a40,40,0,1,0,40,40A40,40,0,0,0,128,92Zm0,72a32,32,0,1,1,32-32A32,32,0,0,1,128,164Z"}))]]),G=c.forwardRef((a,b)=>c.createElement(o.default,{ref:b,...a,weights:F}));G.displayName="CameraIcon";var H=a.i(33686),I=a.i(44306),J=a.i(98874),K=a.i(3043),L=a.i(4971),M=a.i(3916);let N=function(){for(var a,b,c=0,d="",e=arguments.length;c<e;c++)(a=arguments[c])&&(b=function a(b){var c,d,e="";if("string"==typeof b||"number"==typeof b)e+=b;else if("object"==typeof b)if(Array.isArray(b)){var f=b.length;for(c=0;c<f;c++)b[c]&&(d=a(b[c]))&&(e&&(e+=" "),e+=d)}else for(d in b)b[d]&&(e&&(e+=" "),e+=d);return e}(a))&&(d&&(d+=" "),d+=b);return d};var O=Object.prototype.hasOwnProperty;function P(a,b,c){for(c of a.keys())if(Q(c,b))return c}function Q(a,b){var c,d,e;if(a===b)return!0;if(a&&b&&(c=a.constructor)===b.constructor){if(c===Date)return a.getTime()===b.getTime();if(c===RegExp)return a.toString()===b.toString();if(c===Array){if((d=a.length)===b.length)for(;d--&&Q(a[d],b[d]););return -1===d}if(c===Set){if(a.size!==b.size)return!1;for(d of a)if((e=d)&&"object"==typeof e&&!(e=P(b,e))||!b.has(e))return!1;return!0}if(c===Map){if(a.size!==b.size)return!1;for(d of a)if((e=d[0])&&"object"==typeof e&&!(e=P(b,e))||!Q(d[1],b.get(e)))return!1;return!0}if(c===ArrayBuffer)a=new Uint8Array(a),b=new Uint8Array(b);else if(c===DataView){if((d=a.byteLength)===b.byteLength)for(;d--&&a.getInt8(d)===b.getInt8(d););return -1===d}if(ArrayBuffer.isView(a)){if((d=a.byteLength)===b.byteLength)for(;d--&&a[d]===b[d];);return -1===d}if(!c||"object"==typeof a){for(c in d=0,a)if(O.call(a,c)&&++d&&!O.call(b,c)||!(c in b)||!Q(a[c],b[c]))return!1;return Object.keys(b).length===d}}return a!=a&&b!=b}function R(a){let b=!1;return{promise:new Promise((c,d)=>{a.then(a=>!b&&c(a)).catch(a=>!b&&d(a))}),cancel(){b=!0}}}let S=["onCopy","onCut","onPaste","onCompositionEnd","onCompositionStart","onCompositionUpdate","onFocus","onBlur","onInput","onInvalid","onReset","onSubmit","onLoad","onError","onKeyDown","onKeyPress","onKeyUp","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onScroll","onWheel","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd","onChange","onToggle"];function T(a,b){let c={};for(let d of S){let e=a[d];e&&(b?c[d]=a=>e(a,b(d)):c[d]=e)}return c}let U={get url(){return`file://${a.P("node_modules/pdfjs-dist/build/pdf.mjs")}`}};var V={};V.d=(a,b)=>{for(var c in b)V.o(b,c)&&!V.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:b[c]})},V.o=(a,b)=>Object.prototype.hasOwnProperty.call(a,b);let W="object"==typeof process&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),X=[.001,0,0,.001,0,0],Y={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Z="pdfjs_internal_editor_",$={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},_={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},aa={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ab={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ac={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},ad={ERRORS:0,WARNINGS:1,INFOS:5},ae={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},af={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},ag=ad.WARNINGS;function ah(a){ag>=ad.INFOS&&console.info(`Info: ${a}`)}function ai(a){ag>=ad.WARNINGS&&console.warn(`Warning: ${a}`)}function aj(a){throw Error(a)}function ak(a,b){a||aj(b)}function al(a,b=null,c=null){if(!a)return null;if(c&&"string"==typeof a){if(c.addDefaultProtocol&&a.startsWith("www.")){let b=a.match(/\./g);b?.length>=2&&(a=`http://${a}`)}if(c.tryConvertEncoding)try{var d;d=a,a=decodeURIComponent(escape(d))}catch{}}let e=b?URL.parse(a,b):URL.parse(a);return!function(a){switch(a?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(e)?null:e}function am(a,b,c=!1){let d=URL.parse(a);return d?(d.hash=b,d.href):c&&al(a,"http://example.com")?a.split("#",1)[0]+`${b?`#${b}`:""}`:""}function an(a,b,c,d=!1){return Object.defineProperty(a,b,{value:c,enumerable:!d,configurable:!0,writable:!1}),c}let ao=function(){function a(a,b){this.message=a,this.name=b}return a.prototype=Error(),a.constructor=a,a}();class ap extends ao{constructor(a,b){super(a,"PasswordException"),this.code=b}}class aq extends ao{constructor(a,b){super(a,"UnknownErrorException"),this.details=b}}class ar extends ao{constructor(a){super(a,"InvalidPDFException")}}class as extends ao{constructor(a,b,c){super(a,"ResponseException"),this.status=b,this.missing=c}}class at extends ao{constructor(a){super(a,"FormatError")}}class au extends ao{constructor(a){super(a,"AbortException")}}function av(a){("object"!=typeof a||a?.length===void 0)&&aj("Invalid argument for bytesToString");let b=a.length;if(b<8192)return String.fromCharCode.apply(null,a);let c=[];for(let d=0;d<b;d+=8192){let e=Math.min(d+8192,b),f=a.subarray(d,e);c.push(String.fromCharCode.apply(null,f))}return c.join("")}function aw(a){"string"!=typeof a&&aj("Invalid argument for stringToBytes");let b=a.length,c=new Uint8Array(b);for(let d=0;d<b;++d)c[d]=255&a.charCodeAt(d);return c}class ax{static get isLittleEndian(){let a;return an(this,"isLittleEndian",((a=new Uint8Array(4))[0]=1,1===new Uint32Array(a.buffer,0,1)[0]))}static get isEvalSupported(){return an(this,"isEvalSupported",function(){try{return Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return an(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get isImageDecoderSupported(){return an(this,"isImageDecoderSupported","undefined"!=typeof ImageDecoder)}static get platform(){let{platform:a,userAgent:b}=navigator;return an(this,"platform",{isAndroid:b.includes("Android"),isLinux:a.includes("Linux"),isMac:a.includes("Mac"),isWindows:a.includes("Win"),isFirefox:b.includes("Firefox")})}static get isCSSRoundSupported(){return an(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}let ay=Array.from(Array(256).keys(),a=>a.toString(16).padStart(2,"0"));class az{static makeHexColor(a,b,c){return`#${ay[a]}${ay[b]}${ay[c]}`}static domMatrixToTransform(a){return[a.a,a.b,a.c,a.d,a.e,a.f]}static scaleMinMax(a,b){let c;a[0]?(a[0]<0&&(c=b[0],b[0]=b[2],b[2]=c),b[0]*=a[0],b[2]*=a[0],a[3]<0&&(c=b[1],b[1]=b[3],b[3]=c),b[1]*=a[3],b[3]*=a[3]):(c=b[0],b[0]=b[1],b[1]=c,c=b[2],b[2]=b[3],b[3]=c,a[1]<0&&(c=b[1],b[1]=b[3],b[3]=c),b[1]*=a[1],b[3]*=a[1],a[2]<0&&(c=b[0],b[0]=b[2],b[2]=c),b[0]*=a[2],b[2]*=a[2]),b[0]+=a[4],b[1]+=a[5],b[2]+=a[4],b[3]+=a[5]}static transform(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]}static multiplyByDOMMatrix(a,b){return[a[0]*b.a+a[2]*b.b,a[1]*b.a+a[3]*b.b,a[0]*b.c+a[2]*b.d,a[1]*b.c+a[3]*b.d,a[0]*b.e+a[2]*b.f+a[4],a[1]*b.e+a[3]*b.f+a[5]]}static applyTransform(a,b,c=0){let d=a[c],e=a[c+1];a[c]=d*b[0]+e*b[2]+b[4],a[c+1]=d*b[1]+e*b[3]+b[5]}static applyTransformToBezier(a,b,c=0){let d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5];for(let b=0;b<6;b+=2){let j=a[c+b],k=a[c+b+1];a[c+b]=j*d+k*f+h,a[c+b+1]=j*e+k*g+i}}static applyInverseTransform(a,b){let c=a[0],d=a[1],e=b[0]*b[3]-b[1]*b[2];a[0]=(c*b[3]-d*b[2]+b[2]*b[5]-b[4]*b[3])/e,a[1]=(-c*b[1]+d*b[0]+b[4]*b[1]-b[5]*b[0])/e}static axialAlignedBoundingBox(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=a[0],k=a[1],l=a[2],m=a[3],n=d*j+h,o=n,p=d*l+h,q=p,r=g*k+i,s=r,t=g*m+i,u=t;if(0!==e||0!==f){let a=e*j,b=e*l,c=f*k,d=f*m;n+=c,q+=c,p+=d,o+=d,r+=a,u+=a,t+=b,s+=b}c[0]=Math.min(c[0],n,p,o,q),c[1]=Math.min(c[1],r,t,s,u),c[2]=Math.max(c[2],n,p,o,q),c[3]=Math.max(c[3],r,t,s,u)}static inverseTransform(a){let b=a[0]*a[3]-a[1]*a[2];return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,(a[2]*a[5]-a[4]*a[3])/b,(a[4]*a[1]-a[5]*a[0])/b]}static singularValueDecompose2dScale(a,b){let c=a[0],d=a[1],e=a[2],f=a[3],g=c**2+d**2,h=e**2+f**2,i=(g+h)/2,j=Math.sqrt(i**2-(g*h-(c*e+d*f)**2));b[0]=Math.sqrt(i+j||1),b[1]=Math.sqrt(i-j||1)}static normalizeRect(a){let b=a.slice(0);return a[0]>a[2]&&(b[0]=a[2],b[2]=a[0]),a[1]>a[3]&&(b[1]=a[3],b[3]=a[1]),b}static intersect(a,b){let c=Math.max(Math.min(a[0],a[2]),Math.min(b[0],b[2])),d=Math.min(Math.max(a[0],a[2]),Math.max(b[0],b[2]));if(c>d)return null;let e=Math.max(Math.min(a[1],a[3]),Math.min(b[1],b[3])),f=Math.min(Math.max(a[1],a[3]),Math.max(b[1],b[3]));return e>f?null:[c,e,d,f]}static pointBoundingBox(a,b,c){c[0]=Math.min(c[0],a),c[1]=Math.min(c[1],b),c[2]=Math.max(c[2],a),c[3]=Math.max(c[3],b)}static rectBoundingBox(a,b,c,d,e){e[0]=Math.min(e[0],a,c),e[1]=Math.min(e[1],b,d),e[2]=Math.max(e[2],a,c),e[3]=Math.max(e[3],b,d)}static #a(a,b,c,d,e,f,g,h,i,j){if(i<=0||i>=1)return;let k=1-i,l=i*i,m=l*i,n=k*(k*(k*a+3*i*b)+3*l*c)+m*d,o=k*(k*(k*e+3*i*f)+3*l*g)+m*h;j[0]=Math.min(j[0],n),j[1]=Math.min(j[1],o),j[2]=Math.max(j[2],n),j[3]=Math.max(j[3],o)}static #b(a,b,c,d,e,f,g,h,i,j,k,l){if(1e-12>Math.abs(i)){Math.abs(j)>=1e-12&&this.#a(a,b,c,d,e,f,g,h,-k/j,l);return}let m=j**2-4*k*i;if(m<0)return;let n=Math.sqrt(m),o=2*i;this.#a(a,b,c,d,e,f,g,h,(-j+n)/o,l),this.#a(a,b,c,d,e,f,g,h,(-j-n)/o,l)}static bezierBoundingBox(a,b,c,d,e,f,g,h,i){i[0]=Math.min(i[0],a,g),i[1]=Math.min(i[1],b,h),i[2]=Math.max(i[2],a,g),i[3]=Math.max(i[3],b,h),this.#b(a,c,e,g,b,d,f,h,3*(-a+3*(c-e)+g),6*(a-2*c+e),3*(c-a),i),this.#b(a,c,e,g,b,d,f,h,3*(-b+3*(d-f)+h),6*(b-2*d+f),3*(d-b),i)}}let aA=null,aB=null;function aC(a){return aA||(aA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,aB=new Map([["ﬅ","ſt"]])),a.replaceAll(aA,(a,b,c)=>b?b.normalize("NFKC"):aB.get(c))}function aD(){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();let a=new Uint8Array(32);return crypto.getRandomValues(a),av(a)}let aE="pdfjs_internal_id_";function aF(a,b,c){return Math.min(Math.max(a,b),c)}function aG(a){return Uint8Array.prototype.toBase64?a.toBase64():btoa(av(a))}"function"!=typeof Promise.try&&(Promise.try=function(a,...b){return new Promise(c=>{c(a(...b))})}),"function"!=typeof Math.sumPrecise&&(Math.sumPrecise=function(a){return a.reduce((a,b)=>a+b,0)});class aH{static textContent(a){let b=[],c={items:b,styles:Object.create(null)};return!function a(c){if(!c)return;let d=null,e=c.name;if("#text"===e)d=c.value;else{if(!aH.shouldBuildText(e))return;c?.attributes?.textContent?d=c.attributes.textContent:c.value&&(d=c.value)}if(null!==d&&b.push({str:d}),c.children)for(let b of c.children)a(b)}(a),c}static shouldBuildText(a){return"textarea"!==a&&"input"!==a&&"option"!==a&&"select"!==a}}class aI{static setupStorage(a,b,c,d,e){let f=d.getValue(b,{value:null});switch(c.name){case"textarea":if(null!==f.value&&(a.textContent=f.value),"print"===e)break;a.addEventListener("input",a=>{d.setValue(b,{value:a.target.value})});break;case"input":if("radio"===c.attributes.type||"checkbox"===c.attributes.type){if(f.value===c.attributes.xfaOn?a.setAttribute("checked",!0):f.value===c.attributes.xfaOff&&a.removeAttribute("checked"),"print"===e)break;a.addEventListener("change",a=>{d.setValue(b,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(null!==f.value&&a.setAttribute("value",f.value),"print"===e)break;a.addEventListener("input",a=>{d.setValue(b,{value:a.target.value})})}break;case"select":if(null!==f.value)for(let b of(a.setAttribute("value",f.value),c.children))b.attributes.value===f.value?b.attributes.selected=!0:b.attributes.hasOwnProperty("selected")&&delete b.attributes.selected;a.addEventListener("input",a=>{let c=a.target.options,e=-1===c.selectedIndex?"":c[c.selectedIndex].value;d.setValue(b,{value:e})})}}static setAttributes({html:a,element:b,storage:c=null,intent:d,linkService:e}){let{attributes:f}=b,g=a instanceof HTMLAnchorElement;for(let[b,c]of("radio"===f.type&&(f.name=`${f.name}-${d}`),Object.entries(f)))if(null!=c)switch(b){case"class":c.length&&a.setAttribute(b,c.join(" "));break;case"dataId":break;case"id":a.setAttribute("data-element-id",c);break;case"style":Object.assign(a.style,c);break;case"textContent":a.textContent=c;break;default:g&&("href"===b||"newWindow"===b)||a.setAttribute(b,c)}g&&e.addLinkAttributes(a,f.href,f.newWindow),c&&f.dataId&&this.setupStorage(a,f.dataId,b,c)}static render(a){let b=a.annotationStorage,c=a.linkService,d=a.xfaHtml,e=a.intent||"display",f=document.createElement(d.name);d.attributes&&this.setAttributes({html:f,element:d,intent:e,linkService:c});let g="richText"!==e,h=a.div;if(h.append(f),a.viewport){let b=`matrix(${a.viewport.transform.join(",")})`;h.style.transform=b}g&&h.setAttribute("class","xfaLayer xfaFont");let i=[];if(0===d.children.length){if(d.value){let a=document.createTextNode(d.value);f.append(a),g&&aH.shouldBuildText(d.name)&&i.push(a)}return{textDivs:i}}let j=[[d,-1,f]];for(;j.length>0;){let[a,d,f]=j.at(-1);if(d+1===a.children.length){j.pop();continue}let h=a.children[++j.at(-1)[1]];if(null===h)continue;let{name:k}=h;if("#text"===k){let a=document.createTextNode(h.value);i.push(a),f.append(a);continue}let l=h?.attributes?.xmlns?document.createElementNS(h.attributes.xmlns,k):document.createElement(k);if(f.append(l),h.attributes&&this.setAttributes({html:l,element:h,storage:b,intent:e,linkService:c}),h.children?.length>0)j.push([h,-1,l]);else if(h.value){let a=document.createTextNode(h.value);g&&aH.shouldBuildText(k)&&i.push(a),l.append(a)}}for(let a of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))a.setAttribute("readOnly",!0);return{textDivs:i}}static update(a){let b=`matrix(${a.viewport.transform.join(",")})`;a.div.style.transform=b,a.div.hidden=!1}}let aJ="http://www.w3.org/2000/svg";class aK{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function aL(a,b="text"){if(aT(a,document.baseURI)){let c=await fetch(a);if(!c.ok)throw Error(c.statusText);switch(b){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"json":return c.json()}return c.text()}return new Promise((c,d)=>{let e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType=b,e.onreadystatechange=()=>{if(e.readyState===XMLHttpRequest.DONE){if(200===e.status||0===e.status){switch(b){case"arraybuffer":case"blob":case"json":c(e.response);return}c(e.responseText);return}d(Error(e.statusText))}},e.send(null)})}class aM{constructor({viewBox:a,userUnit:b,scale:c,rotation:d,offsetX:e=0,offsetY:f=0,dontFlip:g=!1}){let h,i,j,k,l,m,n,o;this.viewBox=a,this.userUnit=b,this.scale=c,this.rotation=d,this.offsetX=e,this.offsetY=f,c*=b;const p=(a[2]+a[0])/2,q=(a[3]+a[1])/2;switch((d%=360)<0&&(d+=360),d){case 180:h=-1,i=0,j=0,k=1;break;case 90:h=0,i=1,j=1,k=0;break;case 270:h=0,i=-1,j=-1,k=0;break;case 0:h=1,i=0,j=0,k=-1;break;default:throw Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}g&&(j=-j,k=-k),0===h?(l=Math.abs(q-a[1])*c+e,m=Math.abs(p-a[0])*c+f,n=(a[3]-a[1])*c,o=(a[2]-a[0])*c):(l=Math.abs(p-a[0])*c+e,m=Math.abs(q-a[1])*c+f,n=(a[2]-a[0])*c,o=(a[3]-a[1])*c),this.transform=[h*c,i*c,j*c,k*c,l-h*c*p-j*c*q,m-i*c*p-k*c*q],this.width=n,this.height=o}get rawDims(){let a=this.viewBox;return an(this,"rawDims",{pageWidth:a[2]-a[0],pageHeight:a[3]-a[1],pageX:a[0],pageY:a[1]})}clone({scale:a=this.scale,rotation:b=this.rotation,offsetX:c=this.offsetX,offsetY:d=this.offsetY,dontFlip:e=!1}={}){return new aM({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:a,rotation:b,offsetX:c,offsetY:d,dontFlip:e})}convertToViewportPoint(a,b){let c=[a,b];return az.applyTransform(c,this.transform),c}convertToViewportRectangle(a){let b=[a[0],a[1]];az.applyTransform(b,this.transform);let c=[a[2],a[3]];return az.applyTransform(c,this.transform),[b[0],b[1],c[0],c[1]]}convertToPdfPoint(a,b){let c=[a,b];return az.applyInverseTransform(c,this.transform),c}}class aN extends ao{constructor(a,b=0){super(a,"RenderingCancelledException"),this.extraDelay=b}}function aO(a){let b=a.length,c=0;for(;c<b&&""===a[c].trim();)c++;return"data:"===a.substring(c,c+5).toLowerCase()}function aP(a){return"string"==typeof a&&/\.pdf$/i.test(a)}function aQ(a){return[a]=a.split(/[#?]/,1),a.substring(a.lastIndexOf("/")+1)}function aR(a,b="document.pdf"){if("string"!=typeof a)return b;if(aO(a))return ai('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),b;let c=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(a);if(!c)return b;let d=a=>{try{let b=decodeURIComponent(a);if(b.includes("/")){if((b=b.split("/").at(-1)).test(/^\.pdf$/i))return b;return a}return b}catch{return a}},e=/\.pdf$/i,f=c.pathname.split("/").at(-1);if(e.test(f))return d(f);if(c.searchParams.size>0){for(let a of Array.from(c.searchParams.values()).reverse())if(e.test(a))return d(a);for(let a of Array.from(c.searchParams.keys()).reverse())if(e.test(a))return d(a)}if(c.hash){let a=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(c.hash);if(a)return d(a[0])}return b}class aS{started=Object.create(null);times=[];time(a){a in this.started&&ai(`Timer is already running for ${a}`),this.started[a]=Date.now()}timeEnd(a){a in this.started||ai(`Timer has not been started for ${a}`),this.times.push({name:a,start:this.started[a],end:Date.now()}),delete this.started[a]}toString(){let a=[],b=0;for(let{name:a}of this.times)b=Math.max(a.length,b);for(let{name:c,start:d,end:e}of this.times)a.push(`${c.padEnd(b)} ${e-d}ms
`);return a.join("")}}function aT(a,b){let c=b?URL.parse(a,b):URL.parse(a);return c?.protocol==="http:"||c?.protocol==="https:"}function aU(a){a.preventDefault()}function aV(a){a.preventDefault(),a.stopPropagation()}class aW{static #c;static toDateObject(a){if(a instanceof Date)return a;if(!a||"string"!=typeof a)return null;this.#c||=RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let b=this.#c.exec(a);if(!b)return null;let c=parseInt(b[1],10),d=parseInt(b[2],10);d=d>=1&&d<=12?d-1:0;let e=parseInt(b[3],10);e=e>=1&&e<=31?e:1;let f=parseInt(b[4],10);f=f>=0&&f<=23?f:0;let g=parseInt(b[5],10);g=g>=0&&g<=59?g:0;let h=parseInt(b[6],10);h=h>=0&&h<=59?h:0;let i=b[7]||"Z",j=parseInt(b[8],10);j=j>=0&&j<=23?j:0;let k=parseInt(b[9],10)||0;return k=k>=0&&k<=59?k:0,"-"===i?(f+=j,g+=k):"+"===i&&(f-=j,g-=k),new Date(Date.UTC(c,d,e,f,g,h))}}function aX(a,{scale:b=1,rotation:c=0}){let{width:d,height:e}=a.attributes.style;return new aM({viewBox:[0,0,parseInt(d),parseInt(e)],userUnit:1,scale:b,rotation:c})}function aY(a){if(a.startsWith("#")){let b=parseInt(a.slice(1),16);return[(0xff0000&b)>>16,(65280&b)>>8,255&b]}return a.startsWith("rgb(")?a.slice(4,-1).split(",").map(a=>parseInt(a)):a.startsWith("rgba(")?a.slice(5,-1).split(",").map(a=>parseInt(a)).slice(0,3):(ai(`Not a valid color format: "${a}"`),[0,0,0])}function aZ(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=a.getTransform();return[b,c,d,e,f,g]}function a$(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=a.getTransform().invertSelf();return[b,c,d,e,f,g]}function a_(a,b,c=!1,d=!0){if(b instanceof aM){let{pageWidth:d,pageHeight:e}=b.rawDims,{style:f}=a,g=ax.isCSSRoundSupported,h=`var(--total-scale-factor) * ${d}px`,i=`var(--total-scale-factor) * ${e}px`,j=g?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,k=g?`round(down, ${i}, var(--scale-round-y))`:`calc(${i})`;c&&b.rotation%180!=0?(f.width=k,f.height=j):(f.width=j,f.height=k)}d&&a.setAttribute("data-main-rotation",b.rotation)}class a0{constructor(){const{pixelRatio:a}=a0;this.sx=a,this.sy=a}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(a,b,c,d,e=-1){let f=1/0,g=1/0,h=1/0;(c=a0.capPixels(c,e))>0&&(f=Math.sqrt(c/(a*b))),-1!==d&&(g=d/a,h=d/b);let i=Math.min(f,g,h);return(this.sx>i||this.sy>i)&&(this.sx=i,this.sy=i,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(a,b){if(b>=0){let c=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+b/100));return a>0?Math.min(a,c):c}return a}}let a1=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class a2{static get isDarkMode(){return an(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class a3{static get commentForegroundColor(){let a=document.createElement("span");a.classList.add("comment","sidebar");let{style:b}=a;b.width=b.height="0",b.display="none",b.color="var(--comment-fg-color)",document.body.append(a);let{color:c}=window.getComputedStyle(a);return a.remove(),an(this,"commentForegroundColor",aY(c))}}function a4(a,b,c,d){let e=255*(1-(d=Math.min(Math.max(d??1,0),1)));return[a=Math.round(a*d+e),b=Math.round(b*d+e),c=Math.round(c*d+e)]}function a5(a,b){let c=a[0]/255,d=a[1]/255,e=a[2]/255,f=Math.max(c,d,e),g=Math.min(c,d,e),h=(f+g)/2;if(f===g)b[0]=b[1]=0;else{let a=f-g;switch(b[1]=h<.5?a/(f+g):a/(2-f-g),f){case c:b[0]=((d-e)/a+6*(d<e))*60;break;case d:b[0]=((e-c)/a+2)*60;break;case e:b[0]=((c-d)/a+4)*60}}b[2]=h}function a6(a,b){let c=a[0],d=a[1],e=a[2],f=(1-Math.abs(2*e-1))*d,g=f*(1-Math.abs(c/60%2-1)),h=e-f/2;switch(Math.floor(c/60)){case 0:b[0]=f+h,b[1]=g+h,b[2]=h;break;case 1:b[0]=g+h,b[1]=f+h,b[2]=h;break;case 2:b[0]=h,b[1]=f+h,b[2]=g+h;break;case 3:b[0]=h,b[1]=g+h,b[2]=f+h;break;case 4:b[0]=g+h,b[1]=h,b[2]=f+h;break;case 5:case 6:b[0]=f+h,b[1]=h,b[2]=g+h}}function a7(a){return a<=.03928?a/12.92:((a+.055)/1.055)**2.4}function a8(a,b,c){a6(a,c),c.map(a7);let d=.2126*c[0]+.7152*c[1]+.0722*c[2];a6(b,c),c.map(a7);let e=.2126*c[0]+.7152*c[1]+.0722*c[2];return d>e?(d+.05)/(e+.05):(e+.05)/(d+.05)}let a9=new Map;function ba(a,b){let c=a[0]+256*a[1]+65536*a[2]+0x1000000*b[0]+0x100000000*b[1]+0x10000000000*b[2],d=a9.get(c);if(d)return d;let e=new Float32Array(9),f=e.subarray(0,3),g=e.subarray(3,6);a5(a,g);let h=e.subarray(6,9);a5(b,h);let i=h[2]<.5,j=i?12:4.5;if(g[2]=i?Math.sqrt(g[2]):1-Math.sqrt(1-g[2]),a8(g,h,f)<j){let a,b;for(i?(a=g[2],b=1):(a=0,b=g[2]);b-a>.005;){let c=g[2]=(a+b)/2;i===a8(g,h,f)<j?a=c:b=c}g[2]=i?b:a}return a6(g,f),d=az.makeHexColor(Math.round(255*f[0]),Math.round(255*f[1]),Math.round(255*f[2])),a9.set(c,d),d}function bb({html:a,dir:b,className:c},d){let e=document.createDocumentFragment();if("string"==typeof a){let c=document.createElement("p");c.dir=b||"auto";let d=a.split(/(?:\r\n?|\n)/);for(let a=0,b=d.length;a<b;++a){let e=d[a];c.append(document.createTextNode(e)),a<b-1&&c.append(document.createElement("br"))}e.append(c)}else aI.render({xfaHtml:a,div:e,intent:"richText"});e.firstChild.classList.add("richText",c),d.append(e)}class bc{#d=null;#e=null;#f;#g=null;#h=null;#i=null;#j=null;#k=null;static #l=null;constructor(a){this.#f=a,bc.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){let a=this.#d=document.createElement("div");a.classList.add("editToolbar","hidden"),a.setAttribute("role","toolbar");let b=this.#f._uiManager._signal;b instanceof AbortSignal&&!b.aborted&&(a.addEventListener("contextmenu",aU,{signal:b}),a.addEventListener("pointerdown",bc.#m,{signal:b}));let c=this.#g=document.createElement("div");c.className="buttons",a.append(c);let d=this.#f.toolbarPosition;if(d){let{style:b}=a,c="ltr"===this.#f._uiManager.direction?1-d[0]:d[0];b.insetInlineEnd=`${100*c}%`,b.top=`calc(${100*d[1]}% + var(--editor-toolbar-vert-offset))`}return a}get div(){return this.#d}static #m(a){a.stopPropagation()}#n(a){this.#f._focusEventsAllowed=!1,aV(a)}#o(a){this.#f._focusEventsAllowed=!0,aV(a)}#p(a){let b=this.#f._uiManager._signal;return b instanceof AbortSignal&&!b.aborted&&(a.addEventListener("focusin",this.#n.bind(this),{capture:!0,signal:b}),a.addEventListener("focusout",this.#o.bind(this),{capture:!0,signal:b}),a.addEventListener("contextmenu",aU,{signal:b}),!0)}hide(){this.#d.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#d.classList.remove("hidden"),this.#h?.shown(),this.#i?.shown()}addDeleteButton(){let{editorType:a,_uiManager:b}=this.#f,c=document.createElement("button");c.classList.add("basic","deleteButton"),c.tabIndex=0,c.setAttribute("data-l10n-id",bc.#l[a]),this.#p(c)&&c.addEventListener("click",a=>{b.delete()},{signal:b._signal}),this.#g.append(c)}get #q(){let a=document.createElement("div");return a.className="divider",a}async addAltText(a){let b=await a.render();this.#p(b),this.#g.append(b,this.#q),this.#h=a}addComment(a,b=null){if(this.#i)return;let c=a.renderForToolbar();if(!c)return;this.#p(c);let d=this.#j=this.#q;b?(this.#g.insertBefore(c,b),this.#g.insertBefore(d,b)):this.#g.append(c,d),this.#i=a,a.toolbar=this}addColorPicker(a){if(this.#e)return;this.#e=a;let b=a.renderButton();this.#p(b),this.#g.append(b,this.#q)}async addEditSignatureButton(a){let b=this.#k=await a.renderEditButton(this.#f);this.#p(b),this.#g.append(b,this.#q)}removeButton(a){"comment"===a&&(this.#i?.removeToolbarCommentButton(),this.#i=null,this.#j?.remove(),this.#j=null)}async addButton(a,b){switch(a){case"colorPicker":this.addColorPicker(b);break;case"altText":await this.addAltText(b);break;case"editSignature":await this.addEditSignatureButton(b);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(b)}}async addButtonBefore(a,b,c){let d=this.#g.querySelector(c);d&&"comment"===a&&this.addComment(b,d)}updateEditSignatureButton(a){this.#k&&(this.#k.title=a)}remove(){this.#d.remove(),this.#e?.destroy(),this.#e=null}}class bd{#g=null;#d=null;#r;constructor(a){this.#r=a}#s(){let a=this.#d=document.createElement("div");a.className="editToolbar",a.setAttribute("role","toolbar");let b=this.#r._signal;b instanceof AbortSignal&&!b.aborted&&a.addEventListener("contextmenu",aU,{signal:b});let c=this.#g=document.createElement("div");return c.className="buttons",a.append(c),this.#r.hasCommentManager()&&this.#t("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#r.commentSelection("floating_button")}),this.#t("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#r.highlightSelection("floating_button")}),a}#u(a,b){let c=0,d=0;for(let e of a){let a=e.y+e.height;if(a<c)continue;let f=e.x+(b?e.width:0);if(a>c){d=f,c=a;continue}b?f>d&&(d=f):f<d&&(d=f)}return[b?1-d:d,c]}show(a,b,c){let[d,e]=this.#u(b,c),{style:f}=this.#d||=this.#s();a.append(this.#d),f.insetInlineEnd=`${100*d}%`,f.top=`calc(${100*e}% + var(--editor-toolbar-vert-offset))`}hide(){this.#d.remove()}#t(a,b,c,d){let e=document.createElement("button");e.classList.add("basic",a),e.tabIndex=0,e.setAttribute("data-l10n-id",b);let f=document.createElement("span");e.append(f),f.className="visuallyHidden",f.setAttribute("data-l10n-id",c);let g=this.#r._signal;g instanceof AbortSignal&&!g.aborted&&(e.addEventListener("contextmenu",aU,{signal:g}),e.addEventListener("click",d,{signal:g})),this.#g.append(e)}}function be(a,b,c){for(let d of c)b.addEventListener(d,a[d].bind(a))}class bf{#v=0;get id(){return`${Z}${this.#v++}`}}class bg{#w=aD();#v=0;#x=null;static get _isSVGFittingCanvas(){let a=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),b=new Image;return b.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',an(this,"_isSVGFittingCanvas",b.decode().then(()=>(a.drawImage(b,0,0,1,1,0,0,1,3),0===new Uint32Array(a.getImageData(0,0,1,1).data.buffer)[0])))}async #y(a,b){this.#x||=new Map;let c=this.#x.get(a);if(null===c)return null;if(c?.bitmap)return c.refCounter+=1,c;try{let a;if(c||={bitmap:null,id:`image_${this.#w}_${this.#v++}`,refCounter:0,isSvg:!1},"string"==typeof b?(c.url=b,a=await aL(b,"blob")):b instanceof File?a=c.file=b:b instanceof Blob&&(a=b),"image/svg+xml"===a.type){let b=bg._isSVGFittingCanvas,d=new FileReader,e=new Image,f=new Promise((a,f)=>{e.onload=()=>{c.bitmap=e,c.isSvg=!0,a()},d.onload=async()=>{let a=c.svgUrl=d.result;e.src=await b?`${a}#svgView(preserveAspectRatio(none))`:a},e.onerror=d.onerror=f});d.readAsDataURL(a),await f}else c.bitmap=await createImageBitmap(a);c.refCounter=1}catch(a){ai(a),c=null}return this.#x.set(a,c),c&&this.#x.set(c.id,c),c}async getFromFile(a){let{lastModified:b,name:c,size:d,type:e}=a;return this.#y(`${b}_${c}_${d}_${e}`,a)}async getFromUrl(a){return this.#y(a,a)}async getFromBlob(a,b){let c=await b;return this.#y(a,c)}async getFromId(a){this.#x||=new Map;let b=this.#x.get(a);if(!b)return null;if(b.bitmap)return b.refCounter+=1,b;if(b.file)return this.getFromFile(b.file);if(b.blobPromise){let{blobPromise:a}=b;return delete b.blobPromise,this.getFromBlob(b.id,a)}return this.getFromUrl(b.url)}getFromCanvas(a,b){this.#x||=new Map;let c=this.#x.get(a);if(c?.bitmap)return c.refCounter+=1,c;let d=new OffscreenCanvas(b.width,b.height);return d.getContext("2d").drawImage(b,0,0),c={bitmap:d.transferToImageBitmap(),id:`image_${this.#w}_${this.#v++}`,refCounter:1,isSvg:!1},this.#x.set(a,c),this.#x.set(c.id,c),c}getSvgUrl(a){let b=this.#x.get(a);return b?.isSvg?b.svgUrl:null}deleteId(a){this.#x||=new Map;let b=this.#x.get(a);if(!b||(b.refCounter-=1,0!==b.refCounter))return;let{bitmap:c}=b;if(!b.url&&!b.file){let a=new OffscreenCanvas(c.width,c.height);a.getContext("bitmaprenderer").transferFromImageBitmap(c),b.blobPromise=a.convertToBlob()}c.close?.(),b.bitmap=null}isValidId(a){return a.startsWith(`image_${this.#w}_`)}}class bh{#z=[];#A=!1;#B;#C=-1;constructor(a=128){this.#B=a}add({cmd:a,undo:b,post:c,mustExec:d,type:e=NaN,overwriteIfSameType:f=!1,keepUndo:g=!1}){if(d&&a(),this.#A)return;let h={cmd:a,undo:b,post:c,type:e};if(-1===this.#C){this.#z.length>0&&(this.#z.length=0),this.#C=0,this.#z.push(h);return}if(f&&this.#z[this.#C].type===e){g&&(h.undo=this.#z[this.#C].undo),this.#z[this.#C]=h;return}let i=this.#C+1;i===this.#B?this.#z.splice(0,1):(this.#C=i,i<this.#z.length&&this.#z.splice(i)),this.#z.push(h)}undo(){if(-1===this.#C)return;this.#A=!0;let{undo:a,post:b}=this.#z[this.#C];a(),b?.(),this.#A=!1,this.#C-=1}redo(){if(this.#C<this.#z.length-1){this.#C+=1,this.#A=!0;let{cmd:a,post:b}=this.#z[this.#C];a(),b?.(),this.#A=!1}}hasSomethingToUndo(){return -1!==this.#C}hasSomethingToRedo(){return this.#C<this.#z.length-1}cleanType(a){if(-1!==this.#C){for(let b=this.#C;b>=0;b--)if(this.#z[b].type!==a){this.#z.splice(b+1,this.#C-b),this.#C=b;return}this.#z.length=0,this.#C=-1}}destroy(){this.#z=null}}class bi{constructor(a){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:b}=ax.platform;for(const[c,d,e={}]of a)for(const a of c){const c=a.startsWith("mac+");b&&c?(this.callbacks.set(a.slice(4),{callback:d,options:e}),this.allKeys.add(a.split("+").at(-1))):b||c||(this.callbacks.set(a,{callback:d,options:e}),this.allKeys.add(a.split("+").at(-1)))}}#D(a){a.altKey&&this.buffer.push("alt"),a.ctrlKey&&this.buffer.push("ctrl"),a.metaKey&&this.buffer.push("meta"),a.shiftKey&&this.buffer.push("shift"),this.buffer.push(a.key);let b=this.buffer.join("+");return this.buffer.length=0,b}exec(a,b){if(!this.allKeys.has(b.key))return;let c=this.callbacks.get(this.#D(b));if(!c)return;let{callback:d,options:{bubbles:e=!1,args:f=[],checker:g=null}}=c;(!g||g(a,b))&&(d.bind(a,...f,b)(),e||aV(b))}}class bj{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let a=new Map([["CanvasText",null],["Canvas",null]]),b=document.createElement("span");for(let c of(b.style.visibility="hidden",b.style.colorScheme="only light",document.body.append(b),a.keys())){b.style.color=c;let d=window.getComputedStyle(b).color;a.set(c,aY(d))}return b.remove(),an(this,"_colors",a)}convert(a){let b=aY(a);if(!window.matchMedia("(forced-colors: active)").matches)return b;for(let[a,c]of this._colors)if(c.every((a,c)=>a===b[c]))return bj._colorsMapping.get(a);return b}getHexCode(a){let b=this._colors.get(a);return b?az.makeHexColor(...b):a}}class bk{#E=new AbortController;#F=null;#G=null;#H=new Map;#I=new Map;#J=null;#K=null;#L=null;#M=new bh;#N=null;#O=null;#P=null;#Q=0;#R=new Set;#S=null;#T=null;#U=new Set;_editorUndoBar=null;#V=!1;#W=!1;#X=!1;#Y=null;#Z=null;#$=null;#_=null;#aa=!1;#ab=null;#ac=new bf;#ad=!1;#ae=!1;#af=!1;#ag=null;#ah=null;#ai=null;#aj=null;#ak=null;#al=$.NONE;#am=new Set;#an=null;#ao=null;#ap=null;#aq=null;#ar=null;#as={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#at=[0,0];#au=null;#av=null;#aw=null;#ax=null;#ay=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let a=bk.prototype,b=a=>a.#av.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&a.hasSomethingToControl(),c=(a,{target:b})=>{if(b instanceof HTMLInputElement){let{type:a}=b;return"text"!==a&&"number"!==a}return!0},d=this.TRANSLATE_SMALL,e=this.TRANSLATE_BIG;return an(this,"_keyboardManager",new bi([[["ctrl+a","mac+meta+a"],a.selectAll,{checker:c}],[["ctrl+z","mac+meta+z"],a.undo,{checker:c}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],a.redo,{checker:c}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],a.delete,{checker:c}],[["Enter","mac+Enter"],a.addNewEditorFromKeyboard,{checker:(a,{target:b})=>!(b instanceof HTMLButtonElement)&&a.#av.contains(b)&&!a.isEnterHandled}],[[" ","mac+ "],a.addNewEditorFromKeyboard,{checker:(a,{target:b})=>!(b instanceof HTMLButtonElement)&&a.#av.contains(document.activeElement)}],[["Escape","mac+Escape"],a.unselectAll],[["ArrowLeft","mac+ArrowLeft"],a.translateSelectedEditors,{args:[-d,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a.translateSelectedEditors,{args:[-e,0],checker:b}],[["ArrowRight","mac+ArrowRight"],a.translateSelectedEditors,{args:[d,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a.translateSelectedEditors,{args:[e,0],checker:b}],[["ArrowUp","mac+ArrowUp"],a.translateSelectedEditors,{args:[0,-d],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a.translateSelectedEditors,{args:[0,-e],checker:b}],[["ArrowDown","mac+ArrowDown"],a.translateSelectedEditors,{args:[0,d],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a.translateSelectedEditors,{args:[0,e],checker:b}]]))}constructor(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){const q=this._signal=this.#E.signal;this.#av=a,this.#aw=b,this.#ax=c,this.#J=d,this.#N=e,this.#ao=f,this.#ar=h,this._eventBus=g,g._on("editingaction",this.onEditingAction.bind(this),{signal:q}),g._on("pagechanging",this.onPageChanging.bind(this),{signal:q}),g._on("scalechanging",this.onScaleChanging.bind(this),{signal:q}),g._on("rotationchanging",this.onRotationChanging.bind(this),{signal:q}),g._on("setpreference",this.onSetPreference.bind(this),{signal:q}),g._on("switchannotationeditorparams",a=>this.updateParams(a.type,a.value),{signal:q}),window.addEventListener("pointerdown",()=>{this.#ae=!0},{capture:!0,signal:q}),window.addEventListener("pointerup",()=>{this.#ae=!1},{capture:!0,signal:q}),this.#az(),this.#aA(),this.#aB(),this.#K=h.annotationStorage,this.#Y=h.filterFactory,this.#ap=i,this.#_=j||null,this.#V=k,this.#W=l,this.#X=m,this.#ak=n||null,this.viewParameters={realScale:aK.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=o||null,this._supportsPinchToZoom=!1!==p,e?.setSidebarUiManager(this)}destroy(){for(let a of(this.#ay?.resolve(),this.#ay=null,this.#E?.abort(),this.#E=null,this._signal=null,this.#I.values()))a.destroy();this.#I.clear(),this.#H.clear(),this.#U.clear(),this.#aj?.clear(),this.#F=null,this.#am.clear(),this.#M.destroy(),this.#J?.destroy(),this.#N?.destroy(),this.#ao?.destroy(),this.#ab?.hide(),this.#ab=null,this.#ai?.destroy(),this.#ai=null,this.#G=null,this.#Z&&(clearTimeout(this.#Z),this.#Z=null),this.#au&&(clearTimeout(this.#au),this.#au=null),this._editorUndoBar?.destroy(),this.#ar=null}combinedSignal(a){return AbortSignal.any([this._signal,a.signal])}get mlManager(){return this.#ak}get useNewAltTextFlow(){return this.#W}get useNewAltTextWhenAddingImage(){return this.#X}get hcmFilter(){return an(this,"hcmFilter",this.#ap?this.#Y.addHCMFilter(this.#ap.foreground,this.#ap.background):"none")}get direction(){return an(this,"direction",getComputedStyle(this.#av).direction)}get _highlightColors(){return an(this,"_highlightColors",this.#_?new Map(this.#_.split(",").map(a=>((a=a.split("=").map(a=>a.trim()))[1]=a[1].toUpperCase(),a))):null)}get highlightColors(){let{_highlightColors:a}=this;if(!a)return an(this,"highlightColors",null);let b=new Map,c=!!this.#ap;for(let[d,e]of a){let a=d.endsWith("_HCM");if(c&&a){b.set(d.replace("_HCM",""),e);continue}c||a||b.set(d,e)}return an(this,"highlightColors",b)}get highlightColorNames(){return an(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,a=>a.reverse())):null)}getNonHCMColor(a){if(!this._highlightColors)return a;let b=this.highlightColorNames.get(a);return this._highlightColors.get(b)||a}getNonHCMColorName(a){return this.highlightColorNames.get(a)||a}setCurrentDrawingSession(a){a?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#P=a}setMainHighlightColorPicker(a){this.#ai=a}editAltText(a,b=!1){this.#J?.editAltText(this,a,b)}hasCommentManager(){return!!this.#N}editComment(a,b,c,d){this.#N?.showDialog(this,a,b,c,d)}selectComment(a,b){let c=this.#I.get(a),d=c?.getEditorByUID(b);d?.toggleComment(!0,!0)}updateComment(a){this.#N?.updateComment(a.getData())}updatePopupColor(a){this.#N?.updatePopupColor(a)}removeComment(a){this.#N?.removeComments([a.uid])}toggleComment(a,b,c){this.#N?.toggleCommentPopup(a,b,c)}makeCommentColor(a,b){return a&&this.#N?.makeCommentColor(a,b)||null}getCommentDialogElement(){return this.#N?.dialogElement||null}async waitForEditorsRendered(a){if(this.#I.has(a-1))return;let{resolve:b,promise:c}=Promise.withResolvers(),d=c=>{c.pageNumber===a&&(this._eventBus._off("editorsrendered",d),b())};this._eventBus.on("editorsrendered",d),await c}getSignature(a){this.#ao?.getSignature({uiManager:this,editor:a})}get signatureManager(){return this.#ao}switchToMode(a,b){this._eventBus.on("annotationeditormodechanged",b,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:a})}setPreference(a,b){this._eventBus.dispatch("setpreference",{source:this,name:a,value:b})}onSetPreference({name:a,value:b}){"enableNewAltTextWhenAddingImage"===a&&(this.#X=b)}onPageChanging({pageNumber:a}){this.#Q=a-1}focusMainContainer(){this.#av.focus()}findParent(a,b){for(let c of this.#I.values()){let{x:d,y:e,width:f,height:g}=c.div.getBoundingClientRect();if(a>=d&&a<=d+f&&b>=e&&b<=e+g)return c}return null}disableUserSelect(a=!1){this.#aw.classList.toggle("noUserSelect",a)}addShouldRescale(a){this.#U.add(a)}removeShouldRescale(a){this.#U.delete(a)}onScaleChanging({scale:a}){for(let b of(this.commitOrRemove(),this.viewParameters.realScale=a*aK.PDF_TO_CSS_UNITS,this.#U))b.onScaleChanging();this.#P?.onScaleChanging()}onRotationChanging({pagesRotation:a}){this.commitOrRemove(),this.viewParameters.rotation=a}#aC({anchorNode:a}){return a.nodeType===Node.TEXT_NODE?a.parentElement:a}#aD(a){let{currentLayer:b}=this;if(b.hasTextLayer(a))return b;for(let b of this.#I.values())if(b.hasTextLayer(a))return b;return null}highlightSelection(a="",b=!1){let c=document.getSelection();if(!c||c.isCollapsed)return;let{anchorNode:d,anchorOffset:e,focusNode:f,focusOffset:g}=c,h=c.toString(),i=this.#aC(c).closest(".textLayer"),j=this.getSelectionBoxes(i);if(!j)return;c.empty();let k=this.#aD(i),l=this.#al===$.NONE,m=()=>{let c=k?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:a,boxes:j,anchorNode:d,anchorOffset:e,focusNode:f,focusOffset:g,text:h});l&&this.showAllEditors("highlight",!0,!0),b&&c?.editComment()};l?this.switchToMode($.HIGHLIGHT,m):m()}commentSelection(a=""){this.highlightSelection(a,!0)}#aE(){let a=document.getSelection();if(!a||a.isCollapsed)return;let b=this.#aC(a).closest(".textLayer"),c=this.getSelectionBoxes(b);c&&(this.#ab||=new bd(this),this.#ab.show(b,c,"ltr"===this.direction))}getAndRemoveDataFromAnnotationStorage(a){if(!this.#K)return null;let b=`${Z}${a}`,c=this.#K.getRawValue(b);return c&&this.#K.remove(b),c}addToAnnotationStorage(a){a.isEmpty()||!this.#K||this.#K.has(a.id)||this.#K.setValue(a.id,a)}a11yAlert(a,b=null){let c=this.#ax;c&&(c.setAttribute("data-l10n-id",a),b?c.setAttribute("data-l10n-args",JSON.stringify(b)):c.removeAttribute("data-l10n-args"))}#aF(){let a=document.getSelection();if(!a||a.isCollapsed){this.#an&&(this.#ab?.hide(),this.#an=null,this.#aG({hasSelectedText:!1}));return}let{anchorNode:b}=a;if(b===this.#an)return;let c=this.#aC(a).closest(".textLayer");if(!c){this.#an&&(this.#ab?.hide(),this.#an=null,this.#aG({hasSelectedText:!1}));return}if(this.#ab?.hide(),this.#an=b,this.#aG({hasSelectedText:!0}),(this.#al===$.HIGHLIGHT||this.#al===$.NONE)&&(this.#al===$.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#aa=this.isShiftKeyDown,!this.isShiftKeyDown)){let a=this.#al===$.HIGHLIGHT?this.#aD(c):null;if(a?.toggleDrawing(),this.#ae){let b=new AbortController,c=this.combinedSignal(b),d=c=>{("pointerup"!==c.type||0===c.button)&&(b.abort(),a?.toggleDrawing(!0),"pointerup"===c.type&&this.#aH("main_toolbar"))};window.addEventListener("pointerup",d,{signal:c}),window.addEventListener("blur",d,{signal:c})}else a?.toggleDrawing(!0),this.#aH("main_toolbar")}}#aH(a=""){this.#al===$.HIGHLIGHT?this.highlightSelection(a):this.#V&&this.#aE()}#az(){document.addEventListener("selectionchange",this.#aF.bind(this),{signal:this._signal})}#aI(){if(this.#$)return;this.#$=new AbortController;let a=this.combinedSignal(this.#$);window.addEventListener("focus",this.focus.bind(this),{signal:a}),window.addEventListener("blur",this.blur.bind(this),{signal:a})}#aJ(){this.#$?.abort(),this.#$=null}blur(){if(this.isShiftKeyDown=!1,this.#aa&&(this.#aa=!1,this.#aH("main_toolbar")),!this.hasSelection)return;let{activeElement:a}=document;for(let b of this.#am)if(b.div.contains(a)){this.#ah=[b,a],b._focusEventsAllowed=!1;break}}focus(){if(!this.#ah)return;let[a,b]=this.#ah;this.#ah=null,b.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0,signal:this._signal}),b.focus()}#aB(){if(this.#ag)return;this.#ag=new AbortController;let a=this.combinedSignal(this.#ag);window.addEventListener("keydown",this.keydown.bind(this),{signal:a}),window.addEventListener("keyup",this.keyup.bind(this),{signal:a})}#aK(){this.#ag?.abort(),this.#ag=null}#aL(){if(this.#O)return;this.#O=new AbortController;let a=this.combinedSignal(this.#O);document.addEventListener("copy",this.copy.bind(this),{signal:a}),document.addEventListener("cut",this.cut.bind(this),{signal:a}),document.addEventListener("paste",this.paste.bind(this),{signal:a})}#aM(){this.#O?.abort(),this.#O=null}#aA(){let a=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:a}),document.addEventListener("drop",this.drop.bind(this),{signal:a})}addEditListeners(){this.#aB(),this.#aL()}removeEditListeners(){this.#aK(),this.#aM()}dragOver(a){for(let{type:b}of a.dataTransfer.items)for(let c of this.#T)if(c.isHandlingMimeForPasting(b)){a.dataTransfer.dropEffect="copy",a.preventDefault();return}}drop(a){for(let b of a.dataTransfer.items)for(let c of this.#T)if(c.isHandlingMimeForPasting(b.type)){c.paste(b,this.currentLayer),a.preventDefault();return}}copy(a){if(a.preventDefault(),this.#F?.commitOrRemove(),!this.hasSelection)return;let b=[];for(let a of this.#am){let c=a.serialize(!0);c&&b.push(c)}0!==b.length&&a.clipboardData.setData("application/pdfjs",JSON.stringify(b))}cut(a){this.copy(a),this.delete()}async paste(a){a.preventDefault();let{clipboardData:b}=a;for(let a of b.items)for(let b of this.#T)if(b.isHandlingMimeForPasting(a.type))return void b.paste(a,this.currentLayer);let c=b.getData("application/pdfjs");if(!c)return;try{c=JSON.parse(c)}catch(a){ai(`paste: "${a.message}".`);return}if(!Array.isArray(c))return;this.unselectAll();let d=this.currentLayer;try{let a=[];for(let b of c){let c=await d.deserialize(b);if(!c)return;a.push(c)}let b=()=>{for(let b of a)this.#aN(b);this.#aO(a)};this.addCommands({cmd:b,undo:()=>{for(let b of a)b.remove()},mustExec:!0})}catch(a){ai(`paste: "${a.message}".`)}}keydown(a){this.isShiftKeyDown||"Shift"!==a.key||(this.isShiftKeyDown=!0),this.#al===$.NONE||this.isEditorHandlingKeyboard||bk._keyboardManager.exec(this,a)}keyup(a){this.isShiftKeyDown&&"Shift"===a.key&&(this.isShiftKeyDown=!1,this.#aa&&(this.#aa=!1,this.#aH("main_toolbar")))}onEditingAction({name:a}){switch(a){case"undo":case"redo":case"delete":case"selectAll":this[a]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu")}}#aG(a){Object.entries(a).some(([a,b])=>this.#as[a]!==b)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#as,a)}),this.#al===$.HIGHLIGHT&&!1===a.hasSelectedEditor&&this.#aP([[_.HIGHLIGHT_FREE,!0]]))}#aP(a){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:a})}setEditingState(a){a?(this.#aI(),this.#aL(),this.#aG({isEditing:this.#al!==$.NONE,isEmpty:this.#aQ(),hasSomethingToUndo:this.#M.hasSomethingToUndo(),hasSomethingToRedo:this.#M.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#aJ(),this.#aM(),this.#aG({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(a){if(!this.#T)for(let b of(this.#T=a,this.#T))this.#aP(b.defaultPropertiesToUpdate)}getId(){return this.#ac.id}get currentLayer(){return this.#I.get(this.#Q)}getLayer(a){return this.#I.get(a)}get currentPageIndex(){return this.#Q}addLayer(a){this.#I.set(a.pageIndex,a),this.#ad?a.enable():a.disable()}removeLayer(a){this.#I.delete(a.pageIndex)}async updateMode(a,b=null,c=!1,d=!1,e=!1){if(this.#al!==a&&(!this.#ay||(await this.#ay.promise,this.#ay))){if(this.#ay=Promise.withResolvers(),this.#P?.commitOrRemove(),this.#al===$.POPUP&&this.#N?.hideSidebar(),this.#N?.destroyPopup(),this.#al=a,a===$.NONE){for(let a of(this.setEditingState(!1),this.#aR(),this.#H.values()))a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#ay.resolve();return}for(let a of this.#H.values())a.addStandaloneCommentButton();for(let b of(a===$.SIGNATURE&&await this.#ao?.loadSignatures(),this.setEditingState(!0),await this.#aS(),this.unselectAll(),this.#I.values()))b.updateMode(a);if(a===$.POPUP){this.#G||=await this.#ar.getAnnotationsByType(new Set(this.#T.map(a=>a._editorType)));let a=new Set,b=[];for(let c of this.#H.values()){let{annotationElementId:d,hasComment:e,deleted:f}=c;d&&a.add(d),e&&!f&&b.push(c.getData())}for(let c of this.#G){let{id:d,popupRef:e,contentsObj:f}=c;e&&f?.str&&!a.has(d)&&!this.#R.has(d)&&b.push(c)}this.#N?.showSidebar(b)}if(!b){c&&this.addNewEditorFromKeyboard(),this.#ay.resolve();return}for(let a of this.#H.values())a.uid===b?(this.setSelected(a),e?a.editComment():d?a.enterInEditMode():a.focus()):a.unselect();this.#ay.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(a){a.mode!==this.#al&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...a})}updateParams(a,b){if(this.#T){switch(a){case _.CREATE:this.currentLayer.addNewEditor(b);return;case _.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#aq||=new Map).set(a,b),this.showAllEditors("highlight",b)}if(this.hasSelection)for(let c of this.#am)c.updateParams(a,b);else for(let c of this.#T)c.updateDefaultParams(a,b)}}showAllEditors(a,b,c=!1){for(let c of this.#H.values())c.editorType===a&&c.show(b);(this.#aq?.get(_.HIGHLIGHT_SHOW_ALL)??!0)!==b&&this.#aP([[_.HIGHLIGHT_SHOW_ALL,b]])}enableWaiting(a=!1){if(this.#af!==a)for(let b of(this.#af=a,this.#I.values()))a?b.disableClick():b.enableClick(),b.div.classList.toggle("waiting",a)}async #aS(){if(!this.#ad){this.#ad=!0;let a=[];for(let b of this.#I.values())a.push(b.enable());for(let b of(await Promise.all(a),this.#H.values()))b.enable()}}#aR(){if(this.unselectAll(),this.#ad){for(let a of(this.#ad=!1,this.#I.values()))a.disable();for(let a of this.#H.values())a.disable()}}*getEditors(a){for(let b of this.#H.values())b.pageIndex===a&&(yield b)}getEditor(a){return this.#H.get(a)}addEditor(a){this.#H.set(a.id,a)}removeEditor(a){a.div.contains(document.activeElement)&&(this.#Z&&clearTimeout(this.#Z),this.#Z=setTimeout(()=>{this.focusMainContainer(),this.#Z=null},0)),this.#H.delete(a.id),a.annotationElementId&&this.#aj?.delete(a.annotationElementId),this.unselect(a),a.annotationElementId&&this.#R.has(a.annotationElementId)||this.#K?.remove(a.id)}addDeletedAnnotationElement(a){this.#R.add(a.annotationElementId),this.addChangedExistingAnnotation(a),a.deleted=!0}isDeletedAnnotationElement(a){return this.#R.has(a)}removeDeletedAnnotationElement(a){this.#R.delete(a.annotationElementId),this.removeChangedExistingAnnotation(a),a.deleted=!1}#aN(a){let b=this.#I.get(a.pageIndex);b?b.addOrRebuild(a):(this.addEditor(a),this.addToAnnotationStorage(a))}setActiveEditor(a){this.#F!==a&&(this.#F=a,a&&this.#aP(a.propertiesToUpdate))}get #aT(){let a=null;for(a of this.#am);return a}updateUI(a){this.#aT===a&&this.#aP(a.propertiesToUpdate)}updateUIForDefaultProperties(a){this.#aP(a.defaultPropertiesToUpdate)}toggleSelected(a){if(this.#am.has(a)){this.#am.delete(a),a.unselect(),this.#aG({hasSelectedEditor:this.hasSelection});return}this.#am.add(a),a.select(),this.#aP(a.propertiesToUpdate),this.#aG({hasSelectedEditor:!0})}setSelected(a){for(let b of(this.updateToolbar({mode:a.mode,editId:a.id}),this.#P?.commitOrRemove(),this.#am))b!==a&&b.unselect();this.#am.clear(),this.#am.add(a),a.select(),this.#aP(a.propertiesToUpdate),this.#aG({hasSelectedEditor:!0})}isSelected(a){return this.#am.has(a)}get firstSelectedEditor(){return this.#am.values().next().value}unselect(a){a.unselect(),this.#am.delete(a),this.#aG({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#am.size}get isEnterHandled(){return 1===this.#am.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#M.undo(),this.#aG({hasSomethingToUndo:this.#M.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#aQ()}),this._editorUndoBar?.hide()}redo(){this.#M.redo(),this.#aG({hasSomethingToUndo:!0,hasSomethingToRedo:this.#M.hasSomethingToRedo(),isEmpty:this.#aQ()})}addCommands(a){this.#M.add(a),this.#aG({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#aQ()})}cleanUndoStack(a){this.#M.cleanType(a)}#aQ(){if(0===this.#H.size)return!0;if(1===this.#H.size)for(let a of this.#H.values())return a.isEmpty();return!1}delete(){this.commitOrRemove();let a=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!a)return;let b=a?[a]:[...this.#am],c=()=>{for(let a of(this._editorUndoBar?.show(d,1===b.length?b[0].editorType:b.length),b))a.remove()},d=()=>{for(let a of b)this.#aN(a)};this.addCommands({cmd:c,undo:d,mustExec:!0})}commitOrRemove(){this.#F?.commitOrRemove()}hasSomethingToControl(){return this.#F||this.hasSelection}#aO(a){for(let a of this.#am)a.unselect();for(let b of(this.#am.clear(),a))b.isEmpty()||(this.#am.add(b),b.select());this.#aG({hasSelectedEditor:this.hasSelection})}selectAll(){for(let a of this.#am)a.commit();this.#aO(this.#H.values())}unselectAll(){if(!this.#F||(this.#F.commitOrRemove(),this.#al===$.NONE)){if(!this.#P?.commitOrRemove()&&this.hasSelection){for(let a of this.#am)a.unselect();this.#am.clear(),this.#aG({hasSelectedEditor:!1})}}}translateSelectedEditors(a,b,c=!1){if(c||this.commitOrRemove(),!this.hasSelection)return;this.#at[0]+=a,this.#at[1]+=b;let[d,e]=this.#at,f=[...this.#am];for(let c of(this.#au&&clearTimeout(this.#au),this.#au=setTimeout(()=>{this.#au=null,this.#at[0]=this.#at[1]=0,this.addCommands({cmd:()=>{for(let a of f)this.#H.has(a.id)&&(a.translateInPage(d,e),a.translationDone())},undo:()=>{for(let a of f)this.#H.has(a.id)&&(a.translateInPage(-d,-e),a.translationDone())},mustExec:!1})},1e3),f))c.translateInPage(a,b),c.translationDone()}setUpDragSession(){if(this.hasSelection)for(let a of(this.disableUserSelect(!0),this.#S=new Map,this.#am))this.#S.set(a,{savedX:a.x,savedY:a.y,savedPageIndex:a.pageIndex,newX:0,newY:0,newPageIndex:-1})}endDragSession(){if(!this.#S)return!1;this.disableUserSelect(!1);let a=this.#S;this.#S=null;let b=!1;for(let[{x:c,y:d,pageIndex:e},f]of a)f.newX=c,f.newY=d,f.newPageIndex=e,b||=c!==f.savedX||d!==f.savedY||e!==f.savedPageIndex;if(!b)return!1;let c=(a,b,c,d)=>{if(this.#H.has(a.id)){let e=this.#I.get(d);e?a._setParentAndPosition(e,b,c):(a.pageIndex=d,a.x=b,a.y=c)}};return this.addCommands({cmd:()=>{for(let[b,{newX:d,newY:e,newPageIndex:f}]of a)c(b,d,e,f)},undo:()=>{for(let[b,{savedX:d,savedY:e,savedPageIndex:f}]of a)c(b,d,e,f)},mustExec:!0}),!0}dragSelectedEditors(a,b){if(this.#S)for(let c of this.#S.keys())c.drag(a,b)}rebuild(a){if(null===a.parent){let b=this.getLayer(a.pageIndex);b?(b.changeParent(a),b.addOrRebuild(a)):(this.addEditor(a),this.addToAnnotationStorage(a),a.rebuild())}else a.parent.addOrRebuild(a)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#am.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(a){return this.#F===a}getActive(){return this.#F}getMode(){return this.#al}isEditingMode(){return this.#al!==$.NONE}get imageManager(){return an(this,"imageManager",new bg)}getSelectionBoxes(a){let b;if(!a)return null;let c=document.getSelection();for(let b=0,d=c.rangeCount;b<d;b++)if(!a.contains(c.getRangeAt(b).commonAncestorContainer))return null;let{x:d,y:e,width:f,height:g}=a.getBoundingClientRect();switch(a.getAttribute("data-main-rotation")){case"90":b=(a,b,c,h)=>({x:(b-e)/g,y:1-(a+c-d)/f,width:h/g,height:c/f});break;case"180":b=(a,b,c,h)=>({x:1-(a+c-d)/f,y:1-(b+h-e)/g,width:c/f,height:h/g});break;case"270":b=(a,b,c,h)=>({x:1-(b+h-e)/g,y:(a-d)/f,width:h/g,height:c/f});break;default:b=(a,b,c,h)=>({x:(a-d)/f,y:(b-e)/g,width:c/f,height:h/g})}let h=[];for(let a=0,d=c.rangeCount;a<d;a++){let d=c.getRangeAt(a);if(!d.collapsed)for(let{x:a,y:c,width:e,height:f}of d.getClientRects())0!==e&&0!==f&&h.push(b(a,c,e,f))}return 0===h.length?null:h}addChangedExistingAnnotation({annotationElementId:a,id:b}){(this.#L||=new Map).set(a,b)}removeChangedExistingAnnotation({annotationElementId:a}){this.#L?.delete(a)}renderAnnotationElement(a){let b=this.#L?.get(a.data.id);if(!b)return;let c=this.#K.getRawValue(b);!c||(this.#al!==$.NONE||c.hasBeenModified)&&c.renderAnnotationElement(a)}setMissingCanvas(a,b,c){let d=this.#aj?.get(a);d&&(d.setCanvas(b,c),this.#aj.delete(a))}addMissingCanvas(a,b){(this.#aj||=new Map).set(a,b)}}class bl{#h=null;#aU=!1;#aV=null;#aW=null;#aX=null;#aY=null;#aZ=!1;#a$=null;#f=null;#a_=null;#a0=null;#a1=!1;static #a2=null;static _l10n=null;constructor(a){this.#f=a,this.#a1=a._uiManager.useNewAltTextFlow,bl.#a2||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(a){bl._l10n??=a}async render(){let a=this.#aV=document.createElement("button");a.className="altText",a.tabIndex="0";let b=this.#aW=document.createElement("span");a.append(b),this.#a1?(a.classList.add("new"),a.setAttribute("data-l10n-id",bl.#a2.missing),b.setAttribute("data-l10n-id",bl.#a2["missing-label"])):(a.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),b.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let c=this.#f._uiManager._signal;a.addEventListener("contextmenu",aU,{signal:c}),a.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:c});let d=a=>{a.preventDefault(),this.#f._uiManager.editAltText(this.#f),this.#a1&&this.#f._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#a3}})};return a.addEventListener("click",d,{capture:!0,signal:c}),a.addEventListener("keydown",b=>{b.target===a&&"Enter"===b.key&&(this.#aZ=!0,d(b))},{signal:c}),await this.#a4(),a}get #a3(){return this.#h&&"added"||null===this.#h&&this.guessedText&&"review"||"missing"}finish(){this.#aV&&(this.#aV.focus({focusVisible:this.#aZ}),this.#aZ=!1)}isEmpty(){return this.#a1?null===this.#h:!this.#h&&!this.#aU}hasData(){return this.#a1?null!==this.#h||!!this.#a_:this.isEmpty()}get guessedText(){return this.#a_}async setGuessedText(a){null===this.#h&&(this.#a_=a,this.#a0=await bl._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:a}),this.#a4())}toggleAltTextBadge(a=!1){if(!this.#a1||this.#h){this.#a$?.remove(),this.#a$=null;return}if(!this.#a$){let a=this.#a$=document.createElement("div");a.className="noAltTextBadge",this.#f.div.append(a)}this.#a$.classList.toggle("hidden",!a)}serialize(a){let b=this.#h;return a||this.#a_!==b||(b=this.#a0),{altText:b,decorative:this.#aU,guessedText:this.#a_,textWithDisclaimer:this.#a0}}get data(){return{altText:this.#h,decorative:this.#aU}}set data({altText:a,decorative:b,guessedText:c,textWithDisclaimer:d,cancel:e=!1}){c&&(this.#a_=c,this.#a0=d),(this.#h!==a||this.#aU!==b)&&(e||(this.#h=a,this.#aU=b),this.#a4())}toggle(a=!1){this.#aV&&(!a&&this.#aY&&(clearTimeout(this.#aY),this.#aY=null),this.#aV.disabled=!a)}shown(){this.#f._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#a3}})}destroy(){this.#aV?.remove(),this.#aV=null,this.#aW=null,this.#aX=null,this.#a$?.remove(),this.#a$=null}async #a4(){let a=this.#aV;if(!a)return;if(this.#a1){if(a.classList.toggle("done",!!this.#h),a.setAttribute("data-l10n-id",bl.#a2[this.#a3]),this.#aW?.setAttribute("data-l10n-id",bl.#a2[`${this.#a3}-label`]),!this.#h)return void this.#aX?.remove()}else{if(!this.#h&&!this.#aU){a.classList.remove("done"),this.#aX?.remove();return}a.classList.add("done"),a.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let b=this.#aX;if(!b){this.#aX=b=document.createElement("span"),b.className="tooltip",b.setAttribute("role","tooltip"),b.id=`alt-text-tooltip-${this.#f.id}`;let c=this.#f._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(this.#aY),this.#aY=null},{once:!0}),a.addEventListener("mouseenter",()=>{this.#aY=setTimeout(()=>{this.#aY=null,this.#aX.classList.add("show"),this.#f._reportTelemetry({action:"alt_text_tooltip"})},100)},{signal:c}),a.addEventListener("mouseleave",()=>{this.#aY&&(clearTimeout(this.#aY),this.#aY=null),this.#aX?.classList.remove("show")},{signal:c})}this.#aU?b.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(b.removeAttribute("data-l10n-id"),b.textContent=this.#h),b.parentNode||a.append(b);let c=this.#f.getElementForAltText();c?.setAttribute("aria-describedby",b.id)}}class bm{#a5=null;#a6=null;#a7=!1;#f=null;#a8=null;#a9=null;#ba=null;#bb=null;#bc=!1;#bd=null;constructor(a){this.#f=a}renderForToolbar(){let a=this.#a6=document.createElement("button");return a.className="comment",this.#s(a,!1)}renderForStandalone(){let a=this.#a5=document.createElement("button");a.className="annotationCommentButton";let b=this.#f.commentButtonPosition;if(b){let{style:c}=a;c.insetInlineEnd=`calc(${100*("ltr"===this.#f._uiManager.direction?1-b[0]:b[0])}% - var(--comment-button-dim))`,c.top=`calc(${100*b[1]}% - var(--comment-button-dim))`;let d=this.#f.commentButtonColor;d&&(c.backgroundColor=d)}return this.#s(a,!0)}focusButton(){setTimeout(()=>{(this.#a5??this.#a6)?.focus()},0)}onUpdatedColor(){if(!this.#a5)return;let a=this.#f.commentButtonColor;a&&(this.#a5.style.backgroundColor=a),this.#f._uiManager.updatePopupColor(this.#f)}get commentButtonWidth(){return(this.#a5?.getBoundingClientRect().width??0)/this.#f.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#bd)return this.#bd;if(!this.#a5)return null;let{x:a,y:b,height:c}=this.#a5.getBoundingClientRect(),{x:d,y:e,width:f,height:g}=this.#f.parent.boundingClientRect;return[(a-d)/f,(b+c-e)/g]}set commentPopupPositionInLayer(a){this.#bd=a}hasDefaultPopupPosition(){return null===this.#bd}removeStandaloneCommentButton(){this.#a5?.remove(),this.#a5=null}removeToolbarCommentButton(){this.#a6?.remove(),this.#a6=null}setCommentButtonStates({selected:a,hasPopup:b}){this.#a5&&(this.#a5.classList.toggle("selected",a),this.#a5.ariaExpanded=b)}#s(a,b){if(!this.#f._uiManager.hasCommentManager())return null;a.tabIndex="0",a.ariaHasPopup="dialog",b?(a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(a.ariaControlsElements=[this.#f._uiManager.getCommentDialogElement()],a.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));let c=this.#f._uiManager._signal;if(!(c instanceof AbortSignal)||c.aborted)return a;a.addEventListener("contextmenu",aU,{signal:c}),b&&(a.addEventListener("focusin",a=>{this.#f._focusEventsAllowed=!1,aV(a)},{capture:!0,signal:c}),a.addEventListener("focusout",a=>{this.#f._focusEventsAllowed=!0,aV(a)},{capture:!0,signal:c})),a.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:c});let d=b=>{b.preventDefault(),a===this.#a6?this.edit():this.#f.toggleComment(!0)};return a.addEventListener("click",d,{capture:!0,signal:c}),a.addEventListener("keydown",b=>{b.target===a&&"Enter"===b.key&&(this.#a7=!0,d(b))},{signal:c}),a.addEventListener("pointerenter",()=>{this.#f.toggleComment(!1,!0)},{signal:c}),a.addEventListener("pointerleave",()=>{this.#f.toggleComment(!1,!1)},{signal:c}),a}edit(a){let b,c,d=this.commentPopupPositionInLayer;if(d)[b,c]=d;else{[b,c]=this.#f.commentButtonPosition;let{width:a,height:d,x:e,y:f}=this.#f;b=e+b*a,c=f+c*d}let e=this.#f.parent.boundingClientRect,{x:f,y:g,width:h,height:i}=e;this.#f._uiManager.editComment(this.#f,f+b*h,g+c*i,{...a,parentDimensions:e})}finish(){this.#a6&&(this.#a6.focus({focusVisible:this.#a7}),this.#a7=!1)}isDeleted(){return this.#bc||""===this.#ba}isEmpty(){return null===this.#ba}hasBeenEdited(){return this.isDeleted()||this.#ba!==this.#a8}serialize(){return this.data}get data(){return{text:this.#ba,richText:this.#a9,date:this.#bb,deleted:this.isDeleted()}}set data(a){if(a!==this.#ba&&(this.#a9=null),null===a){this.#ba="",this.#bc=!0;return}this.#ba=a,this.#bb=new Date,this.#bc=!1}setInitialText(a,b=null){this.#a8=a,this.data=a,this.#bb=null,this.#a9=b}shown(){}destroy(){this.#a6?.remove(),this.#a6=null,this.#a5?.remove(),this.#a5=null,this.#ba="",this.#a9=null,this.#bb=null,this.#f=null,this.#a7=!1,this.#bc=!1}}class bn{#av;#be=!1;#bf=null;#bg;#bh;#bi;#bj;#bk=null;#bl;#bm=null;#bn;#bo=null;constructor({container:a,isPinchingDisabled:b=null,isPinchingStopped:c=null,onPinchStart:d=null,onPinching:e=null,onPinchEnd:f=null,signal:g}){this.#av=a,this.#bf=c,this.#bg=b,this.#bh=d,this.#bi=e,this.#bj=f,this.#bn=new AbortController,this.#bl=AbortSignal.any([g,this.#bn.signal]),a.addEventListener("touchstart",this.#bp.bind(this),{passive:!1,signal:this.#bl})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/a0.pixelRatio}#bp(a){if(this.#bg?.())return;if(1===a.touches.length){if(this.#bk)return;let a=this.#bk=new AbortController,b=AbortSignal.any([this.#bl,a.signal]),c=this.#av,d={capture:!0,signal:b,passive:!1},e=a=>{"touch"===a.pointerType&&(this.#bk?.abort(),this.#bk=null)};c.addEventListener("pointerdown",a=>{"touch"===a.pointerType&&(aV(a),e(a))},d),c.addEventListener("pointerup",e,d),c.addEventListener("pointercancel",e,d);return}if(!this.#bo){this.#bo=new AbortController;let a=AbortSignal.any([this.#bl,this.#bo.signal]),b=this.#av,c={signal:a,capture:!1,passive:!1};b.addEventListener("touchmove",this.#bq.bind(this),c);let d=this.#br.bind(this);b.addEventListener("touchend",d,c),b.addEventListener("touchcancel",d,c),c.capture=!0,b.addEventListener("pointerdown",aV,c),b.addEventListener("pointermove",aV,c),b.addEventListener("pointercancel",aV,c),b.addEventListener("pointerup",aV,c),this.#bh?.()}if(aV(a),2!==a.touches.length||this.#bf?.()){this.#bm=null;return}let[b,c]=a.touches;b.identifier>c.identifier&&([b,c]=[c,b]),this.#bm={touch0X:b.screenX,touch0Y:b.screenY,touch1X:c.screenX,touch1Y:c.screenY}}#bq(a){if(!this.#bm||2!==a.touches.length)return;aV(a);let[b,c]=a.touches;b.identifier>c.identifier&&([b,c]=[c,b]);let{screenX:d,screenY:e}=b,{screenX:f,screenY:g}=c,h=this.#bm,{touch0X:i,touch0Y:j,touch1X:k,touch1Y:l}=h,m=Math.hypot(f-d,g-e)||1,n=Math.hypot(k-i,l-j)||1;if(!this.#be&&Math.abs(n-m)<=bn.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=d,h.touch0Y=e,h.touch1X=f,h.touch1Y=g,!this.#be){this.#be=!0;return}let o=[(d+f)/2,(e+g)/2];this.#bi?.(o,n,m)}#br(a){a.touches.length>=2||(this.#bo&&(this.#bo.abort(),this.#bo=null,this.#bj?.()),this.#bm&&(aV(a),this.#bm=null,this.#be=!1))}destroy(){this.#bn?.abort(),this.#bn=null,this.#bk?.abort(),this.#bk=null}}class bo{#bs=null;#bt=null;#h=null;#i=null;#a5=null;#bu=!1;#bv=null;#bw="";#bx=null;#by=null;#bz=null;#bA=null;#bB=null;#bC="";#bD=!1;#bE=null;#bF=!1;#bG=!1;#bH=!1;#bI=null;#bJ=0;#bK=0;#bL=null;#bM=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#bN=!1;#bO=bo._zIndex++;static _borderLineWidth=-1;static _colorManager=new bj;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let a=bo.prototype._resizeWithKeyboard,b=bk.TRANSLATE_SMALL,c=bk.TRANSLATE_BIG;return an(this,"_resizerKeyboardManager",new bi([[["ArrowLeft","mac+ArrowLeft"],a,{args:[-b,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a,{args:[-c,0]}],[["ArrowRight","mac+ArrowRight"],a,{args:[b,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a,{args:[c,0]}],[["ArrowUp","mac+ArrowUp"],a,{args:[0,-b]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a,{args:[0,-c]}],[["ArrowDown","mac+ArrowDown"],a,{args:[0,b]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a,{args:[0,c]}],[["Escape","mac+Escape"],bo.prototype._stopResizingWithKeyboard]]))}constructor(a){this.parent=a.parent,this.id=a.id,this.width=this.height=null,this.pageIndex=a.parent.pageIndex,this.name=a.name,this.div=null,this._uiManager=a.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=a.isCentered,this._structTreeParentId=null,this.annotationElementId=a.annotationElementId||null,this.creationDate=a.creationDate||new Date,this.modificationDate=a.modificationDate||null;const{rotation:b,rawDims:{pageWidth:c,pageHeight:d,pageX:e,pageY:f}}=this.parent.viewport;this.rotation=b,this.pageRotation=(360+b-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[c,d],this.pageTranslation=[e,f];const[g,h]=this.parentDimensions;this.x=a.x/g,this.y=a.y/h,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return an(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(a){let b=new bp({id:a.parent.getNextId(),parent:a.parent,uiManager:a._uiManager});b.annotationElementId=a.annotationElementId,b.deleted=!0,b._uiManager.addToAnnotationStorage(b)}static initialize(a,b){if(bo._l10n??=a,bo._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==bo._borderLineWidth)return;let c=getComputedStyle(document.documentElement);bo._borderLineWidth=parseFloat(c.getPropertyValue("--outline-width"))||0}static updateDefaultParams(a,b){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(a){return!1}static paste(a,b){aj("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#bN}set _isDraggable(a){this.#bN=a,this.div?.classList.toggle("draggable",a)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){let[a,b]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*b/(2*a),this.y+=this.width*a/(2*b);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*b/(2*a),this.y-=this.width*a/(2*b);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(a){this._uiManager.addCommands(a)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#bO}setParent(a){null!==a?(this.pageIndex=a.pageIndex,this.pageDimensions=a.pageDimensions):(this.#bP(),this.#bA?.remove(),this.#bA=null),this.parent=a}focusin(a){this._focusEventsAllowed&&(this.#bD?this.#bD=!1:this.parent.setSelected(this))}focusout(a){if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let b=a.relatedTarget;!b?.closest(`#${this.id}`)&&(a.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(a,b,c,d){let[e,f]=this.parentDimensions;[c,d]=this.screenToPageTranslation(c,d),this.x=(a+c)/e,this.y=(b+d)/f,this.fixAndSetPosition()}_moveAfterPaste(a,b){let[c,d]=this.parentDimensions;this.setAt(a*c,b*d,this.width*c,this.height*d),this._onTranslated()}#bQ([a,b],c,d){[c,d]=this.screenToPageTranslation(c,d),this.x+=c/a,this.y+=d/b,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(a,b){this.#bQ(this.parentDimensions,a,b)}translateInPage(a,b){this.#bE||=[this.x,this.y,this.width,this.height],this.#bQ(this.pageDimensions,a,b),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(a,b){this.#bE||=[this.x,this.y,this.width,this.height];let{div:c,parentDimensions:[d,e]}=this;if(this.x+=a/d,this.y+=b/e,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:a,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,a,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:f,y:g}=this,[h,i]=this.getBaseTranslation();f+=h,g+=i;let{style:j}=c;j.left=`${(100*f).toFixed(2)}%`,j.top=`${(100*g).toFixed(2)}%`,this._onTranslating(f,g),c.scrollIntoView({block:"nearest"})}_onTranslating(a,b){}_onTranslated(a,b){}get _hasBeenMoved(){return!!this.#bE&&(this.#bE[0]!==this.x||this.#bE[1]!==this.y)}get _hasBeenResized(){return!!this.#bE&&(this.#bE[2]!==this.width||this.#bE[3]!==this.height)}getBaseTranslation(){let[a,b]=this.parentDimensions,{_borderLineWidth:c}=bo,d=c/a,e=c/b;switch(this.rotation){case 90:return[-d,e];case 180:return[d,e];case 270:return[d,-e];default:return[-d,-e]}}get _mustFixPosition(){return!0}fixAndSetPosition(a=this.rotation){let{div:{style:b},pageDimensions:[c,d]}=this,{x:e,y:f,width:g,height:h}=this;if(g*=c,h*=d,e*=c,f*=d,this._mustFixPosition)switch(a){case 0:e=aF(e,0,c-g),f=aF(f,0,d-h);break;case 90:e=aF(e,0,c-h),f=aF(f,g,d);break;case 180:e=aF(e,g,c),f=aF(f,h,d);break;case 270:e=aF(e,h,c),f=aF(f,0,d-g)}this.x=e/=c,this.y=f/=d;let[i,j]=this.getBaseTranslation();e+=i,f+=j,b.left=`${(100*e).toFixed(2)}%`,b.top=`${(100*f).toFixed(2)}%`,this.moveInDOM()}static #bR(a,b,c){switch(c){case 90:return[b,-a];case 180:return[-a,-b];case 270:return[-b,a];default:return[a,b]}}screenToPageTranslation(a,b){return bo.#bR(a,b,this.parentRotation)}pageTranslationToScreen(a,b){return bo.#bR(a,b,360-this.parentRotation)}#bS(a){switch(a){case 90:{let[a,b]=this.pageDimensions;return[0,-a/b,b/a,0]}case 180:return[-1,0,0,-1];case 270:{let[a,b]=this.pageDimensions;return[0,a/b,-b/a,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:a,pageDimensions:[b,c]}=this;return[b*a,c*a]}setDims(){let{div:{style:a},width:b,height:c}=this;a.width=`${(100*b).toFixed(2)}%`,a.height=`${(100*c).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#bT(){if(this.#bx)return;this.#bx=document.createElement("div"),this.#bx.classList.add("resizers");let a=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],b=this._uiManager._signal;for(let c of a){let a=document.createElement("div");this.#bx.append(a),a.classList.add("resizer",c),a.setAttribute("data-resizer-name",c),a.addEventListener("pointerdown",this.#bU.bind(this,c),{signal:b}),a.addEventListener("contextmenu",aU,{signal:b}),a.tabIndex=-1}this.div.prepend(this.#bx)}#bU(a,b){b.preventDefault();let{isMac:c}=ax.platform;if(0!==b.button||b.ctrlKey&&c)return;this.#h?.toggle(!1);let d=this._isDraggable;this._isDraggable=!1,this.#by=[b.screenX,b.screenY];let e=new AbortController,f=this._uiManager.combinedSignal(e);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#bV.bind(this,a),{passive:!0,capture:!0,signal:f}),window.addEventListener("touchmove",aV,{passive:!1,signal:f}),window.addEventListener("contextmenu",aU,{signal:f}),this.#bz={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let g=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(b.target).cursor;let i=()=>{e.abort(),this.parent.togglePointerEvents(!0),this.#h?.toggle(!0),this._isDraggable=d,this.parent.div.style.cursor=g,this.div.style.cursor=h,this.#bW()};window.addEventListener("pointerup",i,{signal:f}),window.addEventListener("blur",i,{signal:f})}#bX(a,b,c,d){this.width=c,this.height=d,this.x=a,this.y=b,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#bW(){if(!this.#bz)return;let{savedX:a,savedY:b,savedWidth:c,savedHeight:d}=this.#bz;this.#bz=null;let e=this.x,f=this.y,g=this.width,h=this.height;(e!==a||f!==b||g!==c||h!==d)&&this.addCommands({cmd:this.#bX.bind(this,e,f,g,h),undo:this.#bX.bind(this,a,b,c,d),mustExec:!0})}static _round(a){return Math.round(1e4*a)/1e4}#bV(a,b){let c,d,e,f,g,h,[i,j]=this.parentDimensions,k=this.x,l=this.y,m=this.width,n=this.height,o=bo.MIN_SIZE/i,p=bo.MIN_SIZE/j,q=this.#bS(this.rotation),r=(a,b)=>[q[0]*a+q[2]*b,q[1]*a+q[3]*b],s=this.#bS(360-this.rotation),t=!1,u=!1;switch(a){case"topLeft":t=!0,c=(a,b)=>[0,0],d=(a,b)=>[a,b];break;case"topMiddle":c=(a,b)=>[a/2,0],d=(a,b)=>[a/2,b];break;case"topRight":t=!0,c=(a,b)=>[a,0],d=(a,b)=>[0,b];break;case"middleRight":u=!0,c=(a,b)=>[a,b/2],d=(a,b)=>[0,b/2];break;case"bottomRight":t=!0,c=(a,b)=>[a,b],d=(a,b)=>[0,0];break;case"bottomMiddle":c=(a,b)=>[a/2,b],d=(a,b)=>[a/2,0];break;case"bottomLeft":t=!0,c=(a,b)=>[0,b],d=(a,b)=>[a,0];break;case"middleLeft":u=!0,c=(a,b)=>[0,b/2],d=(a,b)=>[a,b/2]}let v=c(m,n),w=d(m,n),x=r(...w),y=bo._round(k+x[0]),z=bo._round(l+x[1]),A=1,B=1;if(b.fromKeyboard)({deltaX:e,deltaY:f}=b);else{let{screenX:a,screenY:c}=b,[d,g]=this.#by;[e,f]=this.screenToPageTranslation(a-d,c-g),this.#by[0]=a,this.#by[1]=c}if([e,f]=(g=e/i,h=f/j,[s[0]*g+s[2]*h,s[1]*g+s[3]*h]),t){let a=Math.hypot(m,n);A=B=Math.max(Math.min(Math.hypot(w[0]-v[0]-e,w[1]-v[1]-f)/a,1/m,1/n),o/m,p/n)}else u?A=aF(Math.abs(w[0]-v[0]-e),o,1)/m:B=aF(Math.abs(w[1]-v[1]-f),p,1)/n;let C=bo._round(m*A),D=bo._round(n*B),E=y-(x=r(...d(C,D)))[0],F=z-x[1];this.#bE||=[this.x,this.y,this.width,this.height],this.width=C,this.height=D,this.x=E,this.y=F,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#h?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#bG)return this._editToolbar;this._editToolbar=new bc(this),this.div.append(this._editToolbar.render());let{toolbarButtons:a}=this;if(a)for(let[b,c]of a)await this._editToolbar.addButton(b,c);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#h?.destroy()}addContainer(a){let b=this._editToolbar?.div;b?b.before(a):this.div.append(a)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return!this.#h&&(bl.initialize(bo._l10n),this.#h=new bl(this),this.#bs&&(this.#h.data=this.#bs,this.#bs=null)),this.#h}get altTextData(){return this.#h?.data}set altTextData(a){this.#h&&(this.#h.data=a)}get guessedAltText(){return this.#h?.guessedText}async setGuessedAltText(a){await this.#h?.setGuessedText(a)}serializeAltText(a){return this.#h?.serialize(a)}hasAltText(){return!!this.#h&&!this.#h.isEmpty()}hasAltTextData(){return this.#h?.hasData()??!1}focusCommentButton(){this.#i?.focusButton()}addCommentButton(){return this.#i||=new bm(this)}addStandaloneCommentButton(){if(this.#a5){this._uiManager.isEditingMode()&&this.#a5.classList.remove("hidden");return}this.hasComment&&(this.#a5=this.#i.renderForStandalone(),this.div.append(this.#a5))}removeStandaloneCommentButton(){this.#i.removeStandaloneCommentButton(),this.#a5=null}hideStandaloneCommentButton(){this.#a5?.classList.add("hidden")}get comment(){let{data:{richText:a,text:b,date:c,deleted:d}}=this.#i;return{text:b,richText:a,date:c,deleted:d,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(a){this.#i||=new bm(this),this.#i.data=a,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:a,popupRef:b,richText:c}){if(!b||(this.#i||=new bm(this),this.#i.setInitialText(a,c),!this.annotationElementId))return;let d=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);d&&this.updateFromAnnotationLayer(d)}get hasEditedComment(){return this.#i?.hasBeenEdited()}get hasDeletedComment(){return this.#i?.isDeleted()}get hasComment(){return!!this.#i&&!this.#i.isEmpty()&&!this.#i.isDeleted()}async editComment(a){this.#i||=new bm(this),this.#i.edit(a)}toggleComment(a,b){this.hasComment&&this._uiManager.toggleComment(this,a,b)}setSelectedCommentButton(a){this.#i.setSelectedButton(a)}addComment(a){if(this.hasEditedComment){let[,,,b]=a.rect,[c]=this.pageDimensions,[d]=this.pageTranslation,e=d+c+1;a.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[e,b-100,e+180,b]}}}updateFromAnnotationLayer({popup:{contents:a,deleted:b}}){this.#i.data=b?null:a}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){let a=this.div=document.createElement("div");a.setAttribute("data-editor-rotation",(360-this.rotation)%360),a.className=this.name,a.setAttribute("id",this.id),a.tabIndex=this.#bu?-1:0,a.setAttribute("role","application"),this.defaultL10nId&&a.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||a.classList.add("hidden"),this.setInForeground(),this.#bY();let[b,c]=this.parentDimensions;this.parentRotation%180!=0&&(a.style.maxWidth=`${(100*c/b).toFixed(2)}%`,a.style.maxHeight=`${(100*b/c).toFixed(2)}%`);let[d,e]=this.getInitialTranslation();return this.translate(d,e),be(this,a,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#bM||=new bn({container:a,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#bZ.bind(this),onPinching:this.#b$.bind(this),onPinchEnd:this.#b_.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),a}#bZ(){this.#bz={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#h?.toggle(!1),this.parent.togglePointerEvents(!1)}#b$(a,b,c){let d=c/b*.7+1-.7;if(1===d)return;let e=this.#bS(this.rotation),f=(a,b)=>[e[0]*a+e[2]*b,e[1]*a+e[3]*b],[g,h]=this.parentDimensions,i=this.x,j=this.y,k=this.width,l=this.height;d=Math.max(Math.min(d,1/k,1/l),bo.MIN_SIZE/g/k,bo.MIN_SIZE/h/l);let m=bo._round(k*d),n=bo._round(l*d);if(m===k&&n===l)return;this.#bE||=[i,j,k,l];let o=f(k/2,l/2),p=bo._round(i+o[0]),q=bo._round(j+o[1]),r=f(m/2,n/2);this.x=p-r[0],this.y=q-r[1],this.width=m,this.height=n,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#b_(){this.#h?.toggle(!0),this.parent.togglePointerEvents(!0),this.#bW()}pointerdown(a){let{isMac:b}=ax.platform;0!==a.button||a.ctrlKey&&b?a.preventDefault():(this.#bD=!0,this._isDraggable)?this.#b0(a):this.#b1(a)}#b1(a){let{isMac:b}=ax.platform;a.ctrlKey&&!b||a.shiftKey||a.metaKey&&b?this.parent.toggleSelected(this):this.parent.setSelected(this)}#b0(a){let{isSelected:b}=this;this._uiManager.setUpDragSession();let c=!1,d=new AbortController,e=this._uiManager.combinedSignal(d),f={capture:!0,passive:!1,signal:e},g=a=>{d.abort(),this.#bv=null,this.#bD=!1,this._uiManager.endDragSession()||this.#b1(a),c&&this._onStopDragging()};b&&(this.#bJ=a.clientX,this.#bK=a.clientY,this.#bv=a.pointerId,this.#bw=a.pointerType,window.addEventListener("pointermove",a=>{c||(c=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());let{clientX:b,clientY:d,pointerId:e}=a;if(e!==this.#bv)return void aV(a);let[f,g]=this.screenToPageTranslation(b-this.#bJ,d-this.#bK);this.#bJ=b,this.#bK=d,this._uiManager.dragSelectedEditors(f,g)},f),window.addEventListener("touchmove",aV,f),window.addEventListener("pointerdown",a=>{a.pointerType===this.#bw&&(this.#bM||a.isPrimary)&&g(a),aV(a)},f));let h=a=>{this.#bv&&this.#bv!==a.pointerId?aV(a):g(a)};window.addEventListener("pointerup",h,{signal:e}),window.addEventListener("blur",h,{signal:e})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#bI&&clearTimeout(this.#bI),this.#bI=setTimeout(()=>{this.#bI=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(a,b,c){a.changeParent(this),this.x=b,this.y=c,this.fixAndSetPosition(),this._onTranslated()}getRect(a,b,c=this.rotation){let d=this.parentScale,[e,f]=this.pageDimensions,[g,h]=this.pageTranslation,i=a/d,j=b/d,k=this.x*e,l=this.y*f,m=this.width*e,n=this.height*f;switch(c){case 0:return[k+i+g,f-l-j-n+h,k+i+m+g,f-l-j+h];case 90:return[k+j+g,f-l+i+h,k+j+n+g,f-l+i+m+h];case 180:return[k-i-m+g,f-l+j+h,k-i+g,f-l+j+n+h];case 270:return[k-j-n+g,f-l-i-m+h,k-j+g,f-l-i+h];default:throw Error("Invalid rotation")}}getRectInCurrentCoords(a,b){let[c,d,e,f]=a,g=e-c,h=f-d;switch(this.rotation){case 0:return[c,b-f,g,h];case 90:return[c,b-d,h,g];case 180:return[e,b-d,g,h];case 270:return[e,b-f,h,g];default:throw Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&bo._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#i?.onUpdatedColor()}getData(){let{comment:{text:a,color:b,date:c,opacity:d,deleted:e,richText:f},uid:g,pageIndex:h,creationDate:i,modificationDate:j}=this;return{id:g,pageIndex:h,rect:this.getPDFRect(),richText:f,contentsObj:{str:a},creationDate:i,modificationDate:c||j,popupRef:!e,color:b,opacity:d}}onceAdded(a){}isEmpty(){return!1}enableEditMode(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),this.#bG=!0,!0)}disableEditMode(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),this.#bG=!1,!0)}isInEditMode(){return this.#bG}shouldGetKeyboardEvents(){return this.#bH}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:a,left:b,bottom:c,right:d}=this.getClientDimensions(),{innerHeight:e,innerWidth:f}=window;return b<f&&d>0&&a<e&&c>0}#bY(){if(this.#bB||!this.div)return;this.#bB=new AbortController;let a=this._uiManager.combinedSignal(this.#bB);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:a}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:a})}rebuild(){this.#bY()}rotate(a){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(a=!1,b=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(a,b,c){let d=new this.prototype.constructor({parent:b,id:b.getNextId(),uiManager:c,annotationElementId:a.annotationElementId,creationDate:a.creationDate,modificationDate:a.modificationDate});d.rotation=a.rotation,d.#bs=a.accessibilityData,d._isCopy=a.isCopy||!1;let[e,f]=d.pageDimensions,[g,h,i,j]=d.getRectInCurrentCoords(a.rect,f);return d.x=g/e,d.y=h/f,d.width=i/e,d.height=j/f,d}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#bB?.abort(),this.#bB=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#bI&&(clearTimeout(this.#bI),this.#bI=null),this.#bP(),this.removeEditToolbar(),this.#bL){for(let a of this.#bL.values())clearTimeout(a);this.#bL=null}this.parent=null,this.#bM?.destroy(),this.#bM=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#bT(),this.#bx.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return"ltr"===this._uiManager.direction?[1,0]:[0,0]}get commentButtonPositionInPage(){let{commentButtonPosition:[a,b]}=this,[c,d,e,f]=this.getPDFRect();return[bo._round(c+(e-c)*a),bo._round(d+(f-d)*(1-b))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#i.commentPopupPositionInLayer}set commentPopupPosition(a){this.#i.commentPopupPositionInLayer=a}hasDefaultPopupPosition(){return this.#i.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#i.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(a){this.#i.setCommentButtonStates(a)}keydown(a){if(!this.isResizable||a.target!==this.div||"Enter"!==a.key)return;this._uiManager.setSelected(this),this.#bz={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let b=this.#bx.children;if(!this.#bt){this.#bt=Array.from(b);let a=this.#b2.bind(this),c=this.#b3.bind(this),d=this._uiManager._signal;for(let b of this.#bt){let e=b.getAttribute("data-resizer-name");b.setAttribute("role","spinbutton"),b.addEventListener("keydown",a,{signal:d}),b.addEventListener("blur",c,{signal:d}),b.addEventListener("focus",this.#b4.bind(this,e),{signal:d}),b.setAttribute("data-l10n-id",bo._l10nResizer[e])}}let c=this.#bt[0],d=0;for(let a of b){if(a===c)break;d++}let e=(360-this.rotation+this.parentRotation)%360/90*(this.#bt.length/4);if(e!==d){if(e<d)for(let a=0;a<d-e;a++)this.#bx.append(this.#bx.firstChild);else if(e>d)for(let a=0;a<e-d;a++)this.#bx.firstChild.before(this.#bx.lastChild);let a=0;for(let c of b){let b=this.#bt[a++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",bo._l10nResizer[b])}}this.#b5(0),this.#bH=!0,this.#bx.firstChild.focus({focusVisible:!0}),a.preventDefault(),a.stopImmediatePropagation()}#b2(a){bo._resizerKeyboardManager.exec(this,a)}#b3(a){this.#bH&&a.relatedTarget?.parentNode!==this.#bx&&this.#bP()}#b4(a){this.#bC=this.#bH?a:""}#b5(a){if(this.#bt)for(let b of this.#bt)b.tabIndex=a}_resizeWithKeyboard(a,b){this.#bH&&this.#bV(this.#bC,{deltaX:a,deltaY:b,fromKeyboard:!0})}#bP(){this.#bH=!1,this.#b5(-1),this.#bW()}_stopResizingWithKeyboard(){this.#bP(),this.div.focus()}select(){this.isSelected&&this._editToolbar?this._editToolbar.show():(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar)?(this._editToolbar?.show(),this.#h?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()})}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#bx?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#h?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(a,b){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(a){"BUTTON"!==a.target.nodeName&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#bF}set isEditing(a){this.#bF=a,this.parent&&(a?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(a,b=!1){if(b){this.#bL||=new Map;let{action:b}=a,c=this.#bL.get(b);c&&clearTimeout(c),c=setTimeout(()=>{this._reportTelemetry(a),this.#bL.delete(b),0===this.#bL.size&&(this.#bL=null)},bo._telemetryTimeout),this.#bL.set(b,c);return}a.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:a}})}show(a=this._isVisible){this.div.classList.toggle("hidden",!a),this._isVisible=a}enable(){this.div&&(this.div.tabIndex=0),this.#bu=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#bu=!0}updateFakeAnnotationElement(a){if(!this.#bA&&!this.deleted){this.#bA=a.addFakeAnnotation(this);return}if(this.deleted){this.#bA.remove(),this.#bA=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#bA.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(a){if(this.deleted)return a.hide(),null;let b=a.container.querySelector(".annotationContent");if(b){if("CANVAS"===b.nodeName){let a=b;(b=document.createElement("div")).classList.add("annotationContent",this.editorType),a.before(b)}}else(b=document.createElement("div")).classList.add("annotationContent",this.editorType),a.container.prepend(b);return b}resetAnnotationElement(a){let{firstChild:b}=a.container;b?.nodeName==="DIV"&&b.classList.contains("annotationContent")&&b.remove()}}class bp extends bo{constructor(a){super(a),this.annotationElementId=a.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}class bq{constructor(a){this.h1=a?0|a:0xc3d2e1f0,this.h2=a?0|a:0xc3d2e1f0}update(a){let b,c;if("string"==typeof a){b=new Uint8Array(2*a.length),c=0;for(let d=0,e=a.length;d<e;d++){let e=a.charCodeAt(d);e<=255?b[c++]=e:(b[c++]=e>>>8,b[c++]=255&e)}}else if(ArrayBuffer.isView(a))c=(b=a.slice()).byteLength;else throw Error("Invalid data format, must be a string or TypedArray.");let d=c>>2,e=c-4*d,f=new Uint32Array(b.buffer,0,d),g=0,h=0,i=this.h1,j=this.h2;for(let a=0;a<d;a++)1&a?(i^=g=0x1b873593*(g=(g=0xcc9e2d51*(g=f[a])&0xffff0000|11601*g&65535)<<15|g>>>17)&0xffff0000|13715*g&65535,i=5*(i=i<<13|i>>>19)+0xe6546b64):(j^=h=0x1b873593*(h=(h=0xcc9e2d51*(h=f[a])&0xffff0000|11601*h&65535)<<15|h>>>17)&0xffff0000|13715*h&65535,j=5*(j=j<<13|j>>>19)+0xe6546b64);switch(g=0,e){case 3:g^=b[4*d+2]<<16;case 2:g^=b[4*d+1]<<8;case 1:g^=b[4*d],g=0x1b873593*(g=(g=0xcc9e2d51*g&0xffff0000|11601*g&65535)<<15|g>>>17)&0xffff0000|13715*g&65535,1&d?i^=g:j^=g}this.h1=i,this.h2=j}hexdigest(){let a=this.h1,b=this.h2;return a^=b>>>1,b=0xff51afd7*b&0xffff0000|((b<<16|(a=0xed558ccd*a&0xffff0000|36045*a&65535)>>>16)*0xafd7ed55&0xffff0000)>>>16,a^=b>>>1,b=0xc4ceb9fe*b&0xffff0000|((b<<16|(a=0x1a85ec53*a&0xffff0000|60499*a&65535)>>>16)*0xb9fe1a85&0xffff0000)>>>16,((a^=b>>>1)>>>0).toString(16).padStart(8,"0")+(b>>>0).toString(16).padStart(8,"0")}}let br=Object.freeze({map:null,hash:"",transfer:void 0});class bs{#b6=!1;#b7=null;#b8=null;#b9=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(a,b){let c=this.#b9.get(a);return void 0===c?b:Object.assign(b,c)}getRawValue(a){return this.#b9.get(a)}remove(a){let b=this.#b9.get(a);if(void 0!==b&&(b instanceof bo&&this.#b8.delete(b.annotationElementId),this.#b9.delete(a),0===this.#b9.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor)){for(let a of this.#b9.values())if(a instanceof bo)return;this.onAnnotationEditor(null)}}setValue(a,b){let c=this.#b9.get(a),d=!1;if(void 0!==c)for(let[a,e]of Object.entries(b))c[a]!==e&&(d=!0,c[a]=e);else d=!0,this.#b9.set(a,b);d&&this.#ca(),b instanceof bo&&((this.#b8||=new Map).set(b.annotationElementId,b),"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(b.constructor._type))}has(a){return this.#b9.has(a)}get size(){return this.#b9.size}#ca(){this.#b6||(this.#b6=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#b6&&(this.#b6=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new bt(this)}get serializable(){if(0===this.#b9.size)return br;let a=new Map,b=new bq,c=[],d=Object.create(null),e=!1;for(let[c,f]of this.#b9){let g=f instanceof bo?f.serialize(!1,d):f;g&&(a.set(c,g),b.update(`${c}:${JSON.stringify(g)}`),e||=!!g.bitmap)}if(e)for(let b of a.values())b.bitmap&&c.push(b.bitmap);return a.size>0?{map:a,hash:b.hexdigest(),transfer:c}:br}get editorStats(){let a=null,b=new Map,c=0,d=0;for(let e of this.#b9.values()){if(!(e instanceof bo)){e.popup&&(e.popup.deleted?d+=1:c+=1);continue}e.isCommentDeleted?d+=1:e.hasEditedComment&&(c+=1);let f=e.telemetryFinalData;if(!f)continue;let{type:g}=f;b.has(g)||b.set(g,Object.getPrototypeOf(e).constructor),a||=Object.create(null);let h=a[g]||=new Map;for(let[a,b]of Object.entries(f)){if("type"===a)continue;let c=h.get(a);c||(c=new Map,h.set(a,c));let d=c.get(b)??0;c.set(b,d+1)}}if((d>0||c>0)&&((a||=Object.create(null)).comments={deleted:d,edited:c}),!a)return null;for(let[c,d]of b)a[c]=d.computeTelemetryFinalData(a[c]);return a}resetModifiedIds(){this.#b7=null}updateEditor(a,b){let c=this.#b8?.get(a);return!!c&&(c.updateFromAnnotationLayer(b),!0)}getEditor(a){return this.#b8?.get(a)||null}get modifiedIds(){if(this.#b7)return this.#b7;let a=[];if(this.#b8)for(let b of this.#b8.values())b.serialize()&&a.push(b.annotationElementId);return this.#b7={ids:new Set(a),hash:a.join(",")}}[Symbol.iterator](){return this.#b9.entries()}}class bt extends bs{#cb;constructor(a){super();const{map:b,hash:c,transfer:d}=a.serializable,e=structuredClone(b,d?{transfer:d}:null);this.#cb={map:e,hash:c,transfer:d}}get print(){aj("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#cb}get modifiedIds(){return an(this,"modifiedIds",{ids:new Set,hash:""})}}class bu{#cc=new Set;constructor({ownerDocument:a=globalThis.document,styleElement:b=null}){this._document=a,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(a){this.nativeFontFaces.add(a),this._document.fonts.add(a)}removeNativeFontFace(a){this.nativeFontFaces.delete(a),this._document.fonts.delete(a)}insertRule(a){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let b=this.styleElement.sheet;b.insertRule(a,b.cssRules.length)}clear(){for(let a of this.nativeFontFaces)this._document.fonts.delete(a);this.nativeFontFaces.clear(),this.#cc.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:a,disableFontFace:b,_inspectFont:c}){if(!(!a||this.#cc.has(a.loadedName))){if(ak(!b,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:b,src:d,style:e}=a,f=new FontFace(b,d,e);this.addNativeFontFace(f);try{await f.load(),this.#cc.add(b),c?.(a)}catch{ai(`Cannot load system font: ${a.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(f)}return}aj("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(a){if(a.attached||a.missingFile&&!a.systemFontInfo)return;if(a.attached=!0,a.systemFontInfo)return void await this.loadSystemFont(a);if(this.isFontLoadingAPISupported){let b=a.createNativeFontFace();if(b){this.addNativeFontFace(b);try{await b.loaded}catch(c){throw ai(`Failed to load font '${b.family}': '${c}'.`),a.disableFontFace=!0,c}}return}let b=a.createFontFaceRule();if(b){if(this.insertRule(b),this.isSyncFontLoadingSupported)return;await new Promise(b=>{let c=this._queueLoadingCallback(b);this._prepareFontLoadEvent(a,c)})}}get isFontLoadingAPISupported(){return an(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return an(this,"isSyncFontLoadingSupported",W||ax.platform.isFirefox)}_queueLoadingCallback(a){let{loadingRequests:b}=this,c={done:!1,complete:function(){for(ak(!c.done,"completeRequest() cannot be called twice."),c.done=!0;b.length>0&&b[0].done;)setTimeout(b.shift().callback,0)},callback:a};return b.push(c),c}get _loadTestFont(){return an(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(a,b){var c;let d,e;function f(a,b){return a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|255&a.charCodeAt(b+3)}function g(a,b,c,d){return a.substring(0,b)+d+a.substring(b+c)}let h=this._document.createElement("canvas");h.width=1,h.height=1;let i=h.getContext("2d"),j=0,k=`lt${Date.now()}${this.loadTestFontId++}`,l=this._loadTestFont,m=f(l=g(l,976,k.length,k),16);for(d=0,e=k.length-3;d<e;d+=4)m=m-0x58585858+f(k,d)|0;d<k.length&&(m=m-0x58585858+f(k+"XXX",d)|0),l=g(l,16,4,String.fromCharCode((c=m)>>24&255,c>>16&255,c>>8&255,255&c));let n=`url(data:font/opentype;base64,${btoa(l)});`,o=`@font-face {font-family:"${k}";src:${n}}`;this.insertRule(o);let p=this._document.createElement("div");for(let b of(p.style.visibility="hidden",p.style.width=p.style.height="10px",p.style.position="absolute",p.style.top=p.style.left="0px",[a.loadedName,k])){let a=this._document.createElement("span");a.textContent="Hi",a.style.fontFamily=b,p.append(a)}this._document.body.append(p),function a(b,c){if(++j>30){ai("Load test font never loaded."),c();return}(i.font="30px "+b,i.fillText(".",0,20),i.getImageData(0,0,1,1).data[3]>0)?c():setTimeout(a.bind(null,b,c))}(k,()=>{p.remove(),b.complete()})}}class bv{#cd;constructor(a,b=null,c,d){this.compiledGlyphs=Object.create(null),this.#cd=a,this._inspectFont=b,c&&Object.assign(this,c),d&&(this.charProcOperatorList=d)}createNativeFontFace(){let a;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){let b={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(b.style=`oblique ${this.cssFontInfo.italicAngle}deg`),a=new FontFace(this.cssFontInfo.fontFamily,this.data,b)}else a=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),a}createFontFaceRule(){let a;if(!this.data||this.disableFontFace)return null;let b=`url(data:${this.mimetype};base64,${aG(this.data)});`;if(this.cssFontInfo){let c=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(c+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),a=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${c}src:${b}}`}else a=`@font-face {font-family:"${this.loadedName}";src:${b}}`;return this._inspectFont?.(this,b),a}getPathGenerator(a,b){let c;if(void 0!==this.compiledGlyphs[b])return this.compiledGlyphs[b];let d=this.loadedName+"_path_"+b;try{c=a.get(d)}catch(a){ai(`getPathGenerator - ignoring character: "${a}".`)}let e=new Path2D(c||"");return this.fontExtraProperties||a.delete(d),this.compiledGlyphs[b]=e}get black(){return this.#cd.black}get bold(){return this.#cd.bold}get disableFontFace(){return this.#cd.disableFontFace??!1}get fontExtraProperties(){return this.#cd.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#cd.isInvalidPDFjsFont}get isType3Font(){return this.#cd.isType3Font}get italic(){return this.#cd.italic}get missingFile(){return this.#cd.missingFile}get remeasure(){return this.#cd.remeasure}get vertical(){return this.#cd.vertical}get ascent(){return this.#cd.ascent}get defaultWidth(){return this.#cd.defaultWidth}get descent(){return this.#cd.descent}get bbox(){return this.#cd.bbox}get fontMatrix(){return this.#cd.fontMatrix}get fallbackName(){return this.#cd.fallbackName}get loadedName(){return this.#cd.loadedName}get mimetype(){return this.#cd.mimetype}get name(){return this.#cd.name}get data(){return this.#cd.data}clearData(){this.#cd.clearData()}get cssFontInfo(){return this.#cd.cssFontInfo}get systemFontInfo(){return this.#cd.systemFontInfo}get defaultVMetrics(){return this.#cd.defaultVMetrics}}function bw(a){if("string"!=typeof a)return null;if(a.endsWith("/"))return a;throw Error(`Invalid factory url: "${a}" must include trailing slash.`)}let bx=a=>"object"==typeof a&&Number.isInteger(a?.num)&&a.num>=0&&Number.isInteger(a?.gen)&&a.gen>=0,by=(function(a,b,c){if(!Array.isArray(c)||c.length<2)return!1;let[d,e,...f]=c;if(!a(d)&&!Number.isInteger(d)||!b(e))return!1;let g=f.length,h=!0;switch(e.name){case"XYZ":if(g<2||g>3)return!1;break;case"Fit":case"FitB":return 0===g;case"FitH":case"FitBH":case"FitV":case"FitBV":if(g>1)return!1;break;case"FitR":if(4!==g)return!1;h=!1;break;default:return!1}for(let a of f)if("number"!=typeof a&&(!h||null!==a))return!1;return!0}).bind(null,bx,a=>"object"==typeof a&&"string"==typeof a?.name);class bz{#ce=new Map;#cf=Promise.resolve();postMessage(a,b){let c={data:structuredClone(a,b?{transfer:b}:null)};this.#cf.then(()=>{for(let[a]of this.#ce)a.call(this,c)})}addEventListener(a,b,c=null){let d=null;if(c?.signal instanceof AbortSignal){let{signal:e}=c;if(e.aborted)return void ai("LoopbackPort - cannot use an `aborted` signal.");let f=()=>this.removeEventListener(a,b);d=()=>e.removeEventListener("abort",f),e.addEventListener("abort",f)}this.#ce.set(b,d)}removeEventListener(a,b){let c=this.#ce.get(b);c?.(),this.#ce.delete(b)}terminate(){for(let[,a]of this.#ce)a?.();this.#ce.clear()}}function bA(){}function bB(a){if(a instanceof au||a instanceof ar||a instanceof ap||a instanceof as||a instanceof aq)return a;switch(!(a instanceof Error||"object"==typeof a&&null!==a)&&aj('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),a.name){case"AbortException":return new au(a.message);case"InvalidPDFException":return new ar(a.message);case"PasswordException":return new ap(a.message,a.code);case"ResponseException":return new as(a.message,a.status,a.missing);case"UnknownErrorException":return new aq(a.message,a.details)}return new aq(a.message,a.toString())}class bC{#cg=new AbortController;constructor(a,b,c){this.sourceName=a,this.targetName=b,this.comObj=c,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),c.addEventListener("message",this.#ch.bind(this),{signal:this.#cg.signal})}#ch({data:a}){if(a.targetName!==this.sourceName)return;if(a.stream)return void this.#ci(a);if(a.callback){let b=a.callbackId,c=this.callbackCapabilities[b];if(!c)throw Error(`Cannot resolve callback ${b}`);if(delete this.callbackCapabilities[b],1===a.callback)c.resolve(a.data);else if(2===a.callback)c.reject(bB(a.reason));else throw Error("Unexpected callback case");return}let b=this.actionHandler[a.action];if(!b)throw Error(`Unknown action from worker: ${a.action}`);if(a.callbackId){let c=this.sourceName,d=a.sourceName,e=this.comObj;Promise.try(b,a.data).then(function(b){e.postMessage({sourceName:c,targetName:d,callback:1,callbackId:a.callbackId,data:b})},function(b){e.postMessage({sourceName:c,targetName:d,callback:2,callbackId:a.callbackId,reason:bB(b)})});return}a.streamId?this.#cj(a):b(a.data)}on(a,b){let c=this.actionHandler;if(c[a])throw Error(`There is already an actionName called "${a}"`);c[a]=b}send(a,b,c){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,data:b},c)}sendWithPromise(a,b,c){let d=this.callbackId++,e=Promise.withResolvers();this.callbackCapabilities[d]=e;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,callbackId:d,data:b},c)}catch(a){e.reject(a)}return e.promise}sendWithStream(a,b,c,d){let e=this.streamId++,f=this.sourceName,g=this.targetName,h=this.comObj;return new ReadableStream({start:c=>{let i=Promise.withResolvers();return this.streamControllers[e]={controller:c,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:f,targetName:g,action:a,streamId:e,data:b,desiredSize:c.desiredSize},d),i.promise},pull:a=>{let b=Promise.withResolvers();return this.streamControllers[e].pullCall=b,h.postMessage({sourceName:f,targetName:g,stream:6,streamId:e,desiredSize:a.desiredSize}),b.promise},cancel:a=>{ak(a instanceof Error,"cancel must have a valid reason");let b=Promise.withResolvers();return this.streamControllers[e].cancelCall=b,this.streamControllers[e].isClosed=!0,h.postMessage({sourceName:f,targetName:g,stream:1,streamId:e,reason:bB(a)}),b.promise}},c)}#cj(a){let b=a.streamId,c=this.sourceName,d=a.sourceName,e=this.comObj,f=this,g=this.actionHandler[a.action],h={enqueue(a,f=1,g){if(this.isCancelled)return;let h=this.desiredSize;this.desiredSize-=f,h>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),e.postMessage({sourceName:c,targetName:d,stream:4,streamId:b,chunk:a},g)},close(){this.isCancelled||(this.isCancelled=!0,e.postMessage({sourceName:c,targetName:d,stream:3,streamId:b}),delete f.streamSinks[b])},error(a){ak(a instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,e.postMessage({sourceName:c,targetName:d,stream:5,streamId:b,reason:bB(a)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:a.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[b]=h,Promise.try(g,a.data,h).then(function(){e.postMessage({sourceName:c,targetName:d,stream:8,streamId:b,success:!0})},function(a){e.postMessage({sourceName:c,targetName:d,stream:8,streamId:b,reason:bB(a)})})}#ci(a){let b=a.streamId,c=this.sourceName,d=a.sourceName,e=this.comObj,f=this.streamControllers[b],g=this.streamSinks[b];switch(a.stream){case 8:a.success?f.startCall.resolve():f.startCall.reject(bB(a.reason));break;case 7:a.success?f.pullCall.resolve():f.pullCall.reject(bB(a.reason));break;case 6:if(!g){e.postMessage({sourceName:c,targetName:d,stream:7,streamId:b,success:!0});break}g.desiredSize<=0&&a.desiredSize>0&&g.sinkCapability.resolve(),g.desiredSize=a.desiredSize,Promise.try(g.onPull||bA).then(function(){e.postMessage({sourceName:c,targetName:d,stream:7,streamId:b,success:!0})},function(a){e.postMessage({sourceName:c,targetName:d,stream:7,streamId:b,reason:bB(a)})});break;case 4:if(ak(f,"enqueue should have stream controller"),f.isClosed)break;f.controller.enqueue(a.chunk);break;case 3:if(ak(f,"close should have stream controller"),f.isClosed)break;f.isClosed=!0,f.controller.close(),this.#ck(f,b);break;case 5:ak(f,"error should have stream controller"),f.controller.error(bB(a.reason)),this.#ck(f,b);break;case 2:a.success?f.cancelCall.resolve():f.cancelCall.reject(bB(a.reason)),this.#ck(f,b);break;case 1:if(!g)break;let h=bB(a.reason);Promise.try(g.onCancel||bA,h).then(function(){e.postMessage({sourceName:c,targetName:d,stream:2,streamId:b,success:!0})},function(a){e.postMessage({sourceName:c,targetName:d,stream:2,streamId:b,reason:bB(a)})}),g.sinkCapability.reject(h),g.isCancelled=!0,delete this.streamSinks[b];break;default:throw Error("Unexpected stream case")}}async #ck(a,b){await Promise.allSettled([a.startCall?.promise,a.pullCall?.promise,a.cancelCall?.promise]),delete this.streamControllers[b]}destroy(){this.#cg?.abort(),this.#cg=null}}class bD{#cl=!1;constructor({enableHWA:a=!1}){this.#cl=a}create(a,b){if(a<=0||b<=0)throw Error("Invalid canvas size");let c=this._createCanvas(a,b);return{canvas:c,context:c.getContext("2d",{willReadFrequently:!this.#cl})}}reset(a,b,c){if(!a.canvas)throw Error("Canvas is not specified");if(b<=0||c<=0)throw Error("Invalid canvas size");a.canvas.width=b,a.canvas.height=c}destroy(a){if(!a.canvas)throw Error("Canvas is not specified");a.canvas.width=0,a.canvas.height=0,a.canvas=null,a.context=null}_createCanvas(a,b){aj("Abstract method `_createCanvas` called.")}}class bE extends bD{constructor({ownerDocument:a=globalThis.document,enableHWA:b=!1}){super({enableHWA:b}),this._document=a}_createCanvas(a,b){let c=this._document.createElement("canvas");return c.width=a,c.height=b,c}}class bF{constructor({baseUrl:a=null,isCompressed:b=!0}){this.baseUrl=a,this.isCompressed=b}async fetch({name:a}){if(!this.baseUrl)throw Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!a)throw Error("CMap name must be specified.");let b=this.baseUrl+a+(this.isCompressed?".bcmap":"");return this._fetch(b).then(a=>({cMapData:a,isCompressed:this.isCompressed})).catch(a=>{throw Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${b}`)})}async _fetch(a){aj("Abstract method `_fetch` called.")}}class bG extends bF{async _fetch(a){let b=await aL(a,this.isCompressed?"arraybuffer":"text");return b instanceof ArrayBuffer?new Uint8Array(b):aw(b)}}class bH{addFilter(a){return"none"}addHCMFilter(a,b){return"none"}addAlphaFilter(a){return"none"}addLuminosityFilter(a){return"none"}addHighlightHCMFilter(a,b,c,d,e){return"none"}destroy(a=!1){}}class bI extends bH{#cm;#cn;#co;#cp;#cq;#cr;#v=0;constructor({docId:a,ownerDocument:b=globalThis.document}){super(),this.#cp=a,this.#cq=b}get #x(){return this.#cn||=new Map}get #cs(){return this.#cr||=new Map}get #ct(){if(!this.#co){let a=this.#cq.createElement("div"),{style:b}=a;b.visibility="hidden",b.contain="strict",b.width=b.height=0,b.position="absolute",b.top=b.left=0,b.zIndex=-1;let c=this.#cq.createElementNS(aJ,"svg");c.setAttribute("width",0),c.setAttribute("height",0),this.#co=this.#cq.createElementNS(aJ,"defs"),a.append(c),c.append(this.#co),this.#cq.body.append(a)}return this.#co}#cu(a){if(1===a.length){let b=a[0],c=Array(256);for(let a=0;a<256;a++)c[a]=b[a]/255;let d=c.join(",");return[d,d,d]}let[b,c,d]=a,e=Array(256),f=Array(256),g=Array(256);for(let a=0;a<256;a++)e[a]=b[a]/255,f[a]=c[a]/255,g[a]=d[a]/255;return[e.join(","),f.join(","),g.join(",")]}#cv(a){if(void 0===this.#cm){this.#cm="";let a=this.#cq.URL;a!==this.#cq.baseURI&&(aO(a)?ai('#createUrl: ignore "data:"-URL for performance reasons.'):this.#cm=am(a,""))}return`url(${this.#cm}#${a})`}addFilter(a){if(!a)return"none";let b=this.#x.get(a);if(b)return b;let[c,d,e]=this.#cu(a),f=1===a.length?c:`${c}${d}${e}`;if(b=this.#x.get(f))return this.#x.set(a,b),b;let g=`g_${this.#cp}_transfer_map_${this.#v++}`,h=this.#cv(g);this.#x.set(a,h),this.#x.set(f,h);let i=this.#cw(g);return this.#cx(c,d,e,i),h}addHCMFilter(a,b){let c=`${a}-${b}`,d="base",e=this.#cs.get(d);if(e?.key===c||(e?(e.filter?.remove(),e.key=c,e.url="none",e.filter=null):(e={key:c,url:"none",filter:null},this.#cs.set(d,e)),!a||!b))return e.url;let f=this.#cy(a);a=az.makeHexColor(...f);let g=this.#cy(b);if(b=az.makeHexColor(...g),this.#ct.style.color="","#000000"===a&&"#ffffff"===b||a===b)return e.url;let h=Array(256);for(let a=0;a<=255;a++){let b=a/255;h[a]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}let i=h.join(","),j=`g_${this.#cp}_hcm_filter`,k=e.filter=this.#cw(j);this.#cx(i,i,i,k),this.#cz(k);let l=(a,b)=>{let c=f[a]/255,d=g[a]/255,e=Array(b+1);for(let a=0;a<=b;a++)e[a]=c+a/b*(d-c);return e.join(",")};return this.#cx(l(0,5),l(1,5),l(2,5),k),e.url=this.#cv(j),e.url}addAlphaFilter(a){let b=this.#x.get(a);if(b)return b;let[c]=this.#cu([a]),d=`alpha_${c}`;if(b=this.#x.get(d))return this.#x.set(a,b),b;let e=`g_${this.#cp}_alpha_map_${this.#v++}`,f=this.#cv(e);this.#x.set(a,f),this.#x.set(d,f);let g=this.#cw(e);return this.#cA(c,g),f}addLuminosityFilter(a){let b,c,d=this.#x.get(a||"luminosity");if(d)return d;if(a?([b]=this.#cu([a]),c=`luminosity_${b}`):c="luminosity",d=this.#x.get(c))return this.#x.set(a,d),d;let e=`g_${this.#cp}_luminosity_map_${this.#v++}`,f=this.#cv(e);this.#x.set(a,f),this.#x.set(c,f);let g=this.#cw(e);return this.#cB(g),a&&this.#cA(b,g),f}addHighlightHCMFilter(a,b,c,d,e){let f=`${b}-${c}-${d}-${e}`,g=this.#cs.get(a);if(g?.key===f||(g?(g.filter?.remove(),g.key=f,g.url="none",g.filter=null):(g={key:f,url:"none",filter:null},this.#cs.set(a,g)),!b||!c))return g.url;let[h,i]=[b,c].map(this.#cy.bind(this)),j=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),k=Math.round(.2126*i[0]+.7152*i[1]+.0722*i[2]),[l,m]=[d,e].map(this.#cy.bind(this));k<j&&([j,k,l,m]=[k,j,m,l]),this.#ct.style.color="";let n=(a,b,c)=>{let d=Array(256),e=(k-j)/c,f=a/255,g=(b-a)/(255*c),h=0;for(let a=0;a<=c;a++){let b=Math.round(j+a*e),c=f+a*g;for(let a=h;a<=b;a++)d[a]=c;h=b+1}for(let a=h;a<256;a++)d[a]=d[h-1];return d.join(",")},o=`g_${this.#cp}_hcm_${a}_filter`,p=g.filter=this.#cw(o);return this.#cz(p),this.#cx(n(l[0],m[0],5),n(l[1],m[1],5),n(l[2],m[2],5),p),g.url=this.#cv(o),g.url}destroy(a=!1){a&&this.#cr?.size||(this.#co?.parentNode.parentNode.remove(),this.#co=null,this.#cn?.clear(),this.#cn=null,this.#cr?.clear(),this.#cr=null,this.#v=0)}#cB(a){let b=this.#cq.createElementNS(aJ,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),a.append(b)}#cz(a){let b=this.#cq.createElementNS(aJ,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),a.append(b)}#cw(a){let b=this.#cq.createElementNS(aJ,"filter");return b.setAttribute("color-interpolation-filters","sRGB"),b.setAttribute("id",a),this.#ct.append(b),b}#cC(a,b,c){let d=this.#cq.createElementNS(aJ,b);d.setAttribute("type","discrete"),d.setAttribute("tableValues",c),a.append(d)}#cx(a,b,c,d){let e=this.#cq.createElementNS(aJ,"feComponentTransfer");d.append(e),this.#cC(e,"feFuncR",a),this.#cC(e,"feFuncG",b),this.#cC(e,"feFuncB",c)}#cA(a,b){let c=this.#cq.createElementNS(aJ,"feComponentTransfer");b.append(c),this.#cC(c,"feFuncA",a)}#cy(a){return this.#ct.style.color=a,aY(getComputedStyle(this.#ct).getPropertyValue("color"))}}class bJ{constructor({baseUrl:a=null}){this.baseUrl=a}async fetch({filename:a}){if(!this.baseUrl)throw Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!a)throw Error("Font filename must be specified.");let b=`${this.baseUrl}${a}`;return this._fetch(b).catch(a=>{throw Error(`Unable to load font data at: ${b}`)})}async _fetch(a){aj("Abstract method `_fetch` called.")}}class bK extends bJ{async _fetch(a){return new Uint8Array(await aL(a,"arraybuffer"))}}class bL{constructor({baseUrl:a=null}){this.baseUrl=a}async fetch({filename:a}){if(!this.baseUrl)throw Error("Ensure that the `wasmUrl` API parameter is provided.");if(!a)throw Error("Wasm filename must be specified.");let b=`${this.baseUrl}${a}`;return this._fetch(b).catch(a=>{throw Error(`Unable to load wasm data at: ${b}`)})}async _fetch(a){aj("Abstract method `_fetch` called.")}}class bM extends bL{async _fetch(a){return new Uint8Array(await aL(a,"arraybuffer"))}}async function bN(a){let b=process.getBuiltinModule("fs");return new Uint8Array(await b.promises.readFile(a))}W&&ai("Please use the `legacy` build in Node.js environments.");class bO extends bH{}class bP extends bD{_createCanvas(a,b){return process.getBuiltinModule("module").createRequire(U.url)("@napi-rs/canvas").createCanvas(a,b)}}class bQ extends bF{async _fetch(a){return bN(a)}}class bR extends bJ{async _fetch(a){return bN(a)}}class bS extends bL{async _fetch(a){return bN(a)}}let bT="__forcedDependency",{floor:bU,ceil:bV}=Math;function bW(a,b,c,d,e,f){a[4*b+0]=Math.min(a[4*b+0],c),a[4*b+1]=Math.min(a[4*b+1],d),a[4*b+2]=Math.max(a[4*b+2],e),a[4*b+3]=Math.max(a[4*b+3],f)}let bX=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class bY{#cD;#cE;constructor(a,b){this.#cD=a,this.#cE=b}get length(){return this.#cD.length}isEmpty(a){return this.#cD[a]===bX}minX(a){return this.#cE[4*a+0]/256}minY(a){return this.#cE[4*a+1]/256}maxX(a){return(this.#cE[4*a+2]+1)/256}maxY(a){return(this.#cE[4*a+3]+1)/256}}let bZ=(a,b)=>{if(!a)return;let c=a.get(b);return c||(c={dependencies:new Set,isRenderingOperation:!1},a.set(b,c)),c};class b${#cF={__proto__:null};#cG={__proto__:null,transform:[],moveText:[],sameLineText:[],[bT]:[]};#cH=new Map;#cI=[];#cJ=[];#cK=[[1,0,0,1,0,0]];#cL=[-1/0,-1/0,1/0,1/0];#cM=new Float64Array([1/0,1/0,-1/0,-1/0]);#cN=-1;#cO=new Set;#cP=new Map;#cQ=new Map;#cR;#cS;#cT;#cD;#cU;constructor(a,b,c=!1){this.#cR=a.width,this.#cS=a.height,this.#cV(b),c&&(this.#cU=new Map)}growOperationsCount(a){a>=this.#cD.length&&this.#cV(a,this.#cD)}#cV(a,b){let c=new ArrayBuffer(4*a);this.#cT=new Uint8ClampedArray(c),this.#cD=new Uint32Array(c),b&&b.length>0?(this.#cD.set(b),this.#cD.fill(bX,b.length)):this.#cD.fill(bX)}save(a){return this.#cF={__proto__:this.#cF},this.#cG={__proto__:this.#cG,transform:{__proto__:this.#cG.transform},moveText:{__proto__:this.#cG.moveText},sameLineText:{__proto__:this.#cG.sameLineText},[bT]:{__proto__:this.#cG[bT]}},this.#cL={__proto__:this.#cL},this.#cI.push(a),this}restore(a){let b=Object.getPrototypeOf(this.#cF);if(null===b)return this;this.#cF=b,this.#cG=Object.getPrototypeOf(this.#cG),this.#cL=Object.getPrototypeOf(this.#cL);let c=this.#cI.pop();return void 0!==c&&(bZ(this.#cU,a)?.dependencies.add(c),this.#cD[a]=this.#cD[c]),this}recordOpenMarker(a){return this.#cI.push(a),this}getOpenMarker(){return 0===this.#cI.length?null:this.#cI.at(-1)}recordCloseMarker(a){let b=this.#cI.pop();return void 0!==b&&(bZ(this.#cU,a)?.dependencies.add(b),this.#cD[a]=this.#cD[b]),this}beginMarkedContent(a){return this.#cJ.push(a),this}endMarkedContent(a){let b=this.#cJ.pop();return void 0!==b&&(bZ(this.#cU,a)?.dependencies.add(b),this.#cD[a]=this.#cD[b]),this}pushBaseTransform(a){return this.#cK.push(az.multiplyByDOMMatrix(this.#cK.at(-1),a.getTransform())),this}popBaseTransform(){return this.#cK.length>1&&this.#cK.pop(),this}recordSimpleData(a,b){return this.#cF[a]=b,this}recordIncrementalData(a,b){return this.#cG[a].push(b),this}resetIncrementalData(a,b){return this.#cG[a].length=0,this}recordNamedData(a,b){return this.#cH.set(a,b),this}recordSimpleDataFromNamed(a,b,c){this.#cF[a]=this.#cH.get(b)??c}recordFutureForcedDependency(a,b){return this.recordIncrementalData(bT,b),this}inheritSimpleDataAsFutureForcedDependencies(a){for(let b of a)b in this.#cF&&this.recordFutureForcedDependency(b,this.#cF[b]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(let a of this.#cO)this.recordFutureForcedDependency(bT,a);return this}resetBBox(a){return this.#cN!==a&&(this.#cN=a,this.#cM[0]=1/0,this.#cM[1]=1/0,this.#cM[2]=-1/0,this.#cM[3]=-1/0),this}recordClipBox(a,b,c,d,e,f){let g=az.multiplyByDOMMatrix(this.#cK.at(-1),b.getTransform()),h=[1/0,1/0,-1/0,-1/0];az.axialAlignedBoundingBox([c,e,d,f],g,h);let i=az.intersect(this.#cL,h);return i?(this.#cL[0]=i[0],this.#cL[1]=i[1],this.#cL[2]=i[2],this.#cL[3]=i[3]):(this.#cL[0]=this.#cL[1]=1/0,this.#cL[2]=this.#cL[3]=-1/0),this}recordBBox(a,b,c,d,e,f){let g=this.#cL;if(g[0]===1/0)return this;let h=az.multiplyByDOMMatrix(this.#cK.at(-1),b.getTransform());if(g[0]===-1/0)return az.axialAlignedBoundingBox([c,e,d,f],h,this.#cM),this;let i=[1/0,1/0,-1/0,-1/0];return az.axialAlignedBoundingBox([c,e,d,f],h,i),this.#cM[0]=Math.min(this.#cM[0],Math.max(i[0],g[0])),this.#cM[1]=Math.min(this.#cM[1],Math.max(i[1],g[1])),this.#cM[2]=Math.max(this.#cM[2],Math.min(i[2],g[2])),this.#cM[3]=Math.max(this.#cM[3],Math.min(i[3],g[3])),this}recordCharacterBBox(a,b,c,d=1,e=0,f=0,g){let h,i,j=c.bbox;if(j&&!1!==(h=j[2]!==j[0]&&j[3]!==j[1]&&this.#cQ.get(c))&&(i=[0,0,0,0],az.axialAlignedBoundingBox(j,c.fontMatrix,i),(1!==d||0!==e||0!==f)&&az.scaleMinMax([d,0,0,-d,e,f],i),h))return this.recordBBox(a,b,i[0],i[2],i[1],i[3]);if(!g)return this.recordFullPageBBox(a);let k=g();return j&&i&&void 0===h&&(h=i[0]<=e-k.actualBoundingBoxLeft&&i[2]>=e+k.actualBoundingBoxRight&&i[1]<=f-k.actualBoundingBoxAscent&&i[3]>=f+k.actualBoundingBoxDescent,this.#cQ.set(c,h),h)?this.recordBBox(a,b,i[0],i[2],i[1],i[3]):this.recordBBox(a,b,e-k.actualBoundingBoxLeft,e+k.actualBoundingBoxRight,f-k.actualBoundingBoxAscent,f+k.actualBoundingBoxDescent)}recordFullPageBBox(a){return this.#cM[0]=Math.max(0,this.#cL[0]),this.#cM[1]=Math.max(0,this.#cL[1]),this.#cM[2]=Math.min(this.#cR,this.#cL[2]),this.#cM[3]=Math.min(this.#cS,this.#cL[3]),this}getSimpleIndex(a){return this.#cF[a]}recordDependencies(a,b){let c=this.#cO,d=this.#cF,e=this.#cG;for(let a of b)a in this.#cF?c.add(d[a]):a in e&&e[a].forEach(c.add,c);return this}recordNamedDependency(a,b){return this.#cH.has(b)&&this.#cO.add(this.#cH.get(b)),this}recordOperation(a,b=!1){if(this.recordDependencies(a,[bT]),this.#cU){let b=bZ(this.#cU,a),{dependencies:c}=b;this.#cO.forEach(c.add,c),this.#cI.forEach(c.add,c),this.#cJ.forEach(c.add,c),c.delete(a),b.isRenderingOperation=!0}if(this.#cN===a){let c=bU(256*this.#cM[0]/this.#cR),d=bU(256*this.#cM[1]/this.#cS),e=bV(256*this.#cM[2]/this.#cR),f=bV(256*this.#cM[3]/this.#cS);for(let b of(bW(this.#cT,a,c,d,e,f),this.#cO))b!==a&&bW(this.#cT,b,c,d,e,f);for(let b of this.#cI)b!==a&&bW(this.#cT,b,c,d,e,f);for(let b of this.#cJ)b!==a&&bW(this.#cT,b,c,d,e,f);b||(this.#cO.clear(),this.#cN=-1)}return this}recordShowTextOperation(a,b=!1){let c=Array.from(this.#cO);for(let d of(this.recordOperation(a,b),this.recordIncrementalData("sameLineText",a),c))this.recordIncrementalData("sameLineText",d);return this}bboxToClipBoxDropOperation(a,b=!1){return this.#cN===a&&(this.#cN=-1,this.#cL[0]=Math.max(this.#cL[0],this.#cM[0]),this.#cL[1]=Math.max(this.#cL[1],this.#cM[1]),this.#cL[2]=Math.min(this.#cL[2],this.#cM[2]),this.#cL[3]=Math.min(this.#cL[3],this.#cM[3]),b||this.#cO.clear()),this}_takePendingDependencies(){let a=this.#cO;return this.#cO=new Set,a}_extractOperation(a){let b=this.#cP.get(a);return this.#cP.delete(a),b}_pushPendingDependencies(a){for(let b of a)this.#cO.add(b)}take(){return this.#cQ.clear(),new bY(this.#cD,this.#cT)}takeDebugMetadata(){return this.#cU}}class b_{#cW;#cX;#cY;#cZ=0;#c$=0;constructor(a,b,c){if(a instanceof b_&&!!c===a.#cY)return a;this.#cW=a,this.#cX=b,this.#cY=!!c}growOperationsCount(){throw Error("Unreachable")}save(a){return this.#c$++,this.#cW.save(this.#cX),this}restore(a){return this.#c$>0&&(this.#cW.restore(this.#cX),this.#c$--),this}recordOpenMarker(a){return this.#cZ++,this}getOpenMarker(){return this.#cZ>0?this.#cX:this.#cW.getOpenMarker()}recordCloseMarker(a){return this.#cZ--,this}beginMarkedContent(a){return this}endMarkedContent(a){return this}pushBaseTransform(a){return this.#cW.pushBaseTransform(a),this}popBaseTransform(){return this.#cW.popBaseTransform(),this}recordSimpleData(a,b){return this.#cW.recordSimpleData(a,this.#cX),this}recordIncrementalData(a,b){return this.#cW.recordIncrementalData(a,this.#cX),this}resetIncrementalData(a,b){return this.#cW.resetIncrementalData(a,this.#cX),this}recordNamedData(a,b){return this}recordSimpleDataFromNamed(a,b,c){return this.#cW.recordSimpleDataFromNamed(a,b,this.#cX),this}recordFutureForcedDependency(a,b){return this.#cW.recordFutureForcedDependency(a,this.#cX),this}inheritSimpleDataAsFutureForcedDependencies(a){return this.#cW.inheritSimpleDataAsFutureForcedDependencies(a),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#cW.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(a){return this.#cY||this.#cW.resetBBox(this.#cX),this}recordClipBox(a,b,c,d,e,f){return this.#cY||this.#cW.recordClipBox(this.#cX,b,c,d,e,f),this}recordBBox(a,b,c,d,e,f){return this.#cY||this.#cW.recordBBox(this.#cX,b,c,d,e,f),this}recordCharacterBBox(a,b,c,d,e,f,g){return this.#cY||this.#cW.recordCharacterBBox(this.#cX,b,c,d,e,f,g),this}recordFullPageBBox(a){return this.#cY||this.#cW.recordFullPageBBox(this.#cX),this}getSimpleIndex(a){return this.#cW.getSimpleIndex(a)}recordDependencies(a,b){return this.#cW.recordDependencies(this.#cX,b),this}recordNamedDependency(a,b){return this.#cW.recordNamedDependency(this.#cX,b),this}recordOperation(a){return this.#cW.recordOperation(this.#cX,!0),this}recordShowTextOperation(a){return this.#cW.recordShowTextOperation(this.#cX,!0),this}bboxToClipBoxDropOperation(a){return this.#cY||this.#cW.bboxToClipBoxDropOperation(this.#cX,!0),this}take(){throw Error("Unreachable")}takeDebugMetadata(){throw Error("Unreachable")}}let b0=["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],b1=["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],b2=["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],b3=["filter","fillColor","fillAlpha"],b4=["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],b5=["transform"],b6=["transform","fillColor"],b7="Fill",b8="Stroke",b9="Shading";function ca(a,b){if(!b)return;let c=b[2]-b[0],d=b[3]-b[1],e=new Path2D;e.rect(b[0],b[1],c,d),a.clip(e)}class cb{isModifyingCurrentTransform(){return!1}getPattern(){aj("Abstract method `getPattern` called.")}}class cc extends cb{constructor(a){super(),this._type=a[1],this._bbox=a[2],this._colorStops=a[3],this._p0=a[4],this._p1=a[5],this._r0=a[6],this._r1=a[7],this.matrix=null}_createGradient(a){let b;for(let c of("axial"===this._type?b=a.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(b=a.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)),this._colorStops))b.addColorStop(c[0],c[1]);return b}getPattern(a,b,c,d){let e;if(d===b8||d===b7){let f=b.current.getClippedPathBoundingBox(d,aZ(a))||[0,0,0,0],g=Math.ceil(f[2]-f[0])||1,h=Math.ceil(f[3]-f[1])||1,i=b.cachedCanvases.getCanvas("pattern",g,h),j=i.context;j.clearRect(0,0,j.canvas.width,j.canvas.height),j.beginPath(),j.rect(0,0,j.canvas.width,j.canvas.height),j.translate(-f[0],-f[1]),c=az.transform(c,[1,0,0,1,f[0],f[1]]),j.transform(...b.baseTransform),this.matrix&&j.transform(...this.matrix),ca(j,this._bbox),j.fillStyle=this._createGradient(j),j.fill(),e=a.createPattern(i.canvas,"no-repeat");let k=new DOMMatrix(c);e.setTransform(k)}else ca(a,this._bbox),e=this._createGradient(a);return e}}function cd(a,b,c,d,e,f,g,h){let i,j,k,l,m,n,o,p,q,r=b.coords,s=b.colors,t=a.data,u=4*a.width;r[c+1]>r[d+1]&&(i=c,c=d,d=i,i=f,f=g,g=i),r[d+1]>r[e+1]&&(i=d,d=e,e=i,i=g,g=h,h=i),r[c+1]>r[d+1]&&(i=c,c=d,d=i,i=f,f=g,g=i);let v=(r[c]+b.offsetX)*b.scaleX,w=(r[c+1]+b.offsetY)*b.scaleY,x=(r[d]+b.offsetX)*b.scaleX,y=(r[d+1]+b.offsetY)*b.scaleY,z=(r[e]+b.offsetX)*b.scaleX,A=(r[e+1]+b.offsetY)*b.scaleY;if(w>=A)return;let B=s[f],C=s[f+1],D=s[f+2],E=s[g],F=s[g+1],G=s[g+2],H=s[h],I=s[h+1],J=s[h+2],K=Math.round(w),L=Math.round(A);for(let a=K;a<=L;a++){let b;if(a<y){let b=a<w?0:(w-a)/(w-y);j=v-(v-x)*b,k=B-(B-E)*b,l=C-(C-F)*b,m=D-(D-G)*b}else{let b;j=x-(x-z)*(b=a>A?1:y===A?0:(y-a)/(y-A)),k=E-(E-H)*b,l=F-(F-I)*b,m=G-(G-J)*b}n=v-(v-z)*(b=a<w?0:a>A?1:(w-a)/(w-A)),o=B-(B-H)*b,p=C-(C-I)*b,q=D-(D-J)*b;let c=Math.round(Math.min(j,n)),d=Math.round(Math.max(j,n)),e=u*a+4*c;for(let a=c;a<=d;a++)(b=(j-a)/(j-n))<0?b=0:b>1&&(b=1),t[e++]=k-(k-o)*b|0,t[e++]=l-(l-p)*b|0,t[e++]=m-(m-q)*b|0,t[e++]=255}}class ce extends cb{constructor(a){super(),this._coords=a[2],this._colors=a[3],this._figures=a[4],this._bounds=a[5],this._bbox=a[6],this._background=a[7],this.matrix=null}_createMeshCanvas(a,b,c){let d=Math.floor(this._bounds[0]),e=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-d,g=Math.ceil(this._bounds[3])-e,h=Math.min(Math.ceil(Math.abs(f*a[0]*1.1)),3e3),i=Math.min(Math.ceil(Math.abs(g*a[1]*1.1)),3e3),j=f/h,k=g/i,l={coords:this._coords,colors:this._colors,offsetX:-d,offsetY:-e,scaleX:1/j,scaleY:1/k},m=h+4,n=i+4,o=c.getCanvas("mesh",m,n),p=o.context,q=p.createImageData(h,i);if(b){let a=q.data;for(let c=0,d=a.length;c<d;c+=4)a[c]=b[0],a[c+1]=b[1],a[c+2]=b[2],a[c+3]=255}for(let a of this._figures)!function(a,b,c){let d,e,f=b.coords,g=b.colors;switch(b.type){case"lattice":let h=b.verticesPerRow,i=Math.floor(f.length/h)-1,j=h-1;for(d=0;d<i;d++){let b=d*h;for(let d=0;d<j;d++,b++)cd(a,c,f[b],f[b+1],f[b+h],g[b],g[b+1],g[b+h]),cd(a,c,f[b+h+1],f[b+1],f[b+h],g[b+h+1],g[b+1],g[b+h])}break;case"triangles":for(d=0,e=f.length;d<e;d+=3)cd(a,c,f[d],f[d+1],f[d+2],g[d],g[d+1],g[d+2]);break;default:throw Error("illegal figure")}}(q,a,l);return p.putImageData(q,2,2),{canvas:o.canvas,offsetX:d-2*j,offsetY:e-2*k,scaleX:j,scaleY:k}}isModifyingCurrentTransform(){return!0}getPattern(a,b,c,d){ca(a,this._bbox);let e=new Float32Array(2);if(d===b9)az.singularValueDecompose2dScale(aZ(a),e);else if(this.matrix){az.singularValueDecompose2dScale(this.matrix,e);let[a,c]=e;az.singularValueDecompose2dScale(b.baseTransform,e),e[0]*=a,e[1]*=c}else az.singularValueDecompose2dScale(b.baseTransform,e);let f=this._createMeshCanvas(e,d===b9?null:this._background,b.cachedCanvases);return d!==b9&&(a.setTransform(...b.baseTransform),this.matrix&&a.transform(...this.matrix)),a.translate(f.offsetX,f.offsetY),a.scale(f.scaleX,f.scaleY),a.createPattern(f.canvas,"no-repeat")}}class cf extends cb{getPattern(){return"hotpink"}}class cg{static MAX_PATTERN_SIZE=3e3;constructor(a,b,c,d){this.color=a[1],this.operatorList=a[2],this.matrix=a[3],this.bbox=a[4],this.xstep=a[5],this.ystep=a[6],this.paintType=a[7],this.tilingType=a[8],this.ctx=b,this.canvasGraphicsFactory=c,this.baseTransform=d}createPatternCanvas(a,b){let{bbox:c,operatorList:d,paintType:e,tilingType:f,color:g,canvasGraphicsFactory:h}=this,{xstep:i,ystep:j}=this;i=Math.abs(i),j=Math.abs(j),ah("TilingType: "+f);let k=c[0],l=c[1],m=c[2],n=c[3],o=m-k,p=n-l,q=new Float32Array(2);az.singularValueDecompose2dScale(this.matrix,q);let[r,s]=q;az.singularValueDecompose2dScale(this.baseTransform,q);let t=r*q[0],u=s*q[1],v=o,w=p,x=!1,y=!1,z=Math.ceil(j*u),A=Math.ceil(p*u);Math.ceil(i*t)>=Math.ceil(o*t)?v=i:x=!0,z>=A?w=j:y=!0;let B=this.getSizeAndScale(v,this.ctx.canvas.width,t),C=this.getSizeAndScale(w,this.ctx.canvas.height,u),D=a.cachedCanvases.getCanvas("pattern",B.size,C.size),E=D.context,F=h.createCanvasGraphics(E,b);if(F.groupLevel=a.groupLevel,this.setFillAndStrokeStyleToContext(F,e,g),E.translate(-B.scale*k,-C.scale*l),F.transform(0,B.scale,0,0,C.scale,0,0),E.save(),F.dependencyTracker?.save(),this.clipBbox(F,k,l,m,n),F.baseTransform=aZ(F.ctx),F.executeOperatorList(d),F.endDrawing(),F.dependencyTracker?.restore(),E.restore(),x||y){let b=D.canvas;x&&(v=i),y&&(w=j);let c=this.getSizeAndScale(v,this.ctx.canvas.width,t),d=this.getSizeAndScale(w,this.ctx.canvas.height,u),e=c.size,f=d.size,g=a.cachedCanvases.getCanvas("pattern-workaround",e,f),h=g.context,m=x?Math.floor(o/i):0,n=y?Math.floor(p/j):0;for(let a=0;a<=m;a++)for(let c=0;c<=n;c++)h.drawImage(b,e*a,f*c,e,f,0,0,e,f);return{canvas:g.canvas,scaleX:c.scale,scaleY:d.scale,offsetX:k,offsetY:l}}return{canvas:D.canvas,scaleX:B.scale,scaleY:C.scale,offsetX:k,offsetY:l}}getSizeAndScale(a,b,c){let d=Math.max(cg.MAX_PATTERN_SIZE,b),e=Math.ceil(a*c);return e>=d?e=d:c=e/a,{scale:c,size:e}}clipBbox(a,b,c,d,e){let f=d-b,g=e-c;a.ctx.rect(b,c,f,g),az.axialAlignedBoundingBox([b,c,d,e],aZ(a.ctx),a.current.minMax),a.clip(),a.endPath()}setFillAndStrokeStyleToContext(a,b,c){let d=a.ctx,e=a.current;switch(b){case 1:let{fillStyle:f,strokeStyle:g}=this.ctx;d.fillStyle=e.fillColor=f,d.strokeStyle=e.strokeColor=g;break;case 2:d.fillStyle=d.strokeStyle=c,e.fillColor=e.strokeColor=c;break;default:throw new at(`Unsupported paint type: ${b}`)}}isModifyingCurrentTransform(){return!1}getPattern(a,b,c,d,e){let f=c;d!==b9&&(f=az.transform(f,b.baseTransform),this.matrix&&(f=az.transform(f,this.matrix)));let g=this.createPatternCanvas(b,e),h=new DOMMatrix(f);h=(h=h.translate(g.offsetX,g.offsetY)).scale(1/g.scaleX,1/g.scaleY);let i=a.createPattern(g.canvas,"repeat");return i.setTransform(h),i}}let ch=new DOMMatrix,ci=new Float32Array(2),cj=new Float32Array([1/0,1/0,-1/0,-1/0]);class ck{constructor(a){this.canvasFactory=a,this.cache=Object.create(null)}getCanvas(a,b,c){let d;return void 0!==this.cache[a]?(d=this.cache[a],this.canvasFactory.reset(d,b,c)):(d=this.canvasFactory.create(b,c),this.cache[a]=d),d}delete(a){delete this.cache[a]}clear(){for(let a in this.cache){let b=this.cache[a];this.canvasFactory.destroy(b),delete this.cache[a]}}}function cl(a,b,c,d,e,f,g,h,i,j){let[k,l,m,n,o,p]=aZ(a);if(0===l&&0===m){let q=Math.round(g*k+o),r=Math.round(h*n+p),s=Math.abs(Math.round((g+i)*k+o)-q)||1,t=Math.abs(Math.round((h+j)*n+p)-r)||1;return a.setTransform(Math.sign(k),0,0,Math.sign(n),q,r),a.drawImage(b,c,d,e,f,0,0,s,t),a.setTransform(k,l,m,n,o,p),[s,t]}if(0===k&&0===n){let q=Math.round(h*m+o),r=Math.round(g*l+p),s=Math.abs(Math.round((h+j)*m+o)-q)||1,t=Math.abs(Math.round((g+i)*l+p)-r)||1;return a.setTransform(0,Math.sign(l),Math.sign(m),0,q,r),a.drawImage(b,c,d,e,f,0,0,t,s),a.setTransform(k,l,m,n,o,p),[t,s]}return a.drawImage(b,c,d,e,f,g,h,i,j),[Math.hypot(k,l)*i,Math.hypot(m,n)*j]}class cm{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=X;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=0;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(a,b,c){c?.(this),this.clipBox=new Float32Array([0,0,a,b]),this.minMax=cj.slice()}clone(){let a=Object.create(this);return a.clipBox=this.clipBox.slice(),a.minMax=this.minMax.slice(),a}getPathBoundingBox(a=b7,b=null){let c=this.minMax.slice();if(a===b8){b||aj("Stroke bounding box must include transform."),az.singularValueDecompose2dScale(b,ci);let a=ci[0]*this.lineWidth/2,d=ci[1]*this.lineWidth/2;c[0]-=a,c[1]-=d,c[2]+=a,c[3]+=d}return c}updateClipFromPath(){let a=az.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(a||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(a){this.clipBox.set(a,0),this.minMax.set(cj,0)}getClippedPathBoundingBox(a=b7,b=null){return az.intersect(this.clipBox,this.getPathBoundingBox(a,b))}}function cn(a,b){let c,d,e,f;if(b instanceof ImageData)return void a.putImageData(b,0,0);let g=b.height,h=b.width,i=g%16,j=(g-i)/16,k=0===i?j:j+1,l=a.createImageData(h,16),m=0,n,o=b.data,p=l.data;if(b.kind===ab.GRAYSCALE_1BPP){let b=o.byteLength,f=new Uint32Array(p.buffer,0,p.byteLength>>2),g=f.length,q=h+7>>3,r=ax.isLittleEndian?0xff000000:255;for(c=0;c<k;c++){for(d=0,e=c<j?16:i,n=0;d<e;d++){let a=b-m,c=0,d=a>q?h:8*a-7,e=-8&d,g=0,i=0;for(;c<e;c+=8)i=o[m++],f[n++]=128&i?0xffffffff:r,f[n++]=64&i?0xffffffff:r,f[n++]=32&i?0xffffffff:r,f[n++]=16&i?0xffffffff:r,f[n++]=8&i?0xffffffff:r,f[n++]=4&i?0xffffffff:r,f[n++]=2&i?0xffffffff:r,f[n++]=1&i?0xffffffff:r;for(;c<d;c++)0===g&&(i=o[m++],g=128),f[n++]=i&g?0xffffffff:r,g>>=1}for(;n<g;)f[n++]=0;a.putImageData(l,0,16*c)}}else if(b.kind===ab.RGBA_32BPP){for(c=0,d=0,f=16*h*4;c<j;c++)p.set(o.subarray(m,m+f)),m+=f,a.putImageData(l,0,d),d+=16;c<k&&(f=h*i*4,p.set(o.subarray(m,m+f)),a.putImageData(l,0,d))}else if(b.kind===ab.RGB_24BPP)for(c=0,f=h*(e=16);c<k;c++){for(c>=j&&(f=h*(e=i)),n=0,d=f;d--;)p[n++]=o[m++],p[n++]=o[m++],p[n++]=o[m++],p[n++]=255;a.putImageData(l,0,16*c)}else throw Error(`bad image kind: ${b.kind}`)}function co(a,b){if(b.bitmap)return void a.drawImage(b.bitmap,0,0);let c=b.height,d=b.width,e=c%16,f=(c-e)/16,g=0===e?f:f+1,h=a.createImageData(d,16),i=0,j=b.data,k=h.data;for(let b=0;b<g;b++){let c=b<f?16:e;({srcPos:i}=function({src:a,srcPos:b=0,dest:c,width:d,height:e,nonBlackColor:f=0xffffffff,inverseDecode:g=!1}){let h=ax.isLittleEndian?0xff000000:255,[i,j]=g?[f,h]:[h,f],k=d>>3,l=7&d,m=a.length;c=new Uint32Array(c.buffer);let n=0;for(let d=0;d<e;d++){for(let d=b+k;b<d;b++){let d=b<m?a[b]:255;c[n++]=128&d?j:i,c[n++]=64&d?j:i,c[n++]=32&d?j:i,c[n++]=16&d?j:i,c[n++]=8&d?j:i,c[n++]=4&d?j:i,c[n++]=2&d?j:i,c[n++]=1&d?j:i}if(0===l)continue;let d=b<m?a[b++]:255;for(let a=0;a<l;a++)c[n++]=d&1<<7-a?j:i}return{srcPos:b,destPos:n}}({src:j,srcPos:i,dest:k,width:d,height:c,nonBlackColor:0})),a.putImageData(h,0,16*b)}}function cp(a,b){for(let c of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==a[c]&&(b[c]=a[c]);void 0!==a.setLineDash&&(b.setLineDash(a.getLineDash()),b.lineDashOffset=a.lineDashOffset)}function cq(a){a.strokeStyle=a.fillStyle="#000000",a.fillRule="nonzero",a.globalAlpha=1,a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter",a.miterLimit=10,a.globalCompositeOperation="source-over",a.font="10px sans-serif",void 0!==a.setLineDash&&(a.setLineDash([]),a.lineDashOffset=0);let{filter:b}=a;"none"!==b&&""!==b&&(a.filter="none")}function cr(a,b){if(b)return!0;az.singularValueDecompose2dScale(a,ci);let c=Math.fround(a0.pixelRatio*aK.PDF_TO_CSS_UNITS);return ci[0]<=c&&ci[1]<=c}let cs=["butt","round","square"],ct=["miter","round","bevel"],cu={},cv={};class cw{constructor(a,b,c,d,e,{optionalContentConfig:f,markedContentStack:g=null},h,i,j){this.ctx=a,this.current=new cm(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=b,this.objs=c,this.canvasFactory=d,this.filterFactory=e,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=g||[],this.optionalContentConfig=f,this.cachedCanvases=new ck(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=i,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=j??null}getObject(a,b,c=null){return"string"==typeof b?(this.dependencyTracker?.recordNamedDependency(a,b),b.startsWith("g_")?this.commonObjs.get(b):this.objs.get(b)):c}beginDrawing({transform:a,viewport:b,transparency:c=!1,background:d=null}){let e=this.ctx.canvas.width,f=this.ctx.canvas.height,g=this.ctx.fillStyle;if(this.ctx.fillStyle=d||"#ffffff",this.ctx.fillRect(0,0,e,f),this.ctx.fillStyle=g,c){let a=this.cachedCanvases.getCanvas("transparent",e,f);this.compositeCtx=this.ctx,this.transparentCanvas=a.canvas,this.ctx=a.context,this.ctx.save(),this.ctx.transform(...aZ(this.compositeCtx))}this.ctx.save(),cq(this.ctx),a&&(this.ctx.transform(...a),this.outputScaleX=a[0],this.outputScaleY=a[0]),this.ctx.transform(...b.transform),this.viewportScale=b.scale,this.baseTransform=aZ(this.ctx)}executeOperatorList(a,b,c,d,e){let f,g,h=a.argsArray,i=a.fnArray,j=b||0,k=h.length;if(k===j)return j;let l=k-j>10&&"function"==typeof c,m=l?Date.now()+15:0,n=0,o=this.commonObjs,p=this.objs;for(;;){if(void 0!==d&&j===d.nextBreakPoint)return d.breakIt(j,c),j;if(!e||e(j))if(f=i[j],g=h[j]??null,f!==ae.dependency)null===g?this[f](j):this[f](j,...g);else for(let a of g){this.dependencyTracker?.recordNamedData(a,j);let b=a.startsWith("g_")?o:p;if(!b.has(a))return b.get(a,c),j}if(++j===k)return j;if(l&&++n>10){if(Date.now()>m)return c(),j;n=0}}}#c_(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){for(let a of(this.#c_(),this.cachedCanvases.clear(),this.cachedPatterns.clear(),this._cachedBitmapsMap.values())){for(let b of a.values())"undefined"!=typeof HTMLCanvasElement&&b instanceof HTMLCanvasElement&&(b.width=b.height=0);a.clear()}this._cachedBitmapsMap.clear(),this.#c0()}#c0(){if(this.pageColors){let a=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==a){let b=this.ctx.filter;this.ctx.filter=a,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=b}}}_scaleImage(a,b){let c,d,e=a.width??a.displayWidth,f=a.height??a.displayHeight,g=Math.max(Math.hypot(b[0],b[1]),1),h=Math.max(Math.hypot(b[2],b[3]),1),i=e,j=f,k="prescale1";for(;g>2&&i>1||h>2&&j>1;){let b=i,e=j;g>2&&i>1&&(b=i>=16384?Math.floor(i/2)-1||1:Math.ceil(i/2),g/=i/b),h>2&&j>1&&(e=j>=16384?Math.floor(j/2)-1||1:Math.ceil(j)/2,h/=j/e),(d=(c=this.cachedCanvases.getCanvas(k,b,e)).context).clearRect(0,0,b,e),d.drawImage(a,0,0,i,j,0,0,b,e),a=c.canvas,i=b,j=e,k="prescale1"===k?"prescale2":"prescale1"}return{img:a,paintWidth:i,paintHeight:j}}_createMaskCanvas(a,b){let c,d,e,f,g=this.ctx,{width:h,height:i}=b,j=this.current.fillColor,k=this.current.patternFill,l=aZ(g);if((b.bitmap||b.data)&&b.count>1){let f=b.bitmap||b.data.buffer;d=JSON.stringify(k?l:[l.slice(0,4),j]),(c=this._cachedBitmapsMap.get(f))||(c=new Map,this._cachedBitmapsMap.set(f,c));let g=c.get(d);if(g&&!k){let b=Math.round(Math.min(l[0],l[2])+l[4]),c=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(a,b6),{canvas:g,offsetX:b,offsetY:c}}e=g}e||co((f=this.cachedCanvases.getCanvas("maskCanvas",h,i)).context,b);let m=az.transform(l,[1/h,0,0,-1/i,0,0]);m=az.transform(m,[1,0,0,1,0,-i]);let n=cj.slice();az.axialAlignedBoundingBox([0,0,h,i],m,n);let[o,p,q,r]=n,s=Math.round(q-o)||1,t=Math.round(r-p)||1,u=this.cachedCanvases.getCanvas("fillCanvas",s,t),v=u.context;v.translate(-o,-p),v.transform(...m),!e&&(e=(e=this._scaleImage(f.canvas,a$(v))).img,c&&k&&c.set(d,e)),v.imageSmoothingEnabled=cr(aZ(v),b.interpolate),cl(v,e,0,0,e.width,e.height,0,0,h,i),v.globalCompositeOperation="source-in";let w=az.transform(a$(v),[1,0,0,1,-o,-p]);return v.fillStyle=k?j.getPattern(g,this,w,b7,a):j,v.fillRect(0,0,h,i),c&&!k&&(this.cachedCanvases.delete("fillCanvas"),c.set(d,u.canvas)),this.dependencyTracker?.recordDependencies(a,b6),{canvas:u.canvas,offsetX:Math.round(o),offsetY:Math.round(p)}}setLineWidth(a,b){this.dependencyTracker?.recordSimpleData("lineWidth",a),b!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=b,this.ctx.lineWidth=b}setLineCap(a,b){this.dependencyTracker?.recordSimpleData("lineCap",a),this.ctx.lineCap=cs[b]}setLineJoin(a,b){this.dependencyTracker?.recordSimpleData("lineJoin",a),this.ctx.lineJoin=ct[b]}setMiterLimit(a,b){this.dependencyTracker?.recordSimpleData("miterLimit",a),this.ctx.miterLimit=b}setDash(a,b,c){this.dependencyTracker?.recordSimpleData("dash",a);let d=this.ctx;void 0!==d.setLineDash&&(d.setLineDash(b),d.lineDashOffset=c)}setRenderingIntent(a,b){}setFlatness(a,b){}setGState(a,b){for(let[c,d]of b)switch(c){case"LW":this.setLineWidth(a,d);break;case"LC":this.setLineCap(a,d);break;case"LJ":this.setLineJoin(a,d);break;case"ML":this.setMiterLimit(a,d);break;case"D":this.setDash(a,d[0],d[1]);break;case"RI":this.setRenderingIntent(a,d);break;case"FL":this.setFlatness(a,d);break;case"Font":this.setFont(a,d[0],d[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",a),this.current.strokeAlpha=d;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",a),this.ctx.globalAlpha=this.current.fillAlpha=d;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",a),this.ctx.globalCompositeOperation=d;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",a),this.current.activeSMask=d?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",a),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(d)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let a=this.inSMaskMode;this.current.activeSMask&&!a?this.beginSMaskMode():!this.current.activeSMask&&a&&this.endSMaskMode()}beginSMaskMode(a){if(this.inSMaskMode)throw Error("beginSMaskMode called while already in smask mode");let b=this.ctx.canvas.width,c=this.ctx.canvas.height,d="smaskGroupAt"+this.groupLevel,e=this.cachedCanvases.getCanvas(d,b,c);this.suspendedCtx=this.ctx;let f=this.ctx=e.context;f.setTransform(this.suspendedCtx.getTransform()),cp(this.suspendedCtx,f);var g=this.suspendedCtx;if(f._removeMirroring)throw Error("Context is already forwarding operations.");f.__originalSave=f.save,f.__originalRestore=f.restore,f.__originalRotate=f.rotate,f.__originalScale=f.scale,f.__originalTranslate=f.translate,f.__originalTransform=f.transform,f.__originalSetTransform=f.setTransform,f.__originalResetTransform=f.resetTransform,f.__originalClip=f.clip,f.__originalMoveTo=f.moveTo,f.__originalLineTo=f.lineTo,f.__originalBezierCurveTo=f.bezierCurveTo,f.__originalRect=f.rect,f.__originalClosePath=f.closePath,f.__originalBeginPath=f.beginPath,f._removeMirroring=()=>{f.save=f.__originalSave,f.restore=f.__originalRestore,f.rotate=f.__originalRotate,f.scale=f.__originalScale,f.translate=f.__originalTranslate,f.transform=f.__originalTransform,f.setTransform=f.__originalSetTransform,f.resetTransform=f.__originalResetTransform,f.clip=f.__originalClip,f.moveTo=f.__originalMoveTo,f.lineTo=f.__originalLineTo,f.bezierCurveTo=f.__originalBezierCurveTo,f.rect=f.__originalRect,f.closePath=f.__originalClosePath,f.beginPath=f.__originalBeginPath,delete f._removeMirroring},f.save=function(){g.save(),this.__originalSave()},f.restore=function(){g.restore(),this.__originalRestore()},f.translate=function(a,b){g.translate(a,b),this.__originalTranslate(a,b)},f.scale=function(a,b){g.scale(a,b),this.__originalScale(a,b)},f.transform=function(a,b,c,d,e,f){g.transform(a,b,c,d,e,f),this.__originalTransform(a,b,c,d,e,f)},f.setTransform=function(a,b,c,d,e,f){g.setTransform(a,b,c,d,e,f),this.__originalSetTransform(a,b,c,d,e,f)},f.resetTransform=function(){g.resetTransform(),this.__originalResetTransform()},f.rotate=function(a){g.rotate(a),this.__originalRotate(a)},f.clip=function(a){g.clip(a),this.__originalClip(a)},f.moveTo=function(a,b){g.moveTo(a,b),this.__originalMoveTo(a,b)},f.lineTo=function(a,b){g.lineTo(a,b),this.__originalLineTo(a,b)},f.bezierCurveTo=function(a,b,c,d,e,f){g.bezierCurveTo(a,b,c,d,e,f),this.__originalBezierCurveTo(a,b,c,d,e,f)},f.rect=function(a,b,c,d){g.rect(a,b,c,d),this.__originalRect(a,b,c,d)},f.closePath=function(){g.closePath(),this.__originalClosePath()},f.beginPath=function(){g.beginPath(),this.__originalBeginPath()},this.setGState(a,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),cp(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(a){if(!this.current.activeSMask)return;a?(a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.ceil(a[2]),a[3]=Math.ceil(a[3])):a=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let b=this.current.activeSMask,c=this.suspendedCtx;this.composeSMask(c,b,this.ctx,a),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(a,b,c,d){let e=d[0],f=d[1],g=d[2]-e,h=d[3]-f;0!==g&&0!==h&&(this.genericComposeSMask(b.context,c,g,h,b.subtype,b.backdrop,b.transferMap,e,f,b.offsetX,b.offsetY),a.save(),a.globalAlpha=1,a.globalCompositeOperation="source-over",a.setTransform(1,0,0,1,0,0),a.drawImage(c.canvas,0,0),a.restore())}genericComposeSMask(a,b,c,d,e,f,g,h,i,j,k){let l=a.canvas,m=h-j,n=i-k;if(f)if(m<0||n<0||m+c>l.width||n+d>l.height){let a=this.cachedCanvases.getCanvas("maskExtension",c,d),b=a.context;b.drawImage(l,-m,-n),b.globalCompositeOperation="destination-atop",b.fillStyle=f,b.fillRect(0,0,c,d),b.globalCompositeOperation="source-over",l=a.canvas,m=n=0}else{a.save(),a.globalAlpha=1,a.setTransform(1,0,0,1,0,0);let b=new Path2D;b.rect(m,n,c,d),a.clip(b),a.globalCompositeOperation="destination-atop",a.fillStyle=f,a.fillRect(m,n,c,d),a.restore()}b.save(),b.globalAlpha=1,b.setTransform(1,0,0,1,0,0),"Alpha"===e&&g?b.filter=this.filterFactory.addAlphaFilter(g):"Luminosity"===e&&(b.filter=this.filterFactory.addLuminosityFilter(g));let o=new Path2D;o.rect(h,i,c,d),b.clip(o),b.globalCompositeOperation="destination-in",b.drawImage(l,m,n,c,d,h,i,c,d),b.restore()}save(a){this.inSMaskMode&&cp(this.ctx,this.suspendedCtx),this.ctx.save();let b=this.current;this.stateStack.push(b),this.current=b.clone(),this.dependencyTracker?.save(a)}restore(a){if(this.dependencyTracker?.restore(a),0===this.stateStack.length){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&cp(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(a,b,c,d,e,f,g){this.dependencyTracker?.recordIncrementalData("transform",a),this.ctx.transform(b,c,d,e,f,g),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(a,b,c,d){let[e]=c;if(!d){e||=c[0]=new Path2D,this[b](a,e);return}if(null!==this.dependencyTracker){let c=b===ae.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(a).recordBBox(a,this.ctx,d[0]-c,d[2]+c,d[1]-c,d[3]+c).recordDependencies(a,["transform"])}if(!(e instanceof Path2D)){let a=c[0]=new Path2D;for(let b=0,c=e.length;b<c;)switch(e[b++]){case 0:a.moveTo(e[b++],e[b++]);break;case 1:a.lineTo(e[b++],e[b++]);break;case 2:a.bezierCurveTo(e[b++],e[b++],e[b++],e[b++],e[b++],e[b++]);break;case 3:a.closePath();break;default:ai(`Unrecognized drawing path operator: ${e[b-1]}`)}e=a}az.axialAlignedBoundingBox(d,aZ(this.ctx),this.current.minMax),this[b](a,e),this._pathStartIdx=a}closePath(a){this.ctx.closePath()}stroke(a,b,c=!0){let d=this.ctx,e=this.current.strokeColor;if(d.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"==typeof e&&e?.getPattern){let c=e.isModifyingCurrentTransform()?d.getTransform():null;if(d.save(),d.strokeStyle=e.getPattern(d,this,a$(d),b8,a),c){let a=new Path2D;a.addPath(b,d.getTransform().invertSelf().multiplySelf(c)),b=a}this.rescaleAndStroke(b,!1),d.restore()}else this.rescaleAndStroke(b,!0);this.dependencyTracker?.recordDependencies(a,b0),c&&this.consumePath(a,b,this.current.getClippedPathBoundingBox(b8,aZ(this.ctx))),d.globalAlpha=this.current.fillAlpha}closeStroke(a,b){this.stroke(a,b)}fill(a,b,c=!0){let d=this.ctx,e=this.current.fillColor,f=this.current.patternFill,g=!1;if(f){let c=e.isModifyingCurrentTransform()?d.getTransform():null;if(this.dependencyTracker?.save(a),d.save(),d.fillStyle=e.getPattern(d,this,a$(d),b7,a),c){let a=new Path2D;a.addPath(b,d.getTransform().invertSelf().multiplySelf(c)),b=a}g=!0}let h=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==h&&(this.pendingEOFill?(d.fill(b,"evenodd"),this.pendingEOFill=!1):d.fill(b)),this.dependencyTracker?.recordDependencies(a,b1),g&&(d.restore(),this.dependencyTracker?.restore(a)),c&&this.consumePath(a,b,h)}eoFill(a,b){this.pendingEOFill=!0,this.fill(a,b)}fillStroke(a,b){this.fill(a,b,!1),this.stroke(a,b,!1),this.consumePath(a,b)}eoFillStroke(a,b){this.pendingEOFill=!0,this.fillStroke(a,b)}closeFillStroke(a,b){this.fillStroke(a,b)}closeEOFillStroke(a,b){this.pendingEOFill=!0,this.fillStroke(a,b)}endPath(a,b){this.consumePath(a,b)}rawFillPath(a,b){this.ctx.fill(b),this.dependencyTracker?.recordDependencies(a,b3).recordOperation(a)}clip(a){this.dependencyTracker?.recordFutureForcedDependency("clipMode",a),this.pendingClip=cu}eoClip(a){this.dependencyTracker?.recordFutureForcedDependency("clipMode",a),this.pendingClip=cv}beginText(a){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(a).resetIncrementalData("sameLineText").resetIncrementalData("moveText",a)}endText(a){let b=this.pendingTextPaths,c=this.ctx;if(this.dependencyTracker){let{dependencyTracker:c}=this;void 0!==b&&c.recordFutureForcedDependency("textClip",c.getOpenMarker()).recordFutureForcedDependency("textClip",a),c.recordCloseMarker(a)}if(void 0!==b){let a=new Path2D,d=c.getTransform().invertSelf();for(let{transform:c,x:e,y:f,fontSize:g,path:h}of b)h&&a.addPath(h,new DOMMatrix(c).preMultiplySelf(d).translate(e,f).scale(g,-g));c.clip(a)}delete this.pendingTextPaths}setCharSpacing(a,b){this.dependencyTracker?.recordSimpleData("charSpacing",a),this.current.charSpacing=b}setWordSpacing(a,b){this.dependencyTracker?.recordSimpleData("wordSpacing",a),this.current.wordSpacing=b}setHScale(a,b){this.dependencyTracker?.recordSimpleData("hScale",a),this.current.textHScale=b/100}setLeading(a,b){this.dependencyTracker?.recordSimpleData("leading",a),this.current.leading=-b}setFont(a,b,c){this.dependencyTracker?.recordSimpleData("font",a).recordSimpleDataFromNamed("fontObj",b,a);let d=this.commonObjs.get(b),e=this.current;if(!d)throw Error(`Can't find font for ${b}`);if(e.fontMatrix=d.fontMatrix||X,(0===e.fontMatrix[0]||0===e.fontMatrix[3])&&ai("Invalid font matrix for font "+b),c<0?(c=-c,e.fontDirection=-1):e.fontDirection=1,this.current.font=d,this.current.fontSize=c,d.isType3Font)return;let f=d.loadedName||"sans-serif",g=d.systemFontInfo?.css||`"${f}", ${d.fallbackName}`,h="normal";d.black?h="900":d.bold&&(h="bold");let i=d.italic?"italic":"normal",j=c;c<16?j=16:c>100&&(j=100),this.current.fontSizeScale=c/j,this.ctx.font=`${i} ${h} ${j}px ${g}`}setTextRenderingMode(a,b){this.dependencyTracker?.recordSimpleData("textRenderingMode",a),this.current.textRenderingMode=b}setTextRise(a,b){this.dependencyTracker?.recordSimpleData("textRise",a),this.current.textRise=b}moveText(a,b,c){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",a),this.current.x=this.current.lineX+=b,this.current.y=this.current.lineY+=c}setLeadingMoveText(a,b,c){this.setLeading(a,-c),this.moveText(a,b,c)}setTextMatrix(a,b){this.dependencyTracker?.recordSimpleData("textMatrix",a);let{current:c}=this;c.textMatrix=b,c.textMatrixScale=Math.hypot(b[0],b[1]),c.x=c.lineX=0,c.y=c.lineY=0}nextLine(a){this.moveText(a,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??a)}#c1(a,b,c){let d=new Path2D;return d.addPath(a,new DOMMatrix(c).invertSelf().multiplySelf(b)),d}paintChar(a,b,c,d,e,f){let g,h=this.ctx,i=this.current,j=i.font,k=i.textRenderingMode,l=i.fontSize/i.fontSizeScale,m=3&k,n=!!(4&k),o=i.patternFill&&!j.missingFile,p=i.patternStroke&&!j.missingFile;if((j.disableFontFace||n||o||p)&&!j.missingFile&&(g=j.getPathGenerator(this.commonObjs,b)),g&&(j.disableFontFace||o||p)){let b;if(h.save(),h.translate(c,d),h.scale(l,-l),this.dependencyTracker?.recordCharacterBBox(a,h,j),0===m||2===m)if(e){b=h.getTransform(),h.setTransform(...e);let a=this.#c1(g,b,e);h.fill(a)}else h.fill(g);if(1===m||2===m)if(f){b||=h.getTransform(),h.setTransform(...f);let{a,b:c,c:d,d:e}=b,i=az.inverseTransform(f),j=az.transform([a,c,d,e,0,0],i);az.singularValueDecompose2dScale(j,ci),h.lineWidth*=Math.max(ci[0],ci[1])/l,h.stroke(this.#c1(g,b,f))}else h.lineWidth/=l,h.stroke(g);h.restore()}else(0===m||2===m)&&(h.fillText(b,c,d),this.dependencyTracker?.recordCharacterBBox(a,h,j,l,c,d,()=>h.measureText(b))),(1===m||2===m)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(a,h,j,l,c,d,()=>h.measureText(b)).recordDependencies(a,b0),h.strokeText(b,c,d));n&&((this.pendingTextPaths||=[]).push({transform:aZ(h),x:c,y:d,fontSize:l,path:g}),this.dependencyTracker?.recordCharacterBBox(a,h,j,l,c,d))}get isFontSubpixelAAEnabled(){let{context:a}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);a.scale(1.5,1),a.fillText("I",0,10);let b=a.getImageData(0,0,10,10).data,c=!1;for(let a=3;a<b.length;a+=4)if(b[a]>0&&b[a]<255){c=!0;break}return an(this,"isFontSubpixelAAEnabled",c)}showText(a,b){let c,d;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(a,b4).resetBBox(a),4&this.current.textRenderingMode&&this.dependencyTracker.recordFutureForcedDependency("textClip",a).inheritPendingDependenciesAsFutureForcedDependencies());let e=this.current,f=e.font;if(f.isType3Font){this.showType3Text(a,b),this.dependencyTracker?.recordShowTextOperation(a);return}let g=e.fontSize;if(0===g)return void this.dependencyTracker?.recordOperation(a);let h=this.ctx,i=e.fontSizeScale,j=e.charSpacing,k=e.wordSpacing,l=e.fontDirection,m=e.textHScale*l,n=b.length,o=f.vertical,p=o?1:-1,q=f.defaultVMetrics,r=g*e.fontMatrix[0],s=0===e.textRenderingMode&&!f.disableFontFace&&!e.patternFill;if(h.save(),e.textMatrix&&h.transform(...e.textMatrix),h.translate(e.x,e.y+e.textRise),l>0?h.scale(m,-1):h.scale(m,1),e.patternFill){h.save();let b=e.fillColor.getPattern(h,this,a$(h),b7,a);c=aZ(h),h.restore(),h.fillStyle=b}if(e.patternStroke){h.save();let b=e.strokeColor.getPattern(h,this,a$(h),b8,a);d=aZ(h),h.restore(),h.strokeStyle=b}let t=e.lineWidth,u=e.textMatrixScale;if(0===u||0===t){let a=3&e.textRenderingMode;(1===a||2===a)&&(t=this.getSinglePixelWidth())}else t/=u;if(1!==i&&(h.scale(i,i),t/=i),h.lineWidth=t,f.isInvalidPDFjsFont){let c=[],d=0;for(let a of b)c.push(a.unicode),d+=a.width;let f=c.join("");if(h.fillText(f,0,0),null!==this.dependencyTracker){let b=h.measureText(f);this.dependencyTracker.recordBBox(a,this.ctx,-b.actualBoundingBoxLeft,b.actualBoundingBoxRight,-b.actualBoundingBoxAscent,b.actualBoundingBoxDescent).recordShowTextOperation(a)}e.x+=d*r*m,h.restore(),this.compose();return}let v=0,w;for(w=0;w<n;++w){let e,m,n,t=b[w];if("number"==typeof t){v+=p*t*g/1e3;continue}let u=!1,x=(t.isSpace?k:0)+j,y=t.fontChar,z=t.accent,A=t.width;if(o){let a=t.vmetric||q,b=-(t.vmetric?a[1]:.5*A)*r,c=a[2]*r;A=a?-a[0]:A,e=b/i,m=(v+c)/i}else e=v/i,m=0;if(f.remeasure&&A>0){let a=1e3*(n=h.measureText(y)).width/g*i;if(A<a&&this.isFontSubpixelAAEnabled){let b=A/a;u=!0,h.save(),h.scale(b,1),e/=b}else A!==a&&(e+=(A-a)/2e3*g/i)}if(this.contentVisible&&(t.isInFont||f.missingFile)){if(s&&!z)h.fillText(y,e,m),this.dependencyTracker?.recordCharacterBBox(a,h,n?{bbox:null}:f,g/i,e,m,()=>n??h.measureText(y));else if(this.paintChar(a,y,e,m,c,d),z){let b=e+g*z.offset.x/i,f=m-g*z.offset.y/i;this.paintChar(a,z.fontChar,b,f,c,d)}}v+=o?A*r-x*l:A*r+x*l,u&&h.restore()}o?e.y-=v:e.x+=v*m,h.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(a)}showType3Text(a,b){let c,d,e,f,g=this.ctx,h=this.current,i=h.font,j=h.fontSize,k=h.fontDirection,l=i.vertical?1:-1,m=h.charSpacing,n=h.wordSpacing,o=h.textHScale*k,p=h.fontMatrix||X,q=b.length;if(3===h.textRenderingMode||0===j)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,g.save(),h.textMatrix&&g.transform(...h.textMatrix),g.translate(h.x,h.y+h.textRise),g.scale(o,k);let r=this.dependencyTracker;for(c=0,this.dependencyTracker=r?new b_(r,a):null;c<q;++c){if("number"==typeof(d=b[c])){f=l*d*j/1e3,this.ctx.translate(f,0),h.x+=f*o;continue}let a=(d.isSpace?n:0)+m,k=i.charProcOperatorList[d.operatorListId];k?this.contentVisible&&(this.save(),g.scale(j,j),g.transform(...p),this.executeOperatorList(k),this.restore()):ai(`Type3 character "${d.operatorListId}" is not available.`);let q=[d.width,0];az.applyTransform(q,p),e=q[0]*j+a,g.translate(e,0),h.x+=e*o}g.restore(),r&&(this.dependencyTracker=r)}setCharWidth(a,b,c){}setCharWidthAndBounds(a,b,c,d,e,f,g){let h=new Path2D;h.rect(d,e,f-d,g-e),this.ctx.clip(h),this.dependencyTracker?.recordBBox(a,this.ctx,d,f,e,g).recordClipBox(a,this.ctx,d,f,e,g),this.endPath(a)}getColorN_Pattern(a,b){let c;if("TilingPattern"===b[0]){let a=this.baseTransform||aZ(this.ctx);c=new cg(b,this.ctx,{createCanvasGraphics:(a,b)=>new cw(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new b_(this.dependencyTracker,b,!0):null)},a)}else c=this._getPattern(a,b[1],b[2]);return c}setStrokeColorN(a,...b){this.dependencyTracker?.recordSimpleData("strokeColor",a),this.current.strokeColor=this.getColorN_Pattern(a,b),this.current.patternStroke=!0}setFillColorN(a,...b){this.dependencyTracker?.recordSimpleData("fillColor",a),this.current.fillColor=this.getColorN_Pattern(a,b),this.current.patternFill=!0}setStrokeRGBColor(a,b){this.dependencyTracker?.recordSimpleData("strokeColor",a),this.ctx.strokeStyle=this.current.strokeColor=b,this.current.patternStroke=!1}setStrokeTransparent(a){this.dependencyTracker?.recordSimpleData("strokeColor",a),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(a,b){this.dependencyTracker?.recordSimpleData("fillColor",a),this.ctx.fillStyle=this.current.fillColor=b,this.current.patternFill=!1}setFillTransparent(a){this.dependencyTracker?.recordSimpleData("fillColor",a),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(a,b,c=null){let d;return this.cachedPatterns.has(b)?d=this.cachedPatterns.get(b):(d=function(a){switch(a[0]){case"RadialAxial":return new cc(a);case"Mesh":return new ce(a);case"Dummy":return new cf}throw Error(`Unknown IR type: ${a[0]}`)}(this.getObject(a,b)),this.cachedPatterns.set(b,d)),c&&(d.matrix=c),d}shadingFill(a,b){if(!this.contentVisible)return;let c=this.ctx;this.save(a),c.fillStyle=this._getPattern(a,b).getPattern(c,this,a$(c),b9,a);let d=a$(c);{let{width:a,height:b}=c.canvas,e=cj.slice();az.axialAlignedBoundingBox([0,0,a,b],d,e);let[f,g,h,i]=e;this.ctx.fillRect(f,g,h-f,i-g)}this.dependencyTracker?.resetBBox(a).recordFullPageBBox(a).recordDependencies(a,b5).recordDependencies(a,b1).recordOperation(a),this.compose(this.current.getClippedPathBoundingBox()),this.restore(a)}beginInlineImage(){aj("Should not call beginInlineImage")}beginImageData(){aj("Should not call beginImageData")}paintFormXObjectBegin(a,b,c){if(this.contentVisible&&(this.save(a),this.baseTransformStack.push(this.baseTransform),b&&this.transform(a,...b),this.baseTransform=aZ(this.ctx),c)){az.axialAlignedBoundingBox(c,this.baseTransform,this.current.minMax);let[b,d,e,f]=c,g=new Path2D;g.rect(b,d,e-b,f-d),this.ctx.clip(g),this.dependencyTracker?.recordClipBox(a,this.ctx,b,e,d,f),this.endPath(a)}}paintFormXObjectEnd(a){this.contentVisible&&(this.restore(a),this.baseTransform=this.baseTransformStack.pop())}beginGroup(a,b){if(!this.contentVisible)return;this.save(a),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let c=this.ctx;b.isolated||ah("TODO: Support non-isolated groups."),b.knockout&&ai("Knockout groups not supported.");let d=aZ(c);if(b.matrix&&c.transform(...b.matrix),!b.bbox)throw Error("Bounding box is required.");let e=cj.slice();az.axialAlignedBoundingBox(b.bbox,aZ(c),e);let f=[0,0,c.canvas.width,c.canvas.height],g=Math.floor((e=az.intersect(e,f)||[0,0,0,0])[0]),h=Math.floor(e[1]),i=Math.max(Math.ceil(e[2])-g,1),j=Math.max(Math.ceil(e[3])-h,1);this.current.startNewPathAndClipBox([0,0,i,j]);let k="groupAt"+this.groupLevel;b.smask&&(k+="_smask_"+this.smaskCounter++%2);let l=this.cachedCanvases.getCanvas(k,i,j),m=l.context;m.translate(-g,-h),m.transform(...d);let n=new Path2D,[o,p,q,r]=b.bbox;if(n.rect(o,p,q-o,r-p),b.matrix){let a=new Path2D;a.addPath(n,new DOMMatrix(b.matrix)),n=a}m.clip(n),b.smask&&this.smaskStack.push({canvas:l.canvas,context:m,offsetX:g,offsetY:h,subtype:b.smask.subtype,backdrop:b.smask.backdrop,transferMap:b.smask.transferMap||null,startTransformInverse:null}),(!b.smask||this.dependencyTracker)&&(c.setTransform(1,0,0,1,0,0),c.translate(g,h),c.save()),cp(c,m),this.ctx=m,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(c),this.setGState(a,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(c),this.groupLevel++}endGroup(a,b){if(!this.contentVisible)return;this.groupLevel--;let c=this.ctx,d=this.groupStack.pop();if(this.ctx=d,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),b.smask)this.tempSMask=this.smaskStack.pop(),this.restore(a),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();let b=aZ(this.ctx);this.restore(a),this.ctx.save(),this.ctx.setTransform(...b);let d=cj.slice();az.axialAlignedBoundingBox([0,0,c.canvas.width,c.canvas.height],b,d),this.ctx.drawImage(c.canvas,0,0),this.ctx.restore(),this.compose(d)}}beginAnnotation(a,b,c,d,e,f){if(this.#c_(),cq(this.ctx),this.ctx.save(),this.save(a),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),c){let e=c[2]-c[0],g=c[3]-c[1];if(f&&this.annotationCanvasMap){d=d.slice(),d[4]-=c[0],d[5]-=c[1],(c=c.slice())[0]=c[1]=0,c[2]=e,c[3]=g,az.singularValueDecompose2dScale(aZ(this.ctx),ci);let{viewportScale:a}=this,f=Math.ceil(e*this.outputScaleX*a),h=Math.ceil(g*this.outputScaleY*a);this.annotationCanvas=this.canvasFactory.create(f,h);let{canvas:i,context:j}=this.annotationCanvas;this.annotationCanvasMap.set(b,i),this.annotationCanvas.savedCtx=this.ctx,this.ctx=j,this.ctx.save(),this.ctx.setTransform(ci[0],0,0,-ci[1],0,g*ci[1]),cq(this.ctx)}else{cq(this.ctx),this.endPath(a);let b=new Path2D;b.rect(c[0],c[1],e,g),this.ctx.clip(b)}}this.current=new cm(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(a,...d),this.transform(a,...e)}endAnnotation(a){this.annotationCanvas&&(this.ctx.restore(),this.#c0(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(a,b){if(!this.contentVisible)return;let c=b.count;(b=this.getObject(a,b.data,b)).count=c;let d=this.ctx,e=this._createMaskCanvas(a,b),f=e.canvas;d.save(),d.setTransform(1,0,0,1,0,0),d.drawImage(f,e.offsetX,e.offsetY),this.dependencyTracker?.resetBBox(a).recordBBox(a,this.ctx,e.offsetX,e.offsetX+f.width,e.offsetY,e.offsetY+f.height).recordOperation(a),d.restore(),this.compose()}paintImageMaskXObjectRepeat(a,b,c,d=0,e=0,f,g){if(!this.contentVisible)return;b=this.getObject(a,b.data,b);let h=this.ctx;h.save();let i=aZ(h);h.transform(c,d,e,f,0,0);let j=this._createMaskCanvas(a,b);h.setTransform(1,0,0,1,j.offsetX-i[4],j.offsetY-i[5]),this.dependencyTracker?.resetBBox(a);for(let b=0,k=g.length;b<k;b+=2){let k=az.transform(i,[c,d,e,f,g[b],g[b+1]]);h.drawImage(j.canvas,k[4],k[5]),this.dependencyTracker?.recordBBox(a,this.ctx,k[4],k[4]+j.canvas.width,k[5],k[5]+j.canvas.height)}h.restore(),this.compose(),this.dependencyTracker?.recordOperation(a)}paintImageMaskXObjectGroup(a,b){if(!this.contentVisible)return;let c=this.ctx,d=this.current.fillColor,e=this.current.patternFill;for(let f of(this.dependencyTracker?.resetBBox(a).recordDependencies(a,b6),b)){let{data:b,width:g,height:h,transform:i}=f,j=this.cachedCanvases.getCanvas("maskCanvas",g,h),k=j.context;k.save(),co(k,this.getObject(a,b,f)),k.globalCompositeOperation="source-in",k.fillStyle=e?d.getPattern(k,this,a$(c),b7,a):d,k.fillRect(0,0,g,h),k.restore(),c.save(),c.transform(...i),c.scale(1,-1),cl(c,j.canvas,0,0,g,h,0,-1,1,1),this.dependencyTracker?.recordBBox(a,c,0,g,0,h),c.restore()}this.compose(),this.dependencyTracker?.recordOperation(a)}paintImageXObject(a,b){if(!this.contentVisible)return;let c=this.getObject(a,b);c?this.paintInlineImageXObject(a,c):ai("Dependent image isn't ready yet")}paintImageXObjectRepeat(a,b,c,d,e){if(!this.contentVisible)return;let f=this.getObject(a,b);if(!f)return void ai("Dependent image isn't ready yet");let g=f.width,h=f.height,i=[];for(let a=0,b=e.length;a<b;a+=2)i.push({transform:[c,0,0,d,e[a],e[a+1]],x:0,y:0,w:g,h:h});this.paintInlineImageXObjectGroup(a,f,i)}applyTransferMapsToCanvas(a){return"none"!==this.current.transferMaps&&(a.filter=this.current.transferMaps,a.drawImage(a.canvas,0,0),a.filter="none"),a.canvas}applyTransferMapsToBitmap(a){if("none"===this.current.transferMaps)return a.bitmap;let{bitmap:b,width:c,height:d}=a,e=this.cachedCanvases.getCanvas("inlineImage",c,d),f=e.context;return f.filter=this.current.transferMaps,f.drawImage(b,0,0),f.filter="none",e.canvas}paintInlineImageXObject(a,b){let c;if(!this.contentVisible)return;let d=b.width,e=b.height,f=this.ctx;this.save(a);let{filter:g}=f;if("none"!==g&&""!==g&&(f.filter="none"),f.scale(1/d,-1/e),b.bitmap)c=this.applyTransferMapsToBitmap(b);else if("function"==typeof HTMLElement&&b instanceof HTMLElement||!b.data)c=b;else{let a=this.cachedCanvases.getCanvas("inlineImage",d,e).context;cn(a,b),c=this.applyTransferMapsToCanvas(a)}let h=this._scaleImage(c,a$(f));f.imageSmoothingEnabled=cr(aZ(f),b.interpolate),this.dependencyTracker?.resetBBox(a).recordBBox(a,f,0,d,-e,0).recordDependencies(a,b2).recordOperation(a),cl(f,h.img,0,0,h.paintWidth,h.paintHeight,0,-e,d,e),this.compose(),this.restore(a)}paintInlineImageXObjectGroup(a,b,c){let d;if(!this.contentVisible)return;let e=this.ctx;if(b.bitmap)d=b.bitmap;else{let a=b.width,c=b.height,e=this.cachedCanvases.getCanvas("inlineImage",a,c).context;cn(e,b),d=this.applyTransferMapsToCanvas(e)}for(let b of(this.dependencyTracker?.resetBBox(a),c))e.save(),e.transform(...b.transform),e.scale(1,-1),cl(e,d,b.x,b.y,b.w,b.h,0,-1,1,1),this.dependencyTracker?.recordBBox(a,e,0,1,-1,0),e.restore();this.dependencyTracker?.recordOperation(a),this.compose()}paintSolidColorImageMask(a){this.contentVisible&&(this.dependencyTracker?.resetBBox(a).recordBBox(a,this.ctx,0,1,0,1).recordDependencies(a,b1).recordOperation(a),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(a,b){}markPointProps(a,b,c){}beginMarkedContent(a,b){this.dependencyTracker?.beginMarkedContent(a),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(a,b,c){this.dependencyTracker?.beginMarkedContent(a),"OC"===b?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(c)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(a){this.dependencyTracker?.endMarkedContent(a),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(a){}endCompat(a){}consumePath(a,b,c){let d=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(c);let e=this.ctx;this.pendingClip?(d||(this.pendingClip===cv?e.clip(b,"evenodd"):e.clip(b)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(a).recordFutureForcedDependency("clipPath",a)):this.dependencyTracker?.recordOperation(a),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let a=aZ(this.ctx);if(0===a[1]&&0===a[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(a[0]),Math.abs(a[3]));else{let b=Math.abs(a[0]*a[3]-a[2]*a[1]),c=Math.hypot(a[0],a[2]),d=Math.hypot(a[1],a[3]);this._cachedGetSinglePixelWidth=Math.max(c,d)/b}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let a,b,{lineWidth:c}=this.current,{a:d,b:e,c:f,d:g}=this.ctx.getTransform();if(0===e&&0===f){let e=Math.abs(d),f=Math.abs(g);if(e===f)if(0===c)a=b=1/e;else{let d=e*c;a=b=d<1?1/d:1}else if(0===c)a=1/e,b=1/f;else{let d=e*c,g=f*c;a=d<1?1/d:1,b=g<1?1/g:1}}else{let h=Math.abs(d*g-e*f),i=Math.hypot(d,e),j=Math.hypot(f,g);if(0===c)a=j/h,b=i/h;else{let d=c*h;a=j>d?j/d:1,b=i>d?i/d:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=b}return this._cachedScaleForStroking}rescaleAndStroke(a,b){let{ctx:c,current:{lineWidth:d}}=this,[e,f]=this.getScaleForStroking();if(e===f){c.lineWidth=(d||1)*e,c.stroke(a);return}let g=c.getLineDash();b&&c.save(),c.scale(e,f),ch.a=1/e,ch.d=1/f;let h=new Path2D;if(h.addPath(a,ch),g.length>0){let a=Math.max(e,f);c.setLineDash(g.map(b=>b/a)),c.lineDashOffset/=a}c.lineWidth=d||1,c.stroke(h),b&&c.restore()}isContentVisible(){for(let a=this.markedContentStack.length-1;a>=0;a--)if(!this.markedContentStack[a].visible)return!1;return!0}}for(let a in ae)void 0!==cw.prototype[a]&&(cw.prototype[ae[a]]=cw.prototype[a]);class cx{#c2;#c3;#c4;static strings=["fontFamily","fontWeight","italicAngle"];static write(a){let b=new TextEncoder,c={},d=0;for(let e of cx.strings){let f=b.encode(a[e]);c[e]=f,d+=4+f.length}let e=new ArrayBuffer(d),f=new Uint8Array(e),g=new DataView(e),h=0;for(let a of cx.strings){let b=c[a],d=b.length;g.setUint32(h,d),f.set(b,h+4),h+=4+d}return ak(h===e.byteLength,"CssFontInfo.write: Buffer overflow"),e}constructor(a){this.#c2=a,this.#c3=new DataView(this.#c2),this.#c4=new TextDecoder}#c5(a){ak(a<cx.strings.length,"Invalid string index");let b=0;for(let c=0;c<a;c++)b+=this.#c3.getUint32(b)+4;let c=this.#c3.getUint32(b);return this.#c4.decode(new Uint8Array(this.#c2,b+4,c))}get fontFamily(){return this.#c5(0)}get fontWeight(){return this.#c5(1)}get italicAngle(){return this.#c5(2)}}class cy{#c2;#c3;#c4;static strings=["css","loadedName","baseFontName","src"];static write(a){let b=new TextEncoder,c={},d=0;for(let e of cy.strings){let f=b.encode(a[e]);c[e]=f,d+=4+f.length}let e,f,g=1+(d+=4);a.style&&(e=b.encode(a.style.style),f=b.encode(a.style.weight),g+=4+e.length+4+f.length);let h=new ArrayBuffer(g),i=new Uint8Array(h),j=new DataView(h),k=0;for(let b of(j.setUint8(k++,+!!a.guessFallback),j.setUint32(k,0),k+=4,d=0,cy.strings)){let a=c[b],e=a.length;d+=4+e,j.setUint32(k,e),i.set(a,k+4),k+=4+e}return j.setUint32(k-d-4,d),a.style&&(j.setUint32(k,e.length),i.set(e,k+4),k+=4+e.length,j.setUint32(k,f.length),i.set(f,k+4),k+=4+f.length),ak(k<=h.byteLength,"SubstitionInfo.write: Buffer overflow"),h.transferToFixedLength(k)}constructor(a){this.#c2=a,this.#c3=new DataView(this.#c2),this.#c4=new TextDecoder}get guessFallback(){return 0!==this.#c3.getUint8(0)}#c5(a){ak(a<cy.strings.length,"Invalid string index");let b=5;for(let c=0;c<a;c++)b+=this.#c3.getUint32(b)+4;let c=this.#c3.getUint32(b);return this.#c4.decode(new Uint8Array(this.#c2,b+4,c))}get css(){return this.#c5(0)}get loadedName(){return this.#c5(1)}get baseFontName(){return this.#c5(2)}get src(){return this.#c5(3)}get style(){let a=1;a+=4+this.#c3.getUint32(a);let b=this.#c3.getUint32(a),c=this.#c4.decode(new Uint8Array(this.#c2,a+4,b));a+=4+b;let d=this.#c3.getUint32(a),e=this.#c4.decode(new Uint8Array(this.#c2,a+4,d));return{style:c,weight:e}}}class cz{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static #c6=Math.ceil(2*this.bools.length/8);static #c7=this.#c6+8*this.numbers.length;static #c8=this.#c7+1+8;static #c9=this.#c8+1+48;static #da=this.#c9+1+6;#c2;#c4;#c3;constructor({data:a,extra:b}){this.#c2=a,this.#c4=new TextDecoder,this.#c3=new DataView(this.#c2),b&&Object.assign(this,b)}#db(a){ak(a<cz.bools.length,"Invalid boolean index");let b=Math.floor(a/4),c=this.#c3.getUint8(b)>>2*a%8&3;return 0===c?void 0:2===c}get black(){return this.#db(0)}get bold(){return this.#db(1)}get disableFontFace(){return this.#db(2)}get fontExtraProperties(){return this.#db(3)}get isInvalidPDFjsFont(){return this.#db(4)}get isType3Font(){return this.#db(5)}get italic(){return this.#db(6)}get missingFile(){return this.#db(7)}get remeasure(){return this.#db(8)}get vertical(){return this.#db(9)}#dc(a){return ak(a<cz.numbers.length,"Invalid number index"),this.#c3.getFloat64(cz.#c6+8*a)}get ascent(){return this.#dc(0)}get defaultWidth(){return this.#dc(1)}get descent(){return this.#dc(2)}get bbox(){let a=cz.#c7;if(0===this.#c3.getUint8(a))return;a+=1;let b=[];for(let c=0;c<4;c++)b.push(this.#c3.getInt16(a,!0)),a+=2;return b}get fontMatrix(){let a=cz.#c8;if(0===this.#c3.getUint8(a))return;a+=1;let b=[];for(let c=0;c<6;c++)b.push(this.#c3.getFloat64(a,!0)),a+=8;return b}get defaultVMetrics(){let a=cz.#c9;if(0===this.#c3.getUint8(a))return;a+=1;let b=[];for(let c=0;c<3;c++)b.push(this.#c3.getInt16(a,!0)),a+=2;return b}#c5(a){ak(a<cz.strings.length,"Invalid string index");let b=cz.#da+4;for(let c=0;c<a;c++)b+=this.#c3.getUint32(b)+4;let c=this.#c3.getUint32(b),d=new Uint8Array(c);return d.set(new Uint8Array(this.#c2,b+4,c)),this.#c4.decode(d)}get fallbackName(){return this.#c5(0)}get loadedName(){return this.#c5(1)}get mimetype(){return this.#c5(2)}get name(){return this.#c5(3)}get data(){let a=cz.#da,b=this.#c3.getUint32(a);a+=4+b;let c=this.#c3.getUint32(a);a+=4+c;let d=this.#c3.getUint32(a);a+=4+d;let e=this.#c3.getUint32(a);if(0!==e)return new Uint8Array(this.#c2,a+4,e)}clearData(){let a=cz.#da,b=this.#c3.getUint32(a);a+=4+b;let c=this.#c3.getUint32(a);a+=4+c;let d=this.#c3.getUint32(a);a+=4+d;let e=this.#c3.getUint32(a);new Uint8Array(this.#c2,a+4,e).fill(0),this.#c3.setUint32(a,0)}get cssFontInfo(){let a=cz.#da,b=this.#c3.getUint32(a);a+=4+b;let c=this.#c3.getUint32(a);a+=4+c;let d=this.#c3.getUint32(a);if(0===d)return null;let e=new Uint8Array(d);return e.set(new Uint8Array(this.#c2,a+4,d)),new cx(e.buffer)}get systemFontInfo(){let a=cz.#da,b=this.#c3.getUint32(a);a+=4+b;let c=this.#c3.getUint32(a);if(0===c)return null;let d=new Uint8Array(c);return d.set(new Uint8Array(this.#c2,a+4,c)),new cy(d.buffer)}static write(a){let b=a.systemFontInfo?cy.write(a.systemFontInfo):null,c=a.cssFontInfo?cx.write(a.cssFontInfo):null,d=new TextEncoder,e={},f=0;for(let b of cz.strings)e[b]=d.encode(a[b]),f+=4+e[b].length;let g=new ArrayBuffer(cz.#da+4+f+4+(b?b.byteLength:0)+4+(c?c.byteLength:0)+4+(a.data?a.data.length:0)),h=new Uint8Array(g),i=new DataView(g),j=0,k=cz.bools.length,l=0,m=0;for(let b=0;b<k;b++){let c=a[cz.bools[b]];l|=(void 0===c?0:c?2:1)<<m,(8===(m+=2)||b===k-1)&&(i.setUint8(j++,l),l=0,m=0)}for(let b of(ak(j===cz.#c6,"FontInfo.write: Boolean properties offset mismatch"),cz.numbers))i.setFloat64(j,a[b]),j+=8;if(ak(j===cz.#c7,"FontInfo.write: Number properties offset mismatch"),a.bbox)for(let b of(i.setUint8(j++,4),a.bbox))i.setInt16(j,b,!0),j+=2;else i.setUint8(j++,0),j+=8;if(ak(j===cz.#c8,"FontInfo.write: BBox properties offset mismatch"),a.fontMatrix)for(let b of(i.setUint8(j++,6),a.fontMatrix))i.setFloat64(j,b,!0),j+=8;else i.setUint8(j++,0),j+=48;if(ak(j===cz.#c9,"FontInfo.write: FontMatrix properties offset mismatch"),a.defaultVMetrics)for(let b of(i.setUint8(j++,1),a.defaultVMetrics))i.setInt16(j,b,!0),j+=2;else i.setUint8(j++,0),j+=6;for(let a of(ak(j===cz.#da,"FontInfo.write: DefaultVMetrics properties offset mismatch"),i.setUint32(cz.#da,0),j+=4,cz.strings)){let b=e[a],c=b.length;i.setUint32(j,c),h.set(b,j+4),j+=4+c}if(i.setUint32(cz.#da,j-cz.#da-4),b){let a=b.byteLength;i.setUint32(j,a),ak(j+4+a<=g.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(b),j+4),j+=4+a}else i.setUint32(j,0),j+=4;if(c){let a=c.byteLength;i.setUint32(j,a),ak(j+4+a<=g.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(c),j+4),j+=4+a}else i.setUint32(j,0),j+=4;return void 0===a.data?(i.setUint32(j,0),j+=4):(i.setUint32(j,a.data.length),h.set(a.data,j+4),j+=4+a.data.length),ak(j<=g.byteLength,"FontInfo.write: Buffer overflow"),g.transferToFixedLength(j)}}class cA{static #dd=null;static #de="";static get workerPort(){return this.#dd}static set workerPort(a){if(!("undefined"!=typeof Worker&&a instanceof Worker)&&null!==a)throw Error("Invalid `workerPort` type.");this.#dd=a}static get workerSrc(){return this.#de}static set workerSrc(a){if("string"!=typeof a)throw Error("Invalid `workerSrc` type.");this.#de=a}}class cB{#df;#dg;constructor({parsedData:a,rawData:b}){this.#df=a,this.#dg=b}getRaw(){return this.#dg}get(a){return this.#df.get(a)??null}[Symbol.iterator](){return this.#df.entries()}}let cC=Symbol("INTERNAL");class cD{#dh=!1;#di=!1;#dj=!1;#dk=!0;constructor(a,{name:b,intent:c,usage:d,rbGroups:e}){this.#dh=!!(2&a),this.#di=!!(4&a),this.name=b,this.intent=c,this.usage=d,this.rbGroups=e}get visible(){if(this.#dj)return this.#dk;if(!this.#dk)return!1;let{print:a,view:b}=this.usage;return this.#dh?b?.viewState!=="OFF":!this.#di||a?.printState!=="OFF"}_setVisible(a,b,c=!1){a!==cC&&aj("Internal method `_setVisible` called."),this.#dj=c,this.#dk=b}}class cE{#dl=null;#dm=new Map;#dn=null;#dp=null;constructor(a,b=2){if(this.renderingIntent=b,this.name=null,this.creator=null,null===a)return;for(const c of(this.name=a.name,this.creator=a.creator,this.#dp=a.order,a.groups))this.#dm.set(c.id,new cD(b,c));if("OFF"===a.baseState)for(const a of this.#dm.values())a._setVisible(cC,!1);for(const b of a.on)this.#dm.get(b)._setVisible(cC,!0);for(const b of a.off)this.#dm.get(b)._setVisible(cC,!1);this.#dn=this.getHash()}#dq(a){let b=a.length;if(b<2)return!0;let c=a[0];for(let d=1;d<b;d++){let b,e=a[d];if(Array.isArray(e))b=this.#dq(e);else{if(!this.#dm.has(e))return ai(`Optional content group not found: ${e}`),!0;b=this.#dm.get(e).visible}switch(c){case"And":if(!b)return!1;break;case"Or":if(b)return!0;break;case"Not":return!b;default:return!0}}return"And"===c}isVisible(a){if(0===this.#dm.size)return!0;if(!a)return ah("Optional content group not defined."),!0;if("OCG"===a.type)return this.#dm.has(a.id)?this.#dm.get(a.id).visible:(ai(`Optional content group not found: ${a.id}`),!0);if("OCMD"===a.type){if(a.expression)return this.#dq(a.expression);if(a.policy&&"AnyOn"!==a.policy){if("AllOn"===a.policy){for(let b of a.ids){if(!this.#dm.has(b)){ai(`Optional content group not found: ${b}`);break}if(!this.#dm.get(b).visible)return!1}return!0}else if("AnyOff"===a.policy){for(let b of a.ids){if(!this.#dm.has(b))return ai(`Optional content group not found: ${b}`),!0;if(!this.#dm.get(b).visible)return!0}return!1}else if("AllOff"===a.policy){for(let b of a.ids){if(!this.#dm.has(b)){ai(`Optional content group not found: ${b}`);break}if(this.#dm.get(b).visible)return!1}return!0}}else{for(let b of a.ids){if(!this.#dm.has(b))return ai(`Optional content group not found: ${b}`),!0;if(this.#dm.get(b).visible)return!0}return!1}return ai(`Unknown optional content policy ${a.policy}.`),!0}return ai(`Unknown group type ${a.type}.`),!0}setVisibility(a,b=!0,c=!0){let d=this.#dm.get(a);if(!d)return void ai(`Optional content group not found: ${a}`);if(c&&b&&d.rbGroups.length)for(let b of d.rbGroups)for(let c of b)c!==a&&this.#dm.get(c)?._setVisible(cC,!1,!0);d._setVisible(cC,!!b,!0),this.#dl=null}setOCGState({state:a,preserveRB:b}){let c;for(let d of a){switch(d){case"ON":case"OFF":case"Toggle":c=d;continue}let a=this.#dm.get(d);if(a)switch(c){case"ON":this.setVisibility(d,!0,b);break;case"OFF":this.setVisibility(d,!1,b);break;case"Toggle":this.setVisibility(d,!a.visible,b)}}this.#dl=null}get hasInitialVisibility(){return null===this.#dn||this.getHash()===this.#dn}getOrder(){return this.#dm.size?this.#dp?this.#dp.slice():[...this.#dm.keys()]:null}getGroup(a){return this.#dm.get(a)||null}getHash(){if(null!==this.#dl)return this.#dl;let a=new bq;for(let[b,c]of this.#dm)a.update(`${b}:${c.visible}`);return this.#dl=a.hexdigest()}[Symbol.iterator](){return this.#dm.entries()}}class cF{constructor(a,{disableRange:b=!1,disableStream:c=!1}){ak(a,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:d,initialData:e,progressiveDone:f,contentDispositionFilename:g}=a;if(this._queuedChunks=[],this._progressiveDone=f,this._contentDispositionFilename=g,e?.length>0){const a=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;this._queuedChunks.push(a)}this._pdfDataRangeTransport=a,this._isStreamingSupported=!c,this._isRangeSupported=!b,this._contentLength=d,this._fullRequestReader=null,this._rangeReaders=[],a.addRangeListener((a,b)=>{this._onReceiveData({begin:a,chunk:b})}),a.addProgressListener((a,b)=>{this._onProgress({loaded:a,total:b})}),a.addProgressiveReadListener(a=>{this._onReceiveData({chunk:a})}),a.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),a.transportReady()}_onReceiveData({begin:a,chunk:b}){let c=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;void 0===a?this._fullRequestReader?this._fullRequestReader._enqueue(c):this._queuedChunks.push(c):ak(this._rangeReaders.some(function(b){return b._begin===a&&(b._enqueue(c),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(a){void 0===a.total?this._rangeReaders[0]?.onProgress?.({loaded:a.loaded}):this._fullRequestReader?.onProgress?.({loaded:a.loaded,total:a.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(a){let b=this._rangeReaders.indexOf(a);b>=0&&this._rangeReaders.splice(b,1)}getFullReader(){ak(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let a=this._queuedChunks;return this._queuedChunks=null,new cG(this,a,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new cH(this,a,b);return this._pdfDataRangeTransport.requestDataRange(a,b),this._rangeReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeReaders.slice(0)))b.cancel(a);this._pdfDataRangeTransport.abort()}}class cG{constructor(a,b,c=!1,d=null){for(const e of(this._stream=a,this._done=c||!1,this._filename=aP(d)?d:null,this._queuedChunks=b||[],this._loaded=0,this._queuedChunks))this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),a._fullRequestReader=this,this.onProgress=null}_enqueue(a){this._done||(this._requests.length>0?this._requests.shift().resolve({value:a,done:!1}):this._queuedChunks.push(a),this._loaded+=a.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let a=Promise.withResolvers();return this._requests.push(a),a.promise}cancel(a){for(let a of(this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class cH{constructor(a,b,c){this._stream=a,this._begin=b,this._end=c,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(a){if(!this._done){if(0===this._requests.length)this._queuedChunk=a;else{for(let b of(this._requests.shift().resolve({value:a,done:!1}),this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let a=Promise.withResolvers();return this._requests.push(a),a.promise}cancel(a){for(let a of(this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function cI(a,b){let c=new Headers;if(!a||!b||"object"!=typeof b)return c;for(let a in b){let d=b[a];void 0!==d&&c.append(a,d)}return c}function cJ(a){return URL.parse(a)?.origin??null}function cK({responseHeaders:a,isHttp:b,rangeChunkSize:c,disableRange:d}){let e={allowRangeRequests:!1,suggestedLength:void 0},f=parseInt(a.get("Content-Length"),10);return Number.isInteger(f)&&(e.suggestedLength=f,f<=2*c||d||!b||"bytes"!==a.get("Accept-Ranges")||"identity"!==(a.get("Content-Encoding")||"identity")||(e.allowRangeRequests=!0)),e}function cL(a){let b=a.get("Content-Disposition");if(b){let a=function(a){let b=!0,c=d("filename\\*","i").exec(a);if(c){let a=g(c=c[1]);return f(a=i(a=h(a=unescape(a))))}if(c=function(a){let b,c=[],e=d("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(b=e.exec(a));){let[,a,d,e]=b;if((a=parseInt(a,10))in c){if(0===a)break;continue}c[a]=[d,e]}let f=[];for(let a=0;a<c.length&&a in c;++a){let[b,d]=c[a];d=g(d),b&&(d=unescape(d),0===a&&(d=h(d))),f.push(d)}return f.join("")}(a))return f(i(c));if(c=d("filename","i").exec(a)){let a=g(c=c[1]);return f(a=i(a))}function d(a,b){return RegExp("(?:^|;)\\s*"+a+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function e(a,c){if(a){if(!/^[\x00-\xFF]+$/.test(c))return c;try{let d=new TextDecoder(a,{fatal:!0}),e=aw(c);c=d.decode(e),b=!1}catch{}}return c}function f(a){return b&&/[\x80-\xff]/.test(a)&&(a=e("utf-8",a),b&&(a=e("iso-8859-1",a))),a}function g(a){if(a.startsWith('"')){let b=a.slice(1).split('\\"');for(let a=0;a<b.length;++a){let c=b[a].indexOf('"');-1!==c&&(b[a]=b[a].slice(0,c),b.length=a+1),b[a]=b[a].replaceAll(/\\(.)/g,"$1")}a=b.join('"')}return a}function h(a){let b=a.indexOf("'");return -1===b?a:e(a.slice(0,b),a.slice(b+1).replace(/^[^']*'/,""))}function i(a){return!a.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(a)?a:a.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(a,b,c,d){if("q"===c||"Q"===c)return e(b,d=(d=d.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(a,b){return String.fromCharCode(parseInt(b,16))}));try{d=atob(d)}catch{}return e(b,d)})}return""}(b);if(a.includes("%"))try{a=decodeURIComponent(a)}catch{}if(aP(a))return a}return null}function cM(a,b){return new as(`Unexpected server response (${a}) while retrieving PDF "${b}".`,a,404===a||0===a&&b.startsWith("file:"))}function cN(a){return 200===a||206===a}function cO(a,b,c){return{method:"GET",headers:a,signal:c.signal,mode:"cors",credentials:b?"include":"same-origin",redirect:"follow"}}function cP(a){return a instanceof Uint8Array?a.buffer:a instanceof ArrayBuffer?a:(ai(`getArrayBuffer - unexpected data format: ${a}`),new Uint8Array(a).buffer)}class cQ{_responseOrigin=null;constructor(a){this.source=a,this.isHttp=/^https?:/i.test(a.url),this.headers=cI(this.isHttp,a.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ak(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new cR(this),this._fullRequestReader}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new cS(this,a,b);return this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class cR{constructor(a){this._stream=a,this._reader=null,this._loaded=0,this._filename=null;const b=a.source;this._withCredentials=b.withCredentials||!1,this._contentLength=b.length,this._headersCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange;const c=new Headers(a.headers),d=b.url;fetch(d,cO(c,this._withCredentials,this._abortController)).then(b=>{if(a._responseOrigin=cJ(b.url),!cN(b.status))throw cM(b.status,d);this._reader=b.body.getReader(),this._headersCapability.resolve();let c=b.headers,{allowRangeRequests:e,suggestedLength:f}=cK({responseHeaders:c,isHttp:a.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=e,this._contentLength=f||this._contentLength,this._filename=cL(c),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new au("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:a,done:b}=await this._reader.read();return b?{value:a,done:b}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:cP(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}class cS{constructor(a,b,c){this._stream=a,this._reader=null,this._loaded=0;const d=a.source;this._withCredentials=d.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController;const e=new Headers(a.headers);e.append("Range",`bytes=${b}-${c-1}`);const f=d.url;fetch(f,cO(e,this._withCredentials,this._abortController)).then(b=>{let c=cJ(b.url);if(c!==a._responseOrigin)throw Error(`Expected range response-origin "${c}" to match "${a._responseOrigin}".`);if(!cN(b.status))throw cM(b.status,f);this._readCapability.resolve(),this._reader=b.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:a,done:b}=await this._reader.read();return b?{value:a,done:b}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded}),{value:cP(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}class cT{_responseOrigin=null;constructor({url:a,httpHeaders:b,withCredentials:c}){this.url=a,this.isHttp=/^https?:/i.test(a),this.headers=cI(this.isHttp,b),this.withCredentials=c||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(a){let b=new XMLHttpRequest,c=this.currXhrId++,d=this.pendingRequests[c]={xhr:b};for(let[a,c]of(b.open("GET",this.url),b.withCredentials=this.withCredentials,this.headers))b.setRequestHeader(a,c);return this.isHttp&&"begin"in a&&"end"in a?(b.setRequestHeader("Range",`bytes=${a.begin}-${a.end-1}`),d.expectedStatus=206):d.expectedStatus=200,b.responseType="arraybuffer",ak(a.onError,"Expected `onError` callback to be provided."),b.onerror=()=>{a.onError(b.status)},b.onreadystatechange=this.onStateChange.bind(this,c),b.onprogress=this.onProgress.bind(this,c),d.onHeadersReceived=a.onHeadersReceived,d.onDone=a.onDone,d.onError=a.onError,d.onProgress=a.onProgress,b.send(null),c}onProgress(a,b){let c=this.pendingRequests[a];c&&c.onProgress?.(b)}onStateChange(a,b){let c,d=this.pendingRequests[a];if(!d)return;let e=d.xhr;if(e.readyState>=2&&d.onHeadersReceived&&(d.onHeadersReceived(),delete d.onHeadersReceived),4!==e.readyState||!(a in this.pendingRequests))return;if(delete this.pendingRequests[a],0===e.status&&this.isHttp)return void d.onError(e.status);let f=e.status||200;if((200!==f||206!==d.expectedStatus)&&f!==d.expectedStatus)return void d.onError(e.status);let g="string"!=typeof(c=e.response)?c:aw(c).buffer;if(206===f){let a=e.getResponseHeader("Content-Range"),b=/bytes (\d+)-(\d+)\/(\d+)/.exec(a);b?d.onDone({begin:parseInt(b[1],10),chunk:g}):(ai('Missing or invalid "Content-Range" header.'),d.onError(0))}else g?d.onDone({begin:0,chunk:g}):d.onError(e.status)}getRequestXhr(a){return this.pendingRequests[a].xhr}isPendingRequest(a){return a in this.pendingRequests}abortRequest(a){let b=this.pendingRequests[a].xhr;delete this.pendingRequests[a],b.abort()}}class cU{constructor(a){this._source=a,this._manager=new cT(a),this._rangeChunkSize=a.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(a){let b=this._rangeRequestReaders.indexOf(a);b>=0&&this._rangeRequestReaders.splice(b,1)}getFullReader(){return ak(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new cV(this._manager,this._source),this._fullRequestReader}getRangeReader(a,b){let c=new cW(this._manager,a,b);return c.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class cV{constructor(a,b){this._manager=a,this._url=b.url,this._fullRequestId=a.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._contentLength=b.length,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let a=this._fullRequestId,b=this._manager.getRequestXhr(a);this._manager._responseOrigin=cJ(b.responseURL);let c=b.getAllResponseHeaders(),d=new Headers(c?c.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{let[b,...c]=a.split(": ");return[b,c.join(": ")]}):[]),{allowRangeRequests:e,suggestedLength:f}=cK({responseHeaders:d,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});e&&(this._isRangeSupported=!0),this._contentLength=f||this._contentLength,this._filename=cL(d),this._isRangeSupported&&this._manager.abortRequest(a),this._headersCapability.resolve()}_onDone(a){if(a&&(this._requests.length>0?this._requests.shift().resolve({value:a.chunk,done:!1}):this._cachedChunks.push(a.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let a of this._requests)a.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(a){for(let b of(this._storedError=cM(a,this._url),this._headersCapability.reject(this._storedError),this._requests))b.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(a){this.onProgress?.({loaded:a.loaded,total:a.lengthComputable?a.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let a=Promise.withResolvers();return this._requests.push(a),a.promise}cancel(a){for(let b of(this._done=!0,this._headersCapability.reject(a),this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class cW{constructor(a,b,c){this._manager=a,this._url=a.url,this._requestId=a.request({begin:b,end:c,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let a=cJ(this._manager.getRequestXhr(this._requestId)?.responseURL);a!==this._manager._responseOrigin&&(this._storedError=Error(`Expected range response-origin "${a}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(a){let b=a.chunk;for(let a of(this._requests.length>0?this._requests.shift().resolve({value:b,done:!1}):this._queuedChunk=b,this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(a){for(let b of(this._storedError??=cM(a,this._url),this._requests))b.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(a){this.isStreamingSupported||this.onProgress?.({loaded:a.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let a=Promise.withResolvers();return this._requests.push(a),a.promise}cancel(a){for(let a of(this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}let cX=/^[a-z][a-z0-9\-+.]+:/i;class cY{constructor(a){this.source=a,this.url=function(a){return new URL(cX.test(a)?a:process.getBuiltinModule("url").pathToFileURL(a))}(a.url),ak("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return ak(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new cZ(this),this._fullRequestReader}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new c$(this,a,b);return this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class cZ{constructor(a){this._url=a.url,this._done=!1,this._storedError=null,this.onProgress=null;const b=a.source;this._contentLength=b.length,this._loaded=0,this._filename=null,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const c=process.getBuiltinModule("fs");c.promises.lstat(this._url).then(a=>{this._contentLength=a.size,this._setReadableStream(c.createReadStream(this._url)),this._headersCapability.resolve()},a=>{"ENOENT"===a.code&&(a=cM(0,this._url.href)),this._storedError=a,this._headersCapability.reject(a)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let a=this._readableStream.read();return null===a?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=a.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(a).buffer,done:!1})}cancel(a){this._readableStream?this._readableStream.destroy(a):this._error(a)}_error(a){this._storedError=a,this._readCapability.resolve()}_setReadableStream(a){this._readableStream=a,a.on("readable",()=>{this._readCapability.resolve()}),a.on("end",()=>{a.destroy(),this._done=!0,this._readCapability.resolve()}),a.on("error",a=>{this._error(a)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new au("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class c${constructor(a,b,c){this._url=a.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const d=a.source;this._isStreamingSupported=!d.disableStream;const e=process.getBuiltinModule("fs");this._setReadableStream(e.createReadStream(this._url,{start:b,end:c-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let a=this._readableStream.read();return null===a?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=a.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(a).buffer,done:!1})}cancel(a){this._readableStream?this._readableStream.destroy(a):this._error(a)}_error(a){this._storedError=a,this._readCapability.resolve()}_setReadableStream(a){this._readableStream=a,a.on("readable",()=>{this._readCapability.resolve()}),a.on("end",()=>{a.destroy(),this._done=!0,this._readCapability.resolve()}),a.on("error",a=>{this._error(a)}),this._storedError&&this._readableStream.destroy(this._storedError)}}let c_=Symbol("INITIAL_DATA");class c0{#dr=Object.create(null);#ds(a){return this.#dr[a]||={...Promise.withResolvers(),data:c_}}get(a,b=null){if(b){let c=this.#ds(a);return c.promise.then(()=>b(c.data)),null}let c=this.#dr[a];if(!c||c.data===c_)throw Error(`Requesting object that isn't resolved yet ${a}.`);return c.data}has(a){let b=this.#dr[a];return!!b&&b.data!==c_}delete(a){let b=this.#dr[a];return!!b&&b.data!==c_&&(delete this.#dr[a],!0)}resolve(a,b=null){let c=this.#ds(a);c.data=b,c.resolve()}clear(){for(let a in this.#dr){let{data:b}=this.#dr[a];b?.bitmap?.close()}this.#dr=Object.create(null)}*[Symbol.iterator](){for(let a in this.#dr){let{data:b}=this.#dr[a];b!==c_&&(yield[a,b])}}}class c1{#dt=Promise.withResolvers();#av=null;#du=!1;#dv=!!globalThis.FontInspector?.enabled;#dw=null;#dx=null;#dy=0;#dz=0;#dA=null;#dB=null;#dC=0;#dD=0;#dE=Object.create(null);#dF=[];#dG=null;#dH=[];#dI=new WeakMap;#dJ=null;static #dK=new Map;static #dL=new Map;static #dM=new WeakMap;static #dN=null;static #dO=new Set;constructor({textContentSource:a,container:b,viewport:c}){if(a instanceof ReadableStream)this.#dG=a;else if("object"==typeof a)this.#dG=new ReadableStream({start(b){b.enqueue(a),b.close()}});else throw Error('No "textContentSource" parameter specified.');this.#av=this.#dB=b,this.#dD=c.scale*a0.pixelRatio,this.#dC=c.rotation,this.#dx={div:null,properties:null,ctx:null};const{pageWidth:d,pageHeight:e,pageX:f,pageY:g}=c.rawDims;this.#dJ=[1,0,0,-1,-f,g+e],this.#dz=d,this.#dy=e,c1.#dP(),a_(b,c),this.#dt.promise.finally(()=>{c1.#dO.delete(this),this.#dx=null,this.#dE=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:a,isFirefox:b}=ax.platform;return an(this,"fontFamilyMap",new Map([["sans-serif",`${a&&b?"Calibri, ":""}sans-serif`],["monospace",`${a&&b?"Lucida Console, ":""}monospace`]]))}render(){let a=()=>{this.#dA.read().then(({value:b,done:c})=>{c?this.#dt.resolve():(this.#dw??=b.lang,Object.assign(this.#dE,b.styles),this.#dQ(b.items),a())},this.#dt.reject)};return this.#dA=this.#dG.getReader(),c1.#dO.add(this),a(),this.#dt.promise}update({viewport:a,onBefore:b=null}){let c=a.scale*a0.pixelRatio,d=a.rotation;if(d!==this.#dC&&(b?.(),this.#dC=d,a_(this.#dB,{rotation:d})),c!==this.#dD){b?.(),this.#dD=c;let a={div:null,properties:null,ctx:c1.#dR(this.#dw)};for(let b of this.#dH)a.properties=this.#dI.get(b),a.div=b,this.#dS(a)}}cancel(){let a=new au("TextLayer task cancelled.");this.#dA?.cancel(a).catch(()=>{}),this.#dA=null,this.#dt.reject(a)}get textDivs(){return this.#dH}get textContentItemsStr(){return this.#dF}#dQ(a){if(this.#du)return;this.#dx.ctx??=c1.#dR(this.#dw);let b=this.#dH,c=this.#dF;for(let d of a){if(b.length>1e5){ai("Ignoring additional textDivs for performance reasons."),this.#du=!0;return}if(void 0===d.str){if("beginMarkedContentProps"===d.type||"beginMarkedContent"===d.type){let a=this.#av;this.#av=document.createElement("span"),this.#av.classList.add("markedContent"),d.id&&this.#av.setAttribute("id",`${d.id}`),a.append(this.#av)}else"endMarkedContent"===d.type&&(this.#av=this.#av.parentNode);continue}c.push(d.str),this.#dT(d)}}#dT(a){let b,c,d=document.createElement("span"),e={angle:0,canvasWidth:0,hasText:""!==a.str,hasEOL:a.hasEOL,fontSize:0};this.#dH.push(d);let f=az.transform(this.#dJ,a.transform),g=Math.atan2(f[1],f[0]),h=this.#dE[a.fontName];h.vertical&&(g+=Math.PI/2);let i=this.#dv&&h.fontSubstitution||h.fontFamily;i=c1.fontFamilyMap.get(i)||i;let j=Math.hypot(f[2],f[3]),k=j*c1.#dU(i,h,this.#dw);0===g?(b=f[4],c=f[5]-k):(b=f[4]+k*Math.sin(g),c=f[5]-k*Math.cos(g));let l="calc(var(--total-scale-factor) *",m=d.style;this.#av===this.#dB?(m.left=`${(100*b/this.#dz).toFixed(2)}%`,m.top=`${(100*c/this.#dy).toFixed(2)}%`):(m.left=`${l}${b.toFixed(2)}px)`,m.top=`${l}${c.toFixed(2)}px)`),m.fontSize=`${l}${(c1.#dN*j).toFixed(2)}px)`,m.fontFamily=i,e.fontSize=j,d.setAttribute("role","presentation"),d.textContent=a.str,d.dir=a.dir,this.#dv&&(d.dataset.fontName=h.fontSubstitutionLoadedName||a.fontName),0!==g&&(e.angle=180/Math.PI*g);let n=!1;if(a.str.length>1)n=!0;else if(" "!==a.str&&a.transform[0]!==a.transform[3]){let b=Math.abs(a.transform[0]),c=Math.abs(a.transform[3]);b!==c&&Math.max(b,c)/Math.min(b,c)>1.5&&(n=!0)}if(n&&(e.canvasWidth=h.vertical?a.height:a.width),this.#dI.set(d,e),this.#dx.div=d,this.#dx.properties=e,this.#dS(this.#dx),e.hasText&&this.#av.append(d),e.hasEOL){let a=document.createElement("br");a.setAttribute("role","presentation"),this.#av.append(a)}}#dS(a){let{div:b,properties:c,ctx:d}=a,{style:e}=b,f="";if(c1.#dN>1&&(f=`scale(${1/c1.#dN})`),0!==c.canvasWidth&&c.hasText){let{fontFamily:a}=e,{canvasWidth:g,fontSize:h}=c;c1.#dV(d,h*this.#dD,a);let{width:i}=d.measureText(b.textContent);i>0&&(f=`scaleX(${g*this.#dD/i}) ${f}`)}0!==c.angle&&(f=`rotate(${c.angle}deg) ${f}`),f.length>0&&(e.transform=f)}static cleanup(){if(!(this.#dO.size>0)){for(let{canvas:a}of(this.#dK.clear(),this.#dL.values()))a.remove();this.#dL.clear()}}static #dR(a=null){let b=this.#dL.get(a||="");if(!b){let c=document.createElement("canvas");c.className="hiddenCanvasElement",c.lang=a,document.body.append(c),b=c.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#dL.set(a,b),this.#dM.set(b,{size:0,family:""})}return b}static #dV(a,b,c){let d=this.#dM.get(a);(b!==d.size||c!==d.family)&&(a.font=`${b}px ${c}`,d.size=b,d.family=c)}static #dP(){if(null!==this.#dN)return;let a=document.createElement("div");a.style.opacity=0,a.style.lineHeight=1,a.style.fontSize="1px",a.style.position="absolute",a.textContent="X",document.body.append(a),this.#dN=a.getBoundingClientRect().height,a.remove()}static #dU(a,b,c){let d=this.#dK.get(a);if(d)return d;let e=this.#dR(c);e.canvas.width=e.canvas.height=30,this.#dV(e,30,a);let f=e.measureText(""),g=f.fontBoundingBoxAscent,h=Math.abs(f.fontBoundingBoxDescent);e.canvas.width=e.canvas.height=0;let i=.8;return g?i=g/(g+h):(ax.platform.isFirefox&&ai("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),b.ascent?i=b.ascent:b.descent&&(i=1+b.descent)),this.#dK.set(a,i),i}}function c2(a={}){"string"==typeof a||a instanceof URL?a={url:a}:(a instanceof ArrayBuffer||ArrayBuffer.isView(a))&&(a={data:a});let b=new c3,{docId:c}=b,d=a.url?function(a){if(a instanceof URL)return a.href;if("string"==typeof a){if(W)return a;let b=URL.parse(a,window.location);if(b)return b.href}throw Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(a.url):null,e=a.data?function(a){if(W&&"undefined"!=typeof Buffer&&a instanceof Buffer)throw Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if("string"==typeof a)return aw(a);if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||"object"==typeof a&&!isNaN(a?.length))return new Uint8Array(a);throw Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(a.data):null,f=a.httpHeaders||null,g=!0===a.withCredentials,h=a.password??null,i=a.range instanceof c4?a.range:null,j=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:65536,k=a.worker instanceof c7?a.worker:null,l=a.verbosity,m="string"!=typeof a.docBaseUrl||aO(a.docBaseUrl)?null:a.docBaseUrl,n=bw(a.cMapUrl),o=!1!==a.cMapPacked,p=a.CMapReaderFactory||(W?bQ:bG),q=bw(a.iccUrl),r=bw(a.standardFontDataUrl),s=a.StandardFontDataFactory||(W?bR:bK),t=bw(a.wasmUrl),u=a.WasmFactory||(W?bS:bM),v=!0!==a.stopAtErrors,w=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,x=!1!==a.isEvalSupported,y="boolean"==typeof a.isOffscreenCanvasSupported?a.isOffscreenCanvasSupported:!W,z="boolean"==typeof a.isImageDecoderSupported?a.isImageDecoderSupported:!W&&(ax.platform.isFirefox||!globalThis.chrome),A=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,B="boolean"==typeof a.disableFontFace?a.disableFontFace:W,C=!0===a.fontExtraProperties,D=!0===a.enableXfa,E=a.ownerDocument||globalThis.document,F=!0===a.disableRange,G=!0===a.disableStream,H=!0===a.disableAutoFetch,I=!0===a.pdfBug,J=a.CanvasFactory||(W?bP:bE),K=a.FilterFactory||(W?bO:bI),L=!0===a.enableHWA,M=!1!==a.useWasm,N=i?i.length:a.length??NaN,O="boolean"==typeof a.useSystemFonts?a.useSystemFonts:!W&&!B,P="boolean"==typeof a.useWorkerFetch?a.useWorkerFetch:!!(p===bG&&s===bK&&u===bM&&n&&r&&t&&aT(n,document.baseURI)&&aT(r,document.baseURI)&&aT(t,document.baseURI));Number.isInteger(l)&&(ag=l);let Q={canvasFactory:new J({ownerDocument:E,enableHWA:L}),filterFactory:new K({docId:c,ownerDocument:E}),cMapReaderFactory:P?null:new p({baseUrl:n,isCompressed:o}),standardFontDataFactory:P?null:new s({baseUrl:r}),wasmFactory:P?null:new u({baseUrl:t})};k||(b._worker=k=c7.create({verbosity:l,port:cA.workerPort}));let R={docId:c,apiVersion:"5.4.296",data:e,password:h,disableAutoFetch:H,rangeChunkSize:j,length:N,docBaseUrl:m,enableXfa:D,evaluatorOptions:{maxImageSize:w,disableFontFace:B,ignoreErrors:v,isEvalSupported:x,isOffscreenCanvasSupported:y,isImageDecoderSupported:z,canvasMaxAreaInBytes:A,fontExtraProperties:C,useSystemFonts:O,useWasm:M,useWorkerFetch:P,cMapUrl:n,iccUrl:q,standardFontDataUrl:r,wasmUrl:t}},S={ownerDocument:E,pdfBug:I,styleElement:null,loadingParams:{disableAutoFetch:H,enableXfa:D}};return k.promise.then(function(){let a;if(b.destroyed)throw Error("Loading aborted");if(k.destroyed)throw Error("Worker was destroyed");let h=k.messageHandler.sendWithPromise("GetDocRequest",R,e?[e.buffer]:null);if(i)a=new cF(i,{disableRange:F,disableStream:G});else if(!e){if(!d)throw Error("getDocument - no `url` parameter provided.");a=new(aT(d)?cQ:W?cY:cU)({url:d,length:N,httpHeaders:f,withCredentials:g,rangeChunkSize:j,disableRange:F,disableStream:G})}return h.then(d=>{if(b.destroyed)throw Error("Loading aborted");if(k.destroyed)throw Error("Worker was destroyed");let e=new bC(c,d,k.port),f=new c8(e,b,a,S,Q,L);b._transport=f,e.send("Ready",null)})}).catch(b._capability.reject),b}class c3{static #cp=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${c3.#cp++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(a){throw this._worker?.port&&delete this._worker._pendingDestroy,a}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class c4{#dt=Promise.withResolvers();#dW=[];#dX=[];#dY=[];#dZ=[];constructor(a,b,c=!1,d=null){this.length=a,this.initialData=b,this.progressiveDone=c,this.contentDispositionFilename=d}addRangeListener(a){this.#dZ.push(a)}addProgressListener(a){this.#dY.push(a)}addProgressiveReadListener(a){this.#dX.push(a)}addProgressiveDoneListener(a){this.#dW.push(a)}onDataRange(a,b){for(let c of this.#dZ)c(a,b)}onDataProgress(a,b){this.#dt.promise.then(()=>{for(let c of this.#dY)c(a,b)})}onDataProgressiveRead(a){this.#dt.promise.then(()=>{for(let b of this.#dX)b(a)})}onDataProgressiveDone(){this.#dt.promise.then(()=>{for(let a of this.#dW)a()})}transportReady(){this.#dt.resolve()}requestDataRange(a,b){aj("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class c5{constructor(a,b){this._pdfInfo=a,this._transport=b}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return an(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(a){return this._transport.getPage(a)}getPageIndex(a){return this._transport.getPageIndex(a)}getDestinations(){return this._transport.getDestinations()}getDestination(a){return this._transport.getDestination(a)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(a,b){return this._transport.getAnnotationsByType(a,b)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:a="display"}={}){let{renderingIntent:b}=this._transport.getRenderingIntent(a);return this._transport.getOptionalContentConfig(b)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(a=!1){return this._transport.startCleanup(a||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(a){return this._transport.cachedPageNumber(a)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class c6{#d$=!1;constructor(a,b,c,d=!1){this._pageIndex=a,this._pageInfo=b,this._transport=c,this._stats=d?new aS:null,this._pdfBug=d,this.commonObjs=c.commonObjs,this.objs=new c0,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:a,rotation:b=this.rotate,offsetX:c=0,offsetY:d=0,dontFlip:e=!1}={}){return new aM({viewBox:this.view,userUnit:this.userUnit,scale:a,rotation:b,offsetX:c,offsetY:d,dontFlip:e})}getAnnotations({intent:a="display"}={}){let{renderingIntent:b}=this._transport.getRenderingIntent(a);return this._transport.getAnnotations(this._pageIndex,b)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return an(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:a,canvas:b=a.canvas,viewport:c,intent:d="display",annotationMode:e=Y.ENABLE,transform:f=null,background:g=null,optionalContentConfigPromise:h=null,annotationCanvasMap:i=null,pageColors:j=null,printAnnotationStorage:k=null,isEditing:l=!1,recordOperations:m=!1,operationsFilter:n=null}){this._stats?.time("Overall");let o=this._transport.getRenderingIntent(d,e,k,l),{renderingIntent:p,cacheKey:q}=o;this.#d$=!1,h||=this._transport.getOptionalContentConfig(p);let r=this._intentStates.get(q);r||(r=Object.create(null),this._intentStates.set(q,r)),r.streamReaderCancelTimeout&&(clearTimeout(r.streamReaderCancelTimeout),r.streamReaderCancelTimeout=null);let s=!!(4&p);r.displayReadyCapability||(r.displayReadyCapability=Promise.withResolvers(),r.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o));let t=!!(this._pdfBug&&globalThis.StepperManager?.enabled),u=!this.recordedBBoxes&&(m||t),v=a=>{if(r.renderTasks.delete(w),u){let a=w.gfx?.dependencyTracker.take();a&&(w.stepper&&w.stepper.setOperatorBBoxes(a,w.gfx.dependencyTracker.takeDebugMetadata()),m&&(this.recordedBBoxes=a))}s&&(this.#d$=!0),this.#d_(),a?(w.capability.reject(a),this._abortOperatorList({intentState:r,reason:a instanceof Error?a:Error(a)})):w.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new da({callback:v,params:{canvas:b,canvasContext:a,dependencyTracker:u?new b$(b,r.operatorList.length,t):null,viewport:c,transform:f,background:g},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:i,operatorList:r.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!s,pdfBug:this._pdfBug,pageColors:j,enableHWA:this._transport.enableHWA,operationsFilter:n});(r.renderTasks||=new Set).add(w);let x=w.task;return Promise.all([r.displayReadyCapability.promise,h]).then(([a,b])=>{if(this.destroyed)return void v();if(this._stats?.time("Rendering"),!(b.renderingIntent&p))throw Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:a,optionalContentConfig:b}),w.operatorListChanged()}).catch(v),x}getOperatorList({intent:a="display",annotationMode:b=Y.ENABLE,printAnnotationStorage:c=null,isEditing:d=!1}={}){let e,f=this._transport.getRenderingIntent(a,b,c,d,!0),g=this._intentStates.get(f.cacheKey);return g||(g=Object.create(null),this._intentStates.set(f.cacheKey,g)),g.opListReadCapability||((e=Object.create(null)).operatorListChanged=function(){g.operatorList.lastChunk&&(g.opListReadCapability.resolve(g.operatorList),g.renderTasks.delete(e))},g.opListReadCapability=Promise.withResolvers(),(g.renderTasks||=new Set).add(e),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(f)),g.opListReadCapability.promise}streamTextContent({includeMarkedContent:a=!1,disableNormalization:b=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===a,disableNormalization:!0===b},{highWaterMark:100,size:a=>a.items.length})}getTextContent(a={}){if(this._transport._htmlForXfa)return this.getXfa().then(a=>aH.textContent(a));let b=this.streamTextContent(a);return new Promise(function(a,c){let d=b.getReader(),e={items:[],styles:Object.create(null),lang:null};!function b(){d.read().then(function({value:c,done:d}){d?a(e):(e.lang??=c.lang,Object.assign(e.styles,c.styles),e.items.push(...c.items),b())},c)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let a=[];for(let b of this._intentStates.values())if(this._abortOperatorList({intentState:b,reason:Error("Page was destroyed."),force:!0}),!b.opListReadCapability)for(let c of b.renderTasks)a.push(c.completed),c.cancel();return this.objs.clear(),this.#d$=!1,Promise.all(a)}cleanup(a=!1){this.#d$=!0;let b=this.#d_();return a&&b&&(this._stats&&=new aS),b}#d_(){if(!this.#d$||this.destroyed)return!1;for(let{renderTasks:a,operatorList:b}of this._intentStates.values())if(a.size>0||!b.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#d$=!1,!0}_startRenderPage(a,b){let c=this._intentStates.get(b);c&&(this._stats?.timeEnd("Page Request"),c.displayReadyCapability?.resolve(a))}_renderPageChunk(a,b){for(let c=0,d=a.length;c<d;c++)b.operatorList.fnArray.push(a.fnArray[c]),b.operatorList.argsArray.push(a.argsArray[c]);for(let c of(b.operatorList.lastChunk=a.lastChunk,b.operatorList.separateAnnots=a.separateAnnots,b.renderTasks))c.operatorListChanged();a.lastChunk&&this.#d_()}_pumpOperatorList({renderingIntent:a,cacheKey:b,annotationStorageSerializable:c,modifiedIds:d}){let{map:e,transfer:f}=c,g=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:a,cacheKey:b,annotationStorage:e,modifiedIds:d},f).getReader(),h=this._intentStates.get(b);h.streamReader=g;let i=()=>{g.read().then(({value:a,done:b})=>{if(b){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(a,h),i())},a=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){for(let a of(h.operatorList.lastChunk=!0,h.renderTasks))a.operatorListChanged();this.#d_()}if(h.displayReadyCapability)h.displayReadyCapability.reject(a);else if(h.opListReadCapability)h.opListReadCapability.reject(a);else throw a}})};i()}_abortOperatorList({intentState:a,reason:b,force:c=!1}){if(a.streamReader){if(a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null),!c){if(a.renderTasks.size>0)return;if(b instanceof aN){let c=100;b.extraDelay>0&&b.extraDelay<1e3&&(c+=b.extraDelay),a.streamReaderCancelTimeout=setTimeout(()=>{a.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:a,reason:b,force:!0})},c);return}}if(a.streamReader.cancel(new au(b.message)).catch(()=>{}),a.streamReader=null,!this._transport.destroyed){for(let[b,c]of this._intentStates)if(c===a){this._intentStates.delete(b);break}this.cleanup()}}}get stats(){return this._stats}}class c7{#dt=Promise.withResolvers();#d0=null;#dd=null;#d1=null;static #d2=0;static #d3=!1;static #d4=new WeakMap;static{W&&(this.#d3=!0,cA.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(a,b)=>{let c=URL.parse(a);if(!c?.origin||"null"===c.origin)return!1;let d=new URL(b,c);return c.origin===d.origin},this._createCDNWrapper=a=>{let b=`await import("${a}");`;return URL.createObjectURL(new Blob([b],{type:"text/javascript"}))},this.fromPort=a=>{if(console.log("Deprecated API usage: `PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!a?.port)throw Error("PDFWorker.fromPort - invalid method signature.");return this.create(a)}}constructor({name:a=null,port:b=null,verbosity:c=ag}={}){if(this.name=a,this.destroyed=!1,this.verbosity=c,b){if(c7.#d4.has(b))throw Error("Cannot use more than one PDFWorker per port.");c7.#d4.set(b,this),this.#d5(b)}else this.#d6()}get promise(){return this.#dt.promise}#d7(){this.#dt.resolve(),this.#d0.send("configure",{verbosity:this.verbosity})}get port(){return this.#dd}get messageHandler(){return this.#d0}#d5(a){this.#dd=a,this.#d0=new bC("main","worker",a),this.#d0.on("ready",()=>{}),this.#d7()}#d6(){if(c7.#d3||c7.#d8)return void this.#d9();let{workerSrc:a}=c7;try{c7._isSameOrigin(window.location,a)||(a=c7._createCDNWrapper(new URL(a,window.location).href));let b=new Worker(a,{type:"module"}),c=new bC("main","worker",b),d=()=>{e.abort(),c.destroy(),b.terminate(),this.destroyed?this.#dt.reject(Error("Worker was destroyed")):this.#d9()},e=new AbortController;b.addEventListener("error",()=>{this.#d1||d()},{signal:e.signal}),c.on("test",a=>{(e.abort(),this.destroyed||!a)?d():(this.#d0=c,this.#dd=b,this.#d1=b,this.#d7())}),c.on("ready",a=>{if(e.abort(),this.destroyed)return void d();try{f()}catch{this.#d9()}});let f=()=>{let a=new Uint8Array;c.send("test",a,[a.buffer])};f();return}catch{ah("The worker has been disabled.")}this.#d9()}#d9(){c7.#d3||(ai("Setting up fake worker."),c7.#d3=!0),c7._setupFakeWorkerGlobal.then(a=>{if(this.destroyed)return void this.#dt.reject(Error("Worker was destroyed"));let b=new bz;this.#dd=b;let c=`fake${c7.#d2++}`,d=new bC(c+"_worker",c,b);a.setup(d,b),this.#d0=new bC(c,c+"_worker",b),this.#d7()}).catch(a=>{this.#dt.reject(Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this.#d1?.terminate(),this.#d1=null,c7.#d4.delete(this.#dd),this.#dd=null,this.#d0?.destroy(),this.#d0=null}static create(a){let b=this.#d4.get(a?.port);if(b){if(b._pendingDestroy)throw Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return b}return new c7(a)}static get workerSrc(){if(cA.workerSrc)return cA.workerSrc;throw Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get #d8(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return an(this,"_setupFakeWorkerGlobal",(async()=>this.#d8?this.#d8:(await import(this.workerSrc)).WorkerMessageHandler)())}}class c8{#ea=new Map;#eb=new Map;#ec=new Map;#ed=new Map;#ee=null;constructor(a,b,c,d,e,f){this.messageHandler=a,this.loadingTask=b,this.commonObjs=new c0,this.fontLoader=new bu({ownerDocument:d.ownerDocument,styleElement:d.styleElement}),this.loadingParams=d.loadingParams,this._params=d,this.canvasFactory=e.canvasFactory,this.filterFactory=e.filterFactory,this.cMapReaderFactory=e.cMapReaderFactory,this.standardFontDataFactory=e.standardFontDataFactory,this.wasmFactory=e.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=c,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=f,this.setupMessageHandler()}#ef(a,b=null){let c=this.#ea.get(a);if(c)return c;let d=this.messageHandler.sendWithPromise(a,b);return this.#ea.set(a,d),d}get annotationStorage(){return an(this,"annotationStorage",new bs)}getRenderingIntent(a,b=Y.ENABLE,c=null,d=!1,e=!1){let f=2,g=br;switch(a){case"any":f=1;break;case"display":break;case"print":f=4;break;default:ai(`getRenderingIntent - invalid intent: ${a}`)}let h=4&f&&c instanceof bt?c:this.annotationStorage;switch(b){case Y.DISABLE:f+=64;break;case Y.ENABLE:break;case Y.ENABLE_FORMS:f+=16;break;case Y.ENABLE_STORAGE:f+=32,g=h.serializable;break;default:ai(`getRenderingIntent - invalid annotationMode: ${b}`)}d&&(f+=128),e&&(f+=256);let{ids:i,hash:j}=h.modifiedIds,k=[f,g.hash,j];return{renderingIntent:f,cacheKey:k.join("_"),annotationStorageSerializable:g,modifiedIds:i}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#ee?.reject(Error("Worker was destroyed during onPassword callback"));let a=[];for(let b of this.#eb.values())a.push(b._destroy());this.#eb.clear(),this.#ec.clear(),this.#ed.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let b=this.messageHandler.sendWithPromise("Terminate",null);return a.push(b),Promise.all(a).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#ea.clear(),this.filterFactory.destroy(),c1.cleanup(),this._networkStream?.cancelAllRequests(new au("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:a,loadingTask:b}=this;a.on("GetReader",(a,b)=>{ak(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},b.onPull=()=>{this._fullReader.read().then(function({value:a,done:c}){c?b.close():(ak(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),b.enqueue(new Uint8Array(a),1,[a]))}).catch(a=>{b.error(a)})},b.onCancel=a=>{this._fullReader.cancel(a),b.ready.catch(a=>{if(!this.destroyed)throw a})}}),a.on("ReaderHeadersReady",async a=>{await this._fullReader.headersReady;let{isStreamingSupported:c,isRangeSupported:d,contentLength:e}=this._fullReader;return c&&d||(this._lastProgress&&b.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{b.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:c,isRangeSupported:d,contentLength:e}}),a.on("GetRangeReader",(a,b)=>{ak(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let c=this._networkStream.getRangeReader(a.begin,a.end);c?(b.onPull=()=>{c.read().then(function({value:a,done:c}){c?b.close():(ak(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),b.enqueue(new Uint8Array(a),1,[a]))}).catch(a=>{b.error(a)})},b.onCancel=a=>{c.cancel(a),b.ready.catch(a=>{if(!this.destroyed)throw a})}):b.close()}),a.on("GetDoc",({pdfInfo:a})=>{this._numPages=a.numPages,this._htmlForXfa=a.htmlForXfa,delete a.htmlForXfa,b._capability.resolve(new c5(a,this))}),a.on("DocException",a=>{b._capability.reject(bB(a))}),a.on("PasswordRequest",a=>{this.#ee=Promise.withResolvers();try{if(!b.onPassword)throw bB(a);let c=a=>{a instanceof Error?this.#ee.reject(a):this.#ee.resolve({password:a})};b.onPassword(c,a.code)}catch(a){this.#ee.reject(a)}return this.#ee.promise}),a.on("DataLoaded",a=>{b.onProgress?.({loaded:a.length,total:a.length}),this.downloadInfoCapability.resolve(a)}),a.on("StartRenderPage",a=>{this.destroyed||this.#eb.get(a.pageIndex)._startRenderPage(a.transparency,a.cacheKey)}),a.on("commonobj",([b,c,d])=>{if(this.destroyed||this.commonObjs.has(b))return null;switch(c){case"Font":if("error"in d){let a=d.error;ai(`Error during font loading: ${a}`),this.commonObjs.resolve(b,a);break}let e=new bv(new cz(d),this._params.pdfBug&&globalThis.FontInspector?.enabled?(a,b)=>globalThis.FontInspector.fontAdded(a,b):null,d.extra,d.charProcOperatorList);this.fontLoader.bind(e).catch(()=>a.sendWithPromise("FontFallback",{id:b})).finally(()=>{!e.fontExtraProperties&&e.data&&e.clearData(),this.commonObjs.resolve(b,e)});break;case"CopyLocalImage":let{imageRef:f}=d;for(let a of(ak(f,"The imageRef must be defined."),this.#eb.values()))for(let[,c]of a.objs)if(c?.ref===f){if(!c.dataLen)return null;return this.commonObjs.resolve(b,structuredClone(c)),c.dataLen}break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(b,d);break;default:throw Error(`Got unknown common object type ${c}`)}return null}),a.on("obj",([a,b,c,d])=>{if(this.destroyed)return;let e=this.#eb.get(b);if(!e.objs.has(a)){if(0===e._intentStates.size)return void d?.bitmap?.close();switch(c){case"Image":case"Pattern":e.objs.resolve(a,d);break;default:throw Error(`Got unknown object type ${c}`)}}}),a.on("DocProgress",a=>{this.destroyed||b.onProgress?.({loaded:a.loaded,total:a.total})}),a.on("FetchBinaryData",async a=>{if(this.destroyed)throw Error("Worker was destroyed.");let b=this[a.type];if(!b)throw Error(`${a.type} not initialized, see the \`useWorkerFetch\` parameter.`);return b.fetch(a)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&ai("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:a,transfer:b}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:this._fullReader?.filename??null},b).finally(()=>{this.annotationStorage.resetModified()})}getPage(a){if(!Number.isInteger(a)||a<=0||a>this._numPages)return Promise.reject(Error("Invalid page request."));let b=a-1,c=this.#ec.get(b);if(c)return c;let d=this.messageHandler.sendWithPromise("GetPage",{pageIndex:b}).then(c=>{if(this.destroyed)throw Error("Transport destroyed");c.refStr&&this.#ed.set(c.refStr,a);let d=new c6(b,c,this,this._params.pdfBug);return this.#eb.set(b,d),d});return this.#ec.set(b,d),d}getPageIndex(a){return bx(a)?this.messageHandler.sendWithPromise("GetPageIndex",{num:a.num,gen:a.gen}):Promise.reject(Error("Invalid pageIndex request."))}getAnnotations(a,b){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:a,intent:b})}getFieldObjects(){return this.#ef("GetFieldObjects")}hasJSActions(){return this.#ef("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(a){return"string"!=typeof a?Promise.reject(Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:a})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(a,b){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:a,pageIndexesToSkip:b})}getDocJSActions(){return this.#ef("GetDocJSActions")}getPageJSActions(a){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:a})}getStructTree(a){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:a})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(a){return this.#ef("GetOptionalContentConfig").then(b=>new cE(b,a))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let a="GetMetadata",b=this.#ea.get(a);if(b)return b;let c=this.messageHandler.sendWithPromise(a,null).then(a=>({info:a[0],metadata:a[1]?new cB(a[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#ea.set(a,c),c}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(a=!1){if(!this.destroyed){for(let a of(await this.messageHandler.sendWithPromise("Cleanup",null),this.#eb.values()))if(!a.cleanup())throw Error(`startCleanup: Page ${a.pageNumber} is currently rendering.`);this.commonObjs.clear(),a||this.fontLoader.clear(),this.#ea.clear(),this.filterFactory.destroy(!0),c1.cleanup()}}cachedPageNumber(a){if(!bx(a))return null;let b=0===a.gen?`${a.num}R`:`${a.num}R${a.gen}`;return this.#ed.get(b)??null}}class c9{#eg=null;onContinue=null;onError=null;constructor(a){this.#eg=a}get promise(){return this.#eg.capability.promise}cancel(a=0){this.#eg.cancel(null,a)}get separateAnnots(){let{separateAnnots:a}=this.#eg.operatorList;if(!a)return!1;let{annotationCanvasMap:b}=this.#eg;return a.form||a.canvas&&b?.size>0}}class da{#eh=null;static #ei=new WeakSet;constructor({callback:a,params:b,objs:c,commonObjs:d,annotationCanvasMap:e,operatorList:f,pageIndex:g,canvasFactory:h,filterFactory:i,useRequestAnimationFrame:j=!1,pdfBug:k=!1,pageColors:l=null,enableHWA:m=!1,operationsFilter:n=null}){this.callback=a,this.params=b,this.objs=c,this.commonObjs=d,this.annotationCanvasMap=e,this.operatorListIdx=null,this.operatorList=f,this._pageIndex=g,this.canvasFactory=h,this.filterFactory=i,this._pdfBug=k,this.pageColors=l,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===j&&!1,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new c9(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=b.canvas,this._canvasContext=b.canvas?null:b.canvasContext,this._enableHWA=m,this._dependencyTracker=b.dependencyTracker,this._operationsFilter=n}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:a=!1,optionalContentConfig:b}){if(this.cancelled)return;if(this._canvas){if(da.#ei.has(this._canvas))throw Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");da.#ei.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{viewport:c,transform:d,background:e,dependencyTracker:f}=this.params,g=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new cw(g,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:b},this.annotationCanvasMap,this.pageColors,f),this.gfx.beginDrawing({transform:d,viewport:c,transparency:a,background:e}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(a=null,b=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#eh&&(window.cancelAnimationFrame(this.#eh),this.#eh=null),da.#ei.delete(this._canvas),a||=new aN(`Rendering cancelled, page ${this._pageIndex+1}`,b),this.callback(a),this.task.onError?.(a)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#eh=window.requestAnimationFrame(()=>{this.#eh=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){!this.cancelled&&(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),da.#ei.delete(this._canvas),this.callback())))}}let db="5.4.296",dc="f56dc8601";class dd{#ej=null;#ek=null;#el;#em=null;#en=!1;#eo=!1;#f=null;#ep;#eq=null;#r=null;static #er=null;static get _keyboardManager(){return an(this,"_keyboardManager",new bi([[["Escape","mac+Escape"],dd.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],dd.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],dd.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],dd.prototype._moveToPrevious],[["Home","mac+Home"],dd.prototype._moveToBeginning],[["End","mac+End"],dd.prototype._moveToEnd]]))}constructor({editor:a=null,uiManager:b=null}){a?(this.#eo=!1,this.#f=a):this.#eo=!0,this.#r=a?._uiManager||b,this.#ep=this.#r._eventBus,this.#el=a?.color?.toUpperCase()||this.#r?.highlightColors.values().next().value||"#FFFF98",dd.#er||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let a=this.#ej=document.createElement("button");a.className="colorPicker",a.tabIndex="0",a.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),a.ariaHasPopup="true",this.#f&&(a.ariaControls=`${this.#f.id}_colorpicker_dropdown`);let b=this.#r._signal;a.addEventListener("click",this.#es.bind(this),{signal:b}),a.addEventListener("keydown",this.#et.bind(this),{signal:b});let c=this.#ek=document.createElement("span");return c.className="swatch",c.ariaHidden="true",c.style.backgroundColor=this.#el,a.append(c),a}renderMainDropdown(){let a=this.#em=this.#eu();return a.ariaOrientation="horizontal",a.ariaLabelledBy="highlightColorPickerLabel",a}#eu(){let a=document.createElement("div"),b=this.#r._signal;for(let[c,d]of(a.addEventListener("contextmenu",aU,{signal:b}),a.className="dropdown",a.role="listbox",a.ariaMultiSelectable="false",a.ariaOrientation="vertical",a.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#f&&(a.id=`${this.#f.id}_colorpicker_dropdown`),this.#r.highlightColors)){let e=document.createElement("button");e.tabIndex="0",e.role="option",e.setAttribute("data-color",d),e.title=c,e.setAttribute("data-l10n-id",dd.#er[c]);let f=document.createElement("span");e.append(f),f.className="swatch",f.style.backgroundColor=d,e.ariaSelected=d===this.#el,e.addEventListener("click",this.#ev.bind(this,d),{signal:b}),a.append(e)}return a.addEventListener("keydown",this.#et.bind(this),{signal:b}),a}#ev(a,b){b.stopPropagation(),this.#ep.dispatch("switchannotationeditorparams",{source:this,type:_.HIGHLIGHT_COLOR,value:a}),this.updateColor(a)}_colorSelectFromKeyboard(a){if(a.target===this.#ej)return void this.#es(a);let b=a.target.getAttribute("data-color");b&&this.#ev(b,a)}_moveToNext(a){this.#ew?a.target===this.#ej?this.#em.firstChild?.focus():a.target.nextSibling?.focus():this.#es(a)}_moveToPrevious(a){if(a.target===this.#em?.firstChild||a.target===this.#ej){this.#ew&&this._hideDropdownFromKeyboard();return}this.#ew||this.#es(a),a.target.previousSibling?.focus()}_moveToBeginning(a){this.#ew?this.#em.firstChild?.focus():this.#es(a)}_moveToEnd(a){this.#ew?this.#em.lastChild?.focus():this.#es(a)}#et(a){dd._keyboardManager.exec(this,a)}#es(a){if(this.#ew)return void this.hideDropdown();if(this.#en=0===a.detail,this.#eq||(this.#eq=new AbortController,window.addEventListener("pointerdown",this.#m.bind(this),{signal:this.#r.combinedSignal(this.#eq)})),this.#ej.ariaExpanded="true",this.#em)return void this.#em.classList.remove("hidden");let b=this.#em=this.#eu();this.#ej.append(b)}#m(a){this.#em?.contains(a.target)||this.hideDropdown()}hideDropdown(){this.#em?.classList.add("hidden"),this.#ej.ariaExpanded="false",this.#eq?.abort(),this.#eq=null}get #ew(){return this.#em&&!this.#em.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#eo){if(!this.#ew)return void this.#f?.unselect();this.hideDropdown(),this.#ej.focus({preventScroll:!0,focusVisible:this.#en})}}updateColor(a){if(this.#ek&&(this.#ek.style.backgroundColor=a),!this.#em)return;let b=this.#r.highlightColors.values();for(let c of this.#em.children)c.ariaSelected=b.next().value===a.toUpperCase()}destroy(){this.#ej?.remove(),this.#ej=null,this.#ek=null,this.#em?.remove(),this.#em=null}}class de{#ex=null;#f=null;#r=null;static #er=null;constructor(a){this.#f=a,this.#r=a._uiManager,de.#er||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#ex)return this.#ex;let{editorType:a,colorType:b,colorValue:c}=this.#f,d=this.#ex=document.createElement("input");return d.type="color",d.value=c||"#000000",d.className="basicColorPicker",d.tabIndex=0,d.setAttribute("data-l10n-id",de.#er[a]),d.addEventListener("input",()=>{this.#r.updateParams(b,d.value)},{signal:this.#r._signal}),d}update(a){this.#ex&&(this.#ex.value=a)}destroy(){this.#ex?.remove(),this.#ex=null}hideDropdown(){}}function df(a){return Math.floor(255*Math.max(0,Math.min(1,a))).toString(16).padStart(2,"0")}function dg(a){return Math.max(0,Math.min(255,255*a))}class dh{static CMYK_G([a,b,c,d]){return["G",1-Math.min(1,.3*a+.59*c+.11*b+d)]}static G_CMYK([a]){return["CMYK",0,0,0,1-a]}static G_RGB([a]){return["RGB",a,a,a]}static G_rgb([a]){return[a=dg(a),a,a]}static G_HTML([a]){let b=df(a);return`#${b}${b}${b}`}static RGB_G([a,b,c]){return["G",.3*a+.59*b+.11*c]}static RGB_rgb(a){return a.map(dg)}static RGB_HTML(a){return`#${a.map(df).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([a,b,c,d]){return["RGB",1-Math.min(1,a+d),1-Math.min(1,c+d),1-Math.min(1,b+d)]}static CMYK_rgb([a,b,c,d]){return[dg(1-Math.min(1,a+d)),dg(1-Math.min(1,c+d)),dg(1-Math.min(1,b+d))]}static CMYK_HTML(a){let b=this.CMYK_RGB(a).slice(1);return this.RGB_HTML(b)}static RGB_CMYK([a,b,c]){let d=1-a,e=1-b,f=1-c,g=Math.min(d,e,f);return["CMYK",d,e,f,g]}}class di{create(a,b,c=!1){if(a<=0||b<=0)throw Error("Invalid SVG dimensions");let d=this._createSVG("svg:svg");return d.setAttribute("version","1.1"),c||(d.setAttribute("width",`${a}px`),d.setAttribute("height",`${b}px`)),d.setAttribute("preserveAspectRatio","none"),d.setAttribute("viewBox",`0 0 ${a} ${b}`),d}createElement(a){if("string"!=typeof a)throw Error("Invalid SVG element type");return this._createSVG(a)}_createSVG(a){aj("Abstract method `_createSVG` called.")}}class dj extends di{_createSVG(a){return document.createElementNS(aJ,a)}}let dk=new WeakSet,dl=60*new Date().getTimezoneOffset()*1e3;class dm{static create(a){switch(a.data.annotationType){case ac.LINK:return new dq(a);case ac.TEXT:return new dr(a);case ac.WIDGET:switch(a.data.fieldType){case"Tx":return new dt(a);case"Btn":if(a.data.radioButton)return new dw(a);if(a.data.checkBox)return new dv(a);return new dx(a);case"Ch":return new dy(a);case"Sig":return new du(a)}return new ds(a);case ac.POPUP:return new dz(a);case ac.FREETEXT:return new dB(a);case ac.LINE:return new dC(a);case ac.SQUARE:return new dD(a);case ac.CIRCLE:return new dE(a);case ac.POLYLINE:return new dF(a);case ac.CARET:return new dH(a);case ac.INK:return new dI(a);case ac.POLYGON:return new dG(a);case ac.HIGHLIGHT:return new dJ(a);case ac.UNDERLINE:return new dK(a);case ac.SQUIGGLY:return new dL(a);case ac.STRIKEOUT:return new dM(a);case ac.STAMP:return new dN(a);case ac.FILEATTACHMENT:return new dO(a);default:return new dn(a)}}}class dn{#ey=null;#ez=!1;#eA=null;constructor(a,{isRenderable:b=!1,ignoreBorder:c=!1,createQuadrilaterals:d=!1}={}){this.isRenderable=b,this.data=a.data,this.layer=a.layer,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableComment=a.enableComment,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this.parent=a.parent,b&&(this.container=this._createContainer(c)),d&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:a,richText:b}){return!!(a?.str||b?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return dn._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){let{data:a}=this,b=this.annotationStorage?.getEditor(a.id);return b?b.getData():a}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){let a=this.annotationStorage?.getEditor(this.data.id);if(a)return a.commentButtonPositionInPage;let{quadPoints:b,inkLists:c,rect:d}=this.data,e=-1/0,f=-1/0;if(b?.length>=8){for(let a=0;a<b.length;a+=8)b[a+1]>f?(f=b[a+1],e=b[a+2]):b[a+1]===f&&(e=Math.max(e,b[a+2]));return[e,f]}if(c?.length>=1){for(let a of c)for(let b=0,c=a.length;b<c;b+=2)a[b+1]>f?(f=a[b+1],e=a[b]):a[b+1]===f&&(e=Math.max(e,a[b]));if(e!==1/0)return[e,f]}return d?[d[2],d[3]]:null}_normalizePoint(a){let{page:{view:b},viewport:{rawDims:{pageWidth:c,pageHeight:d,pageX:e,pageY:f}}}=this.parent;return a[1]=b[3]-a[1]+b[1],a[0]=100*(a[0]-e)/c,a[1]=100*(a[1]-f)/d,a}get commentText(){let{data:a}=this;return this.annotationStorage.getRawValue(`${Z}${a.id}`)?.popup?.contents||a.contentsObj?.str||""}set commentText(a){let{data:b}=this,c={deleted:!a,contents:a||""};this.annotationStorage.updateEditor(b.id,{popup:c})||this.annotationStorage.setValue(`${Z}${b.id}`,{id:b.id,annotationType:b.annotationType,pageIndex:this.parent.page._pageIndex,popup:c,popupRef:b.popupRef,modificationDate:new Date}),a||this.removePopup()}removePopup(){(this.#eA?.popup||this.popup)?.remove(),this.#eA=this.popup=null}updateEdited(a){if(!this.container)return;a.rect&&(this.#ey||={rect:this.data.rect.slice(0)});let{rect:b,popup:c}=a;b&&this.#eB(b);let d=this.#eA?.popup||this.popup;!d&&c?.text&&(this._createPopup(c),d=this.#eA.popup),d&&(d.updateEdited(a),c?.deleted&&(d.remove(),this.#eA=null,this.popup=null))}resetEdited(){this.#ey&&(this.#eB(this.#ey.rect),this.#eA?.popup.resetEdited(),this.#ey=null)}#eB(a){let{container:{style:b},data:{rect:c,rotation:d},parent:{viewport:{rawDims:{pageWidth:e,pageHeight:f,pageX:g,pageY:h}}}}=this;c?.splice(0,4,...a),b.left=`${100*(a[0]-g)/e}%`,b.top=`${100*(f-a[3]+h)/f}%`,0===d?(b.width=`${100*(a[2]-a[0])/e}%`,b.height=`${100*(a[3]-a[1])/f}%`):this.setRotation(d)}_createContainer(a){let{data:b,parent:{page:c,viewport:d}}=this,e=document.createElement("section");e.setAttribute("data-annotation-id",b.id),this instanceof ds||this instanceof dq||(e.tabIndex=0);let{style:f}=e;if(f.zIndex=this.parent.zIndex,this.parent.zIndex+=2,b.alternativeText&&(e.title=b.alternativeText),b.noRotate&&e.classList.add("norotate"),!b.rect||this instanceof dz){let{rotation:a}=b;return b.hasOwnCanvas||0===a||this.setRotation(a,e),e}let{width:g,height:h}=this;if(!a&&b.borderStyle.width>0){f.borderWidth=`${b.borderStyle.width}px`;let a=b.borderStyle.horizontalCornerRadius,c=b.borderStyle.verticalCornerRadius;switch(a>0||c>0?f.borderRadius=`calc(${a}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`:this instanceof dw&&(f.borderRadius=`calc(${g}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`),b.borderStyle.style){case 1:f.borderStyle="solid";break;case 2:f.borderStyle="dashed";break;case 3:ai("Unimplemented border style: beveled");break;case 4:ai("Unimplemented border style: inset");break;case 5:f.borderBottomStyle="solid"}let d=b.borderColor||null;d?(this.#ez=!0,f.borderColor=az.makeHexColor(0|d[0],0|d[1],0|d[2])):f.borderWidth=0}let i=az.normalizeRect([b.rect[0],c.view[3]-b.rect[1]+c.view[1],b.rect[2],c.view[3]-b.rect[3]+c.view[1]]),{pageWidth:j,pageHeight:k,pageX:l,pageY:m}=d.rawDims;f.left=`${100*(i[0]-l)/j}%`,f.top=`${100*(i[1]-m)/k}%`;let{rotation:n}=b;return b.hasOwnCanvas||0===n?(f.width=`${100*g/j}%`,f.height=`${100*h/k}%`):this.setRotation(n,e),e}setRotation(a,b=this.container){if(!this.data.rect)return;let{pageWidth:c,pageHeight:d}=this.parent.viewport.rawDims,{width:e,height:f}=this;a%180!=0&&([e,f]=[f,e]),b.style.width=`${100*e/c}%`,b.style.height=`${100*f/d}%`,b.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){let a=(a,b,c)=>{let d=c.detail[a],e=d[0],f=d.slice(1);c.target.style[b]=dh[`${e}_HTML`](f),this.annotationStorage.setValue(this.data.id,{[b]:dh[`${e}_rgb`](f)})};return an(this,"_commonActions",{display:a=>{let{display:b}=a.detail,c=b%2==1;this.container.style.visibility=c?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:c,noPrint:1===b||2===b})},print:a=>{this.annotationStorage.setValue(this.data.id,{noPrint:!a.detail.print})},hidden:a=>{let{hidden:b}=a.detail;this.container.style.visibility=b?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:b,noView:b})},focus:a=>{setTimeout(()=>a.target.focus({preventScroll:!1}),0)},userName:a=>{a.target.title=a.detail.userName},readonly:a=>{a.target.disabled=a.detail.readonly},required:a=>{this._setRequired(a.target,a.detail.required)},bgColor:b=>{a("bgColor","backgroundColor",b)},fillColor:b=>{a("fillColor","backgroundColor",b)},fgColor:b=>{a("fgColor","color",b)},textColor:b=>{a("textColor","color",b)},borderColor:b=>{a("borderColor","borderColor",b)},strokeColor:b=>{a("strokeColor","borderColor",b)},rotation:a=>{let b=a.detail.rotation;this.setRotation(b),this.annotationStorage.setValue(this.data.id,{rotation:b})}})}_dispatchEventFromSandbox(a,b){let c=this._commonActions;for(let d of Object.keys(b.detail)){let e=a[d]||c[d];e?.(b)}}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;let b=this.annotationStorage.getRawValue(this.data.id);if(!b)return;let c=this._commonActions;for(let[d,e]of Object.entries(b)){let f=c[d];f&&(f({detail:{[d]:e},target:a}),delete b[d])}}_createQuadrilaterals(){let a;if(!this.container)return;let{quadPoints:b}=this.data;if(!b)return;let[c,d,e,f]=this.data.rect.map(a=>Math.fround(a));if(8===b.length){let[a,g,h,i]=b.subarray(2,6);if(e===a&&f===g&&c===h&&d===i)return}let{style:g}=this.container;if(this.#ez){let{borderColor:b,borderWidth:c}=g;g.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${b}" stroke-width="${c}">`],this.container.classList.add("hasBorder")}let h=e-c,i=f-d,{svgFactory:j}=this,k=j.createElement("svg");k.classList.add("quadrilateralsContainer"),k.setAttribute("width",0),k.setAttribute("height",0),k.role="none";let l=j.createElement("defs");k.append(l);let m=j.createElement("clipPath"),n=`clippath_${this.data.id}`;m.setAttribute("id",n),m.setAttribute("clipPathUnits","objectBoundingBox"),l.append(m);for(let d=2,e=b.length;d<e;d+=8){let e=b[d],g=b[d+1],k=b[d+2],l=b[d+3],n=j.createElement("rect"),o=(k-c)/h,p=(f-g)/i,q=(e-k)/h,r=(g-l)/i;n.setAttribute("x",o),n.setAttribute("y",p),n.setAttribute("width",q),n.setAttribute("height",r),m.append(n),a?.push(`<rect vector-effect="non-scaling-stroke" x="${o}" y="${p}" width="${q}" height="${r}"/>`)}this.#ez&&(a.push("</g></svg>')"),g.backgroundImage=a.join("")),this.container.append(k),this.container.style.clipPath=`url(#${n})`}_createPopup(a=null){let b,c,{data:d}=this;a?(b={str:a.text},c=a.date):(b=d.contentsObj,c=d.modificationDate);let e=this.#eA=new dz({data:{color:d.color,titleObj:d.titleObj,modificationDate:c,contentsObj:b,richText:d.richText,parentRect:d.rect,borderStyle:0,id:`popup_${d.id}`,rotation:d.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(e.render())}get hasPopupElement(){return!!(this.#eA||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#eA}render(){aj("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,b=null){let c=[];if(this._fieldObjects){let d=this._fieldObjects[a];if(d)for(let{page:a,id:e,exportValues:f}of d){if(-1===a||e===b)continue;let d="string"==typeof f?f:null,g=document.querySelector(`[data-element-id="${e}"]`);if(g&&!dk.has(g)){ai(`_getElementsByName - element not allowed: ${e}`);continue}c.push({id:e,exportValue:d,domElement:g})}return c}for(let d of document.getElementsByName(a)){let{exportValue:a}=d,e=d.getAttribute("data-element-id");e!==b&&dk.has(d)&&c.push({id:e,exportValue:a,domElement:d})}return c}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let a=this.getElementsToTriggerPopup();if(Array.isArray(a))for(let b of a)b.classList.add("highlightArea");else a.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:a,data:{id:b}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:a,editId:b,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class dp extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.editor=a.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){let{editor:a}=this;a.hasComment&&(this._createPopup(a.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(a){this.editor.comment=a,a||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class dq extends dn{constructor(a,b=null){super(a,{isRenderable:!0,ignoreBorder:!!b?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){let{data:a,linkService:b}=this,c=document.createElement("a");c.setAttribute("data-element-id",a.id);let d=!1;return a.url?(b.addLinkAttributes(c,a.url,a.newWindow),d=!0):a.action?(this._bindNamedAction(c,a.action,a.overlaidText),d=!0):a.attachment?(this.#eC(c,a.attachment,a.overlaidText,a.attachmentDest),d=!0):a.setOCGState?(this.#eD(c,a.setOCGState,a.overlaidText),d=!0):a.dest?(this._bindLink(c,a.dest,a.overlaidText),d=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(c,a),d=!0),a.resetForm?(this._bindResetFormAction(c,a.resetForm),d=!0):this.isTooltipOnly&&!d&&(this._bindLink(c,""),d=!0)),this.container.classList.add("linkAnnotation"),d&&this.container.append(c),this.container}#eE(){this.container.setAttribute("data-internal-link","")}_bindLink(a,b,c=""){a.href=this.linkService.getDestinationHash(b),a.onclick=()=>(b&&this.linkService.goToDestination(b),!1),(b||""===b)&&this.#eE(),c&&(a.title=c)}_bindNamedAction(a,b,c=""){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(b),!1),c&&(a.title=c),this.#eE()}#eC(a,b,c="",d=null){a.href=this.linkService.getAnchorUrl(""),b.description?a.title=b.description:c&&(a.title=c),a.onclick=()=>(this.downloadManager?.openOrDownloadData(b.content,b.filename,d),!1),this.#eE()}#eD(a,b,c=""){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeSetOCGState(b),!1),c&&(a.title=c),this.#eE()}_bindJSAction(a,b){a.href=this.linkService.getAnchorUrl("");let c=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let d of Object.keys(b.actions)){let e=c.get(d);e&&(a[e]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b.id,name:d}}),!1))}b.overlaidText&&(a.title=b.overlaidText),a.onclick||(a.onclick=()=>!1),this.#eE()}_bindResetFormAction(a,b){let c=a.onclick;if(c||(a.href=this.linkService.getAnchorUrl("")),this.#eE(),!this._fieldObjects){ai('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),c||(a.onclick=()=>!1);return}a.onclick=()=>{c?.();let{fields:a,refs:d,include:e}=b,f=[];if(0!==a.length||0!==d.length){let b=new Set(d);for(let c of a)for(let{id:a}of this._fieldObjects[c]||[])b.add(a);for(let a of Object.values(this._fieldObjects))for(let c of a)b.has(c.id)===e&&f.push(c)}else for(let a of Object.values(this._fieldObjects))f.push(...a);let g=this.annotationStorage,h=[];for(let a of f){let{id:b}=a;switch(h.push(b),a.type){case"text":{let c=a.defaultValue||"";g.setValue(b,{value:c});break}case"checkbox":case"radiobutton":{let c=a.defaultValue===a.exportValues;g.setValue(b,{value:c});break}case"combobox":case"listbox":{let c=a.defaultValue||"";g.setValue(b,{value:c});break}default:continue}let c=document.querySelector(`[data-element-id="${b}"]`);if(c){if(!dk.has(c)){ai(`_bindResetFormAction - element not allowed: ${b}`);continue}c.dispatchEvent(new Event("resetform"))}}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class dr extends dn{constructor(a){super(a,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),a.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(a),this.container}}class ds extends dn{render(){return this.container}showElementAndHideCanvas(a){this.data.hasOwnCanvas&&(a.previousSibling?.nodeName==="CANVAS"&&(a.previousSibling.hidden=!0),a.hidden=!1)}_getKeyModifier(a){return ax.platform.isMac?a.metaKey:a.ctrlKey}_setEventListener(a,b,c,d,e){c.includes("mouse")?a.addEventListener(c,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:d,value:e(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):a.addEventListener(c,a=>{if("blur"===c){if(!b.focused||!a.relatedTarget)return;b.focused=!1}else if("focus"===c){if(b.focused)return;b.focused=!0}e&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:d,value:e(a)}})})}_setEventListeners(a,b,c,d){for(let[e,f]of c)("Action"===f||this.data.actions?.[f])&&(("Focus"===f||"Blur"===f)&&(b||={focused:!1}),this._setEventListener(a,b,e,f,d),"Focus"!==f||this.data.actions?.Blur?"Blur"!==f||this.data.actions?.Focus||this._setEventListener(a,b,"focus","Focus",null):this._setEventListener(a,b,"blur","Blur",null))}_setBackgroundColor(a){let b=this.data.backgroundColor||null;a.style.backgroundColor=null===b?"transparent":az.makeHexColor(b[0],b[1],b[2])}_setTextStyle(a){let b,{fontColor:c}=this.data.defaultAppearanceData,d=this.data.defaultAppearanceData.fontSize||9,e=a.style,f=a=>Math.round(10*a)/10;if(this.data.multiLine){let a=Math.abs(this.data.rect[3]-this.data.rect[1]-2),c=Math.round(a/(1.35*d))||1;b=Math.min(d,f(a/c/1.35))}else b=Math.min(d,f(Math.abs(this.data.rect[3]-this.data.rect[1]-2)/1.35));e.fontSize=`calc(${b}px * var(--total-scale-factor))`,e.color=az.makeHexColor(c[0],c[1],c[2]),null!==this.data.textAlignment&&(e.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(a,b){b?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",b)}}class dt extends ds{constructor(a){super(a,{isRenderable:a.renderForms||a.data.hasOwnCanvas||!a.data.hasAppearance&&!!a.data.fieldValue})}setPropertyOnSiblings(a,b,c,d){let e=this.annotationStorage;for(let f of this._getElementsByName(a.name,a.id))f.domElement&&(f.domElement[b]=c),e.setValue(f.id,{[d]:c})}render(){let a=this.annotationStorage,b=this.data.id;this.container.classList.add("textWidgetAnnotation");let c=null;if(this.renderForms){let d=a.getValue(b,{value:this.data.fieldValue}),e=d.value||"",f=a.getValue(b,{charLimit:this.data.maxLen}).charLimit;f&&e.length>f&&(e=e.slice(0,f));let g=d.formattedValue||this.data.textContent?.join("\n")||null;g&&this.data.comb&&(g=g.replaceAll(/\s+/g,""));let h={userValue:e,formattedValue:g,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((c=document.createElement("textarea")).textContent=g??e,this.data.doNotScroll&&(c.style.overflowY="hidden")):((c=document.createElement("input")).type=this.data.password?"password":"text",c.setAttribute("value",g??e),this.data.doNotScroll&&(c.style.overflowX="hidden")),this.data.hasOwnCanvas&&(c.hidden=!0),dk.add(c),c.setAttribute("data-element-id",b),c.disabled=this.data.readOnly,c.name=this.data.fieldName,c.tabIndex=0;let{datetimeFormat:i,datetimeType:j,timeStep:k}=this.data,l=!!j&&this.enableScripting;i&&(c.title=i),this._setRequired(c,this.data.required),f&&(c.maxLength=f),c.addEventListener("input",d=>{a.setValue(b,{value:d.target.value}),this.setPropertyOnSiblings(c,"value",d.target.value,"value"),h.formattedValue=null}),c.addEventListener("resetform",a=>{let b=this.data.defaultFieldValue??"";c.value=h.userValue=b,h.formattedValue=null});let m=a=>{let{formattedValue:b}=h;null!=b&&(a.target.value=b),a.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){c.addEventListener("focus",a=>{if(h.focused)return;let{target:b}=a;if(l&&(b.type=j,k&&(b.step=k)),h.userValue){let a=h.userValue;if(l)if("time"===j){let c=new Date(a);b.value=[c.getHours(),c.getMinutes(),c.getSeconds()].map(a=>a.toString().padStart(2,"0")).join(":")}else b.value=new Date(a-dl).toISOString().split("date"===j?"T":".",1)[0];else b.value=a}h.lastCommittedValue=b.value,h.commitKey=1,this.data.actions?.Focus||(h.focused=!0)}),c.addEventListener("updatefromsandbox",c=>{this.showElementAndHideCanvas(c.target),this._dispatchEventFromSandbox({value(c){h.userValue=c.detail.value??"",l||a.setValue(b,{value:h.userValue.toString()}),c.target.value=h.userValue},formattedValue(c){let{formattedValue:d}=c.detail;h.formattedValue=d,null!=d&&c.target!==document.activeElement&&(c.target.value=d);let e={formattedValue:d};l&&(e.value=d),a.setValue(b,e)},selRange(a){a.target.setSelectionRange(...a.detail.selRange)},charLimit:c=>{let{charLimit:d}=c.detail,{target:e}=c;if(0===d)return void e.removeAttribute("maxLength");e.setAttribute("maxLength",d);let f=h.userValue;f&&!(f.length<=d)&&(e.value=h.userValue=f=f.slice(0,d),a.setValue(b,{value:f}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:f,willCommit:!0,commitKey:1,selStart:e.selectionStart,selEnd:e.selectionEnd}}))}},c)}),c.addEventListener("keydown",a=>{h.commitKey=1;let c=-1;if("Escape"===a.key?c=0:"Enter"!==a.key||this.data.multiLine?"Tab"===a.key&&(h.commitKey=3):c=2,-1===c)return;let{value:d}=a.target;h.lastCommittedValue!==d&&(h.lastCommittedValue=d,h.userValue=d,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:d,willCommit:!0,commitKey:c,selStart:a.target.selectionStart,selEnd:a.target.selectionEnd}}))});let d=m;m=null,c.addEventListener("blur",a=>{if(!h.focused||!a.relatedTarget)return;this.data.actions?.Blur||(h.focused=!1);let{target:c}=a,{value:e}=c;if(l){if(e&&"time"===j){let a=e.split(":").map(a=>parseInt(a,10));e=new Date(2e3,0,1,a[0],a[1],a[2]||0).valueOf(),c.step=""}else e.includes("T")||(e=`${e}T00:00`),e=new Date(e).valueOf();c.type="text"}h.userValue=e,h.lastCommittedValue!==e&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:e,willCommit:!0,commitKey:h.commitKey,selStart:a.target.selectionStart,selEnd:a.target.selectionEnd}}),d(a)}),this.data.actions?.Keystroke&&c.addEventListener("beforeinput",a=>{h.lastCommittedValue=null;let{data:c,target:d}=a,{value:e,selectionStart:f,selectionEnd:g}=d,i=f,j=g;switch(a.inputType){case"deleteWordBackward":{let a=e.substring(0,f).match(/\w*[^\w]*$/);a&&(i-=a[0].length);break}case"deleteWordForward":{let a=e.substring(f).match(/^[^\w]*\w*/);a&&(j+=a[0].length);break}case"deleteContentBackward":f===g&&(i-=1);break;case"deleteContentForward":f===g&&(j+=1)}a.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:e,change:c||"",willCommit:!1,selStart:i,selEnd:j}})}),this._setEventListeners(c,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.value)}if(m&&c.addEventListener("blur",m),this.data.comb){let a=(this.data.rect[2]-this.data.rect[0])/f;c.classList.add("comb"),c.style.letterSpacing=`calc(${a}px * var(--total-scale-factor) - 1ch)`}}else(c=document.createElement("div")).textContent=this.data.fieldValue,c.style.verticalAlign="middle",c.style.display="table-cell",this.data.hasOwnCanvas&&(c.hidden=!0);return this._setTextStyle(c),this._setBackgroundColor(c),this._setDefaultPropertiesFromJS(c),this.container.append(c),this.container}}class du extends ds{constructor(a){super(a,{isRenderable:!!a.data.hasOwnCanvas})}}class dv extends ds{constructor(a){super(a,{isRenderable:a.renderForms})}render(){let a=this.annotationStorage,b=this.data,c=b.id,d=a.getValue(c,{value:b.exportValue===b.fieldValue}).value;"string"==typeof d&&(d="Off"!==d,a.setValue(c,{value:d})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let e=document.createElement("input");return dk.add(e),e.setAttribute("data-element-id",c),e.disabled=b.readOnly,this._setRequired(e,this.data.required),e.type="checkbox",e.name=b.fieldName,d&&e.setAttribute("checked",!0),e.setAttribute("exportValue",b.exportValue),e.tabIndex=0,e.addEventListener("change",d=>{let{name:e,checked:f}=d.target;for(let d of this._getElementsByName(e,c)){let c=f&&d.exportValue===b.exportValue;d.domElement&&(d.domElement.checked=c),a.setValue(d.id,{value:c})}a.setValue(c,{value:f})}),e.addEventListener("resetform",a=>{let c=b.defaultFieldValue||"Off";a.target.checked=c===b.exportValue}),this.enableScripting&&this.hasJSActions&&(e.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({value(b){b.target.checked="Off"!==b.detail.value,a.setValue(c,{value:b.target.checked})}},b)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class dw extends ds{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let a=this.annotationStorage,b=this.data,c=b.id,d=a.getValue(c,{value:b.fieldValue===b.buttonValue}).value;if("string"==typeof d&&(d=d!==b.buttonValue,a.setValue(c,{value:d})),d)for(let d of this._getElementsByName(b.fieldName,c))a.setValue(d.id,{value:!1});let e=document.createElement("input");if(dk.add(e),e.setAttribute("data-element-id",c),e.disabled=b.readOnly,this._setRequired(e,this.data.required),e.type="radio",e.name=b.fieldName,d&&e.setAttribute("checked",!0),e.tabIndex=0,e.addEventListener("change",b=>{let{name:d,checked:e}=b.target;for(let b of this._getElementsByName(d,c))a.setValue(b.id,{value:!1});a.setValue(c,{value:e})}),e.addEventListener("resetform",a=>{let c=b.defaultFieldValue;a.target.checked=null!=c&&c===b.buttonValue}),this.enableScripting&&this.hasJSActions){let d=b.buttonValue;e.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({value:b=>{let e=d===b.detail.value;for(let d of this._getElementsByName(b.target.name)){let b=e&&d.id===c;d.domElement&&(d.domElement.checked=b),a.setValue(d.id,{value:b})}}},b)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class dx extends dq{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){let a=super.render();a.classList.add("buttonWidgetAnnotation","pushButton");let b=a.lastChild;return this.enableScripting&&this.hasJSActions&&b&&(this._setDefaultPropertiesFromJS(b),b.addEventListener("updatefromsandbox",a=>{this._dispatchEventFromSandbox({},a)})),a}}class dy extends ds{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let a=this.annotationStorage,b=this.data.id,c=a.getValue(b,{value:this.data.fieldValue}),d=document.createElement("select");dk.add(d),d.setAttribute("data-element-id",b),d.disabled=this.data.readOnly,this._setRequired(d,this.data.required),d.name=this.data.fieldName,d.tabIndex=0;let e=this.data.combo&&this.data.options.length>0;for(let a of(!this.data.combo&&(d.size=this.data.options.length,this.data.multiSelect&&(d.multiple=!0)),d.addEventListener("resetform",a=>{let b=this.data.defaultFieldValue;for(let a of d.options)a.selected=a.value===b}),this.data.options)){let b=document.createElement("option");b.textContent=a.displayValue,b.value=a.exportValue,c.value.includes(a.exportValue)&&(b.setAttribute("selected",!0),e=!1),d.append(b)}let f=null;if(e){let a=document.createElement("option");a.value=" ",a.setAttribute("hidden",!0),a.setAttribute("selected",!0),d.prepend(a),f=()=>{a.remove(),d.removeEventListener("input",f),f=null},d.addEventListener("input",f)}let g=a=>{let b=a?"value":"textContent",{options:c,multiple:e}=d;return e?Array.prototype.filter.call(c,a=>a.selected).map(a=>a[b]):-1===c.selectedIndex?null:c[c.selectedIndex][b]},h=g(!1),i=a=>{let b=a.target.options;return Array.prototype.map.call(b,a=>({displayValue:a.textContent,exportValue:a.value}))};return this.enableScripting&&this.hasJSActions?(d.addEventListener("updatefromsandbox",c=>{this._dispatchEventFromSandbox({value(c){f?.();let e=c.detail.value,i=new Set(Array.isArray(e)?e:[e]);for(let a of d.options)a.selected=i.has(a.value);a.setValue(b,{value:g(!0)}),h=g(!1)},multipleSelection(a){d.multiple=!0},remove(c){let e=d.options,f=c.detail.remove;e[f].selected=!1,d.remove(f),e.length>0&&-1===Array.prototype.findIndex.call(e,a=>a.selected)&&(e[0].selected=!0),a.setValue(b,{value:g(!0),items:i(c)}),h=g(!1)},clear(c){for(;0!==d.length;)d.remove(0);a.setValue(b,{value:null,items:[]}),h=g(!1)},insert(c){let{index:e,displayValue:f,exportValue:j}=c.detail.insert,k=d.children[e],l=document.createElement("option");l.textContent=f,l.value=j,k?k.before(l):d.append(l),a.setValue(b,{value:g(!0),items:i(c)}),h=g(!1)},items(c){let{items:e}=c.detail;for(;0!==d.length;)d.remove(0);for(let a of e){let{displayValue:b,exportValue:c}=a,e=document.createElement("option");e.textContent=b,e.value=c,d.append(e)}d.options.length>0&&(d.options[0].selected=!0),a.setValue(b,{value:g(!0),items:i(c)}),h=g(!1)},indices(c){let d=new Set(c.detail.indices);for(let a of c.target.options)a.selected=d.has(a.index);a.setValue(b,{value:g(!0)}),h=g(!1)},editable(a){a.target.disabled=!a.detail.editable}},c)}),d.addEventListener("input",c=>{let d=g(!0),e=g(!1);a.setValue(b,{value:d}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:h,change:e,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(d,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],a=>a.target.value)):d.addEventListener("input",function(c){a.setValue(b,{value:g(!0)})}),this.data.combo&&this._setTextStyle(d),this._setBackgroundColor(d),this._setDefaultPropertiesFromJS(d),this.container.append(d),this.container}}class dz extends dn{constructor(a){const{data:b,elements:c,parent:d}=a,e=!!d._commentManager;if(super(a,{isRenderable:!e&&dn._hasPopupData(b)}),this.elements=c,e&&dn._hasPopupData(b)){const a=this.popup=this.#eF();for(const b of c)b.popup=a}else this.popup=null}#eF(){return new dA({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){let{container:a}=this;a.classList.add("popupAnnotation"),a.role="comment";let b=this.popup=this.#eF(),c=[];for(let a of this.elements)a.popup=b,a.container.ariaHasPopup="dialog",c.push(a.data.id),a.addHighlightArea();return this.container.setAttribute("aria-controls",c.map(a=>`${aE}${a}`).join(",")),this.container}}class dA{#N=null;#eG=this.#et.bind(this);#eH=this.#eI.bind(this);#eJ=this.#eK.bind(this);#eL=this.#eM.bind(this);#eN=null;#av=null;#eO=null;#eP=null;#eQ=null;#eR=null;#eS=null;#eT=!1;#eU=null;#eV=null;#C=null;#eW=null;#eX=null;#bd=null;#eY=null;#a9=null;#eZ=null;#ey=null;#e$=!1;#e_=null;#e0=null;constructor({container:a,color:b,elements:c,titleObj:d,modificationDate:e,contentsObj:f,richText:g,parent:h,rect:i,parentRect:j,open:k,commentManager:l=null}){this.#av=a,this.#eZ=d,this.#eO=f,this.#a9=g,this.#eR=h,this.#eN=b,this.#eY=i,this.#eS=j,this.#eQ=c,this.#N=l,this.#e_=c[0],this.#eP=aW.toDateObject(e),this.trigger=c.flatMap(a=>a.getElementsToTriggerPopup()),l?this.renderCommentButton():(this.#e1(),this.#av.hidden=!0,k&&this.#eM())}#e1(){if(this.#eV)return;this.#eV=new AbortController;let{signal:a}=this.#eV;for(let b of this.trigger)b.addEventListener("click",this.#eL,{signal:a}),b.addEventListener("pointerenter",this.#eJ,{signal:a}),b.addEventListener("pointerleave",this.#eH,{signal:a}),b.classList.add("popupTriggerArea");for(let b of this.#eQ)b.container?.addEventListener("keydown",this.#eG,{signal:a})}#e2(){let a=this.#eQ.find(a=>a.hasCommentButton);a&&(this.#eX=a._normalizePoint(a.commentButtonPosition))}renderCommentButton(){if(this.#eW||(this.#eX||this.#e2(),!this.#eX))return;let{signal:a}=this.#eV=new AbortController,b=!!this.#e_.extraPopupElement,c=()=>{this.#N.toggleCommentPopup(this,!0,void 0,!b)},d=()=>{this.#N.toggleCommentPopup(this,!1,!0,!b)},e=()=>{this.#N.toggleCommentPopup(this,!1,!1)};if(b)for(let b of(this.#eW=this.#e_.container,this.trigger))b.ariaHasPopup="dialog",b.ariaControls="commentPopup",b.addEventListener("keydown",this.#eG,{signal:a}),b.addEventListener("click",c,{signal:a}),b.addEventListener("pointerenter",d,{signal:a}),b.addEventListener("pointerleave",e,{signal:a}),b.classList.add("popupTriggerArea");else{let b=this.#eW=document.createElement("button");b.className="annotationCommentButton";let f=this.#e_.container;b.style.zIndex=f.style.zIndex+1,b.tabIndex=0,b.ariaHasPopup="dialog",b.ariaControls="commentPopup",b.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#e3(),this.#e4(),b.addEventListener("keydown",this.#eG,{signal:a}),b.addEventListener("click",c,{signal:a}),b.addEventListener("pointerenter",d,{signal:a}),b.addEventListener("pointerleave",e,{signal:a}),f.after(b)}}#e4(){if(this.#e_.extraPopupElement&&!this.#e_.editor)return;this.renderCommentButton();let[a,b]=this.#eX,{style:c}=this.#eW;c.left=`calc(${a}%)`,c.top=`calc(${b}% - var(--comment-button-dim))`}#e3(){this.#e_.extraPopupElement||(this.renderCommentButton(),this.#eW.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){let{color:a,opacity:b}=this.#e_.commentData;return a?this.#eR._commentManager.makeCommentColor(a,b):null}focusCommentButton(){setTimeout(()=>{this.#eW?.focus()},0)}getData(){let{richText:a,color:b,opacity:c,creationDate:d,modificationDate:e}=this.#e_.commentData;return{contentsObj:{str:this.comment},richText:a,color:b,opacity:c,creationDate:d,modificationDate:e}}get elementBeforePopup(){return this.#eW}get comment(){return this.#e0||=this.#e_.commentText,this.#e0}set comment(a){a!==this.comment&&(this.#e_.commentText=this.#e0=a)}get parentBoundingClientRect(){return this.#e_.layer.getBoundingClientRect()}setCommentButtonStates({selected:a,hasPopup:b}){this.#eW&&(this.#eW.classList.toggle("selected",a),this.#eW.ariaExpanded=b)}setSelectedCommentButton(a){this.#eW.classList.toggle("selected",a)}get commentPopupPosition(){if(this.#bd)return this.#bd;let{x:a,y:b,height:c}=this.#eW.getBoundingClientRect(),{x:d,y:e,width:f,height:g}=this.#e_.layer.getBoundingClientRect();return[(a-d)/f,(b+c-e)/g]}set commentPopupPosition(a){this.#bd=a}hasDefaultPopupPosition(){return null===this.#bd}get commentButtonPosition(){return this.#eX}get commentButtonWidth(){return this.#eW.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(a){let[b,c]=this.#bd||this.commentButtonPosition.map(a=>a/100),d=this.parentBoundingClientRect,{x:e,y:f,width:g,height:h}=d;this.#N.showDialog(null,this,e+b*g,f+c*h,{...a,parentDimensions:d})}render(){if(this.#eU)return;let a=this.#eU=document.createElement("div");if(a.className="popup",this.#eN){let b=a.style.outlineColor=az.makeHexColor(...this.#eN);a.style.backgroundColor=`color-mix(in srgb, ${b} 30%, white)`}let b=document.createElement("span");if(b.className="header",this.#eZ?.str){let a=document.createElement("span");a.className="title",b.append(a),{dir:a.dir,str:a.textContent}=this.#eZ}if(a.append(b),this.#eP){let a=document.createElement("time");a.className="popupDate",a.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),a.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#eP.valueOf()})),a.dateTime=this.#eP.toISOString(),b.append(a)}bb({html:this.#e5||this.#eO.str,dir:this.#eO?.dir,className:"popupContent"},a),this.#av.append(a)}get #e5(){let a=this.#a9,b=this.#eO;return a?.str&&(!b?.str||b.str===a.str)&&this.#a9.html||null}get #e6(){return this.#e5?.attributes?.style?.fontSize||0}get #e7(){return this.#e5?.attributes?.style?.color||null}#e8(a){let b=[],c={style:{color:this.#e7,fontSize:this.#e6?`calc(${this.#e6}px * var(--total-scale-factor))`:""}};for(let d of a.split("\n"))b.push({name:"span",value:d,attributes:c});return{str:a,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:b}]}}}#et(a){a.altKey||a.shiftKey||a.ctrlKey||a.metaKey||("Enter"===a.key||"Escape"===a.key&&this.#eT)&&this.#eM()}updateEdited({rect:a,popup:b,deleted:c}){if(this.#N){c?(this.remove(),this.#e0=null):b&&(b.deleted?this.remove():(this.#e3(),this.#e0=b.text)),a&&(this.#eX=null,this.#e2(),this.#e4());return}c||b?.deleted?this.remove():(this.#e1(),this.#ey||={contentsObj:this.#eO,richText:this.#a9},a&&(this.#C=null),b&&b.text&&(this.#a9=this.#e8(b.text),this.#eP=aW.toDateObject(b.date),this.#eO=null),this.#eU?.remove(),this.#eU=null)}resetEdited(){this.#ey&&({contentsObj:this.#eO,richText:this.#a9}=this.#ey,this.#ey=null,this.#eU?.remove(),this.#eU=null,this.#C=null)}remove(){if(this.#eV?.abort(),this.#eV=null,this.#eU?.remove(),this.#eU=null,this.#e$=!1,this.#eT=!1,this.#eW?.remove(),this.#eW=null,this.trigger)for(let a of this.trigger)a.classList.remove("popupTriggerArea")}#e9(){if(null!==this.#C)return;let{page:{view:a},viewport:{rawDims:{pageWidth:b,pageHeight:c,pageX:d,pageY:e}}}=this.#eR,f=!!this.#eS,g=f?this.#eS:this.#eY;for(let a of this.#eQ)if(!g||null!==az.intersect(a.data.rect,g)){g=a.data.rect,f=!0;break}let h=az.normalizeRect([g[0],a[3]-g[1]+a[1],g[2],a[3]-g[3]+a[1]]),i=f?g[2]-g[0]+5:0,j=h[0]+i,k=h[1];this.#C=[100*(j-d)/b,100*(k-e)/c];let{style:l}=this.#av;l.left=`${this.#C[0]}%`,l.top=`${this.#C[1]}%`}#eM(){this.#N?this.#N.toggleCommentPopup(this,!1):(this.#eT=!this.#eT,this.#eT?(this.#eK(),this.#av.addEventListener("click",this.#eL),this.#av.addEventListener("keydown",this.#eG)):(this.#eI(),this.#av.removeEventListener("click",this.#eL),this.#av.removeEventListener("keydown",this.#eG)))}#eK(){this.#eU||this.render(),this.isVisible?this.#eT&&this.#av.classList.add("focused"):(this.#e9(),this.#av.hidden=!1,this.#av.style.zIndex=parseInt(this.#av.style.zIndex)+1e3)}#eI(){this.#av.classList.remove("focused"),!this.#eT&&this.isVisible&&(this.#av.hidden=!0,this.#av.style.zIndex=parseInt(this.#av.style.zIndex)-1e3)}forceHide(){this.#e$=this.isVisible,this.#e$&&(this.#av.hidden=!0)}maybeShow(){this.#N||(this.#e1(),this.#e$&&(this.#eU||this.#eK(),this.#e$=!1,this.#av.hidden=!1))}get isVisible(){return!this.#N&&!1===this.#av.hidden}}class dB extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.textContent=a.data.textContent,this.textPosition=a.data.textPosition,this.annotationEditorType=$.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let a=document.createElement("div");for(let b of(a.classList.add("annotationTextContent"),a.setAttribute("role","comment"),this.textContent)){let c=document.createElement("span");c.textContent=b,a.append(c)}this.container.append(a)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class dC extends dn{#fa=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let{data:a,width:b,height:c}=this,d=this.svgFactory.create(b,c,!0),e=this.#fa=this.svgFactory.createElement("svg:line");return e.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),e.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),e.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),e.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),e.setAttribute("stroke-width",a.borderStyle.width||1),e.setAttribute("stroke","transparent"),e.setAttribute("fill","transparent"),d.append(e),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#fa}addHighlightArea(){this.container.classList.add("highlightArea")}}class dD extends dn{#fb=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let{data:a,width:b,height:c}=this,d=this.svgFactory.create(b,c,!0),e=a.borderStyle.width,f=this.#fb=this.svgFactory.createElement("svg:rect");return f.setAttribute("x",e/2),f.setAttribute("y",e/2),f.setAttribute("width",b-e),f.setAttribute("height",c-e),f.setAttribute("stroke-width",e||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#fb}addHighlightArea(){this.container.classList.add("highlightArea")}}class dE extends dn{#fc=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let{data:a,width:b,height:c}=this,d=this.svgFactory.create(b,c,!0),e=a.borderStyle.width,f=this.#fc=this.svgFactory.createElement("svg:ellipse");return f.setAttribute("cx",b/2),f.setAttribute("cy",c/2),f.setAttribute("rx",b/2-e/2),f.setAttribute("ry",c/2-e/2),f.setAttribute("stroke-width",e||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#fc}addHighlightArea(){this.container.classList.add("highlightArea")}}class dF extends dn{#fd=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:a,vertices:b,borderStyle:c,popupRef:d},width:e,height:f}=this;if(!b)return this.container;let g=this.svgFactory.create(e,f,!0),h=[];for(let c=0,d=b.length;c<d;c+=2){let d=b[c]-a[0],e=a[3]-b[c+1];h.push(`${d},${e}`)}h=h.join(" ");let i=this.#fd=this.svgFactory.createElement(this.svgElementName);return i.setAttribute("points",h),i.setAttribute("stroke-width",c.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),g.append(i),this.container.append(g),!d&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#fd}addHighlightArea(){this.container.classList.add("highlightArea")}}class dG extends dF{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class dH extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class dI extends dn{#fe=null;#ff=[];constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?$.HIGHLIGHT:$.INK}#fg(a,b){switch(a){case 90:return{transform:`rotate(90) translate(${-b[0]},${b[1]}) scale(1,-1)`,width:b[3]-b[1],height:b[2]-b[0]};case 180:return{transform:`rotate(180) translate(${-b[2]},${b[1]}) scale(1,-1)`,width:b[2]-b[0],height:b[3]-b[1]};case 270:return{transform:`rotate(270) translate(${-b[2]},${b[3]}) scale(1,-1)`,width:b[3]-b[1],height:b[2]-b[0]};default:return{transform:`translate(${-b[0]},${b[3]}) scale(1,-1)`,width:b[2]-b[0],height:b[3]-b[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:a,rotation:b,inkLists:c,borderStyle:d,popupRef:e}}=this,{transform:f,width:g,height:h}=this.#fg(b,a),i=this.svgFactory.create(g,h,!0),j=this.#fe=this.svgFactory.createElement("svg:g");i.append(j),j.setAttribute("stroke-width",d.width||1),j.setAttribute("stroke-linecap","round"),j.setAttribute("stroke-linejoin","round"),j.setAttribute("stroke-miterlimit",10),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),j.setAttribute("transform",f);for(let a=0,b=c.length;a<b;a++){let b=this.svgFactory.createElement(this.svgElementName);this.#ff.push(b),b.setAttribute("points",c[a].join(",")),j.append(b)}return!e&&this.hasPopupData&&this._createPopup(),this.container.append(i),this._editOnDoubleClick(),this.container}updateEdited(a){super.updateEdited(a);let{thickness:b,points:c,rect:d}=a,e=this.#fe;if(b>=0&&e.setAttribute("stroke-width",b||1),c)for(let a=0,b=this.#ff.length;a<b;a++)this.#ff[a].setAttribute("points",c[a].join(","));if(d){let{transform:a,width:b,height:c}=this.#fg(this.data.rotation,d);e.parentElement.setAttribute("viewBox",`0 0 ${b} ${c}`),e.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#ff}addHighlightArea(){this.container.classList.add("highlightArea")}}class dJ extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=$.HIGHLIGHT}render(){let{data:{overlaidText:a,popupRef:b}}=this;if(!b&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),a){let b=document.createElement("mark");b.classList.add("overlaidText"),b.textContent=a,this.container.append(b)}return this.container}}class dK extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:a,popupRef:b}}=this;if(!b&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),a){let b=document.createElement("u");b.classList.add("overlaidText"),b.textContent=a,this.container.append(b)}return this.container}}class dL extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:a,popupRef:b}}=this;if(!b&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),a){let b=document.createElement("u");b.classList.add("overlaidText"),b.textContent=a,this.container.append(b)}return this.container}}class dM extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:a,popupRef:b}}=this;if(!b&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),a){let b=document.createElement("s");b.classList.add("overlaidText"),b.textContent=a,this.container.append(b)}return this.container}}class dN extends dn{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=$.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class dO extends dn{#fh=null;constructor(a){super(a,{isRenderable:!0});const{file:b}=this.data;this.filename=b.filename,this.content=b.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...b})}render(){let a;this.container.classList.add("fileAttachmentAnnotation");let{container:b,data:c}=this;c.hasAppearance||0===c.fillAlpha?a=document.createElement("div"):((a=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(c.name)?"paperclip":"pushpin"}.svg`,c.fillAlpha&&c.fillAlpha<1&&(a.style=`filter: opacity(${Math.round(100*c.fillAlpha)}%);`)),a.addEventListener("dblclick",this.#fi.bind(this)),this.#fh=a;let{isMac:d}=ax.platform;return b.addEventListener("keydown",a=>{"Enter"===a.key&&(d?a.metaKey:a.ctrlKey)&&this.#fi()}),!c.popupRef&&this.hasPopupData?this._createPopup():a.classList.add("popupTriggerArea"),b.append(a),b}getElementsToTriggerPopup(){return this.#fh}addHighlightArea(){this.container.classList.add("highlightArea")}#fi(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class dP{#fj=null;#fk=null;#K=null;#fl=new Map;#fm=null;#fn=null;constructor({div:a,accessibilityManager:b,annotationCanvasMap:c,annotationEditorUIManager:d,page:e,viewport:f,structTreeLayer:g,commentManager:h,linkService:i,annotationStorage:j}){this.div=a,this.#fj=b,this.#fk=c,this.#fm=g||null,this.#fn=i||null,this.#K=j||new bs,this.page=e,this.viewport=f,this.zIndex=0,this._annotationEditorUIManager=d,this._commentManager=h||null}hasEditableAnnotations(){return this.#fl.size>0}async #fo(a,b,c){let d=a.firstChild||a,e=d.id=`${aE}${b}`,f=await this.#fm?.getAriaAttributes(e);if(f)for(let[a,b]of f)d.setAttribute(a,b);c?c.at(-1).container.after(a):(this.div.append(a),this.#fj?.moveElementInDOM(this.div,a,d,!1))}async render(a){let{annotations:b}=a,c=this.div;a_(c,this.viewport);let d=new Map,e={data:null,layer:c,linkService:this.#fn,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:!1!==a.renderForms,svgFactory:new dj,annotationStorage:this.#K,enableComment:!0===a.enableComment,enableScripting:!0===a.enableScripting,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,parent:this,elements:null};for(let a of b){if(a.noHTML)continue;let b=a.annotationType===ac.POPUP;if(b){let b=d.get(a.id);if(!b)continue;e.elements=b}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;e.data=a;let c=dm.create(e);if(!c.isRenderable)continue;if(!b&&a.popupRef){let b=d.get(a.popupRef);b?b.push(c):d.set(a.popupRef,[c])}let f=c.render();a.hidden&&(f.style.visibility="hidden"),await this.#fo(f,a.id,e.elements),c.extraPopupElement?.popup?.renderCommentButton(),c._isEditable&&(this.#fl.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}this.#fp()}async addLinkAnnotations(a){let b={data:null,layer:this.div,linkService:this.#fn,svgFactory:new dj,parent:this};for(let c of a){c.borderStyle||=dP._defaultBorderStyle,b.data=c;let a=dm.create(b);if(!a.isRenderable)continue;let d=a.render();await this.#fo(d,c.id,null)}}update({viewport:a}){let b=this.div;this.viewport=a,a_(b,{rotation:a.rotation}),this.#fp(),b.hidden=!1}#fp(){if(!this.#fk)return;let a=this.div;for(let[b,c]of this.#fk){let d=a.querySelector(`[data-annotation-id="${b}"]`);if(!d)continue;c.className="annotationContent";let{firstChild:e}=d;e?"CANVAS"===e.nodeName?e.replaceWith(c):e.classList.contains("annotationContent")?e.after(c):e.before(c):d.append(c);let f=this.#fl.get(b);f&&(f._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(b,d.id,c),f._hasNoCanvas=!1):f.canvas=c)}this.#fk.clear()}getEditableAnnotations(){return Array.from(this.#fl.values())}getEditableAnnotation(a){return this.#fl.get(a)}addFakeAnnotation(a){let{div:b}=this,{id:c,rotation:d}=a,e=new dp({data:{id:c,rect:a.getPDFRect(),rotation:d},editor:a,layer:b,parent:this,enableComment:!!this._commentManager,linkService:this.#fn,annotationStorage:this.#K}),f=e.render();return b.append(f),this.#fj?.moveElementInDOM(b,f,f,!1),e.createOrUpdatePopup(),e}static get _defaultBorderStyle(){return an(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:1,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}let dQ=/\r\n?|\n/g;class dR extends bo{#fq="";#fr=`${this.id}-editor`;#fs=null;#e6;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let a=dR.prototype,b=a=>a.isEmpty(),c=bk.TRANSLATE_SMALL,d=bk.TRANSLATE_BIG;return an(this,"_keyboardManager",new bi([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],a.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],a.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],a._translateEmpty,{args:[-c,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a._translateEmpty,{args:[-d,0],checker:b}],[["ArrowRight","mac+ArrowRight"],a._translateEmpty,{args:[c,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a._translateEmpty,{args:[d,0],checker:b}],[["ArrowUp","mac+ArrowUp"],a._translateEmpty,{args:[0,-c],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a._translateEmpty,{args:[0,-d],checker:b}],[["ArrowDown","mac+ArrowDown"],a._translateEmpty,{args:[0,c],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a._translateEmpty,{args:[0,d],checker:b}]]))}static _type="freetext";static _editorType=$.FREETEXT;constructor(a){super({...a,name:"freeTextEditor"}),this.color=a.color||dR._defaultColor||bo._defaultLineColor,this.#e6=a.fontSize||dR._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(a,b){bo.initialize(a,b);let c=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(c.getPropertyValue("--freetext-padding"))}static updateDefaultParams(a,b){switch(a){case _.FREETEXT_SIZE:dR._defaultFontSize=b;break;case _.FREETEXT_COLOR:dR._defaultColor=b}}updateParams(a,b){switch(a){case _.FREETEXT_SIZE:this.#ft(b);break;case _.FREETEXT_COLOR:this.#e3(b)}}static get defaultPropertiesToUpdate(){return[[_.FREETEXT_SIZE,dR._defaultFontSize],[_.FREETEXT_COLOR,dR._defaultColor||bo._defaultLineColor]]}get propertiesToUpdate(){return[[_.FREETEXT_SIZE,this.#e6],[_.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new de(this),[["colorPicker",this._colorPicker]]}get colorType(){return _.FREETEXT_COLOR}#ft(a){let b=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--total-scale-factor))`,this.translate(0,-(a-this.#e6)*this.parentScale),this.#e6=a,this.#fu()},c=this.#e6;this.addCommands({cmd:b.bind(this,a),undo:b.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#e3(a){let b=a=>{this.color=a,this.onUpdatedColor()},c=this.color;this.addCommands({cmd:b.bind(this,a),undo:b.bind(this,c),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(a,b){this._uiManager.translateSelectedEditors(a,b,!0)}getInitialTranslation(){let a=this.parentScale;return[-dR._internalPadding*a,-(dR._internalPadding+this.#e6)*a]}rebuild(){!this.parent||(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#fs=new AbortController;let a=this._uiManager.combinedSignal(this.#fs);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:a}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:a}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:a}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:a}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:a}),!0}disableEditMode(){return!!super.disableEditMode()&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#fr),this._isDraggable=!0,this.#fs?.abort(),this.#fs=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}focusin(a){this._focusEventsAllowed&&(super.focusin(a),a.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(a){this.width||(this.enableEditMode(),a&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#fv(){let a=[];this.editorDiv.normalize();let b=null;for(let c of this.editorDiv.childNodes)(b?.nodeType!==Node.TEXT_NODE||"BR"!==c.nodeName)&&(a.push(dR.#fw(c)),b=c);return a.join("\n")}#fu(){let a,[b,c]=this.parentDimensions;if(this.isAttachedToDOM)a=this.div.getBoundingClientRect();else{let{currentLayer:b,div:c}=this,d=c.style.display,e=c.classList.contains("hidden");c.classList.remove("hidden"),c.style.display="hidden",b.div.append(this.div),a=c.getBoundingClientRect(),c.remove(),c.style.display=d,c.classList.toggle("hidden",e)}this.rotation%180==this.parentRotation%180?(this.width=a.width/b,this.height=a.height/c):(this.width=a.height/b,this.height=a.width/c),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let a=this.#fq,b=this.#fq=this.#fv().trimEnd();if(a===b)return;let c=a=>{(this.#fq=a,a)?(this.#fx(),this._uiManager.rebuild(this),this.#fu()):this.remove()};this.addCommands({cmd:()=>{c(b)},undo:()=>{c(a)},mustExec:!1}),this.#fu()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(a){a.target===this.div&&"Enter"===a.key&&(this.enterInEditMode(),a.preventDefault())}editorDivKeydown(a){dR._keyboardManager.exec(this,a)}editorDivFocus(a){this.isEditing=!0}editorDivBlur(a){this.isEditing=!1}editorDivInput(a){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){let a,b;if(this.div)return this.div;(this._isCopy||this.annotationElementId)&&(a=this.x,b=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#fr),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#e6}px * var(--total-scale-factor))`,c.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){let[c,d]=this.parentDimensions;if(this.annotationElementId){let e,f,{position:g}=this._initialData,[h,i]=this.getInitialTranslation();[h,i]=this.pageTranslationToScreen(h,i);let[j,k]=this.pageDimensions,[l,m]=this.pageTranslation;switch(this.rotation){case 0:e=a+(g[0]-l)/j,f=b+this.height-(g[1]-m)/k;break;case 90:e=a+(g[0]-l)/j,f=b-(g[1]-m)/k,[h,i]=[i,-h];break;case 180:e=a-this.width+(g[0]-l)/j,f=b-(g[1]-m)/k,[h,i]=[-h,-i];break;case 270:e=a+(g[0]-l-this.height*k)/j,f=b+(g[1]-m-this.width*j)/k,[h,i]=[-i,h]}this.setAt(e*c,f*d,h,i)}else this._moveAfterPaste(a,b);this.#fx(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static #fw(a){return(a.nodeType===Node.TEXT_NODE?a.nodeValue:a.innerText).replaceAll(dQ,"")}editorDivPaste(a){let b=a.clipboardData||window.clipboardData,{types:c}=b;if(1===c.length&&"text/plain"===c[0])return;a.preventDefault();let d=dR.#fy(b.getData("text")||"").replaceAll(dQ,"\n");if(!d)return;let e=window.getSelection();if(!e.rangeCount)return;this.editorDiv.normalize(),e.deleteFromDocument();let f=e.getRangeAt(0);if(!d.includes("\n")){f.insertNode(document.createTextNode(d)),this.editorDiv.normalize(),e.collapseToStart();return}let{startContainer:g,startOffset:h}=f,i=[],j=[];if(g.nodeType===Node.TEXT_NODE){let a=g.parentElement;if(j.push(g.nodeValue.slice(h).replaceAll(dQ,"")),a!==this.editorDiv){let b=i;for(let c of this.editorDiv.childNodes){if(c===a){b=j;continue}b.push(dR.#fw(c))}}i.push(g.nodeValue.slice(0,h).replaceAll(dQ,""))}else if(g===this.editorDiv){let a=i,b=0;for(let c of this.editorDiv.childNodes)b++===h&&(a=j),a.push(dR.#fw(c))}this.#fq=`${i.join("\n")}${d}${j.join("\n")}`,this.#fx();let k=new Range,l=Math.sumPrecise(i.map(a=>a.length));for(let{firstChild:a}of this.editorDiv.childNodes)if(a.nodeType===Node.TEXT_NODE){let b=a.nodeValue.length;if(l<=b){k.setStart(a,l),k.setEnd(a,l);break}l-=b}e.removeAllRanges(),e.addRange(k)}#fx(){if(this.editorDiv.replaceChildren(),this.#fq)for(let a of this.#fq.split("\n")){let b=document.createElement("div");b.append(a?document.createTextNode(a):document.createElement("br")),this.editorDiv.append(b)}}#fz(){return this.#fq.replaceAll(" "," ")}static #fy(a){return a.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){let a=dR._internalPadding*this.parentScale;return this.getRect(a,a)}static async deserialize(a,b,c){let d=null;if(a instanceof dB){let{data:{defaultAppearanceData:{fontSize:b,fontColor:c},rect:e,rotation:f,id:g,popupRef:h,richText:i,contentsObj:j,creationDate:k,modificationDate:l},textContent:m,textPosition:n,parent:{page:{pageNumber:o}}}=a;if(!m||0===m.length)return null;d=a={annotationType:$.FREETEXT,color:Array.from(c),fontSize:b,value:m.join("\n"),position:n,pageIndex:o-1,rect:e.slice(0),rotation:f,annotationElementId:g,id:g,deleted:!1,popupRef:h,comment:j?.str||null,richText:i,creationDate:k,modificationDate:l}}let e=await super.deserialize(a,b,c);return e.#e6=a.fontSize,e.color=az.makeHexColor(...a.color),e.#fq=dR.#fy(a.value),e._initialData=d,a.comment&&e.setCommentData(a),e}serialize(a=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let b=bo._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),c=Object.assign(super.serialize(a),{color:b,fontSize:this.#e6,value:this.#fz()});return(this.addComment(c),a)?(c.isCopy=!0,c):this.annotationElementId&&!this.#fA(c)?null:(c.id=this.annotationElementId,c)}#fA(a){let{value:b,fontSize:c,color:d,pageIndex:e}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||a.value!==b||a.fontSize!==c||a.color.some((a,b)=>a!==d[b])||a.pageIndex!==e}renderAnnotationElement(a){let b=super.renderAnnotationElement(a);if(!b)return null;let{style:c}=b;for(let a of(c.fontSize=`calc(${this.#e6}px * var(--total-scale-factor))`,c.color=this.color,b.replaceChildren(),this.#fq.split("\n"))){let c=document.createElement("div");c.append(a?document.createTextNode(a):document.createElement("br")),b.append(c)}return a.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#fq}}),b}resetAnnotationElement(a){super.resetAnnotationElement(a),a.resetEdited()}}class dS{static PRECISION=1e-4;toSVGPath(){aj("Abstract method `toSVGPath` must be implemented.")}get box(){aj("Abstract getter `box` must be implemented.")}serialize(a,b){aj("Abstract method `serialize` must be implemented.")}static _rescale(a,b,c,d,e,f){f||=new Float32Array(a.length);for(let g=0,h=a.length;g<h;g+=2)f[g]=b+a[g]*d,f[g+1]=c+a[g+1]*e;return f}static _rescaleAndSwap(a,b,c,d,e,f){f||=new Float32Array(a.length);for(let g=0,h=a.length;g<h;g+=2)f[g]=b+a[g+1]*d,f[g+1]=c+a[g]*e;return f}static _translate(a,b,c,d){d||=new Float32Array(a.length);for(let e=0,f=a.length;e<f;e+=2)d[e]=b+a[e],d[e+1]=c+a[e+1];return d}static svgRound(a){return Math.round(1e4*a)}static _normalizePoint(a,b,c,d,e){switch(e){case 90:return[1-b/c,a/d];case 180:return[1-a/c,1-b/d];case 270:return[b/c,1-a/d];default:return[a/c,b/d]}}static _normalizePagePoint(a,b,c){switch(c){case 90:return[1-b,a];case 180:return[1-a,1-b];case 270:return[b,1-a];default:return[a,b]}}static createBezierPoints(a,b,c,d,e,f){return[(a+5*c)/6,(b+5*d)/6,(5*c+e)/6,(5*d+f)/6,(c+e)/2,(d+f)/2]}}class dT{#fB;#fC=[];#fD;#fE;#fF=[];#fG=new Float32Array(18);#fH;#fI;#fJ;#fK;#fL;#fM;#fN=[];static #fO=8;static #fP=2;static #fQ=dT.#fO+dT.#fP;constructor({x:a,y:b},c,d,e,f,g=0){this.#fB=c,this.#fM=e*d,this.#fE=f,this.#fG.set([NaN,NaN,NaN,NaN,a,b],6),this.#fD=g,this.#fK=dT.#fO*d,this.#fJ=dT.#fQ*d,this.#fL=d,this.#fN.push(a,b)}isEmpty(){return isNaN(this.#fG[8])}#fR(){let a=this.#fG.subarray(4,6),b=this.#fG.subarray(16,18),[c,d,e,f]=this.#fB;return[(this.#fH+(a[0]-b[0])/2-c)/e,(this.#fI+(a[1]-b[1])/2-d)/f,(this.#fH+(b[0]-a[0])/2-c)/e,(this.#fI+(b[1]-a[1])/2-d)/f]}add({x:a,y:b}){this.#fH=a,this.#fI=b;let[c,d,e,f]=this.#fB,[g,h,i,j]=this.#fG.subarray(8,12),k=a-i,l=b-j,m=Math.hypot(k,l);if(m<this.#fJ)return!1;let n=m-this.#fK,o=n/m,p=o*k,q=o*l,r=g,s=h;g=i,h=j,i+=p,j+=q,this.#fN?.push(a,b);let t=-q/n*this.#fM,u=p/n*this.#fM;return(this.#fG.set(this.#fG.subarray(2,8),0),this.#fG.set([i+t,j+u],4),this.#fG.set(this.#fG.subarray(14,18),12),this.#fG.set([i-t,j-u],16),isNaN(this.#fG[6]))?(0===this.#fF.length&&(this.#fG.set([g+t,h+u],2),this.#fF.push(NaN,NaN,NaN,NaN,(g+t-c)/e,(h+u-d)/f),this.#fG.set([g-t,h-u],14),this.#fC.push(NaN,NaN,NaN,NaN,(g-t-c)/e,(h-u-d)/f)),this.#fG.set([r,s,g,h,i,j],6),!this.isEmpty()):((this.#fG.set([r,s,g,h,i,j],6),Math.abs(Math.atan2(s-h,r-g)-Math.atan2(q,p))<Math.PI/2)?([g,h,i,j]=this.#fG.subarray(2,6),this.#fF.push(NaN,NaN,NaN,NaN,((g+i)/2-c)/e,((h+j)/2-d)/f),[g,h,r,s]=this.#fG.subarray(14,18),this.#fC.push(NaN,NaN,NaN,NaN,((r+g)/2-c)/e,((s+h)/2-d)/f)):([r,s,g,h,i,j]=this.#fG.subarray(0,6),this.#fF.push(((r+5*g)/6-c)/e,((s+5*h)/6-d)/f,((5*g+i)/6-c)/e,((5*h+j)/6-d)/f,((g+i)/2-c)/e,((h+j)/2-d)/f),[i,j,g,h,r,s]=this.#fG.subarray(12,18),this.#fC.push(((r+5*g)/6-c)/e,((s+5*h)/6-d)/f,((5*g+i)/6-c)/e,((5*h+j)/6-d)/f,((g+i)/2-c)/e,((h+j)/2-d)/f)),!0)}toSVGPath(){if(this.isEmpty())return"";let a=this.#fF,b=this.#fC;if(isNaN(this.#fG[6])&&!this.isEmpty())return this.#fS();let c=[];c.push(`M${a[4]} ${a[5]}`);for(let b=6;b<a.length;b+=6)isNaN(a[b])?c.push(`L${a[b+4]} ${a[b+5]}`):c.push(`C${a[b]} ${a[b+1]} ${a[b+2]} ${a[b+3]} ${a[b+4]} ${a[b+5]}`);this.#fT(c);for(let a=b.length-6;a>=6;a-=6)isNaN(b[a])?c.push(`L${b[a+4]} ${b[a+5]}`):c.push(`C${b[a]} ${b[a+1]} ${b[a+2]} ${b[a+3]} ${b[a+4]} ${b[a+5]}`);return this.#fU(c),c.join(" ")}#fS(){let[a,b,c,d]=this.#fB,[e,f,g,h]=this.#fR();return`M${(this.#fG[2]-a)/c} ${(this.#fG[3]-b)/d} L${(this.#fG[4]-a)/c} ${(this.#fG[5]-b)/d} L${e} ${f} L${g} ${h} L${(this.#fG[16]-a)/c} ${(this.#fG[17]-b)/d} L${(this.#fG[14]-a)/c} ${(this.#fG[15]-b)/d} Z`}#fU(a){let b=this.#fC;a.push(`L${b[4]} ${b[5]} Z`)}#fT(a){let[b,c,d,e]=this.#fB,f=this.#fG.subarray(4,6),g=this.#fG.subarray(16,18),[h,i,j,k]=this.#fR();a.push(`L${(f[0]-b)/d} ${(f[1]-c)/e} L${h} ${i} L${j} ${k} L${(g[0]-b)/d} ${(g[1]-c)/e}`)}newFreeDrawOutline(a,b,c,d,e,f){return new dU(a,b,c,d,e,f)}getOutlines(){let a=this.#fF,b=this.#fC,c=this.#fG,[d,e,f,g]=this.#fB,h=new Float32Array((this.#fN?.length??0)+2);for(let a=0,b=h.length-2;a<b;a+=2)h[a]=(this.#fN[a]-d)/f,h[a+1]=(this.#fN[a+1]-e)/g;if(h[h.length-2]=(this.#fH-d)/f,h[h.length-1]=(this.#fI-e)/g,isNaN(c[6])&&!this.isEmpty())return this.#fV(h);let i=new Float32Array(this.#fF.length+24+this.#fC.length),j=a.length;for(let b=0;b<j;b+=2){if(isNaN(a[b])){i[b]=i[b+1]=NaN;continue}i[b]=a[b],i[b+1]=a[b+1]}j=this.#fW(i,j);for(let a=b.length-6;a>=6;a-=6)for(let c=0;c<6;c+=2){if(isNaN(b[a+c])){i[j]=i[j+1]=NaN,j+=2;continue}i[j]=b[a+c],i[j+1]=b[a+c+1],j+=2}return this.#fX(i,j),this.newFreeDrawOutline(i,h,this.#fB,this.#fL,this.#fD,this.#fE)}#fV(a){let b=this.#fG,[c,d,e,f]=this.#fB,[g,h,i,j]=this.#fR(),k=new Float32Array(36);return k.set([NaN,NaN,NaN,NaN,(b[2]-c)/e,(b[3]-d)/f,NaN,NaN,NaN,NaN,(b[4]-c)/e,(b[5]-d)/f,NaN,NaN,NaN,NaN,g,h,NaN,NaN,NaN,NaN,i,j,NaN,NaN,NaN,NaN,(b[16]-c)/e,(b[17]-d)/f,NaN,NaN,NaN,NaN,(b[14]-c)/e,(b[15]-d)/f],0),this.newFreeDrawOutline(k,a,this.#fB,this.#fL,this.#fD,this.#fE)}#fX(a,b){let c=this.#fC;return a.set([NaN,NaN,NaN,NaN,c[4],c[5]],b),b+=6}#fW(a,b){let c=this.#fG.subarray(4,6),d=this.#fG.subarray(16,18),[e,f,g,h]=this.#fB,[i,j,k,l]=this.#fR();return a.set([NaN,NaN,NaN,NaN,(c[0]-e)/g,(c[1]-f)/h,NaN,NaN,NaN,NaN,i,j,NaN,NaN,NaN,NaN,k,l,NaN,NaN,NaN,NaN,(d[0]-e)/g,(d[1]-f)/h],b),b+=24}}class dU extends dS{#fB;#fY=new Float32Array(4);#fD;#fE;#fN;#fL;#fZ;constructor(a,b,c,d,e,f){super(),this.#fZ=a,this.#fN=b,this.#fB=c,this.#fL=d,this.#fD=e,this.#fE=f,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#f$(f);const[g,h,i,j]=this.#fY;for(let b=0,c=a.length;b<c;b+=2)a[b]=(a[b]-g)/i,a[b+1]=(a[b+1]-h)/j;for(let a=0,c=b.length;a<c;a+=2)b[a]=(b[a]-g)/i,b[a+1]=(b[a+1]-h)/j}toSVGPath(){let a=[`M${this.#fZ[4]} ${this.#fZ[5]}`];for(let b=6,c=this.#fZ.length;b<c;b+=6){if(isNaN(this.#fZ[b])){a.push(`L${this.#fZ[b+4]} ${this.#fZ[b+5]}`);continue}a.push(`C${this.#fZ[b]} ${this.#fZ[b+1]} ${this.#fZ[b+2]} ${this.#fZ[b+3]} ${this.#fZ[b+4]} ${this.#fZ[b+5]}`)}return a.push("Z"),a.join(" ")}serialize([a,b,c,d],e){let f,g,h=c-a,i=d-b;switch(e){case 0:f=dS._rescale(this.#fZ,a,d,h,-i),g=dS._rescale(this.#fN,a,d,h,-i);break;case 90:f=dS._rescaleAndSwap(this.#fZ,a,b,h,i),g=dS._rescaleAndSwap(this.#fN,a,b,h,i);break;case 180:f=dS._rescale(this.#fZ,c,b,-h,i),g=dS._rescale(this.#fN,c,b,-h,i);break;case 270:f=dS._rescaleAndSwap(this.#fZ,c,d,-h,-i),g=dS._rescaleAndSwap(this.#fN,c,d,-h,-i)}return{outline:Array.from(f),points:[Array.from(g)]}}#f$(a){let b=this.#fZ,c=b[4],d=b[5],e=[c,d,c,d],f=c,g=d,h=c,i=d,j=a?Math.max:Math.min,k=new Float32Array(4);for(let a=6,l=b.length;a<l;a+=6){let l=b[a+4],m=b[a+5];isNaN(b[a])?(az.pointBoundingBox(l,m,e),g>m?(f=l,g=m):g===m&&(f=j(f,l)),i<m?(h=l,i=m):i===m&&(h=j(h,l))):(k[0]=k[1]=1/0,k[2]=k[3]=-1/0,az.bezierBoundingBox(c,d,...b.slice(a,a+6),k),az.rectBoundingBox(k[0],k[1],k[2],k[3],e),g>k[1]?(f=k[0],g=k[1]):g===k[1]&&(f=j(f,k[0])),i<k[3]?(h=k[2],i=k[3]):i===k[3]&&(h=j(h,k[2]))),c=l,d=m}let l=this.#fY;l[0]=e[0]-this.#fD,l[1]=e[1]-this.#fD,l[2]=e[2]-e[0]+2*this.#fD,l[3]=e[3]-e[1]+2*this.#fD,this.firstPoint=[f,g],this.lastPoint=[h,i]}get box(){return this.#fY}newOutliner(a,b,c,d,e,f=0){return new dT(a,b,c,d,e,f)}getNewOutline(a,b){let[c,d,e,f]=this.#fY,[g,h,i,j]=this.#fB,k=e*i,l=f*j,m=c*i+g,n=d*j+h,o=this.newOutliner({x:this.#fN[0]*k+m,y:this.#fN[1]*l+n},this.#fB,this.#fL,a,this.#fE,b??this.#fD);for(let a=2;a<this.#fN.length;a+=2)o.add({x:this.#fN[a]*k+m,y:this.#fN[a+1]*l+n});return o.getOutlines()}}class dV{#fB;#f_;#f0;#f1=[];#f2=[];constructor(a,b=0,c=0,d=!0){const e=[1/0,1/0,-1/0,-1/0];for(const{x:c,y:d,width:f,height:g}of a){const a=1e-4*Math.floor((c-b)/1e-4),h=1e-4*Math.ceil((c+f+b)/1e-4),i=1e-4*Math.floor((d-b)/1e-4),j=1e-4*Math.ceil((d+g+b)/1e-4),k=[a,i,j,!0],l=[h,i,j,!1];this.#f1.push(k,l),az.rectBoundingBox(a,i,h,j,e)}const f=e[2]-e[0]+2*c,g=e[3]-e[1]+2*c,h=e[0]-c,i=e[1]-c;let j=d?-1/0:1/0,k=1/0;const l=this.#f1.at(d?-1:-2),m=[l[0],l[2]];for(const a of this.#f1){const[b,c,e,l]=a;!l&&d?c<k?(k=c,j=b):c===k&&(j=Math.max(j,b)):l&&!d&&(c<k?(k=c,j=b):c===k&&(j=Math.min(j,b))),a[0]=(b-h)/f,a[1]=(c-i)/g,a[2]=(e-i)/g}this.#fB=new Float32Array([h,i,f,g]),this.#f_=[j,k],this.#f0=m}getOutlines(){this.#f1.sort((a,b)=>a[0]-b[0]||a[1]-b[1]||a[2]-b[2]);let a=[];for(let b of this.#f1)b[3]?(a.push(...this.#f3(b)),this.#f4(b)):(this.#f5(b),a.push(...this.#f3(b)));return this.#f6(a)}#f6(a){let b,c=[],d=new Set;for(let b of a){let[a,d,e]=b;c.push([a,d,b],[a,e,b])}c.sort((a,b)=>a[1]-b[1]||a[0]-b[0]);for(let a=0,b=c.length;a<b;a+=2){let b=c[a][2],e=c[a+1][2];b.push(e),e.push(b),d.add(b),d.add(e)}let e=[];for(;d.size>0;){let a=d.values().next().value,[c,f,g,h,i]=a;d.delete(a);let j=c,k=f;for(b=[c,g],e.push(b);;){let a;if(d.has(h))a=h;else if(d.has(i))a=i;else break;d.delete(a),[c,f,g,h,i]=a,j!==c&&(b.push(j,k,c,k===f?f:g),j=c),k=k===f?g:f}b.push(j,k)}return new dW(e,this.#fB,this.#f_,this.#f0)}#f7(a){let b=this.#f2,c=0,d=b.length-1;for(;c<=d;){let e=c+d>>1,f=b[e][0];if(f===a)return e;f<a?c=e+1:d=e-1}return d+1}#f4([,a,b]){let c=this.#f7(a);this.#f2.splice(c,0,[a,b])}#f5([,a,b]){let c=this.#f7(a);for(let d=c;d<this.#f2.length;d++){let[c,e]=this.#f2[d];if(c!==a)break;if(c===a&&e===b)return void this.#f2.splice(d,1)}for(let d=c-1;d>=0;d--){let[c,e]=this.#f2[d];if(c!==a)break;if(c===a&&e===b)return void this.#f2.splice(d,1)}}#f3(a){let[b,c,d]=a,e=[[b,c,d]],f=this.#f7(d);for(let a=0;a<f;a++){let[c,d]=this.#f2[a];for(let a=0,f=e.length;a<f;a++){let[,g,h]=e[a];if(!(d<=g)&&!(h<=c)){if(g>=c){if(h>d)e[a][1]=d;else{if(1===f)return[];e.splice(a,1),a--,f--}continue}e[a][2]=c,h>d&&e.push([b,d,h])}}}return e}}class dW extends dS{#fB;#f8;constructor(a,b,c,d){super(),this.#f8=a,this.#fB=b,this.firstPoint=c,this.lastPoint=d}toSVGPath(){let a=[];for(let b of this.#f8){let[c,d]=b;a.push(`M${c} ${d}`);for(let e=2;e<b.length;e+=2){let f=b[e],g=b[e+1];f===c?(a.push(`V${g}`),d=g):g===d&&(a.push(`H${f}`),c=f)}a.push("Z")}return a.join(" ")}serialize([a,b,c,d],e){let f=[],g=c-a,h=d-b;for(let b of this.#f8){let c=Array(b.length);for(let e=0;e<b.length;e+=2)c[e]=a+b[e]*g,c[e+1]=d-b[e+1]*h;f.push(c)}return f}get box(){return this.#fB}get classNamesForOutlining(){return["highlightOutline"]}}class dX extends dT{newFreeDrawOutline(a,b,c,d,e,f){return new dY(a,b,c,d,e,f)}}class dY extends dU{newOutliner(a,b,c,d,e,f=0){return new dX(a,b,c,d,e,f)}}class dZ extends bo{#f9=null;#ga=0;#gb;#gc=null;#e=null;#gd=null;#ge=null;#gf=0;#gg=null;#gh=null;#v=null;#gi=!1;#f_=null;#f0=null;#gj=null;#ba="";#fM;#gk="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=$.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let a=dZ.prototype;return an(this,"_keyboardManager",new bi([[["ArrowLeft","mac+ArrowLeft"],a._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],a._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],a._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],a._moveCaret,{args:[3]}]]))}constructor(a){super({...a,name:"highlightEditor"}),this.color=a.color||dZ._defaultColor,this.#fM=a.thickness||dZ._defaultThickness,this.opacity=a.opacity||dZ._defaultOpacity,this.#gb=a.boxes||null,this.#gk=a.methodOfCreation||"",this.#ba=a.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",a.highlightId>-1?(this.#gi=!0,this.#gl(a),this.#gm()):this.#gb&&(this.#f9=a.anchorNode,this.#ga=a.anchorOffset,this.#ge=a.focusNode,this.#gf=a.focusOffset,this.#gn(),this.#gm(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#gi?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#fM,methodOfCreation:this.#gk}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(a){return{numberOfColors:a.get("color").size}}#gn(){let a=new dV(this.#gb,.001);this.#gh=a.getOutlines(),[this.x,this.y,this.width,this.height]=this.#gh.box;let b=new dV(this.#gb,.0025,.001,"ltr"===this._uiManager.direction);this.#gd=b.getOutlines();let{firstPoint:c}=this.#gh;this.#f_=[(c[0]-this.x)/this.width,(c[1]-this.y)/this.height];let{lastPoint:d}=this.#gd;this.#f0=[(d[0]-this.x)/this.width,(d[1]-this.y)/this.height]}#gl({highlightOutlines:a,highlightId:b,clipPathId:c}){if(this.#gh=a,this.#gd=a.getNewOutline(this.#fM/2+1.5,.0025),b>=0)this.#v=b,this.#gc=c,this.parent.drawLayer.finalizeDraw(b,{bbox:a.box,path:{d:a.toSVGPath()}}),this.#gj=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#gd.box,path:{d:this.#gd.toSVGPath()}},!0);else if(this.parent){let b=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#v,{bbox:dZ.#go(this.#gh.box,(b-this.rotation+360)%360),path:{d:a.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#gj,{bbox:dZ.#go(this.#gd.box,b),path:{d:this.#gd.toSVGPath()}})}let[d,e,f,g]=a.box;switch(this.rotation){case 0:this.x=d,this.y=e,this.width=f,this.height=g;break;case 90:{let[a,b]=this.parentDimensions;this.x=e,this.y=1-d,this.width=f*b/a,this.height=g*a/b;break}case 180:this.x=1-d,this.y=1-e,this.width=f,this.height=g;break;case 270:{let[a,b]=this.parentDimensions;this.x=1-e,this.y=d,this.width=f*b/a,this.height=g*a/b}}let{firstPoint:h}=a;this.#f_=[(h[0]-d)/f,(h[1]-e)/g];let{lastPoint:i}=this.#gd;this.#f0=[(i[0]-d)/f,(i[1]-e)/g]}static initialize(a,b){bo.initialize(a,b),dZ._defaultColor||=b.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(a,b){switch(a){case _.HIGHLIGHT_COLOR:dZ._defaultColor=b;break;case _.HIGHLIGHT_THICKNESS:dZ._defaultThickness=b}}translateInPage(a,b){}get toolbarPosition(){return this.#f0}get commentButtonPosition(){return this.#f_}updateParams(a,b){switch(a){case _.HIGHLIGHT_COLOR:this.#e3(b);break;case _.HIGHLIGHT_THICKNESS:this.#gp(b)}}static get defaultPropertiesToUpdate(){return[[_.HIGHLIGHT_COLOR,dZ._defaultColor],[_.HIGHLIGHT_THICKNESS,dZ._defaultThickness]]}get propertiesToUpdate(){return[[_.HIGHLIGHT_COLOR,this.color||dZ._defaultColor],[_.HIGHLIGHT_THICKNESS,this.#fM||dZ._defaultThickness],[_.HIGHLIGHT_FREE,this.#gi]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#v,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#e?.updateColor(this.color),super.onUpdatedColor()}#e3(a){let b=(a,b)=>{this.color=a,this.opacity=b,this.onUpdatedColor()},c=this.color,d=this.opacity;this.addCommands({cmd:b.bind(this,a,dZ._defaultOpacity),undo:b.bind(this,c,d),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(a)},!0)}#gp(a){let b=this.#fM,c=a=>{this.#fM=a,this.#gq(a)};this.addCommands({cmd:c.bind(this,a),undo:c.bind(this,b),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:_.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:a},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#e=new dd({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#gr())}getBaseTranslation(){return[0,0]}getRect(a,b){return super.getRect(a,b,this.#gr())}onceAdded(a){this.annotationElementId||this.parent.addUndoableEditor(this),a&&this.div.focus()}remove(){this.#gs(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){!this.parent||(super.rebuild(),null!==this.div&&(this.#gm(),this.isAttachedToDOM||this.parent.add(this)))}setParent(a){let b=!1;this.parent&&!a?this.#gs():a&&(this.#gm(a),b=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(a),this.show(this._isVisible),b&&this.select()}#gq(a){this.#gi&&(this.#gl({highlightOutlines:this.#gh.getNewOutline(a/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#gs(){null!==this.#v&&this.parent&&(this.parent.drawLayer.remove(this.#v),this.#v=null,this.parent.drawLayer.remove(this.#gj),this.#gj=null)}#gm(a=this.parent){null===this.#v&&({id:this.#v,clipPathId:this.#gc}=a.drawLayer.draw({bbox:this.#gh.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#gi},path:{d:this.#gh.toSVGPath()}},!1,!0),this.#gj=a.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#gi},bbox:this.#gd.box,path:{d:this.#gd.toSVGPath()}},this.#gi),this.#gg&&(this.#gg.style.clipPath=this.#gc))}static #go([a,b,c,d],e){switch(e){case 90:return[1-b-d,a,d,c];case 180:return[1-a-c,1-b-d,c,d];case 270:return[b,1-a-c,d,c]}return[a,b,c,d]}rotate(a){let b,{drawLayer:c}=this.parent;this.#gi?(a=(a-this.rotation+360)%360,b=dZ.#go(this.#gh.box,a)):b=dZ.#go([this.x,this.y,this.width,this.height],a),c.updateProperties(this.#v,{bbox:b,root:{"data-main-rotation":a}}),c.updateProperties(this.#gj,{bbox:dZ.#go(this.#gd.box,a),root:{"data-main-rotation":a}})}render(){if(this.div)return this.div;let a=super.render();this.#ba&&(a.setAttribute("aria-label",this.#ba),a.setAttribute("role","mark")),this.#gi?a.classList.add("free"):this.div.addEventListener("keydown",this.#gt.bind(this),{signal:this._uiManager._signal});let b=this.#gg=document.createElement("div");return a.append(b),b.setAttribute("aria-hidden","true"),b.className="internal",b.style.clipPath=this.#gc,this.setDims(this.width,this.height),be(this,this.#gg,["pointerover","pointerleave"]),this.enableEditing(),a}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#gj,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#gj,{rootClass:{hovered:!1}})}#gt(a){dZ._keyboardManager.exec(this,a)}_moveCaret(a){switch(this.parent.unselect(this),a){case 0:case 2:this.#gu(!0);break;case 1:case 3:this.#gu(!1)}}#gu(a){if(!this.#f9)return;let b=window.getSelection();a?b.setPosition(this.#f9,this.#ga):b.setPosition(this.#ge,this.#gf)}select(){super.select(),this.#gj&&this.parent?.drawLayer.updateProperties(this.#gj,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#gj&&(this.parent?.drawLayer.updateProperties(this.#gj,{rootClass:{selected:!1}}),this.#gi||this.#gu(!1))}get _mustFixPosition(){return!this.#gi}show(a=this._isVisible){super.show(a),this.parent&&(this.parent.drawLayer.updateProperties(this.#v,{rootClass:{hidden:!a}}),this.parent.drawLayer.updateProperties(this.#gj,{rootClass:{hidden:!a}}))}#gr(){return this.#gi?this.rotation:0}#gv(){if(this.#gi)return null;let[a,b]=this.pageDimensions,[c,d]=this.pageTranslation,e=this.#gb,f=new Float32Array(8*e.length),g=0;for(let{x:h,y:i,width:j,height:k}of e){let e=h*a+c,l=(1-i)*b+d;f[g]=f[g+4]=e,f[g+1]=f[g+3]=l,f[g+2]=f[g+6]=e+j*a,f[g+5]=f[g+7]=l-k*b,g+=8}return f}#gw(a){return this.#gh.serialize(a,this.#gr())}static startHighlighting(a,b,{target:c,x:d,y:e}){let{x:f,y:g,width:h,height:i}=c.getBoundingClientRect(),j=new AbortController,k=a.combinedSignal(j),l=b=>{j.abort(),this.#gx(a,b)};window.addEventListener("blur",l,{signal:k}),window.addEventListener("pointerup",l,{signal:k}),window.addEventListener("pointerdown",aV,{capture:!0,passive:!1,signal:k}),window.addEventListener("contextmenu",aU,{signal:k}),c.addEventListener("pointermove",this.#gy.bind(this,a),{signal:k}),this._freeHighlight=new dX({x:d,y:e},[f,g,h,i],a.scale,this._defaultThickness/2,b,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=a.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static #gy(a,b){this._freeHighlight.add(b)&&a.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static #gx(a,b){this._freeHighlight.isEmpty()?a.drawLayer.remove(this._freeHighlightId):a.createAndAddNewEditor(b,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(a,b,c){let d=null;if(a instanceof dJ){let{data:{quadPoints:b,rect:c,rotation:e,id:f,color:g,opacity:h,popupRef:i,richText:j,contentsObj:k,creationDate:l,modificationDate:m},parent:{page:{pageNumber:n}}}=a;d=a={annotationType:$.HIGHLIGHT,color:Array.from(g),opacity:h,quadPoints:b,boxes:null,pageIndex:n-1,rect:c.slice(0),rotation:e,annotationElementId:f,id:f,deleted:!1,popupRef:i,richText:j,comment:k?.str||null,creationDate:l,modificationDate:m}}else if(a instanceof dI){let{data:{inkLists:b,rect:c,rotation:e,id:f,color:g,borderStyle:{rawWidth:h},popupRef:i,richText:j,contentsObj:k,creationDate:l,modificationDate:m},parent:{page:{pageNumber:n}}}=a;d=a={annotationType:$.HIGHLIGHT,color:Array.from(g),thickness:h,inkLists:b,boxes:null,pageIndex:n-1,rect:c.slice(0),rotation:e,annotationElementId:f,id:f,deleted:!1,popupRef:i,richText:j,comment:k?.str||null,creationDate:l,modificationDate:m}}let{color:e,quadPoints:f,inkLists:g,opacity:h}=a,i=await super.deserialize(a,b,c);i.color=az.makeHexColor(...e),i.opacity=h||1,g&&(i.#fM=a.thickness),i._initialData=d,a.comment&&i.setCommentData(a);let[j,k]=i.pageDimensions,[l,m]=i.pageTranslation;if(f){let a=i.#gb=[];for(let b=0;b<f.length;b+=8)a.push({x:(f[b]-l)/j,y:1-(f[b+1]-m)/k,width:(f[b+2]-f[b])/j,height:(f[b+1]-f[b+5])/k});i.#gn(),i.#gm(),i.rotate(i.rotation)}else if(g){i.#gi=!0;let a=g[0],c={x:a[0]-l,y:k-(a[1]-m)},d=new dX(c,[0,0,j,k],1,i.#fM/2,!0,.001);for(let b=0,e=a.length;b<e;b+=2)c.x=a[b]-l,c.y=k-(a[b+1]-m),d.add(c);let{id:e,clipPathId:f}=b.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:i.color,"fill-opacity":i._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:d.toSVGPath()}},!0,!0);i.#gl({highlightOutlines:d.getOutlines(),highlightId:e,clipPathId:f}),i.#gm(),i.rotate(i.parentRotation)}return i}serialize(a=!1){if(this.isEmpty()||a)return null;if(this.deleted)return this.serializeDeleted();let b=bo._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),c=super.serialize(a);return(Object.assign(c,{color:b,opacity:this.opacity,thickness:this.#fM,quadPoints:this.#gv(),outlines:this.#gw(c.rect)}),this.addComment(c),this.annotationElementId&&!this.#fA(c))?null:(c.id=this.annotationElementId,c)}#fA(a){let{color:b}=this._initialData;return this.hasEditedComment||a.color.some((a,c)=>a!==b[c])}renderAnnotationElement(a){return this.deleted?a.hide():a.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null}static canCreateNewEmptyEditor(){return!1}}class d${#gz=Object.create(null);updateProperty(a,b){this[a]=b,this.updateSVGProperty(a,b)}updateProperties(a){if(a)for(let[b,c]of Object.entries(a))b.startsWith("_")||this.updateProperty(b,c)}updateSVGProperty(a,b){this.#gz[a]=b}toSVGProperties(){let a=this.#gz;return this.#gz=Object.create(null),{root:a}}reset(){this.#gz=Object.create(null)}updateAll(a=this){this.updateProperties(a)}clone(){aj("Not implemented")}}class d_ extends bo{#gA=null;#gB;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static #gC=null;static #gD=null;static #gE=null;static #gF=NaN;static #gG=null;static #gH=null;static #gI=NaN;static _INNER_MARGIN=3;constructor(a){super(a),this.#gB=a.mustBeCommitted||!1,this._addOutlines(a)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(a){a.drawOutlines&&(this.#gJ(a),this.#gm())}#gJ({drawOutlines:a,drawId:b,drawingOptions:c}){this.#gA=a,this._drawingOptions||=c,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),b>=0?(this._drawId=b,this.parent.drawLayer.finalizeDraw(b,a.defaultProperties)):this._drawId=this.#gK(a,this.parent),this.#gL(a.box)}#gK(a,b){let{id:c}=b.drawLayer.draw(d_._mergeSVGProperties(this._drawingOptions.toSVGProperties(),a.defaultSVGProperties),!1,!1);return c}static _mergeSVGProperties(a,b){let c=new Set(Object.keys(a));for(let[d,e]of Object.entries(b))c.has(d)?Object.assign(a[d],e):a[d]=e;return a}static getDefaultDrawingOptions(a){aj("Not implemented")}static get typesMap(){aj("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(a,b){let c=this.typesMap.get(a);c&&this._defaultDrawingOptions.updateProperty(c,b),this._currentParent&&(d_.#gC.updateProperty(c,b),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(a,b){let c=this.constructor.typesMap.get(a);c&&this._updateProperty(a,c,b)}static get defaultPropertiesToUpdate(){let a=[],b=this._defaultDrawingOptions;for(let[c,d]of this.typesMap)a.push([c,b[d]]);return a}get propertiesToUpdate(){let a=[],{_drawingOptions:b}=this;for(let[c,d]of this.constructor.typesMap)a.push([c,b[d]]);return a}_updateProperty(a,b,c){let d=this._drawingOptions,e=d[b],f=c=>{d.updateProperty(b,c);let e=this.#gA.updateProperty(b,c);e&&this.#gL(e),this.parent?.drawLayer.updateProperties(this._drawId,d.toSVGProperties()),a===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:f.bind(this,c),undo:f.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:a,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,d_._mergeSVGProperties(this.#gA.getPathResizingSVGProperties(this.#gM()),{bbox:this.#gN()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,d_._mergeSVGProperties(this.#gA.getPathResizedSVGProperties(this.#gM()),{bbox:this.#gN()}))}_onTranslating(a,b){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#gN()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,d_._mergeSVGProperties(this.#gA.getPathTranslatedSVGProperties(this.#gM(),this.parentDimensions),{bbox:this.#gN()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(a){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#gB&&(this.#gB=!1,this.commit(),this.parent.setSelected(this),a&&this.isOnScreen&&this.div.focus())}remove(){this.#gs(),super.remove()}rebuild(){!this.parent||(super.rebuild(),null!==this.div&&(this.#gm(),this.#gL(this.#gA.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(a){let b=!1;this.parent&&!a?(this._uiManager.removeShouldRescale(this),this.#gs()):a&&(this._uiManager.addShouldRescale(this),this.#gm(a),b=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(a),b&&this.select()}#gs(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#gm(a=this.parent){if(null===this._drawId||this.parent!==a){if(null!==this._drawId)return void this.parent.drawLayer.updateParent(this._drawId,a.drawLayer);this._drawingOptions.updateAll(),this._drawId=this.#gK(this.#gA,a)}}#gO([a,b,c,d]){let{parentDimensions:[e,f],rotation:g}=this;switch(g){case 90:return[b,1-a,f/e*c,e/f*d];case 180:return[1-a,1-b,c,d];case 270:return[1-b,a,f/e*c,e/f*d];default:return[a,b,c,d]}}#gM(){let{x:a,y:b,width:c,height:d,parentDimensions:[e,f],rotation:g}=this;switch(g){case 90:return[1-b,a,e/f*c,f/e*d];case 180:return[1-a,1-b,c,d];case 270:return[b,1-a,e/f*c,f/e*d];default:return[a,b,c,d]}}#gL(a){[this.x,this.y,this.width,this.height]=this.#gO(a),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#gN(){let{x:a,y:b,width:c,height:d,rotation:e,parentRotation:f,parentDimensions:[g,h]}=this;switch((4*e+f)/90){case 1:return[1-b-d,a,d,c];case 2:return[1-a-c,1-b-d,c,d];case 3:return[b,1-a-c,d,c];case 4:return[a,b-g/h*c,h/g*d,g/h*c];case 5:return[1-b,a,g/h*c,h/g*d];case 6:return[1-a-h/g*d,1-b,h/g*d,g/h*c];case 7:return[b-g/h*c,1-a-h/g*d,g/h*c,h/g*d];case 8:return[a-c,b-d,c,d];case 9:return[1-b,a-c,d,c];case 10:return[1-a,1-b,c,d];case 11:return[b-d,1-a,d,c];case 12:return[a-h/g*d,b,h/g*d,g/h*c];case 13:return[1-b-g/h*c,a-h/g*d,g/h*c,h/g*d];case 14:return[1-a,1-b-g/h*c,h/g*d,g/h*c];case 15:return[b,1-a,g/h*c,h/g*d];default:return[a,b,c,d]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,d_._mergeSVGProperties({bbox:this.#gN()},this.#gA.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#gL(this.#gA.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){let a,b;if(this.div)return this.div;this._isCopy&&(a=this.x,b=this.y);let c=super.render();c.classList.add("draw");let d=document.createElement("div");return c.append(d),d.setAttribute("aria-hidden","true"),d.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(a,b),c}static createDrawerInstance(a,b,c,d,e){aj("Not implemented")}static startDrawing(a,b,c,d){let{target:e,offsetX:f,offsetY:g,pointerId:h,pointerType:i}=d;if(d_.#gG&&d_.#gG!==i)return;let{viewport:{rotation:j}}=a,{width:k,height:l}=e.getBoundingClientRect(),m=d_.#gD=new AbortController,n=a.combinedSignal(m);(d_.#gF||=h,d_.#gG??=i,window.addEventListener("pointerup",a=>{d_.#gF===a.pointerId?this._endDraw(a):d_.#gH?.delete(a.pointerId)},{signal:n}),window.addEventListener("pointercancel",a=>{d_.#gF===a.pointerId?this._currentParent.endDrawingSession():d_.#gH?.delete(a.pointerId)},{signal:n}),window.addEventListener("pointerdown",a=>{d_.#gG===a.pointerType&&((d_.#gH||=new Set).add(a.pointerId),d_.#gC.isCancellable()&&(d_.#gC.removeLastElement(),d_.#gC.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:n}),window.addEventListener("contextmenu",aU,{signal:n}),e.addEventListener("pointermove",this._drawMove.bind(this),{signal:n}),e.addEventListener("touchmove",a=>{a.timeStamp===d_.#gI&&aV(a)},{signal:n}),a.toggleDrawing(),b._editorUndoBar?.hide(),d_.#gC)?a.drawLayer.updateProperties(this._currentDrawId,d_.#gC.startNew(f,g,k,l,j)):(b.updateUIForDefaultProperties(this),d_.#gC=this.createDrawerInstance(f,g,k,l,j),d_.#gE=this.getDefaultDrawingOptions(),this._currentParent=a,{id:this._currentDrawId}=a.drawLayer.draw(this._mergeSVGProperties(d_.#gE.toSVGProperties(),d_.#gC.defaultSVGProperties),!0,!1))}static _drawMove(a){if(d_.#gI=-1,!d_.#gC)return;let{offsetX:b,offsetY:c,pointerId:d}=a;if(d_.#gF===d){if(d_.#gH?.size>=1)return void this._endDraw(a);this._currentParent.drawLayer.updateProperties(this._currentDrawId,d_.#gC.add(b,c)),d_.#gI=a.timeStamp,aV(a)}}static _cleanup(a){a&&(this._currentDrawId=-1,this._currentParent=null,d_.#gC=null,d_.#gE=null,d_.#gG=null,d_.#gI=NaN),d_.#gD&&(d_.#gD.abort(),d_.#gD=null,d_.#gF=NaN,d_.#gH=null)}static _endDraw(a){let b=this._currentParent;if(b){if(b.toggleDrawing(!0),this._cleanup(!1),a?.target===b.div&&b.drawLayer.updateProperties(this._currentDrawId,d_.#gC.end(a.offsetX,a.offsetY)),this.supportMultipleDrawings){let a=d_.#gC,c=this._currentDrawId,d=a.getLastElement();b.addCommands({cmd:()=>{b.drawLayer.updateProperties(c,a.setLastElement(d))},undo:()=>{b.drawLayer.updateProperties(c,a.removeLastElement())},mustExec:!1,type:_.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(a){let b=this._currentParent;if(!b)return null;if(b.toggleDrawing(!0),b.cleanUndoStack(_.DRAW_STEP),!d_.#gC.isEmpty()){let{pageDimensions:[c,d],scale:e}=b,f=b.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:d_.#gC.getOutlines(c*e,d*e,e,this._INNER_MARGIN),drawingOptions:d_.#gE,mustBeCommitted:!a});return this._cleanup(!0),f}return b.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(a){}static deserializeDraw(a,b,c,d,e,f){aj("Not implemented")}static async deserialize(a,b,c){let{rawDims:{pageWidth:d,pageHeight:e,pageX:f,pageY:g}}=b.viewport,h=this.deserializeDraw(f,g,d,e,this._INNER_MARGIN,a),i=await super.deserialize(a,b,c);return i.createDrawingOptions(a),i.#gJ({drawOutlines:h}),i.#gm(),i.onScaleChanging(),i.rotate(),i}serializeDraw(a){let[b,c]=this.pageTranslation,[d,e]=this.pageDimensions;return this.#gA.serialize([b,c,d,e],a)}renderAnnotationElement(a){return a.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class d0{#fG=new Float64Array(6);#fa;#gP;#dC;#fM;#fN;#gQ="";#gR=0;#f8=new d1;#gS;#gT;constructor(a,b,c,d,e,f){this.#gS=c,this.#gT=d,this.#dC=e,this.#fM=f,[a,b]=this.#gU(a,b);const g=this.#fa=[NaN,NaN,NaN,NaN,a,b];this.#fN=[a,b],this.#gP=[{line:g,points:this.#fN}],this.#fG.set(g,0)}updateProperty(a,b){"stroke-width"===a&&(this.#fM=b)}#gU(a,b){return dS._normalizePoint(a,b,this.#gS,this.#gT,this.#dC)}isEmpty(){return!this.#gP||0===this.#gP.length}isCancellable(){return this.#fN.length<=10}add(a,b){[a,b]=this.#gU(a,b);let[c,d,e,f]=this.#fG.subarray(2,6),g=a-e,h=b-f;return 2>=Math.hypot(this.#gS*g,this.#gT*h)?null:((this.#fN.push(a,b),isNaN(c))?(this.#fG.set([e,f,a,b],2),this.#fa.push(NaN,NaN,NaN,NaN,a,b)):(isNaN(this.#fG[0])&&this.#fa.splice(6,6),this.#fG.set([c,d,e,f,a,b],0),this.#fa.push(...dS.createBezierPoints(c,d,e,f,a,b))),{path:{d:this.toSVGPath()}})}end(a,b){let c=this.add(a,b);return c||(2===this.#fN.length?{path:{d:this.toSVGPath()}}:null)}startNew(a,b,c,d,e){this.#gS=c,this.#gT=d,this.#dC=e,[a,b]=this.#gU(a,b);let f=this.#fa=[NaN,NaN,NaN,NaN,a,b];this.#fN=[a,b];let g=this.#gP.at(-1);return g&&(g.line=new Float32Array(g.line),g.points=new Float32Array(g.points)),this.#gP.push({line:f,points:this.#fN}),this.#fG.set(f,0),this.#gR=0,this.toSVGPath(),null}getLastElement(){return this.#gP.at(-1)}setLastElement(a){return this.#gP?(this.#gP.push(a),this.#fa=a.line,this.#fN=a.points,this.#gR=0,{path:{d:this.toSVGPath()}}):this.#f8.setLastElement(a)}removeLastElement(){if(!this.#gP)return this.#f8.removeLastElement();this.#gP.pop(),this.#gQ="";for(let a=0,b=this.#gP.length;a<b;a++){let{line:b,points:c}=this.#gP[a];this.#fa=b,this.#fN=c,this.#gR=0,this.toSVGPath()}return{path:{d:this.#gQ}}}toSVGPath(){let a=dS.svgRound(this.#fa[4]),b=dS.svgRound(this.#fa[5]);if(2===this.#fN.length)return this.#gQ=`${this.#gQ} M ${a} ${b} Z`,this.#gQ;if(this.#fN.length<=6){let c=this.#gQ.lastIndexOf("M");this.#gQ=`${this.#gQ.slice(0,c)} M ${a} ${b}`,this.#gR=6}if(4===this.#fN.length){let a=dS.svgRound(this.#fa[10]),b=dS.svgRound(this.#fa[11]);return this.#gQ=`${this.#gQ} L ${a} ${b}`,this.#gR=12,this.#gQ}let c=[];0===this.#gR&&(c.push(`M ${a} ${b}`),this.#gR=6);for(let a=this.#gR,b=this.#fa.length;a<b;a+=6){let[b,d,e,f,g,h]=this.#fa.slice(a,a+6).map(dS.svgRound);c.push(`C${b} ${d} ${e} ${f} ${g} ${h}`)}return this.#gQ+=c.join(" "),this.#gR=this.#fa.length,this.#gQ}getOutlines(a,b,c,d){let e=this.#gP.at(-1);return e.line=new Float32Array(e.line),e.points=new Float32Array(e.points),this.#f8.build(this.#gP,a,b,c,this.#dC,this.#fM,d),this.#fG=null,this.#fa=null,this.#gP=null,this.#gQ=null,this.#f8}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class d1 extends dS{#fY;#gV=0;#fD;#gP;#gS;#gT;#gW;#dC;#fM;build(a,b,c,d,e,f,g){this.#gS=b,this.#gT=c,this.#gW=d,this.#dC=e,this.#fM=f,this.#fD=g??0,this.#gP=a,this.#gX()}get thickness(){return this.#fM}setLastElement(a){return this.#gP.push(a),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#gP.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let a=[];for(let{line:b}of this.#gP){if(a.push(`M${dS.svgRound(b[4])} ${dS.svgRound(b[5])}`),6===b.length){a.push("Z");continue}if(12===b.length&&isNaN(b[6])){a.push(`L${dS.svgRound(b[10])} ${dS.svgRound(b[11])}`);continue}for(let c=6,d=b.length;c<d;c+=6){let[d,e,f,g,h,i]=b.subarray(c,c+6).map(dS.svgRound);a.push(`C${d} ${e} ${f} ${g} ${h} ${i}`)}}return a.join("")}serialize([a,b,c,d],e){let f,g,h,i,j,k,l,m,n,o=[],p=[],[q,r,s,t]=this.#gY();switch(this.#dC){case 0:n=dS._rescale,f=a,g=b+d,h=c,i=-d,j=a+q*c,k=b+(1-r-t)*d,l=a+(q+s)*c,m=b+(1-r)*d;break;case 90:n=dS._rescaleAndSwap,f=a,g=b,h=c,i=d,j=a+r*c,k=b+q*d,l=a+(r+t)*c,m=b+(q+s)*d;break;case 180:n=dS._rescale,f=a+c,g=b,h=-c,i=d,j=a+(1-q-s)*c,k=b+r*d,l=a+(1-q)*c,m=b+(r+t)*d;break;case 270:n=dS._rescaleAndSwap,f=a+c,g=b+d,h=-c,i=-d,j=a+(1-r-t)*c,k=b+(1-q-s)*d,l=a+(1-r)*c,m=b+(1-q)*d}for(let{line:a,points:b}of this.#gP)o.push(n(a,f,g,h,i,e?Array(a.length):null)),p.push(n(b,f,g,h,i,e?Array(b.length):null));return{lines:o,points:p,rect:[j,k,l,m]}}static deserialize(a,b,c,d,e,{paths:{lines:f,points:g},rotation:h,thickness:i}){let j,k,l,m,n,o=[];switch(h){case 0:n=dS._rescale,j=-a/c,k=b/d+1,l=1/c,m=-1/d;break;case 90:n=dS._rescaleAndSwap,j=-b/d,k=-a/c,l=1/d,m=1/c;break;case 180:n=dS._rescale,j=a/c+1,k=-b/d,l=-1/c,m=1/d;break;case 270:n=dS._rescaleAndSwap,j=b/d+1,k=a/c+1,l=-1/d,m=-1/c}if(!f)for(let a of(f=[],g)){let b=a.length;if(2===b){f.push(new Float32Array([NaN,NaN,NaN,NaN,a[0],a[1]]));continue}if(4===b){f.push(new Float32Array([NaN,NaN,NaN,NaN,a[0],a[1],NaN,NaN,NaN,NaN,a[2],a[3]]));continue}let c=new Float32Array(3*(b-2));f.push(c);let[d,e,g,h]=a.subarray(0,4);c.set([NaN,NaN,NaN,NaN,d,e],0);for(let f=4;f<b;f+=2){let b=a[f],i=a[f+1];c.set(dS.createBezierPoints(d,e,g,h,b,i),(f-2)*3),[d,e,g,h]=[g,h,b,i]}}for(let a=0,b=f.length;a<b;a++)o.push({line:n(f[a].map(a=>a??NaN),j,k,l,m),points:n(g[a].map(a=>a??NaN),j,k,l,m)});let p=new this.prototype.constructor;return p.build(o,c,d,1,h,i,e),p}#gZ(a=this.#fM){let b=this.#fD+a/2*this.#gW;return this.#dC%180==0?[b/this.#gS,b/this.#gT]:[b/this.#gT,b/this.#gS]}#gY(){let[a,b,c,d]=this.#fY,[e,f]=this.#gZ(0);return[a+e,b+f,c-2*e,d-2*f]}#gX(){let a=this.#fY=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:b}of this.#gP){if(b.length<=12){for(let c=4,d=b.length;c<d;c+=6)az.pointBoundingBox(b[c],b[c+1],a);continue}let c=b[4],d=b[5];for(let e=6,f=b.length;e<f;e+=6){let[f,g,h,i,j,k]=b.subarray(e,e+6);az.bezierBoundingBox(c,d,f,g,h,i,j,k,a),c=j,d=k}}let[b,c]=this.#gZ();a[0]=aF(a[0]-b,0,1),a[1]=aF(a[1]-c,0,1),a[2]=aF(a[2]+b,0,1),a[3]=aF(a[3]+c,0,1),a[2]-=a[0],a[3]-=a[1]}get box(){return this.#fY}updateProperty(a,b){return"stroke-width"===a?this.#gp(b):null}#gp(a){let[b,c]=this.#gZ();this.#fM=a;let[d,e]=this.#gZ(),[f,g]=[d-b,e-c],h=this.#fY;return h[0]-=f,h[1]-=g,h[2]+=2*f,h[3]+=2*g,h}updateParentDimensions([a,b],c){let[d,e]=this.#gZ();this.#gS=a,this.#gT=b,this.#gW=c;let[f,g]=this.#gZ(),h=f-d,i=g-e,j=this.#fY;return j[0]-=h,j[1]-=i,j[2]+=2*h,j[3]+=2*i,j}updateRotation(a){return this.#gV=a,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#fY.map(dS.svgRound).join(" ")}get defaultProperties(){let[a,b]=this.#fY;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${dS.svgRound(a)} ${dS.svgRound(b)}`}}}get rotationTransform(){let[,,a,b]=this.#fY,c=0,d=0,e=0,f=0,g=0,h=0;switch(this.#gV){case 90:d=b/a,e=-a/b,g=a;break;case 180:c=-1,f=-1,g=a,h=b;break;case 270:d=-b/a,e=a/b,h=b;break;default:return""}return`matrix(${c} ${d} ${e} ${f} ${dS.svgRound(g)} ${dS.svgRound(h)})`}getPathResizingSVGProperties([a,b,c,d]){let[e,f]=this.#gZ(),[g,h,i,j]=this.#fY;if(Math.abs(i-e)<=dS.PRECISION||Math.abs(j-f)<=dS.PRECISION){let e=a+c/2-(g+i/2),f=b+d/2-(h+j/2);return{path:{"transform-origin":`${dS.svgRound(a)} ${dS.svgRound(b)}`,transform:`${this.rotationTransform} translate(${e} ${f})`}}}let k=(c-2*e)/(i-2*e),l=(d-2*f)/(j-2*f);return{path:{"transform-origin":`${dS.svgRound(g)} ${dS.svgRound(h)}`,transform:`${this.rotationTransform} scale(${i/c} ${j/d}) translate(${dS.svgRound(e)} ${dS.svgRound(f)}) scale(${k} ${l}) translate(${dS.svgRound(-e)} ${dS.svgRound(-f)})`}}}getPathResizedSVGProperties([a,b,c,d]){let[e,f]=this.#gZ(),g=this.#fY,[h,i,j,k]=g;if(g[0]=a,g[1]=b,g[2]=c,g[3]=d,Math.abs(j-e)<=dS.PRECISION||Math.abs(k-f)<=dS.PRECISION){let e=a+c/2-(h+j/2),f=b+d/2-(i+k/2);for(let{line:a,points:b}of this.#gP)dS._translate(a,e,f,a),dS._translate(b,e,f,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${dS.svgRound(a)} ${dS.svgRound(b)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let l=(c-2*e)/(j-2*e),m=(d-2*f)/(k-2*f),n=-l*(h+e)+a+e,o=-m*(i+f)+b+f;if(1!==l||1!==m||0!==n||0!==o)for(let{line:a,points:b}of this.#gP)dS._rescale(a,n,o,l,m,a),dS._rescale(b,n,o,l,m,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${dS.svgRound(a)} ${dS.svgRound(b)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([a,b],c){let[d,e]=c,f=this.#fY,g=a-f[0],h=b-f[1];if(this.#gS===d&&this.#gT===e)for(let{line:a,points:b}of this.#gP)dS._translate(a,g,h,a),dS._translate(b,g,h,b);else{let a=this.#gS/d,b=this.#gT/e;for(let{line:c,points:f}of(this.#gS=d,this.#gT=e,this.#gP))dS._rescale(c,g,h,a,b,c),dS._rescale(f,g,h,a,b,f);f[2]*=a,f[3]*=b}return f[0]=a,f[1]=b,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${dS.svgRound(a)} ${dS.svgRound(b)}`}}}get defaultSVGProperties(){let a=this.#fY;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${dS.svgRound(a[0])} ${dS.svgRound(a[1])}`,transform:this.rotationTransform||null},bbox:a}}}class d2 extends d${constructor(a){super(),this._viewParameters=a,super.updateProperties({fill:"none",stroke:bo._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(a,b){"stroke-width"===a&&(b??=this["stroke-width"],b*=this._viewParameters.realScale),super.updateSVGProperty(a,b)}clone(){let a=new d2(this._viewParameters);return a.updateAll(this),a}}class d3 extends d_{static _type="ink";static _editorType=$.INK;static _defaultDrawingOptions=null;constructor(a){super({...a,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(a,b){bo.initialize(a,b),this._defaultDrawingOptions=new d2(b.viewParameters)}static getDefaultDrawingOptions(a){let b=this._defaultDrawingOptions.clone();return b.updateProperties(a),b}static get supportMultipleDrawings(){return!0}static get typesMap(){return an(this,"typesMap",new Map([[_.INK_THICKNESS,"stroke-width"],[_.INK_COLOR,"stroke"],[_.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(a,b,c,d,e){return new d0(a,b,c,d,e,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(a,b,c,d,e,f){return d1.deserialize(a,b,c,d,e,f)}static async deserialize(a,b,c){let d=null;if(a instanceof dI){let{data:{inkLists:b,rect:c,rotation:e,id:f,color:g,opacity:h,borderStyle:{rawWidth:i},popupRef:j,richText:k,contentsObj:l,creationDate:m,modificationDate:n},parent:{page:{pageNumber:o}}}=a;d=a={annotationType:$.INK,color:Array.from(g),thickness:i,opacity:h,paths:{points:b},boxes:null,pageIndex:o-1,rect:c.slice(0),rotation:e,annotationElementId:f,id:f,deleted:!1,popupRef:j,richText:k,comment:l?.str||null,creationDate:m,modificationDate:n}}let e=await super.deserialize(a,b,c);return e._initialData=d,a.comment&&e.setCommentData(a),e}get toolbarButtons(){return this._colorPicker||=new de(this),[["colorPicker",this._colorPicker]]}get colorType(){return _.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:a,_drawingOptions:b,parent:c}=this;b.updateSVGProperty("stroke-width"),c.drawLayer.updateProperties(a,b.toSVGProperties())}static onScaleChangingWhenDrawing(){let a=this._currentParent;a&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),a.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:a,thickness:b,opacity:c}){this._drawingOptions=d3.getDefaultDrawingOptions({stroke:az.makeHexColor(...a),"stroke-width":b,"stroke-opacity":c})}serialize(a=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:b,points:c}=this.serializeDraw(a),{_drawingOptions:{stroke:d,"stroke-opacity":e,"stroke-width":f}}=this,g=Object.assign(super.serialize(a),{color:bo._colorManager.convert(d),opacity:e,thickness:f,paths:{lines:b,points:c}});return(this.addComment(g),a)?(g.isCopy=!0,g):this.annotationElementId&&!this.#fA(g)?null:(g.id=this.annotationElementId,g)}#fA(a){let{color:b,thickness:c,opacity:d,pageIndex:e}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||a.color.some((a,c)=>a!==b[c])||a.thickness!==c||a.opacity!==d||a.pageIndex!==e}renderAnnotationElement(a){if(this.deleted)return a.hide(),null;let{points:b,rect:c}=this.serializeDraw(!1);return a.updateEdited({rect:c,thickness:this._drawingOptions["stroke-width"],points:b,popup:this.comment}),null}}class d4 extends d1{toSVGPath(){let a=super.toSVGPath();return a.endsWith("Z")||(a+="Z"),a}}class d5{static #g$={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static #g_(a,b,c,d){return(c-=a,d-=b,0===c)?d>0?0:4:1===c?d+6:2-d}static #g0=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static #g1(a,b,c,d,e,f,g){let h=this.#g_(c,d,e,f);for(let e=0;e<8;e++){let f=(-e+h-g+16)%8;if(0!==a[(c+this.#g0[2*f])*b+(d+this.#g0[2*f+1])])return f}return -1}static #g2(a,b,c,d,e,f,g){let h=this.#g_(c,d,e,f);for(let e=0;e<8;e++){let f=(e+h+g+16)%8;if(0!==a[(c+this.#g0[2*f])*b+(d+this.#g0[2*f+1])])return f}return -1}static #g3(a,b,c,d){let e,f=a.length,g=new Int32Array(f);for(let b=0;b<f;b++)g[b]=+(a[b]<=d);for(let a=1;a<c-1;a++)g[a*b]=g[a*b+b-1]=0;for(let a=0;a<b;a++)g[a]=g[b*c-1-a]=0;let h=1,i=[];for(let a=1;a<c-1;a++){e=1;for(let c=1;c<b-1;c++){let d,f=a*b+c,j=g[f];if(0===j)continue;let k=a,l=c;if(1===j&&0===g[f-1])h+=1,l-=1;else if(j>=1&&0===g[f+1])h+=1,l+=1,j>1&&(e=j);else{1!==j&&(e=Math.abs(j));continue}let m=[c,a],n=l===c+1,o={isHole:n,points:m,id:h,parent:0};for(let a of(i.push(o),i))if(a.id===e){d=a;break}d?d.isHole?o.parent=n?d.parent:e:o.parent=n?e:d.parent:o.parent=n?e:0;let p=this.#g1(g,b,a,c,k,l,0);if(-1===p){g[f]=-h,1!==g[f]&&(e=Math.abs(g[f]));continue}let q=this.#g0[2*p],r=this.#g0[2*p+1],s=a+q,t=c+r;k=s,l=t;let u=a,v=c;for(;;){let d=this.#g2(g,b,u,v,k,l,1);q=this.#g0[2*d],r=this.#g0[2*d+1];let i=u+q,j=v+r;m.push(j,i);let n=u*b+v;if(0===g[n+1]?g[n]=-h:1===g[n]&&(g[n]=h),i===a&&j===c&&u===s&&v===t){1!==g[f]&&(e=Math.abs(g[f]));break}k=u,l=v,u=i,v=j}}}return i}static #g4(a,b,c,d){if(c-b<=4){for(let e=b;e<c-2;e+=2)d.push(a[e],a[e+1]);return}let e=a[b],f=a[b+1],g=a[c-4]-e,h=a[c-3]-f,i=Math.hypot(g,h),j=g/i,k=h/i,l=j*f-k*e,m=1/i,n=Math.atan(h/g),o=Math.cos(n),p=Math.sin(n),q=m*(Math.abs(o)+Math.abs(p)),r=m*(1-q+q**2),s=Math.max(Math.atan(Math.abs(p+o)*r),Math.atan(Math.abs(p-o)*r)),t=0,u=b;for(let d=b+2;d<c-2;d+=2){let b=Math.abs(l-j*a[d+1]+k*a[d]);b>t&&(u=d,t=b)}t>(i*s)**2?(this.#g4(a,b,u+2,d),this.#g4(a,u,c,d)):d.push(e,f)}static #g5(a){let b=[],c=a.length;return this.#g4(a,0,c,b),b.push(a[c-2],a[c-1]),b.length<=4?null:b}static #g6(a,b,c,d,e,f){let g=new Float32Array(f**2),h=-2*d**2,i=f>>1;for(let a=0;a<f;a++){let b=(a-i)**2;for(let c=0;c<f;c++)g[a*f+c]=Math.exp((b+(c-i)**2)/h)}let j=new Float32Array(256),k=-2*e**2;for(let a=0;a<256;a++)j[a]=Math.exp(a**2/k);let l=new Uint8Array(a.length),m=new Uint32Array(256);for(let d=0;d<c;d++)for(let e=0;e<b;e++){let h=d*b+e,k=a[h],n=0,o=0;for(let h=0;h<f;h++){let l=d+h-i;if(!(l<0)&&!(l>=c))for(let c=0;c<f;c++){let d=e+c-i;if(d<0||d>=b)continue;let m=a[l*b+d],p=g[h*f+c]*j[Math.abs(m-k)];n+=m*p,o+=p}}let p=l[h]=Math.round(n/o);m[p]++}return[l,m]}static #g7(a){let b=new Uint32Array(256);for(let c of a)b[c]++;return b}static #g8(a){let b=new Uint8ClampedArray(a.length>>2),c=-1/0,d=1/0;for(let e=0,f=b.length;e<f;e++){let f=b[e]=a[e<<2];c=Math.max(c,f),d=Math.min(d,f)}let e=255/(c-d);for(let a=0,c=b.length;a<c;a++)b[a]=(b[a]-d)*e;return b}static #g9(a){let b,c=-1/0,d=-1/0,e=a.findIndex(a=>0!==a),f=e,g=e;for(b=e;b<256;b++){let e=a[b];e>c&&(b-f>d&&(d=b-f,g=b-1),c=e,f=b)}for(b=g-1;b>=0&&!(a[b]>a[b+1]);b--);return b}static #ha(a){let b=a,{width:c,height:d}=a,{maxDim:e}=this.#g$,f=c,g=d;if(c>e||d>e){let h=c,i=d,j=Math.log2(Math.max(c,d)/e),k=Math.floor(j);j=j===k?k-1:k;for(let c=0;c<j;c++){let c=new OffscreenCanvas(f=Math.ceil(h/2),g=Math.ceil(i/2));c.getContext("2d").drawImage(a,0,0,h,i,0,0,f,g),h=f,i=g,a!==b&&a.close(),a=c.transferToImageBitmap()}let l=Math.min(e/f,e/g);f=Math.round(f*l),g=Math.round(g*l)}let h=new OffscreenCanvas(f,g).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,f,g),h.filter="grayscale(1)",h.drawImage(a,0,0,a.width,a.height,0,0,f,g);let i=h.getImageData(0,0,f,g).data;return[this.#g8(i),f,g]}static extractContoursFromText(a,{fontFamily:b,fontStyle:c,fontWeight:d},e,f,g,h){let i=new OffscreenCanvas(1,1),j=i.getContext("2d",{alpha:!1}),k=j.font=`${c} ${d} 200px ${b}`,{actualBoundingBoxLeft:l,actualBoundingBoxRight:m,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,fontBoundingBoxAscent:p,fontBoundingBoxDescent:q,width:r}=j.measureText(a),s=Math.ceil(1.5*Math.max(Math.abs(l)+Math.abs(m)||0,r)),t=Math.ceil(1.5*Math.max(Math.abs(n)+Math.abs(o)||200,Math.abs(p)+Math.abs(q)||200));(j=(i=new OffscreenCanvas(s,t)).getContext("2d",{alpha:!0,willReadFrequently:!0})).font=k,j.filter="grayscale(1)",j.fillStyle="white",j.fillRect(0,0,s,t),j.fillStyle="black",j.fillText(a,.5*s/2,1.5*t/2);let u=this.#g8(j.getImageData(0,0,s,t).data),v=this.#g7(u),w=this.#g9(v),x=this.#g3(u,s,t,w);return this.processDrawnLines({lines:{curves:x,width:s,height:t},pageWidth:e,pageHeight:f,rotation:g,innerMargin:h,mustSmooth:!0,areContours:!0})}static process(a,b,c,d,e){let[f,g,h]=this.#ha(a),[i,j]=this.#g6(f,g,h,Math.hypot(g,h)*this.#g$.sigmaSFactor,this.#g$.sigmaR,this.#g$.kernelSize),k=this.#g9(j),l=this.#g3(i,g,h,k);return this.processDrawnLines({lines:{curves:l,width:g,height:h},pageWidth:b,pageHeight:c,rotation:d,innerMargin:e,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:a,pageWidth:b,pageHeight:c,rotation:d,innerMargin:e,mustSmooth:f,areContours:g}){d%180!=0&&([b,c]=[c,b]);let{curves:h,width:i,height:j}=a,k=a.thickness??0,l=[],m=Math.min(b/i,c/j),n=m/b,o=m/c,p=[];for(let{points:a}of h){let b=f?this.#g5(a):a;if(!b)continue;p.push(b);let c=b.length,d=new Float32Array(c),e=new Float32Array(3*(2===c?2:c-2));if(l.push({line:e,points:d}),2===c){d[0]=b[0]*n,d[1]=b[1]*o,e.set([NaN,NaN,NaN,NaN,d[0],d[1]],0);continue}let[g,h,i,j]=b;g*=n,h*=o,i*=n,j*=o,d.set([g,h,i,j],0),e.set([NaN,NaN,NaN,NaN,g,h],0);for(let a=4;a<c;a+=2){let c=d[a]=b[a]*n,f=d[a+1]=b[a+1]*o;e.set(dS.createBezierPoints(g,h,i,j,c,f),(a-2)*3),[g,h,i,j]=[i,j,c,f]}}if(0===l.length)return null;let q=g?new d4:new d1;return q.build(l,b,c,1,d,g?0:k,e),{outline:q,newCurves:p,areContours:g,thickness:k,width:i,height:j}}static async compressSignature({outlines:a,areContours:b,thickness:c,width:d,height:e}){let f,g=1/0,h=-1/0,i=0;for(let b of a){i+=b.length;for(let a=2,c=b.length;a<c;a++){let c=b[a]-b[a-2];g=Math.min(g,c),h=Math.max(h,c)}}f=g>=-128&&h<=127?Int8Array:g>=-32768&&h<=32767?Int16Array:Int32Array;let j=a.length,k=8+3*j,l=new Uint32Array(k),m=0;for(let g of(l[m++]=k*Uint32Array.BYTES_PER_ELEMENT+(i-2*j)*f.BYTES_PER_ELEMENT,l[m++]=0,l[m++]=d,l[m++]=e,l[m++]=+!b,l[m++]=Math.max(0,Math.floor(c??0)),l[m++]=j,l[m++]=f.BYTES_PER_ELEMENT,a))l[m++]=g.length-2,l[m++]=g[0],l[m++]=g[1];let n=new CompressionStream("deflate-raw"),o=n.writable.getWriter();await o.ready,o.write(l);let p=f.prototype.constructor;for(let b of a){let a=new p(b.length-2);for(let c=2,d=b.length;c<d;c++)a[c-2]=b[c]-b[c-2];o.write(a)}return o.close(),aG(new Uint8Array(await new Response(n.readable).arrayBuffer()))}static async decompressSignature(a){try{let b,c=Uint8Array.fromBase64?Uint8Array.fromBase64(a):aw(atob(a)),{readable:d,writable:e}=new DecompressionStream("deflate-raw"),f=e.getWriter();await f.ready,f.write(c).then(async()=>{await f.ready,await f.close()}).catch(()=>{});let g=null,h=0;for await(let a of d)(g||=new Uint8Array(new Uint32Array(a.buffer,0,4)[0])).set(a,h),h+=a.length;let i=new Uint32Array(g.buffer,0,g.length>>2),j=i[1];if(0!==j)throw Error(`Invalid version: ${j}`);let k=i[2],l=i[3],m=0===i[4],n=i[5],o=i[6],p=i[7],q=[],r=(8+3*o)*Uint32Array.BYTES_PER_ELEMENT;switch(p){case Int8Array.BYTES_PER_ELEMENT:b=new Int8Array(g.buffer,r);break;case Int16Array.BYTES_PER_ELEMENT:b=new Int16Array(g.buffer,r);break;case Int32Array.BYTES_PER_ELEMENT:b=new Int32Array(g.buffer,r)}h=0;for(let a=0;a<o;a++){let c=i[3*a+8],d=new Float32Array(c+2);q.push(d);for(let b=0;b<2;b++)d[b]=i[3*a+8+b+1];for(let a=0;a<c;a++)d[a+2]=d[a]+b[h++]}return{areContours:m,thickness:n,outlines:q,width:k,height:l}}catch(a){return ai(`decompressSignature: ${a}`),null}}}class d6 extends d${constructor(){super(),super.updateProperties({fill:bo._defaultLineColor,"stroke-width":0})}clone(){let a=new d6;return a.updateAll(this),a}}class d7 extends d2{constructor(a){super(a),super.updateProperties({stroke:bo._defaultLineColor,"stroke-width":1})}clone(){let a=new d7(this._viewParameters);return a.updateAll(this),a}}class d8 extends d_{#hb=!1;#hc=null;#hd=null;#he=null;static _type="signature";static _editorType=$.SIGNATURE;static _defaultDrawingOptions=null;constructor(a){super({...a,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#hd=a.signatureData||null,this.#hc=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(a,b){bo.initialize(a,b),this._defaultDrawingOptions=new d6,this._defaultDrawnSignatureOptions=new d7(b.viewParameters)}static getDefaultDrawingOptions(a){let b=this._defaultDrawingOptions.clone();return b.updateProperties(a),b}static get supportMultipleDrawings(){return!1}static get typesMap(){return an(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#hc}}static computeTelemetryFinalData(a){let b=a.get("hasDescription");return{hasAltText:b.get(!0)??0,hasNoAltText:b.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){let a,b;if(this.div)return this.div;let{_isCopy:c}=this;if(c&&(this._isCopy=!1,a=this.x,b=this.y),super.render(),null===this._drawId)if(this.#hd){let{lines:a,mustSmooth:b,areContours:c,description:d,uuid:e,heightInPage:f}=this.#hd,{rawDims:{pageWidth:g,pageHeight:h},rotation:i}=this.parent.viewport,j=d5.processDrawnLines({lines:a,pageWidth:g,pageHeight:h,rotation:i,innerMargin:d8._INNER_MARGIN,mustSmooth:b,areContours:c});this.addSignature(j,f,d,e)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#hc||""}));return c&&(this._isCopy=!0,this._moveAfterPaste(a,b)),this.div}setUuid(a){this.#he=a,this.addEditToolbar()}getUuid(){return this.#he}get description(){return this.#hc}set description(a){this.#hc=a,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:a})),super.addEditToolbar().then(b=>{b?.updateEditSignatureButton(a)}))}getSignaturePreview(){let{newCurves:a,areContours:b,thickness:c,width:d,height:e}=this.#hd,f=Math.max(d,e),g=d5.processDrawnLines({lines:{curves:a.map(a=>({points:a})),thickness:c,width:d,height:e},pageWidth:f,pageHeight:f,rotation:0,innerMargin:0,mustSmooth:!1,areContours:b});return{areContours:b,outline:g.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(a,b,c,d){let e,{x:f,y:g}=this,{outline:h}=this.#hd=a;this.#hb=h instanceof d4,this.description=c,this.#hb?e=d8.getDefaultDrawingOptions():(e=d8._defaultDrawnSignatureOptions.clone()).updateProperties({"stroke-width":h.thickness}),this._addOutlines({drawOutlines:h,drawingOptions:e});let[,i]=this.pageDimensions,j=b/i;j=j>=1?.5:j,this.width*=j/this.height,this.width>=1&&(j*=.9/this.width,this.width=.9),this.height=j,this.setDims(),this.x=f,this.y=g,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(d),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!d,hasDescription:!!c}}),this.div.hidden=!1}getFromImage(a){let{rawDims:{pageWidth:b,pageHeight:c},rotation:d}=this.parent.viewport;return d5.process(a,b,c,d,d8._INNER_MARGIN)}getFromText(a,b){let{rawDims:{pageWidth:c,pageHeight:d},rotation:e}=this.parent.viewport;return d5.extractContoursFromText(a,b,c,d,e,d8._INNER_MARGIN)}getDrawnSignature(a){let{rawDims:{pageWidth:b,pageHeight:c},rotation:d}=this.parent.viewport;return d5.processDrawnLines({lines:a,pageWidth:b,pageHeight:c,rotation:d,innerMargin:d8._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:a,thickness:b}){a?this._drawingOptions=d8.getDefaultDrawingOptions():(this._drawingOptions=d8._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":b}))}serialize(a=!1){if(this.isEmpty())return null;let{lines:b,points:c}=this.serializeDraw(a),{_drawingOptions:{"stroke-width":d}}=this,e=Object.assign(super.serialize(a),{isSignature:!0,areContours:this.#hb,color:[0,0,0],thickness:this.#hb?0:d});return this.addComment(e),a?(e.paths={lines:b,points:c},e.uuid=this.#he,e.isCopy=!0):e.lines=b,this.#hc&&(e.accessibilityData={type:"Figure",alt:this.#hc}),e}static deserializeDraw(a,b,c,d,e,f){return f.areContours?d4.deserialize(a,b,c,d,e,f):d1.deserialize(a,b,c,d,e,f)}static async deserialize(a,b,c){let d=await super.deserialize(a,b,c);return d.#hb=a.areContours,d.description=a.accessibilityData?.alt||"",d.#he=a.uuid,d}}class d9 extends bo{#hf=null;#hg=null;#hh=null;#hi=null;#hj=null;#hk="";#hl=null;#hm=!1;#hn=null;#ho=!1;#hp=!1;static _type="stamp";static _editorType=$.STAMP;constructor(a){super({...a,name:"stampEditor"}),this.#hi=a.bitmapUrl,this.#hj=a.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(a,b){bo.initialize(a,b)}static isHandlingMimeForPasting(a){return a1.includes(a)}static paste(a,b){b.pasteEditor({mode:$.STAMP},{bitmapFile:a.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(a){let b=a.get("hasAltText");return{hasAltText:b.get(!0)??0,hasNoAltText:b.get(!1)??0}}#hq(a,b=!1){a?(this.#hf=a.bitmap,b||(this.#hg=a.id,this.#ho=a.isSvg),a.file&&(this.#hk=a.file.name),this.#hr()):this.remove()}#hs(){if(this.#hh=null,this._uiManager.enableWaiting(!1),this.#hl){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#hf)return void this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#hf){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(a=null,b=!0){if(this.hasAltTextData())return null;let{mlManager:c}=this._uiManager;if(!c)throw Error("No ML.");if(!await c.isEnabledFor("altText"))throw Error("ML isn't enabled for alt text.");let{data:d,width:e,height:f}=a||this.copyCanvas(null,null,!0).imageData,g=await c.guess({name:"altText",request:{data:d,width:e,height:f,channels:d.length/(e*f)}});if(!g)throw Error("No response from the AI service.");if(g.error)throw Error("Error from the AI service.");if(g.cancel)return null;if(!g.output)throw Error("No valid response from the AI service.");let h=g.output;return await this.setGuessedAltText(h),b&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}#ht(){if(this.#hg){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#hg).then(a=>this.#hq(a,!0)).finally(()=>this.#hs());return}if(this.#hi){let a=this.#hi;this.#hi=null,this._uiManager.enableWaiting(!0),this.#hh=this._uiManager.imageManager.getFromUrl(a).then(a=>this.#hq(a)).finally(()=>this.#hs());return}if(this.#hj){let a=this.#hj;this.#hj=null,this._uiManager.enableWaiting(!0),this.#hh=this._uiManager.imageManager.getFromFile(a).then(a=>this.#hq(a)).finally(()=>this.#hs());return}let a=document.createElement("input");a.type="file",a.accept=a1.join(",");let b=this._uiManager._signal;this.#hh=new Promise(c=>{a.addEventListener("change",async()=>{if(a.files&&0!==a.files.length){this._uiManager.enableWaiting(!0);let b=await this._uiManager.imageManager.getFromFile(a.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#hq(b)}else this.remove();c()},{signal:b}),a.addEventListener("cancel",()=>{this.remove(),c()},{signal:b})}).finally(()=>this.#hs()),a.click()}remove(){this.#hg&&(this.#hf=null,this._uiManager.imageManager.deleteId(this.#hg),this.#hl?.remove(),this.#hl=null,this.#hn&&(clearTimeout(this.#hn),this.#hn=null)),super.remove()}rebuild(){if(!this.parent){this.#hg&&this.#ht();return}super.rebuild(),null!==this.div&&(this.#hg&&null===this.#hl&&this.#ht(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(a){this._isDraggable=!0,a&&this.div.focus()}isEmpty(){return!(this.#hh||this.#hf||this.#hi||this.#hj||this.#hg||this.#hm)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){let a,b;return this.div||(this._isCopy&&(a=this.x,b=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#hm||(this.#hf?this.#hr():this.#ht()),this._isCopy&&this._moveAfterPaste(a,b),this._uiManager.addShouldRescale(this)),this.div}setCanvas(a,b){let{id:c,bitmap:d}=this._uiManager.imageManager.getFromCanvas(a,b);b.remove(),c&&this._uiManager.imageManager.isValidId(c)&&(this.#hg=c,d&&(this.#hf=d),this.#hm=!1,this.#hr())}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(null!==this.#hn&&clearTimeout(this.#hn),this.#hn=setTimeout(()=>{this.#hn=null,this.#hu()},200))}#hr(){let{div:a}=this,{width:b,height:c}=this.#hf,[d,e]=this.pageDimensions;if(this.width)b=this.width*d,c=this.height*e;else if(b>.75*d||c>.75*e){let a=Math.min(.75*d/b,.75*e/c);b*=a,c*=a}this._uiManager.enableWaiting(!1);let f=this.#hl=document.createElement("canvas");f.setAttribute("role","img"),this.addContainer(f),this.width=b/d,this.height=c/e,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(a.hidden=!1),this.#hu(),this.#hp||(this.parent.addUndoableEditor(this),this.#hp=!0),this._reportTelemetry({action:"inserted_image"}),this.#hk&&this.div.setAttribute("aria-description",this.#hk),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(a,b,c=!1){a||(a=224);let{width:d,height:e}=this.#hf,f=new a0,g=this.#hf,h=d,i=e,j=null;if(b){if(d>b||e>b){let a=Math.min(b/d,b/e);h=Math.floor(d*a),i=Math.floor(e*a)}let a=(j=document.createElement("canvas")).width=Math.ceil(h*f.sx),c=j.height=Math.ceil(i*f.sy);this.#ho||(g=this.#hv(a,c));let k=j.getContext("2d");k.filter=this._uiManager.hcmFilter;let l="white",m="#cfcfd8";"none"!==this._uiManager.hcmFilter?m="black":a2.isDarkMode&&(l="#8f8f9d",m="#42414d");let n=15*f.sx,o=15*f.sy,p=new OffscreenCanvas(2*n,2*o),q=p.getContext("2d");q.fillStyle=l,q.fillRect(0,0,2*n,2*o),q.fillStyle=m,q.fillRect(0,0,n,o),q.fillRect(n,o,n,o),k.fillStyle=k.createPattern(p,"repeat"),k.fillRect(0,0,a,c),k.drawImage(g,0,0,g.width,g.height,0,0,a,c)}let k=null;if(c){let b,c;if(f.symmetric&&g.width<a&&g.height<a)b=g.width,c=g.height;else if(g=this.#hf,d>a||e>a){let f=Math.min(a/d,a/e);b=Math.floor(d*f),c=Math.floor(e*f),this.#ho||(g=this.#hv(b,c))}let h=new OffscreenCanvas(b,c).getContext("2d",{willReadFrequently:!0});h.drawImage(g,0,0,g.width,g.height,0,0,b,c),k={width:b,height:c,data:h.getImageData(0,0,b,c).data}}return{canvas:j,width:h,height:i,imageData:k}}#hv(a,b){let{width:c,height:d}=this.#hf,e=c,f=d,g=this.#hf;for(;e>2*a||f>2*b;){let c=e,d=f;e>2*a&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2)),f>2*b&&(f=f>=16384?Math.floor(f/2)-1:Math.ceil(f/2));let h=new OffscreenCanvas(e,f);h.getContext("2d").drawImage(g,0,0,c,d,0,0,e,f),g=h.transferToImageBitmap()}return g}#hu(){let[a,b]=this.parentDimensions,{width:c,height:d}=this,e=new a0,f=Math.ceil(c*a*e.sx),g=Math.ceil(d*b*e.sy),h=this.#hl;if(!h||h.width===f&&h.height===g)return;h.width=f,h.height=g;let i=this.#ho?this.#hf:this.#hv(f,g),j=h.getContext("2d");j.filter=this._uiManager.hcmFilter,j.drawImage(i,0,0,i.width,i.height,0,0,f,g)}#hw(a){if(a){if(this.#ho){let a=this._uiManager.imageManager.getSvgUrl(this.#hg);if(a)return a}let a=document.createElement("canvas");return{width:a.width,height:a.height}=this.#hf,a.getContext("2d").drawImage(this.#hf,0,0),a.toDataURL()}if(this.#ho){let[a,b]=this.pageDimensions,c=Math.round(this.width*a*aK.PDF_TO_CSS_UNITS),d=Math.round(this.height*b*aK.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(c,d);return e.getContext("2d").drawImage(this.#hf,0,0,this.#hf.width,this.#hf.height,0,0,c,d),e.transferToImageBitmap()}return structuredClone(this.#hf)}static async deserialize(a,b,c){let d=null,e=!1;if(a instanceof dN){let f,g,{data:{rect:h,rotation:i,id:j,structParent:k,popupRef:l,richText:m,contentsObj:n,creationDate:o,modificationDate:p},container:q,parent:{page:{pageNumber:r}},canvas:s}=a;s?(delete a.canvas,{id:f,bitmap:g}=c.imageManager.getFromCanvas(q.id,s),s.remove()):(e=!0,a._hasNoCanvas=!0);let t=(await b._structTree.getAriaAttributes(`${aE}${j}`))?.get("aria-label")||"";d=a={annotationType:$.STAMP,bitmapId:f,bitmap:g,pageIndex:r-1,rect:h.slice(0),rotation:i,annotationElementId:j,id:j,deleted:!1,accessibilityData:{decorative:!1,altText:t},isSvg:!1,structParent:k,popupRef:l,richText:m,comment:n?.str||null,creationDate:o,modificationDate:p}}let f=await super.deserialize(a,b,c),{rect:g,bitmap:h,bitmapUrl:i,bitmapId:j,isSvg:k,accessibilityData:l}=a;e?(c.addMissingCanvas(a.id,f),f.#hm=!0):j&&c.imageManager.isValidId(j)?(f.#hg=j,h&&(f.#hf=h)):f.#hi=i,f.#ho=k;let[m,n]=f.pageDimensions;return f.width=(g[2]-g[0])/m,f.height=(g[3]-g[1])/n,l&&(f.altTextData=l),f._initialData=d,a.comment&&f.setCommentData(a),f.#hp=!!d,f}serialize(a=!1,b=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let c=Object.assign(super.serialize(a),{bitmapId:this.#hg,isSvg:this.#ho});if(this.addComment(c),a)return c.bitmapUrl=this.#hw(!0),c.accessibilityData=this.serializeAltText(!0),c.isCopy=!0,c;let{decorative:d,altText:e}=this.serializeAltText(!1);if(!d&&e&&(c.accessibilityData={type:"Figure",alt:e}),this.annotationElementId){let a=this.#fA(c);return a.isSame?null:(a.isSameAltText?delete c.accessibilityData:c.accessibilityData.structParent=this._initialData.structParent??-1,c.id=this.annotationElementId,delete c.bitmapId,c)}if(null===b)return c;b.stamps||=new Map;let f=this.#ho?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(b.stamps.has(this.#hg)){if(this.#ho){let a=b.stamps.get(this.#hg);f>a.area&&(a.area=f,a.serialized.bitmap.close(),a.serialized.bitmap=this.#hw(!1))}}else b.stamps.set(this.#hg,{area:f,serialized:c}),c.bitmap=this.#hw(!1);return c}#fA(a){let{pageIndex:b,accessibilityData:{altText:c}}=this._initialData,d=a.pageIndex===b,e=(a.accessibilityData?.alt||"")===c;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&d&&e,isSameAltText:e}}renderAnnotationElement(a){return this.deleted?a.hide():a.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null}}class ea{#fj;#hx=!1;#hy=null;#hz=null;#hA=null;#hB=new Map;#hC=!1;#hD=!1;#hE=!1;#hF=null;#hG=null;#hH=null;#hI=null;#hJ=null;#hK=-1;#r;static _initialized=!1;static #T=new Map([dR,d3,d9,dZ,d8].map(a=>[a._editorType,a]));constructor({uiManager:a,pageIndex:b,div:c,structTreeLayer:d,accessibilityManager:e,annotationLayer:f,drawLayer:g,textLayer:h,viewport:i,l10n:j}){const k=[...ea.#T.values()];if(!ea._initialized)for(const b of(ea._initialized=!0,k))b.initialize(j,a);a.registerEditorTypes(k),this.#r=a,this.pageIndex=b,this.div=c,this.#fj=e,this.#hy=f,this.viewport=i,this.#hH=h,this.drawLayer=g,this._structTree=d,this.#r.addLayer(this)}get isEmpty(){return 0===this.#hB.size}get isInvisible(){return this.isEmpty&&this.#r.getMode()===$.NONE}updateToolbar(a){this.#r.updateToolbar(a)}updateMode(a=this.#r.getMode()){switch(this.#hL(),a){case $.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case $.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case $.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:b}=this.div;if(b.toggle("nonEditing",!1),a===$.POPUP)b.toggle("commentEditing",!0);else for(let c of(b.toggle("commentEditing",!1),ea.#T.values()))b.toggle(`${c._type}Editing`,a===c._editorType);this.div.hidden=!1}hasTextLayer(a){return a===this.#hH?.div}setEditingState(a){this.#r.setEditingState(a)}addCommands(a){this.#r.addCommands(a)}cleanUndoStack(a){this.#r.cleanUndoStack(a)}toggleDrawing(a=!1){this.div.classList.toggle("drawing",!a)}togglePointerEvents(a=!1){this.div.classList.toggle("disabled",!a)}toggleAnnotationLayerPointerEvents(a=!1){this.#hy?.div.classList.toggle("disabled",!a)}get #hM(){return 0!==this.#hB.size?this.#hB.values():this.#r.getEditors(this.pageIndex)}async enable(){this.#hE=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#hJ?.abort(),this.#hJ=null;let a=new Set;for(let b of this.#hM)b.enableEditing(),b.show(!0),b.annotationElementId&&(this.#r.removeChangedExistingAnnotation(b),a.add(b.annotationElementId));let b=this.#hy;if(b)for(let c of b.getEditableAnnotations()){if(c.hide(),this.#r.isDeletedAnnotationElement(c.data.id)||a.has(c.data.id))continue;let b=await this.deserialize(c);b&&(this.addOrRebuild(b),b.enableEditing())}this.#hE=!1,this.#r._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#hD=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#hH&&!this.#hJ){this.#hJ=new AbortController;let a=this.#r.combinedSignal(this.#hJ);this.#hH.div.addEventListener("pointerdown",a=>{let b,{clientX:c,clientY:d,timeStamp:e}=a;if(e-this.#hK>500){this.#hK=e;return}this.#hK=-1;let{classList:f}=this.div;f.toggle("getElements",!0);let g=document.elementsFromPoint(c,d);if(f.toggle("getElements",!1),!this.div.contains(g[0]))return;let h=RegExp(`^${Z}[0-9]+$`);for(let a of g)if(h.test(a.id)){b=a.id;break}if(!b)return;let i=this.#hB.get(b);i?.annotationElementId===null&&(a.stopPropagation(),a.preventDefault(),i.dblclick(a))},{signal:a,capture:!0})}let a=this.#hy;if(a){let b=new Map,c=new Map;for(let d of this.#hM){if(d.disableEditing(),!d.annotationElementId){d.updateFakeAnnotationElement(a);continue}if(null!==d.serialize()){b.set(d.annotationElementId,d);continue}c.set(d.annotationElementId,d),this.getEditableAnnotation(d.annotationElementId)?.show(),d.remove()}for(let d of a.getEditableAnnotations()){let{id:a}=d.data;if(this.#r.isDeletedAnnotationElement(a)){d.updateEdited({deleted:!0});continue}let e=c.get(a);if(e){e.resetAnnotationElement(d),e.show(!1),d.show();continue}(e=b.get(a))&&(this.#r.addChangedExistingAnnotation(e),e.renderAnnotationElement(d)&&e.show(!1)),d.show()}}this.#hL(),this.isEmpty&&(this.div.hidden=!0);let{classList:b}=this.div;for(let a of ea.#T.values())b.remove(`${a._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#hD=!1}getEditableAnnotation(a){return this.#hy?.getEditableAnnotation(a)||null}setActiveEditor(a){this.#r.getActive()!==a&&this.#r.setActiveEditor(a)}enableTextSelection(){if(this.div.tabIndex=-1,this.#hH?.div&&!this.#hI){this.#hI=new AbortController;let a=this.#r.combinedSignal(this.#hI);this.#hH.div.addEventListener("pointerdown",this.#hN.bind(this),{signal:a}),this.#hH.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#hH?.div&&this.#hI&&(this.#hI.abort(),this.#hI=null,this.#hH.div.classList.remove("highlighting"))}#hN(a){this.#r.unselectAll();let{target:b}=a;if(b===this.#hH.div||("img"===b.getAttribute("role")||b.classList.contains("endOfContent"))&&this.#hH.div.contains(b)){let{isMac:b}=ax.platform;if(0!==a.button||a.ctrlKey&&b)return;this.#r.showAllEditors("highlight",!0,!0),this.#hH.div.classList.add("free"),this.toggleDrawing(),dZ.startHighlighting(this,"ltr"===this.#r.direction,{target:this.#hH.div,x:a.x,y:a.y}),this.#hH.div.addEventListener("pointerup",()=>{this.#hH.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#r._signal}),a.preventDefault()}}enableClick(){if(this.#hz)return;this.#hz=new AbortController;let a=this.#r.combinedSignal(this.#hz);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:a});let b=this.pointerup.bind(this);this.div.addEventListener("pointerup",b,{signal:a}),this.div.addEventListener("pointercancel",b,{signal:a})}disableClick(){this.#hz?.abort(),this.#hz=null}attach(a){this.#hB.set(a.id,a);let{annotationElementId:b}=a;b&&this.#r.isDeletedAnnotationElement(b)&&this.#r.removeDeletedAnnotationElement(a)}detach(a){this.#hB.delete(a.id),this.#fj?.removePointerInTextLayer(a.contentDiv),!this.#hD&&a.annotationElementId&&this.#r.addDeletedAnnotationElement(a)}remove(a){this.detach(a),this.#r.removeEditor(a),a.div.remove(),a.isAttachedToDOM=!1}changeParent(a){a.parent!==this&&(a.parent&&a.annotationElementId&&(this.#r.addDeletedAnnotationElement(a.annotationElementId),bo.deleteAnnotationElement(a),a.annotationElementId=null),this.attach(a),a.parent?.detach(a),a.setParent(this),a.div&&a.isAttachedToDOM&&(a.div.remove(),this.div.append(a.div)))}add(a){if(a.parent!==this||!a.isAttachedToDOM){if(this.changeParent(a),this.#r.addEditor(a),this.attach(a),!a.isAttachedToDOM){let b=a.render();this.div.append(b),a.isAttachedToDOM=!0}a.fixAndSetPosition(),a.onceAdded(!this.#hE),this.#r.addToAnnotationStorage(a),a._reportTelemetry(a.telemetryInitialData)}}moveEditorInDOM(a){if(!a.isAttachedToDOM)return;let{activeElement:b}=document;a.div.contains(b)&&!this.#hA&&(a._focusEventsAllowed=!1,this.#hA=setTimeout(()=>{this.#hA=null,a.div.contains(document.activeElement)?a._focusEventsAllowed=!0:(a.div.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0,signal:this.#r._signal}),b.focus())},0)),a._structTreeParentId=this.#fj?.moveElementInDOM(this.div,a.div,a.contentDiv,!0)}addOrRebuild(a){a.needsToBeRebuilt()?(a.parent||=this,a.rebuild(),a.show()):this.add(a)}addUndoableEditor(a){this.addCommands({cmd:()=>a._uiManager.rebuild(a),undo:()=>{a.remove()},mustExec:!1})}getEditorByUID(a){for(let b of this.#hB.values())if(b.uid===a)return b;return null}getNextId(){return this.#r.getId()}get #hO(){return ea.#T.get(this.#r.getMode())}combinedSignal(a){return this.#r.combinedSignal(a)}#hP(a){let b=this.#hO;return b?new b.prototype.constructor(a):null}canCreateNewEmptyEditor(){return this.#hO?.canCreateNewEmptyEditor()}async pasteEditor(a,b){this.updateToolbar(a),await this.#r.updateMode(a.mode);let{offsetX:c,offsetY:d}=this.#hQ(),e=this.getNextId(),f=this.#hP({parent:this,id:e,x:c,y:d,uiManager:this.#r,isCentered:!0,...b});f&&this.add(f)}async deserialize(a){return await ea.#T.get(a.annotationType??a.annotationEditorType)?.deserialize(a,this,this.#r)||null}createAndAddNewEditor(a,b,c={}){let d=this.getNextId(),e=this.#hP({parent:this,id:d,x:a.offsetX,y:a.offsetY,uiManager:this.#r,isCentered:b,...c});return e&&this.add(e),e}get boundingClientRect(){return this.div.getBoundingClientRect()}#hQ(){let{x:a,y:b,width:c,height:d}=this.boundingClientRect,e=Math.max(0,a),f=Math.max(0,b),g=Math.min(window.innerWidth,a+c),h=Math.min(window.innerHeight,b+d),i=(e+g)/2-a,j=(f+h)/2-b,[k,l]=this.viewport.rotation%180==0?[i,j]:[j,i];return{offsetX:k,offsetY:l}}addNewEditor(a={}){this.createAndAddNewEditor(this.#hQ(),!0,a)}setSelected(a){this.#r.setSelected(a)}toggleSelected(a){this.#r.toggleSelected(a)}unselect(a){this.#r.unselect(a)}pointerup(a){let{isMac:b}=ax.platform;if(0!==a.button||a.ctrlKey&&b||a.target!==this.div||!this.#hC||(this.#hC=!1,this.#hO?.isDrawer&&this.#hO.supportMultipleDrawings))return;if(!this.#hx){this.#hx=!0;return}let c=this.#r.getMode();c===$.STAMP||c===$.SIGNATURE?this.#r.unselectAll():this.createAndAddNewEditor(a,!1)}pointerdown(a){if(this.#r.getMode()===$.HIGHLIGHT&&this.enableTextSelection(),this.#hC){this.#hC=!1;return}let{isMac:b}=ax.platform;if(0!==a.button||a.ctrlKey&&b||a.target!==this.div)return;if(this.#hC=!0,this.#hO?.isDrawer)return void this.startDrawingSession(a);let c=this.#r.getActive();this.#hx=!c||c.isEmpty()}startDrawingSession(a){if(this.div.focus({preventScroll:!0}),this.#hF)return void this.#hO.startDrawing(this,this.#r,!1,a);this.#r.setCurrentDrawingSession(this),this.#hF=new AbortController;let b=this.#r.combinedSignal(this.#hF);this.div.addEventListener("blur",({relatedTarget:a})=>{a&&!this.div.contains(a)&&(this.#hG=null,this.commitOrRemove())},{signal:b}),this.#hO.startDrawing(this,this.#r,!1,a)}pause(a){if(a){let{activeElement:a}=document;this.div.contains(a)&&(this.#hG=a);return}this.#hG&&setTimeout(()=>{this.#hG?.focus(),this.#hG=null},0)}endDrawingSession(a=!1){return this.#hF?(this.#r.setCurrentDrawingSession(null),this.#hF.abort(),this.#hF=null,this.#hG=null,this.#hO.endDrawing(a)):null}findNewParent(a,b,c){let d=this.#r.findParent(b,c);return null!==d&&d!==this&&(d.changeParent(a),!0)}commitOrRemove(){return!!this.#hF&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#hF&&this.#hO.onScaleChangingWhenDrawing(this)}destroy(){for(let a of(this.commitOrRemove(),this.#r.getActive()?.parent===this&&(this.#r.commitOrRemove(),this.#r.setActiveEditor(null)),this.#hA&&(clearTimeout(this.#hA),this.#hA=null),this.#hB.values()))this.#fj?.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove();this.div=null,this.#hB.clear(),this.#r.removeLayer(this)}#hL(){for(let a of this.#hB.values())a.isEmpty()&&a.remove()}render({viewport:a}){for(let b of(this.viewport=a,a_(this.div,a),this.#r.getEditors(this.pageIndex)))this.add(b),b.rebuild();this.updateMode()}update({viewport:a}){this.#r.commitOrRemove(),this.#hL();let b=this.viewport.rotation,c=a.rotation;if(this.viewport=a,a_(this.div,{rotation:c}),b!==c)for(let a of this.#hB.values())a.rotate(c)}get pageDimensions(){let{pageWidth:a,pageHeight:b}=this.viewport.rawDims;return[a,b]}get scale(){return this.#r.viewParameters.realScale}}class eb{#eR=null;#hR=new Map;#hS=new Map;static #v=0;constructor({pageIndex:a}){this.pageIndex=a}setParent(a){if(!this.#eR){this.#eR=a;return}if(this.#eR!==a){if(this.#hR.size>0)for(let b of this.#hR.values())b.remove(),a.append(b);this.#eR=a}}static get _svgFactory(){return an(this,"_svgFactory",new dj)}static #hT(a,[b,c,d,e]){let{style:f}=a;f.top=`${100*c}%`,f.left=`${100*b}%`,f.width=`${100*d}%`,f.height=`${100*e}%`}#hU(){let a=eb._svgFactory.create(1,1,!0);return this.#eR.append(a),a.setAttribute("aria-hidden",!0),a}#hV(a,b){let c=eb._svgFactory.createElement("clipPath");a.append(c);let d=`clip_${b}`;c.setAttribute("id",d),c.setAttribute("clipPathUnits","objectBoundingBox");let e=eb._svgFactory.createElement("use");return c.append(e),e.setAttribute("href",`#${b}`),e.classList.add("clip"),d}#hW(a,b){for(let[c,d]of Object.entries(b))null===d?a.removeAttribute(c):a.setAttribute(c,d)}draw(a,b=!1,c=!1){let d=eb.#v++,e=this.#hU(),f=eb._svgFactory.createElement("defs");e.append(f);let g=eb._svgFactory.createElement("path");f.append(g);let h=`path_p${this.pageIndex}_${d}`;g.setAttribute("id",h),g.setAttribute("vector-effect","non-scaling-stroke"),b&&this.#hS.set(d,g);let i=c?this.#hV(f,h):null,j=eb._svgFactory.createElement("use");return e.append(j),j.setAttribute("href",`#${h}`),this.updateProperties(e,a),this.#hR.set(d,e),{id:d,clipPathId:`url(#${i})`}}drawOutline(a,b){let c,d=eb.#v++,e=this.#hU(),f=eb._svgFactory.createElement("defs");e.append(f);let g=eb._svgFactory.createElement("path");f.append(g);let h=`path_p${this.pageIndex}_${d}`;if(g.setAttribute("id",h),g.setAttribute("vector-effect","non-scaling-stroke"),b){let a=eb._svgFactory.createElement("mask");f.append(a),c=`mask_p${this.pageIndex}_${d}`,a.setAttribute("id",c),a.setAttribute("maskUnits","objectBoundingBox");let b=eb._svgFactory.createElement("rect");a.append(b),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("fill","white");let e=eb._svgFactory.createElement("use");a.append(e),e.setAttribute("href",`#${h}`),e.setAttribute("stroke","none"),e.setAttribute("fill","black"),e.setAttribute("fill-rule","nonzero"),e.classList.add("mask")}let i=eb._svgFactory.createElement("use");e.append(i),i.setAttribute("href",`#${h}`),c&&i.setAttribute("mask",`url(#${c})`);let j=i.cloneNode();return e.append(j),i.classList.add("mainOutline"),j.classList.add("secondaryOutline"),this.updateProperties(e,a),this.#hR.set(d,e),d}finalizeDraw(a,b){this.#hS.delete(a),this.updateProperties(a,b)}updateProperties(a,b){if(!b)return;let{root:c,bbox:d,rootClass:e,path:f}=b,g="number"==typeof a?this.#hR.get(a):a;if(g){if(c&&this.#hW(g,c),d&&eb.#hT(g,d),e){let{classList:a}=g;for(let[b,c]of Object.entries(e))a.toggle(b,c)}if(f){let a=g.firstChild.firstChild;this.#hW(a,f)}}}updateParent(a,b){if(b===this)return;let c=this.#hR.get(a);c&&(b.#eR.append(c),this.#hR.delete(a),b.#hR.set(a,c))}remove(a){this.#hS.delete(a),null!==this.#eR&&(this.#hR.get(a).remove(),this.#hR.delete(a))}destroy(){for(let a of(this.#eR=null,this.#hR.values()))a.remove();this.#hR.clear(),this.#hS.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:dV},globalThis.pdfjsLib={AbortException:au,AnnotationEditorLayer:ea,AnnotationEditorParamsType:_,AnnotationEditorType:$,AnnotationEditorUIManager:bk,AnnotationLayer:dP,AnnotationMode:Y,AnnotationType:ac,applyOpacity:a4,build:dc,ColorPicker:dd,createValidAbsoluteUrl:al,CSSConstants:a3,DOMSVGFactory:dj,DrawLayer:eb,FeatureTest:ax,fetchData:aL,findContrastColor:ba,getDocument:c2,getFilenameFromUrl:aQ,getPdfFilenameFromUrl:aR,getRGB:aY,getUuid:aD,getXfaPageViewport:aX,GlobalWorkerOptions:cA,ImageKind:ab,InvalidPDFException:ar,isDataScheme:aO,isPdfFile:aP,isValidExplicitDest:by,MathClamp:aF,noContextMenu:aU,normalizeUnicode:aC,OPS:ae,OutputScale:a0,PasswordResponses:af,PDFDataRangeTransport:c4,PDFDateString:aW,PDFWorker:c7,PermissionFlag:aa,PixelsPerInch:aK,RenderingCancelledException:aN,renderRichText:bb,ResponseException:as,setLayerDimensions:a_,shadow:an,SignatureExtractor:d5,stopEvent:aV,SupportedImageMimeTypes:a1,TextLayer:c1,TouchManager:bn,updateUrlHash:am,Util:az,VerbosityLevel:ad,version:db,XfaLayer:aI},a.s(["AbortException",()=>au,"AnnotationEditorLayer",()=>ea,"AnnotationEditorParamsType",()=>_,"AnnotationEditorType",()=>$,"AnnotationEditorUIManager",()=>bk,"AnnotationLayer",()=>dP,"AnnotationMode",()=>Y,"AnnotationType",()=>ac,"CSSConstants",()=>a3,"ColorPicker",()=>dd,"DOMSVGFactory",()=>dj,"DrawLayer",()=>eb,"FeatureTest",()=>ax,"GlobalWorkerOptions",()=>cA,"ImageKind",()=>ab,"InvalidPDFException",()=>ar,"MathClamp",()=>aF,"OPS",()=>ae,"OutputScale",()=>a0,"PDFDataRangeTransport",()=>c4,"PDFDateString",()=>aW,"PDFWorker",()=>c7,"PasswordResponses",()=>af,"PermissionFlag",()=>aa,"PixelsPerInch",()=>aK,"RenderingCancelledException",()=>aN,"ResponseException",()=>as,"SignatureExtractor",()=>d5,"SupportedImageMimeTypes",()=>a1,"TextLayer",()=>c1,"TouchManager",()=>bn,"Util",()=>az,"VerbosityLevel",()=>ad,"XfaLayer",()=>aI,"applyOpacity",()=>a4,"build",()=>dc,"createValidAbsoluteUrl",()=>al,"fetchData",()=>aL,"findContrastColor",()=>ba,"getDocument",()=>c2,"getFilenameFromUrl",()=>aQ,"getPdfFilenameFromUrl",()=>aR,"getRGB",()=>aY,"getUuid",()=>aD,"getXfaPageViewport",()=>aX,"isDataScheme",()=>aO,"isPdfFile",()=>aP,"isValidExplicitDest",()=>by,"noContextMenu",()=>aU,"normalizeUnicode",()=>aC,"renderRichText",()=>bb,"setLayerDimensions",()=>a_,"shadow",()=>an,"stopEvent",()=>aV,"updateUrlHash",()=>am,"version",()=>db],68062);var ec=a.i(68062);function ed(a,b){if(!a)throw Error("Invariant failed")}var ee=a.i(29505);let ef=(0,c.createContext)(null);class eg{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(a){this.pdfDocument=a}setViewer(a){this.pdfViewer=a}setExternalLinkRel(a){this.externalLinkRel=a}setExternalLinkTarget(a){this.externalLinkTarget=a}setHash(){}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return ed(this.pdfViewer,"PDF viewer is not initialized."),this.pdfViewer.currentPageNumber||0}set page(a){ed(this.pdfViewer,"PDF viewer is not initialized."),this.pdfViewer.currentPageNumber=a}get rotation(){return 0}set rotation(a){}addLinkAttributes(a,b,c){a.href=b,a.rel=this.externalLinkRel||"noopener noreferrer nofollow",a.target=c?"_blank":this.externalLinkTarget||""}goToDestination(a){return new Promise(b=>{ed(this.pdfDocument,"PDF document not loaded."),ed(a,"Destination is not specified."),"string"==typeof a?this.pdfDocument.getDestination(a).then(b):Array.isArray(a)?b(a):a.then(b)}).then(a=>{ed(Array.isArray(a),`"${a}" is not a valid destination array.`);let b=a[0];new Promise(a=>{ed(this.pdfDocument,"PDF document not loaded."),b instanceof Object?this.pdfDocument.getPageIndex(b).then(b=>{a(b)}).catch(()=>{ed(!1,`"${b}" is not a valid page reference.`)}):"number"==typeof b?a(b):ed(!1,`"${b}" is not a valid destination reference.`)}).then(b=>{let c=b+1;ed(this.pdfViewer,"PDF viewer is not initialized."),ed(c>=1&&c<=this.pagesCount,`"${c}" is not a valid page number.`),this.pdfViewer.scrollPageIntoView({dest:a,pageIndex:b,pageNumber:c})})})}goToPage(a){ed(this.pdfViewer,"PDF viewer is not initialized."),ed(a>=1&&a<=this.pagesCount,`"${a}" is not a valid page number.`),this.pdfViewer.scrollPageIntoView({pageIndex:a-1,pageNumber:a})}goToXY(){}cachePageRef(){}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}executeNamedAction(){}executeSetOCGState(){}isPageVisible(){return!0}isPageCached(){return!0}navigateTo(a){this.goToDestination(a)}}function eh({children:a,type:c}){return(0,b.jsx)("div",{className:`react-pdf__message react-pdf__message--${c}`,children:a})}function ei(a,b){switch(b.type){case"RESOLVE":return{value:b.value,error:void 0};case"REJECT":return{value:!1,error:b.error};case"RESET":return{value:void 0,error:void 0};default:return a}}function ej(){return(0,c.useReducer)(ei,{value:void 0,error:void 0})}function ek(a){return null!=a}function el(a){return"string"==typeof a&&/^data:/.test(a)}function em(a){ed(el(a),"Invalid data URI.");let[b="",c=""]=a.split(",");return -1!==b.split(";").indexOf("base64")?atob(c):unescape(c)}function en(){(0,ee.default)(!0,"Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.")}function eo(a){(null==a?void 0:a.cancel)&&a.cancel()}function ep(a,b){return Object.defineProperty(a,"width",{get(){return this.view[2]*b},configurable:!0}),Object.defineProperty(a,"height",{get(){return this.view[3]*b},configurable:!0}),Object.defineProperty(a,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(a,"originalHeight",{get(){return this.view[3]},configurable:!0}),a}let{PDFDataRangeTransport:eq}=ec,er=(a,b)=>{switch(b){case 1:a(prompt("Enter the password to open this PDF file."));break;case 2:a(prompt("Invalid password. Please try again."))}};function es(a){return"object"==typeof a&&null!==a&&("data"in a||"range"in a||"url"in a)}let et=(0,c.forwardRef)(function({children:a,className:d,error:e="Failed to load PDF file.",externalLinkRel:f,externalLinkTarget:g,file:h,inputRef:i,imageResourcesPath:j,loading:k="Loading PDF…",noData:l="No PDF file specified.",onItemClick:m,onLoadError:n,onLoadProgress:o,onLoadSuccess:p,onPassword:q=er,onSourceError:r,onSourceSuccess:s,options:t,renderMode:u,rotate:v,scale:w,...x},y){let[z,A]=ej(),{value:B,error:C}=z,[D,E]=ej(),{value:F,error:G}=D,H=(0,c.useRef)(new eg),I=(0,c.useRef)([]),J=(0,c.useRef)(void 0),K=(0,c.useRef)(void 0);h&&h!==J.current&&es(h)&&((0,ee.default)(!Q(h,J.current),'File prop passed to <Document /> changed, but it\'s equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.'),J.current=h),t&&t!==K.current&&((0,ee.default)(!Q(t,K.current),'Options prop passed to <Document /> changed, but it\'s equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.'),K.current=t);let L=(0,c.useRef)({scrollPageIntoView:a=>{let{dest:b,pageNumber:c,pageIndex:d=c-1}=a;if(m)return void m({dest:b,pageIndex:d,pageNumber:c});let e=I.current[d];e?e.scrollIntoView():(0,ee.default)(!1,`An internal link leading to page ${c} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});(0,c.useImperativeHandle)(y,()=>({linkService:H,pages:I,viewer:L}),[]),(0,c.useEffect)(function(){A({type:"RESET"})},[h,A]);let M=(0,c.useCallback)(async()=>{if(!h)return null;if("string"==typeof h)return el(h)?{data:em(h)}:(en(),{url:h});if(h instanceof eq)return{range:h};if(h instanceof ArrayBuffer)return{data:h};if(ed("object"==typeof h,"Invalid parameter in file, need either Uint8Array, string or a parameter object"),ed(es(h),"Invalid parameter object: need either .data, .range or .url"),"url"in h&&"string"==typeof h.url){if(el(h.url)){let{url:a,...b}=h;return{data:em(a),...b}}en()}return h},[h]);(0,c.useEffect)(()=>{let a=R(M());return a.promise.then(a=>{A({type:"RESOLVE",value:a})}).catch(a=>{A({type:"REJECT",error:a})}),()=>{eo(a)}},[M,A]),(0,c.useEffect)(()=>{if(void 0!==B){if(!1===B)return void(C&&((0,ee.default)(!1,C.toString()),r&&r(C)));s&&s()}},[B]),(0,c.useEffect)(function(){E({type:"RESET"})},[E,B]),(0,c.useEffect)(function(){if(!B)return;let a=t?{...B,...t}:B,b=ec.getDocument(a);o&&(b.onProgress=o),q&&(b.onPassword=q);let c=b.promise.then(a=>{E({type:"RESOLVE",value:a})}).catch(a=>{b.destroyed||E({type:"REJECT",error:a})});return()=>{c.finally(()=>b.destroy())}},[t,E,B]),(0,c.useEffect)(()=>{if(void 0!==F){if(!1===F)return void(G&&((0,ee.default)(!1,G.toString()),n&&n(G)));F&&(p&&p(F),I.current=Array(F.numPages),H.current.setDocument(F))}},[F]),(0,c.useEffect)(function(){H.current.setViewer(L.current),H.current.setExternalLinkRel(f),H.current.setExternalLinkTarget(g)},[f,g]);let O=(0,c.useCallback)((a,b)=>{I.current[a]=b},[]),P=(0,c.useCallback)(a=>{delete I.current[a]},[]),S=(0,c.useMemo)(()=>({imageResourcesPath:j,linkService:H.current,onItemClick:m,pdf:F,registerPage:O,renderMode:u,rotate:v,scale:w,unregisterPage:P}),[j,m,F,O,u,v,w,P]),U=(0,c.useMemo)(()=>T(x,()=>F),[x,F]);return(0,b.jsx)("div",{className:N("react-pdf__Document",d),ref:i,...U,children:function(){if(!h)return(0,b.jsx)(eh,{type:"no-data",children:"function"==typeof l?l():l});if(null==F)return(0,b.jsx)(eh,{type:"loading",children:"function"==typeof k?k():k});if(!1===F)return(0,b.jsx)(eh,{type:"error",children:"function"==typeof e?e():e});if(!(null==S?void 0:S.pdf))throw Error("pdf is undefined");let c="function"==typeof a?a(S):a;return(0,b.jsx)(ef.Provider,{value:S,children:c})}()})});function eu(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=a.filter(Boolean);return c.length<=1?c[0]||null:function(a){for(var b=0;b<c.length;b++){var d=c[b];"function"==typeof d?d(a):d&&(d.current=a)}}}function ev(){return(0,c.useContext)(ef)}let ew=(0,c.createContext)(null);function ex(){return(0,c.useContext)(ew)}function ey(){let a=ev(),d=ex();ed(d,"Unable to find Page context.");let{imageResourcesPath:e,linkService:f,onGetAnnotationsError:g,onGetAnnotationsSuccess:h,onRenderAnnotationLayerError:i,onRenderAnnotationLayerSuccess:j,page:k,pdf:l,renderForms:m,rotate:n,scale:o=1}={...a,...d};ed(l,"Attempted to load page annotations, but no document was specified. Wrap <Page /> in a <Document /> or pass explicit `pdf` prop."),ed(k,"Attempted to load page annotations, but no page was specified."),ed(f,"Attempted to load page annotations, but no linkService was specified.");let[p,q]=ej(),{value:r,error:s}=p,t=(0,c.useRef)(null);(0,ee.default)(1===Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10),"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations"),(0,c.useEffect)(function(){q({type:"RESET"})},[q,k]),(0,c.useEffect)(function(){if(!k)return;let a=R(k.getAnnotations());return a.promise.then(a=>{q({type:"RESOLVE",value:a})}).catch(a=>{q({type:"REJECT",error:a})}),()=>{eo(a)}},[q,k]),(0,c.useEffect)(()=>{if(void 0!==r){if(!1===r)return void(s&&((0,ee.default)(!1,s.toString()),g&&g(s)));r&&h&&h(r)}},[r]);let u=(0,c.useMemo)(()=>k.getViewport({scale:o,rotation:n}),[k,n,o]);return(0,c.useEffect)(function(){if(!l||!k||!f||!r)return;let{current:a}=t;if(!a)return;let b=u.clone({dontFlip:!0}),c={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,annotationStorage:l.annotationStorage,commentManager:null,div:a,l10n:null,linkService:f,page:k,structTreeLayer:null,viewport:b},d={annotations:r,annotationStorage:l.annotationStorage,div:a,imageResourcesPath:e,linkService:f,page:k,renderForms:m,viewport:b};a.innerHTML="";try{new dP(c).render(d),j&&j()}catch(a){(0,ee.default)(!1,`${a}`),i&&i(a)}return()=>{}},[r,e,f,k,l,m,u]),(0,b.jsx)("div",{className:N("react-pdf__Page__annotations","annotationLayer"),ref:t})}let ez={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},eA=/^H(\d+)$/;function eB(a){return"children"in a}function eC(a){return!!eB(a)&&1===a.children.length&&0 in a.children&&"id"in a.children[0]}function eD({className:a,node:d}){let e=(0,c.useMemo)(()=>d?{...function(a){let b={};if(eB(a)){let{role:c}=a,d=c.match(eA);if(d)b.role="heading",b["aria-level"]=Number(d[1]);else if(c in ez){let a=ez[c];a&&(b.role=a)}}return b}(d),...function a(b){let c={};if(eB(b)){if(void 0!==b.alt&&(c["aria-label"]=b.alt),void 0!==b.lang&&(c.lang=b.lang),eC(b)){let[d]=b.children;if(d){let b=a(d);return{...c,...b}}}}else"id"in b&&(c["aria-owns"]=b.id);return c}(d)}:null,[d]),f=(0,c.useMemo)(()=>!eB(d)||eC(d)?null:d.children.map((a,c)=>(0,b.jsx)(eD,{node:a},c)),[d]);return(0,b.jsx)("span",{className:a,...e,children:f})}function eE(){let a=ex();ed(a,"Unable to find Page context.");let{onGetStructTreeError:d,onGetStructTreeSuccess:e}=a,[f,g]=ej(),{value:h,error:i}=f,{customTextRenderer:j,page:k}=a;return((0,c.useEffect)(function(){g({type:"RESET"})},[g,k]),(0,c.useEffect)(function(){if(j||!k)return;let a=R(k.getStructTree());return a.promise.then(a=>{g({type:"RESOLVE",value:a})}).catch(a=>{g({type:"REJECT",error:a})}),()=>eo(a)},[j,k,g]),(0,c.useEffect)(()=>{if(void 0!==h){if(!1===h)return void(i&&((0,ee.default)(!1,i.toString()),d&&d(i)));h&&e&&e(h)}},[h]),h)?(0,b.jsx)(eD,{className:"react-pdf__Page__structTree structTree",node:h}):null}function eF(a){let d=ex();ed(d,"Unable to find Page context.");let{_className:e,canvasBackground:f,devicePixelRatio:g=1,onRenderError:h,onRenderSuccess:i,page:j,renderForms:k,renderTextLayer:l,rotate:m,scale:n}={...d,...a},{canvasRef:o}=a;ed(j,"Attempted to render page canvas, but no page was specified.");let p=(0,c.useRef)(null);function q(a){"RenderingCancelledException"!==a.name&&((0,ee.default)(!1,a.toString()),h&&h(a))}let r=(0,c.useMemo)(()=>j.getViewport({scale:n*g,rotation:m}),[g,j,m,n]),s=(0,c.useMemo)(()=>j.getViewport({scale:n,rotation:m}),[j,m,n]);(0,c.useEffect)(function(){if(!j)return;j.cleanup();let{current:a}=p;if(!a)return;a.width=r.width,a.height=r.height,a.style.width=`${Math.floor(s.width)}px`,a.style.height=`${Math.floor(s.height)}px`,a.style.visibility="hidden";let b={annotationMode:k?Y.ENABLE_FORMS:Y.ENABLE,canvas:a,canvasContext:a.getContext("2d",{alpha:!1}),viewport:r};f&&(b.background=f);let c=j.render(b);return c.promise.then(()=>{a.style.visibility="",j&&i&&i(ep(j,n))}).catch(q),()=>eo(c)},[f,j,k,r,s]);let t=(0,c.useCallback)(()=>{let{current:a}=p;a&&(a.width=0,a.height=0)},[]);return(0,c.useEffect)(()=>t,[t]),(0,b.jsx)("canvas",{className:`${e}__canvas`,dir:"ltr",ref:eu(o,p),style:{display:"block",userSelect:"none"},children:l?(0,b.jsx)(eE,{}):null})}function eG(){let a=ex();ed(a,"Unable to find Page context.");let{customTextRenderer:d,onGetTextError:e,onGetTextSuccess:f,onRenderTextLayerError:g,onRenderTextLayerSuccess:h,page:i,pageIndex:j,pageNumber:k,rotate:l,scale:m}=a;ed(i,"Attempted to load page text content, but no page was specified.");let[n,o]=ej(),{value:p,error:q}=n,r=(0,c.useRef)(null);(0,ee.default)(1===Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10),"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer"),(0,c.useEffect)(function(){o({type:"RESET"})},[i,o]),(0,c.useEffect)(function(){if(!i)return;let a=R(i.getTextContent());return a.promise.then(a=>{o({type:"RESOLVE",value:a})}).catch(a=>{o({type:"REJECT",error:a})}),()=>eo(a)},[i,o]),(0,c.useEffect)(()=>{if(void 0!==p){if(!1===p)return void(q&&((0,ee.default)(!1,q.toString()),e&&e(q)));p&&f&&f(p)}},[p]);let s=(0,c.useCallback)(()=>{h&&h()},[h]),t=(0,c.useCallback)(a=>{(0,ee.default)(!1,a.toString()),g&&g(a)},[g]),u=(0,c.useMemo)(()=>i.getViewport({scale:m,rotation:l}),[i,l,m]);return(0,c.useLayoutEffect)(function(){if(!i||!p)return;let{current:a}=r;if(!a)return;a.innerHTML="";let b=new c1({container:a,textContentSource:i.streamTextContent({includeMarkedContent:!0}),viewport:u});return b.render().then(()=>{let b=document.createElement("div");b.className="endOfContent",a.append(b);let c=a.querySelectorAll('[role="presentation"]');if(d){let a=0;p.items.forEach((b,e)=>{if(!("str"in b))return;let f=c[a];f&&(f.innerHTML=d({pageIndex:j,pageNumber:k,itemIndex:e,...b}),a+=b.str&&b.hasEOL?2:1)})}s()}).catch(t),()=>eo(b)},[d,t,s,i,j,k,p,u]),(0,b.jsx)("div",{className:N("react-pdf__Page__textContent","textLayer"),onMouseUp:function(){let a=r.current;a&&a.classList.remove("selecting")},onMouseDown:function(){let a=r.current;a&&a.classList.add("selecting")},ref:r})}function eH(a){let{_className:d="react-pdf__Page",_enableRegisterUnregisterPage:e=!0,canvasBackground:f,canvasRef:g,children:h,className:i,customRenderer:j,customTextRenderer:k,devicePixelRatio:l,error:m="Failed to load the page.",height:n,inputRef:o,loading:p="Loading page…",noData:q="No page specified.",onGetAnnotationsError:r,onGetAnnotationsSuccess:s,onGetStructTreeError:t,onGetStructTreeSuccess:u,onGetTextError:v,onGetTextSuccess:w,onLoadError:x,onLoadSuccess:y,onRenderAnnotationLayerError:z,onRenderAnnotationLayerSuccess:A,onRenderError:B,onRenderSuccess:C,onRenderTextLayerError:D,onRenderTextLayerSuccess:E,pageIndex:F,pageNumber:G,pdf:H,registerPage:I,renderAnnotationLayer:J=!0,renderForms:K=!1,renderMode:L="canvas",renderTextLayer:M=!0,rotate:O,scale:P=1,unregisterPage:Q,width:S,...U}={...ev(),...a},[V,W]=ej(),{value:X,error:Y}=V,Z=(0,c.useRef)(null);ed(H,"Attempted to load a page, but no document was specified. Wrap <Page /> in a <Document /> or pass explicit `pdf` prop.");let $=ek(G)?G-1:null!=F?F:null,_=null!=G?G:ek(F)?F+1:null,aa=null!=O?O:X?X.rotate:null,ab=(0,c.useMemo)(()=>{if(!X)return null;let a=1,b=null!=P?P:1;if(S||n){let b=X.getViewport({scale:1,rotation:aa});S?a=S/b.width:n&&(a=n/b.height)}return b*a},[n,X,aa,P,S]);(0,c.useEffect)(function(){return()=>{ek($)&&e&&Q&&Q($)}},[e,H,$,Q]),(0,c.useEffect)(function(){W({type:"RESET"})},[W,H,$]),(0,c.useEffect)(function(){if(!H||!_)return;let a=R(H.getPage(_));return a.promise.then(a=>{W({type:"RESOLVE",value:a})}).catch(a=>{W({type:"REJECT",error:a})}),()=>eo(a)},[W,H,_]),(0,c.useEffect)(()=>{if(void 0!==X){if(!1===X)return void(Y&&((0,ee.default)(!1,Y.toString()),x&&x(Y)));!function(){if(y){if(!X||!ab)return;y(ep(X,ab))}if(e&&I){if(!ek($)||!Z.current)return;I($,Z.current)}}()}},[X,ab]);let ac=(0,c.useMemo)(()=>ek($)&&_&&ek(aa)&&ek(ab)?{_className:d,canvasBackground:f,customTextRenderer:k,devicePixelRatio:l,onGetAnnotationsError:r,onGetAnnotationsSuccess:s,onGetStructTreeError:t,onGetStructTreeSuccess:u,onGetTextError:v,onGetTextSuccess:w,onRenderAnnotationLayerError:z,onRenderAnnotationLayerSuccess:A,onRenderError:B,onRenderSuccess:C,onRenderTextLayerError:D,onRenderTextLayerSuccess:E,page:X,pageIndex:$,pageNumber:_,renderForms:K,renderTextLayer:M,rotate:aa,scale:ab}:null,[d,f,k,l,r,s,t,u,v,w,z,A,B,C,D,E,X,$,_,K,M,aa,ab]),ad=(0,c.useMemo)(()=>T(U,()=>X?ab?ep(X,ab):void 0:X),[U,X,ab]),ae=`${$}@${ab}/${aa}`;return(0,b.jsx)("div",{className:N(d,i),"data-page-number":_,ref:eu(o,Z),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${ab}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:f||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...ad,children:function(){if(!_)return(0,b.jsx)(eh,{type:"no-data",children:"function"==typeof q?q():q});if(null===H||null==X)return(0,b.jsx)(eh,{type:"loading",children:"function"==typeof p?p():p});if(!1===H||!1===X)return(0,b.jsx)(eh,{type:"error",children:"function"==typeof m?m():m});if(!(null==ac?void 0:ac.page))throw Error("page is undefined");let a="function"==typeof h?h(ac):h;return(0,b.jsxs)(ew.Provider,{value:ac,children:[function(){switch(L){case"custom":return ed(j,'renderMode was set to "custom", but no customRenderer was passed.'),(0,b.jsx)(j,{},`${ae}_custom`);case"none":return null;default:return(0,b.jsx)(eF,{canvasRef:g},`${ae}_canvas`)}}(),M?(0,b.jsx)(eG,{},`${ae}_text`):null,J?(0,b.jsx)(ey,{},`${ae}_annotations`):null,a]})}()})}var eI=a.i(24382);function eJ({url:a,comments:d=[],selectedCommentId:e,onCommentClick:f,onCanvasClick:g,pendingMarker:h}){let[i,j]=(0,c.useState)(0),[k,l]=(0,c.useState)(1),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),q=(0,c.useRef)(null),r=(0,c.useMemo)(()=>({cMapUrl:`https://unpkg.com/pdfjs-dist@${ec.version}/cmaps/`,cMapPacked:!0}),[]);return((0,c.useEffect)(()=>{let b=null;return n(null),p(null),a.startsWith("data:")?fetch(a).then(a=>a.blob()).then(a=>{n(b=URL.createObjectURL(a))}).catch(a=>{console.error("Error converting Data URL:",a),p(a)}):n(a),()=>{b&&URL.revokeObjectURL(b)}},[a]),m||o)?(0,b.jsx)("div",{className:"bg-slate-200 h-full w-full overflow-y-auto flex justify-center p-8",ref:q,children:(0,b.jsx)("div",{className:"max-w-3xl w-full",children:(0,b.jsx)(et,{file:m,onLoadSuccess:function({numPages:a}){j(a)},onLoadError:a=>{console.error("PDF Load Error:",a),p(a)},className:"flex flex-col gap-4 items-center",loading:(0,b.jsx)("div",{className:"text-slate-500 font-bold animate-pulse mt-10",children:"Cargando PDF..."}),error:(0,b.jsxs)("div",{className:"text-center mt-10 p-6 bg-red-50 border border-red-200 rounded-xl max-w-md mx-auto",children:[(0,b.jsx)("div",{className:"text-red-500 font-bold mb-2",children:"Error al cargar el PDF"}),(0,b.jsx)("p",{className:"text-xs text-red-600 mb-2",children:o?.message||(a.startsWith("data:")?"El archivo puede estar corrupto o no ser un PDF válido.":"Verifica que la URL sea válida y permita CORS.")}),(0,b.jsxs)("p",{className:"text-[10px] text-slate-400 font-mono",children:["Src: ",a.substring(0,30),"..."]})]}),options:r,children:Array.from(Array(i),(a,c)=>(0,b.jsxs)("div",{className:"relative group shadow-lg",children:[(0,b.jsx)(eH,{pageNumber:c+1,width:q.current?Math.min(q.current.offsetWidth-64,800):600,renderTextLayer:!1,renderAnnotationLayer:!1,onClick:a=>((a,b)=>{if(!g)return;let c=a.currentTarget.getBoundingClientRect();g({page:b+1,x:(a.clientX-c.left)/c.width*100,y:(a.clientY-c.top)/c.height*100})})(a,c),className:"bg-white cursor-crosshair"}),d.filter(a=>a.position?.page===c+1).map(a=>(0,b.jsx)("div",{onClick:b=>{b.stopPropagation(),f?.(a.id)},className:`absolute cursor-pointer transform -translate-x-1/2 -translate-y-1/2 transition-all hover:scale-110 z-10 
                                        ${e===a.id?"z-20 scale-125":""}`,style:{left:`${a.position.x}%`,top:`${a.position.y}%`},children:(0,b.jsxs)("div",{className:`
                                        w-8 h-8 rounded-full shadow-md flex items-center justify-center border-2 
                                        ${e===a.id?"bg-blue-600 border-white text-white rotate-[360deg] transition-transform duration-500":"bg-white border-blue-600 text-blue-600 hover:bg-blue-50"}
                                    `,children:[(0,b.jsx)("div",{className:"text-xs font-bold",children:a.userName.substring(0,1)}),(0,b.jsx)("div",{className:"absolute top-full mt-1 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-slate-800 text-white text-[10px] px-2 py-1 rounded whitespace-nowrap pointer-events-none transition-opacity",children:a.userName})]})},a.id)),h?.page===c+1&&(0,b.jsx)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 pointer-events-none animate-bounce",style:{left:`${h.x}%`,top:`${h.y}%`},children:(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-yellow-400 border-2 border-white shadow-lg flex items-center justify-center text-yellow-900",children:(0,b.jsx)(eI.PlusCircle,{size:20,weight:"fill"})})})]},`page_${c+1}`))})})}):(0,b.jsx)("div",{className:"bg-slate-200 h-full w-full flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-slate-500 font-bold animate-pulse",children:"Preparando documento..."})})}console.log("Configuring PDF Worker to local file: /pdf.worker.js"),ec.GlobalWorkerOptions.workerSrc="/pdf.worker.js";let eK=a=>a.activities&&0!==a.activities.length?Math.round(a.activities.reduce((a,b)=>a+(a=>{switch(a){case"VALIDATED":return 100;case"DELIVERED":return 90;case"IN_REVIEW":return 80;case"COMPLETED":return 60;case"IN_PROGRESS":return 20;default:return 0}})(b.status),0)/a.activities.length):0,eL=a=>a.phases&&0!==a.phases.length?Math.round(a.phases.reduce((a,b)=>a+eK(b),0)/a.phases.length):0;function eM(){let{currentUser:a,currentTenantId:d,createProject:j,updateProject:k,createProjectFolder:l,updateProjectFolder:m,deleteProjectFolder:o,version:p}=(0,e.useApp)(),{t:q}=(0,f.useTranslation)(),[r,t]=(0,c.useState)("PROJECTS"),[u,v]=(0,c.useState)("REQUESTS"),[w,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),[J,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(0),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)("ALL"),[W,X]=(0,c.useState)("ALL"),[Y,Z]=(0,c.useState)("ALL"),[$,_]=(0,c.useState)(""),aa=(0,c.useMemo)(()=>g.DB.units.filter(a=>a.tenantId===d&&"UNIT"===a.type).map(a=>a.name),[d,Q]),ab=(0,c.useMemo)(()=>{let a=g.DB.projects.filter(a=>a.tenantId===d),b=g.DB.projectFolders.filter(a=>a.tenantId===d),c=new Set;return a.forEach(a=>{a.process&&("ALL"===U||a.unit===U)&&c.add(a.process)}),b.forEach(a=>{a.process&&("ALL"===U||a.unit===U)&&c.add(a.process)}),Array.from(c).sort()},[d,U,Q]),ac=a=>{let b=!S||a.title.toLowerCase().includes(S.toLowerCase())||a.id.toLowerCase().includes(S.toLowerCase()),c="ALL"===U||a.unit===U,d="ALL"===Y||a.status===Y,e=!$||a.createdAt.startsWith($);return b&&c&&d&&e};(0,c.useEffect)(()=>{P(!0)},[]),(0,c.useEffect)(()=>{X("ALL")},[U]);let ad=()=>R(a=>a+1),ae=(0,c.useMemo)(()=>O?g.DB.workflowCases.filter(b=>b.tenantId===d&&b.creatorId===a?.id&&ac(b)):[],[d,a?.id,O,Q,S,U,Y,$,p]),af=(0,c.useMemo)(()=>a&&O?g.DB.workflowCases.filter(b=>b.tenantId===d&&"IN_PROGRESS"===b.status&&(b.assigneeId===a.id||!b.assigneeId&&b.unit===a.unit)&&ac(b)):[],[d,a,O,Q,S,U,Y,$,p]),ag=(0,c.useMemo)(()=>O?g.DB.projects.filter(a=>{let b=a.tenantId===d,c=!S||a.title.toLowerCase().includes(S.toLowerCase()),e="ALL"===U||a.unit===U,f="ALL"===W||a.process===W,g="ALL"===Y||a.status===Y,h=!$||a.createdAt.startsWith($);return b&&c&&e&&f&&g&&h}):[],[d,O,Q,p,S,U,W,Y,$]),ah=(0,c.useMemo)(()=>O?g.DB.projectFolders.filter(a=>{let b=a.tenantId===d,c=!S||a.name.toLowerCase().includes(S.toLowerCase()),e="ALL"===U||a.unit===U,f="ALL"===W||a.process===W,g=!$||a.createdAt.startsWith($);return b&&c&&e&&f&&g}):[],[d,O,Q,p,S,U,W,Y,$]),[ai,aj]=(0,c.useState)(null),[ak,al]=(0,c.useState)(null),am=a=>{if(!ak||!D)return;let{type:b,phaseId:c,activityId:d}=ak,e={userId:a.id,role:"Member"},f={...D};if("GLOBAL"===b){if(f.participants.some(b=>"object"==typeof b&&b.userId===a.id))return void alert("El usuario ya es parte del equipo global.");f.participants=[...f.participants,e]}else if("ACTIVITY"===b&&c&&d){let b=D.phases.map(b=>{if(b.id===c){let c=b.activities.map(b=>b.id===d?b.participants.some(b=>"object"==typeof b&&b.userId===a.id)?b:{...b,participants:[...b.participants,e]}:b);return{...b,activities:c}}return b});f={...f,phases:b}}k(D.id,f),E(f),al(null)},[an,ao]=(0,c.useState)(null);if(!O)return(0,b.jsx)("div",{className:"p-8 text-slate-400",children:"Cargando workflows..."});let ap="REQUESTS"===u?ae:af;return(0,b.jsxs)("div",{className:"flex h-full bg-slate-50 overflow-hidden",children:[(0,b.jsxs)("div",{className:`flex-1 flex flex-col min-w-0 transition-all ${w||D?"mr-0":""}`,children:[(0,b.jsxs)("div",{className:"bg-white border-b border-slate-200 px-8 py-6 flex justify-between items-center shadow-sm z-10",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center gap-4 mb-2",children:(0,b.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[(0,b.jsx)("button",{onClick:()=>t("PROJECTS"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${"PROJECTS"===r?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:q("nav_projects")}),(0,b.jsx)("button",{onClick:()=>t("WORKFLOWS"),className:`px-3 py-1 text-xs font-bold rounded-md transition-all ${"WORKFLOWS"===r?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:q("nav_requests")})]})}),(0,b.jsxs)("h1",{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:["WORKFLOWS"===r?(0,b.jsx)(i.Kanban,{className:"text-blue-600",weight:"duotone"}):(0,b.jsx)(y.Briefcase,{className:"text-purple-600",weight:"duotone"}),q("WORKFLOWS"===r?"wf_title_requests":"wf_title_projects")]}),(0,b.jsx)("p",{className:"text-slate-500 text-sm mt-1",children:q("WORKFLOWS"===r?"wf_desc_requests":"wf_desc_projects")})]}),"WORKFLOWS"===r?(0,b.jsxs)("button",{onClick:()=>C(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-blue-600/20 active:scale-95 transition-all flex items-center gap-2",children:[(0,b.jsx)(h.Plus,{weight:"bold",size:18})," ",q("wf_new_request")]}):a?.role==="ADMIN"||a?.role==="superadmin"||a?.role==="Admin Global"||a?.level===1?(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>I(!0),className:"bg-purple-600 hover:bg-purple-700 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-purple-600/20 active:scale-95 transition-all flex items-center gap-2",children:[(0,b.jsx)(h.Plus,{weight:"bold",size:18})," ",q("wf_new_project")]}),(0,b.jsxs)("button",{onClick:()=>L(!0),className:"bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 px-3 py-2.5 rounded-xl font-bold text-sm transition-all flex items-center gap-2",children:[(0,b.jsx)(z.Folder,{weight:"duotone",size:18})," ",q("wf_new_folder")]}),(0,b.jsxs)("button",{onClick:()=>N(!0),className:"bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 px-3 py-2.5 rounded-xl font-bold text-sm transition-all flex items-center gap-2",title:q("wf_import"),children:[(0,b.jsx)(K.FileCsv,{weight:"duotone",size:18})," ",q("wf_import")]})]}):null]}),(0,b.jsxs)("div",{className:"px-8 mt-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(x.MagnifyingGlass,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{placeholder:"WORKFLOWS"===r?"Buscar por asunto o ID...":"Buscar proyecto...",className:"w-full pl-9 pr-3 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:S,onChange:a=>T(a.target.value)})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("select",{className:"w-full pl-3 pr-8 py-2 bg-white border border-slate-200 rounded-lg text-sm appearance-none outline-none focus:ring-2 focus:ring-blue-500 text-slate-600",value:U,onChange:a=>V(a.target.value),children:[(0,b.jsx)("option",{value:"ALL",children:"Todas las Áreas"}),aa.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)(s.CaretRight,{className:"absolute right-3 top-1/2 -translate-y-1/2 rotate-90 text-slate-400 pointer-events-none",size:12})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("select",{className:"w-full pl-3 pr-8 py-2 bg-white border border-slate-200 rounded-lg text-sm appearance-none outline-none focus:ring-2 focus:ring-blue-500 text-slate-600",value:W,onChange:a=>X(a.target.value),children:[(0,b.jsx)("option",{value:"ALL",children:"Todos los Procesos"}),ab.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)(s.CaretRight,{className:"absolute right-3 top-1/2 -translate-y-1/2 rotate-90 text-slate-400 pointer-events-none",size:12})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("select",{className:"w-full pl-3 pr-8 py-2 bg-white border border-slate-200 rounded-lg text-sm appearance-none outline-none focus:ring-2 focus:ring-blue-500 text-slate-600",value:Y,onChange:a=>Z(a.target.value),children:[(0,b.jsx)("option",{value:"ALL",children:"Todos los Estados"}),"WORKFLOWS"===r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("option",{value:"RECEIVED",children:"Recibido"}),(0,b.jsx)("option",{value:"IN_PROGRESS",children:"En Proceso"}),(0,b.jsx)("option",{value:"REVIEW",children:"En Revisión"}),(0,b.jsx)("option",{value:"APPROVED",children:"Aprobado"}),(0,b.jsx)("option",{value:"REJECTED",children:"Rechazado"}),(0,b.jsx)("option",{value:"CLOSED",children:"Cerrado"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("option",{value:"PLANNING",children:"Planning"}),(0,b.jsx)("option",{value:"ACTIVE",children:"En Ejecución"}),(0,b.jsx)("option",{value:"COMPLETED",children:"Completado"}),(0,b.jsx)("option",{value:"ON_HOLD",children:"En Espera"}),(0,b.jsx)("option",{value:"CANCELLED",children:"Cancelado"})]})]}),(0,b.jsx)(s.CaretRight,{className:"absolute right-3 top-1/2 -translate-y-1/2 rotate-90 text-slate-400 pointer-events-none",size:12})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Calendar,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{type:"date",className:"w-full pl-9 pr-3 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none text-slate-600",value:$,onChange:a=>_(a.target.value)})]})]}),"WORKFLOWS"===r&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"px-8 mt-6",children:(0,b.jsxs)("div",{className:"flex gap-6 border-b border-slate-200",children:[(0,b.jsx)(eN,{active:"REQUESTS"===u,onClick:()=>v("REQUESTS"),label:"Mis Solicitudes",count:ae.length}),(0,b.jsx)(eN,{active:"TASKS"===u,onClick:()=>v("TASKS"),label:"Mis Tareas",count:af.length,alert:af.length>0})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-8",children:ap.length>0?(0,b.jsx)("div",{className:"space-y-3",children:ap.map(a=>(0,b.jsx)(eO,{data:a,onClick:()=>A(a),active:w?.id===a.id},a.id))}):(0,b.jsx)(eR,{type:u,onAction:()=>C(!0)})})]}),"PROJECTS"===r&&(0,b.jsx)(eT,{projects:ag,folders:ah,onSelect:E,selectedId:D?.id,forceUpdate:ad,currentFolderId:F,setCurrentFolderId:G})]}),w&&(0,b.jsx)("div",{className:"w-[450px] bg-white border-l border-slate-200 shadow-2xl flex flex-col overflow-hidden animate-slideLeft z-20",children:(0,b.jsx)(eP,{workflowCase:w,onClose:()=>{A(null),ad()},currentUser:a})}),D&&(0,b.jsx)(eU,{project:D,folders:ah,onClose:()=>{E(null),ad()},onSave:ad,currentUser:a,active:!0,onRequestAddDoc:(a,b)=>aj({projectId:D.id,phaseId:a,activityId:b}),onRequestAddMember:a=>al(a),onRequestWorkOnDoc:(a,b,c,d)=>ao({projectId:D.id,phaseId:a,activityId:b,docId:c,mode:d})}),B&&(0,b.jsx)(eQ,{onClose:()=>C(!1),onCreate:b=>{let c={id:`case-${Date.now()}`,workflowId:b.id,tenantId:d,title:`${b.title} - ${a?.name}`,status:"RECEIVED",creatorId:a.id,unit:b.unit,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),data:{},history:[{status:"RECEIVED",by:a.name,date:new Date().toISOString(),comment:"Solicitud creada"}],comments:[]};g.DB.workflowCases.unshift(c),ad(),C(!1),v("REQUESTS")},tenantId:d}),H&&(0,b.jsx)(eV,{onClose:()=>I(!1),onCreate:a=>{j&&j(a),ad(),I(!1)},tenantId:d,folders:ah}),J&&(0,b.jsx)(eW,{onClose:()=>L(!1),onCreate:a=>{let b={id:`fld-${Date.now()}`,tenantId:d,createdAt:new Date().toISOString(),...a};g.DB.projectFolders.push(b),ad(),L(!1)},folders:ah}),M&&(0,b.jsx)(eS,{onClose:()=>N(!1),onImport:a=>{let b=a.split("\n").filter(a=>a.trim().length>0),c={};for(let a=1;a<b.length;a++){let d=b[a].split(",").map(a=>a.trim().replace(/^"|"$/g,""));if(d.length<3)continue;let e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6];if(!g)continue;let l=`${e}|${f}|${g}`;c[l]||(c[l]={l1:e,l2:f,projName:g,startDate:j,endDate:k,phases:{}}),h&&(c[l].phases[h]||(c[l].phases[h]=[]),i&&c[l].phases[h].push({name:i,start:j,end:k}))}Object.values(c).forEach(a=>{let b;if(a.l1){let c=g.DB.projectFolders.find(b=>b.tenantId===d&&b.name.toLowerCase()===a.l1.toLowerCase()&&!b.parentId);if(c||(l(a.l1),c=g.DB.projectFolders[g.DB.projectFolders.length-1]),b=c.id,a.l2){let e=g.DB.projectFolders.find(b=>b.tenantId===d&&b.name.toLowerCase()===a.l2.toLowerCase()&&b.parentId===c.id);e||(l(a.l2,c.id),e=g.DB.projectFolders[g.DB.projectFolders.length-1]),b=e.id}}let c=Object.keys(a.phases).map((b,c)=>({id:`ph-${Date.now()}-${c}`,name:b,order:c+1,status:"NOT_STARTED",activities:a.phases[b].map((a,b)=>({id:`act-${Date.now()}-${c}-${b}`,name:a.name,status:"NOT_STARTED",participants:[],documents:[],startDate:a.start,endDate:a.end}))}));0===c.length&&c.push({id:`ph-${Date.now()}`,name:"Fase Inicial",order:1,status:"NOT_STARTED",activities:[]}),j({title:a.projName,description:"Importado vía CSV",startDate:a.startDate,endDate:a.endDate,folderId:b,phases:c})}),alert("Proyectos importados exitosamente."),N(!1),ad()}}),ai&&(0,b.jsx)(eX,{onClose:()=>aj(null),onAdd:a=>{if(!ai||!D)return;let{phaseId:b,activityId:c}=ai,d=D.phases.map(d=>{if(d.id===b){let b=d.activities.map(b=>b.id===c?{...b,documents:[...b.documents,a]}:b);return{...d,activities:b}}return d}),e={...D,phases:d};k(D.id,e),E(e),E(e),aj(null)},tenantId:d||""}),ak&&(0,b.jsx)(eY,{onClose:()=>al(null),onAdd:am,tenantId:d||""}),ak&&(0,b.jsx)(eY,{onClose:()=>al(null),onAdd:am,tenantId:d||""}),an&&D&&(0,b.jsx)(eZ,{project:D,target:an,onClose:()=>ao(null),onUpdate:a=>{k(D.id,a),E(a)}})]})}function eN({active:a,onClick:c,label:d,count:e,alert:f}){return(0,b.jsxs)("button",{onClick:c,className:`pb-3 font-semibold text-sm transition-all relative flex items-center gap-2 ${a?"text-blue-600 border-b-2 border-blue-600":"text-slate-500 hover:text-slate-800"}`,children:[d,(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-[10px] ${a?"bg-blue-100":"bg-slate-100"} ${f?"text-white bg-rose-500":""}`,children:e})]})}function eO({data:a,onClick:c,active:d}){let e={RECEIVED:{color:"bg-slate-100 text-slate-600",label:"Recibido",icon:q},IN_PROGRESS:{color:"bg-blue-50 text-blue-600",label:"En Proceso",icon:k.Clock},CLOSED:{color:"bg-emerald-50 text-emerald-600",label:"Cerrado",icon:j.CheckCircle},REJECTED:{color:"bg-rose-50 text-rose-600",label:"Rechazado",icon:l.XCircle}},f=e[a.status]||e.RECEIVED,g=f.icon;return(0,b.jsxs)("div",{onClick:c,className:`p-4 rounded-xl border transition-all cursor-pointer hover:shadow-md bg-white ${d?"border-blue-500 ring-1 ring-blue-500":"border-slate-200 hover:border-blue-300"}`,children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsxs)("div",{className:`px-2 py-1 rounded-md text-[10px] font-bold uppercase flex items-center gap-1.5 ${f.color}`,children:[(0,b.jsx)(g,{weight:"bold"})," ",f.label]}),(0,b.jsxs)("span",{className:"text-[10px] text-slate-400 font-medium flex items-center gap-1",children:[(0,b.jsx)(n.Calendar,{})," ",new Date(a.createdAt).toLocaleDateString()]})]}),(0,b.jsx)("h3",{className:"font-bold text-slate-800 text-sm mb-1",children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[(0,b.jsx)("span",{className:"truncate max-w-[150px]",children:a.unit}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:["ID: ",a.id.split("-").pop()]})]})]})}function eP({workflowCase:a,onClose:d,currentUser:e}){let f=a.assigneeId===e?.id||!a.assigneeId&&a.unit===e?.unit||e?.role==="ADMIN",[h,i]=(0,c.useState)(""),j=b=>{a.status=b,"IN_PROGRESS"!==b||a.assigneeId||(a.assigneeId=e.id),a.history.unshift({status:b,by:e.name,date:new Date().toISOString(),comment:`Estado cambiado a ${b}`}),d()};return(0,b.jsxs)("div",{className:"flex flex-col h-full",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-slate-100 bg-slate-50/50",children:[(0,b.jsxs)("button",{onClick:d,className:"mb-4 text-xs font-bold text-slate-500 flex items-center gap-1 hover:text-slate-800 transition-colors",children:[(0,b.jsx)(r.ArrowRight,{className:"rotate-180"})," Volver"]}),(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900 leading-snug mb-2",children:a.title}),(0,b.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,b.jsx)("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded-md text-slate-600 font-medium",children:a.unit}),(0,b.jsxs)("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded-md text-slate-600 font-medium",children:["Creado por ",a.creatorId.split("-").pop()]})]})]}),"CLOSED"!==a.status&&"REJECTED"!==a.status&&(0,b.jsxs)("div",{className:"p-4 border-b border-slate-100 bg-white grid grid-cols-2 gap-3",children:[e?.level<=3&&(0,b.jsxs)("div",{className:"col-span-2 mb-2 p-3 bg-indigo-50 rounded-lg flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-indigo-800 text-xs font-bold",children:[(0,b.jsx)(w.UserSwitch,{size:18}),(0,b.jsxs)("span",{children:["Líder de Área (",e.unit,"): Asignar Responsable"]})]}),(0,b.jsxs)("select",{className:"bg-white border border-indigo-200 text-xs rounded px-2 py-1 outline-none text-indigo-700",onChange:b=>{b.target.value&&(a.assigneeId=b.target.value,a.history.unshift({status:a.status,by:e.name,date:new Date().toISOString(),comment:`Reasignado a usuario ${b.target.value}`}),d())},value:a.assigneeId||"",children:[(0,b.jsx)("option",{value:"",children:"-- Sin Asignar --"}),g.DB.users.filter(b=>b.tenantId===a.tenantId).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.role,")"]},a.id))]})]}),f?"RECEIVED"===a.status?(0,b.jsx)("button",{onClick:()=>j("IN_PROGRESS"),className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg text-sm transition-all shadow-md shadow-blue-500/20",children:"Iniciar Trámite"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>j("REJECTED"),className:"bg-white border border-red-200 text-red-600 hover:bg-red-50 font-bold py-2 rounded-lg text-sm transition-all",children:"Rechazar"}),(0,b.jsx)("button",{onClick:()=>j("CLOSED"),className:"bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 rounded-lg text-sm transition-all shadow-md shadow-emerald-500/20",children:"Aprobar / Cerrar"})]}):(0,b.jsx)("div",{className:"col-span-2 text-center text-xs text-slate-400 italic py-2",children:"Solo el responsable asignado puede gestionar este caso."})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[(0,b.jsxs)("section",{children:[(0,b.jsx)("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Línea de Tiempo"}),(0,b.jsx)("div",{className:"border-l-2 border-slate-100 ml-2 space-y-6 pl-6 relative",children:a.history.map((a,c)=>(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:`absolute -left-[31px] w-3 h-3 rounded-full border-2 border-white ring-2 ${0===c?"bg-blue-500 ring-blue-100":"bg-slate-300 ring-slate-100"}`}),(0,b.jsxs)("p",{className:"text-xs font-bold text-slate-800 flex items-center gap-2",children:[a.status," ",(0,b.jsx)("span",{className:"text-[10px] font-normal text-slate-400",children:new Date(a.date).toLocaleDateString()})]}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:a.by}),a.comment&&(0,b.jsxs)("p",{className:"text-xs text-slate-600 italic mt-1 bg-slate-50 p-2 rounded border border-slate-100 inline-block",children:['"',a.comment,'"']})]},c))})]}),(0,b.jsxs)("section",{children:[(0,b.jsx)("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Datos de la Solicitud"}),(0,b.jsxs)("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"ID Referencia"}),(0,b.jsx)("span",{className:"text-xs font-medium text-slate-900",children:a.id})]}),(0,b.jsxs)("div",{className:"flex justify-between border-b border-slate-200 pb-2",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Prioridad"}),(0,b.jsx)("span",{className:"text-xs font-medium text-amber-600",children:"Alta (Simulado)"})]}),(0,b.jsxs)("div",{className:"pt-2",children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Descripción / Motivo"}),(0,b.jsx)("p",{className:"text-sm text-slate-800",children:"Solicitud generada automáticamente para demostración de flujos de trabajo."})]})]})]}),(0,b.jsxs)("section",{children:[(0,b.jsx)("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Comentarios Internos"}),(0,b.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-slate-50 p-6 text-center text-xs text-slate-400",children:[(0,b.jsx)(t.ChatCircle,{size:24,className:"mx-auto mb-2 opacity-50"}),"No hay comentarios aún."]}),(0,b.jsxs)("div",{className:"p-3 border-t border-slate-200 bg-slate-50 flex gap-2",children:[(0,b.jsx)("input",{className:"flex-1 bg-white border border-slate-200 rounded-lg px-3 py-2 text-xs focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Escribe un comentario..."}),(0,b.jsx)("button",{className:"bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition-colors",children:(0,b.jsx)(s.CaretRight,{weight:"bold"})})]})]})]})]})]})}function eQ({onClose:a,onCreate:d,tenantId:e}){let f=(0,c.useMemo)(()=>g.DB.workflowDefinitions.filter(a=>a.tenantId===e&&a.active),[e]),[h,i]=(0,c.useState)("ALL"),[j,k]=(0,c.useState)(""),m=(0,c.useMemo)(()=>Array.from(new Set(f.map(a=>a.unit))),[f]),n=(0,c.useMemo)(()=>f.filter(a=>{let b="ALL"===h||a.unit===h,c=a.title.toLowerCase().includes(j.toLowerCase());return b&&c}),[f,h,j]);return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden animate-scaleIn flex flex-col max-h-[90vh]",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Iniciar Nueva Solicitud"}),(0,b.jsx)("button",{onClick:a,className:"text-slate-400 hover:text-slate-800",children:(0,b.jsx)(l.XCircle,{size:24})})]}),(0,b.jsxs)("div",{className:"px-6 py-3 bg-white border-b border-slate-100 flex gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(x.MagnifyingGlass,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{className:"w-full pl-9 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Buscar proceso...",value:j,onChange:a=>k(a.target.value)})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(v.Funnel,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",size:16}),(0,b.jsxs)("select",{className:"pl-9 pr-8 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm appearance-none outline-none focus:ring-2 focus:ring-blue-500 font-medium text-slate-700",value:h,onChange:a=>i(a.target.value),children:[(0,b.jsx)("option",{value:"ALL",children:"Todas las Áreas"}),m.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]})]}),(0,b.jsx)("div",{className:"p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50",children:n.map(a=>(0,b.jsxs)("button",{onClick:()=>d(a),className:"bg-white p-4 rounded-xl border border-slate-200 hover:border-blue-400 hover:shadow-lg hover:shadow-blue-500/10 text-left transition-all group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,b.jsxs)("div",{className:"w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600 group-hover:scale-110 transition-transform",children:[(0,b.jsx)(u.Paperclip,{weight:"duotone",size:20})," "]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-slate-800 text-sm",children:a.title}),(0,b.jsx)("span",{className:"text-[10px] text-slate-500 uppercase tracking-wide",children:a.unit})]})]}),(0,b.jsx)("p",{className:"text-xs text-slate-500 line-clamp-2",children:a.description})]},a.id))})]})})}function eR({type:a,onAction:c}){return(0,b.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center opacity-60",children:[(0,b.jsx)(q,{size:48,className:"text-slate-300 mb-4"}),(0,b.jsxs)("h3",{className:"text-lg font-bold text-slate-700",children:["No hay ","REQUESTS"===a?"solicitudes":"tareas"]}),(0,b.jsx)("p",{className:"text-sm text-slate-500 max-w-xs mx-auto mb-6",children:"REQUESTS"===a?"Aún no has creado ninguna solicitud. Inicia un nuevo trámite desde el botón superior.":"Estás al día. No tienes tareas pendientes asignadas a ti o tu unidad."}),"REQUESTS"===a&&(0,b.jsx)("button",{onClick:c,className:"text-blue-600 font-bold hover:underline",children:"Crear Solicitud"})]})}function eS({onClose:a,onImport:d}){let[e,f]=(0,c.useState)("");return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-lg p-6 shadow-2xl animate-scaleIn relative",children:[(0,b.jsx)("button",{onClick:a,className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:(0,b.jsx)(l.XCircle,{size:24})}),(0,b.jsxs)("h2",{className:"text-xl font-bold text-slate-800 mb-2 flex items-center gap-2",children:[(0,b.jsx)(K.FileCsv,{className:"text-green-600",size:24})," Importar Estructura de Proyectos"]}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mb-6",children:"Carga un archivo CSV para generar automáticamente carpetas, proyectos, fases y actividades."}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[(0,b.jsx)("h3",{className:"text-sm font-bold text-slate-700 mb-2",children:"1. Descarga la plantilla"}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-3",children:"Usa este archivo como base para llenar tu información."}),(0,b.jsxs)("button",{onClick:()=>{let a=new Blob([`Carpeta Nivel 1,Carpeta Nivel 2,Nombre Proyecto,Fase,Actividad,Fecha Inicio (YYYY-MM-DD),Fecha Fin (YYYY-MM-DD)
Educaci\xf3n,Virtual,Curso de Python,Fase 1: Introducci\xf3n,Instalaci\xf3n de Entorno,2025-01-10,2025-01-12
Educaci\xf3n,Virtual,Curso de Python,Fase 1: Introducci\xf3n,Variables y Tipos,2025-01-13,2025-01-15
Educaci\xf3n,Virtual,Curso de Python,Fase 2: Estructuras,Bucles y Condicionales,2025-01-16,2025-01-20`],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(a),c=document.createElement("a");c.setAttribute("href",b),c.setAttribute("download","plantilla_proyectos_m360.csv"),document.body.appendChild(c),c.click()},className:"text-xs bg-white border border-slate-300 px-3 py-2 rounded font-bold text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[(0,b.jsx)(B.Upload,{size:14})," Descargar CSV Ejemplo"]})]}),(0,b.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200",children:[(0,b.jsx)("h3",{className:"text-sm font-bold text-slate-700 mb-2",children:"2. Sube tu archivo"}),(0,b.jsx)("input",{type:"file",accept:".csv",onChange:a=>{let b=a.target.files?.[0];if(b){let a=new FileReader;a.onload=a=>{f(a.target?.result)},a.readAsText(b)}},className:"block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),e&&(0,b.jsxs)("div",{className:"bg-green-50 text-green-700 p-3 rounded text-xs font-bold flex items-center gap-2",children:[(0,b.jsx)(j.CheckCircle,{size:16})," Archivo cargado y listo para procesar."]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-8",children:[(0,b.jsx)("button",{onClick:a,className:"px-4 py-2 text-slate-500 hover:text-slate-800 font-bold text-sm",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>{e&&d(e)},disabled:!e,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 shadow-lg shadow-blue-500/30 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Procesar e Importar"})]})]})})}function eT({projects:a,folders:d,onSelect:h,selectedId:i,forceUpdate:j,currentFolderId:k,setCurrentFolderId:l}){let{deleteProject:o,deleteProjectFolder:p,updateProjectFolder:q,duplicateProject:r,currentUser:t}=(0,e.useApp)(),{t:u}=(0,f.useTranslation)(),v=t?.role==="ADMIN"||t?.role==="superadmin"||t?.role==="Admin Global"||t?.level===1,[w,x]=(0,c.useState)(null),[B,C]=(0,c.useState)({name:"",color:"",startDate:"",endDate:"",parentId:"",unit:"",process:""}),D=d.find(a=>a.id===k),E=(0,c.useMemo)(()=>k?a.filter(a=>a.folderId===k):a.filter(a=>!a.folderId),[a,k]),F=(0,c.useMemo)(()=>k?d.filter(a=>a.parentId===k):d.filter(a=>!a.parentId),[d,k]);return(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-8",children:[k&&(0,b.jsxs)("div",{className:"mb-6 flex items-center gap-2 text-sm text-slate-500",children:[(0,b.jsxs)("button",{onClick:()=>l(null),className:"hover:underline flex items-center gap-1",children:[(0,b.jsx)(z.Folder,{})," ",u("nav_projects")]}),(0,b.jsx)(s.CaretRight,{size:12}),D?.parentId&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>l(D.parentId),className:"hover:underline",children:d.find(a=>a.id===D.parentId)?.name}),(0,b.jsx)(s.CaretRight,{size:12})]}),(0,b.jsx)("span",{className:"font-bold text-slate-900",children:D?.name})]}),(0,b.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(250px,1fr))] gap-6",children:[F.map(c=>{let e=a.filter(a=>a.folderId===c.id),f=e.length>0?Math.round(e.reduce((a,b)=>a+eL(b),0)/e.length):0;return(0,b.jsxs)("div",{onClick:()=>l(c.id),className:"bg-slate-50 border border-slate-200 rounded-xl p-5 cursor-pointer hover:bg-white hover:shadow-lg hover:border-blue-200 transition-all group relative",children:[v&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),confirm("¿Seguro que deseas eliminar esta carpeta?")&&p(c.id)},className:"absolute top-2 right-2 p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10",title:"Eliminar Carpeta",children:(0,b.jsx)(A.Trash,{size:16})}),(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),x(c),C({name:c.name,color:c.color||"#3b82f6",startDate:c.startDate||"",endDate:c.endDate||"",parentId:c.parentId||"",unit:c.unit||"",process:c.process||""})},className:"absolute top-2 right-9 p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10 mr-1",title:"Editar Carpeta",children:(0,b.jsx)(H.PencilSimple,{size:16})}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation();let e=b=>{let c=a.filter(a=>a.folderId===b),f=d.filter(a=>a.parentId===b),g=[...c];return f.forEach(a=>{g=[...g,...e(a.id)]}),g},f=e(c.id),g=[];if(0===f.length)return void alert("Esta carpeta no contiene proyectos para exportar.");f.forEach(a=>{let b=d.find(b=>b.id===a.folderId),c=b?b.name:"Root";a.phases&&0!==a.phases.length?a.phases.forEach(b=>{b.activities&&0!==b.activities.length?b.activities.forEach(d=>{let e=d.participants?d.participants.map(a=>"object"==typeof a?a.userId:a).join("; "):"";g.push([c,a.title,b.name,b.status,d.name,d.status||"NOT_STARTED",d.startDate||"",d.endDate||"",e])}):g.push([c,a.title,b.name,b.status,"","",b.startDate||"",b.endDate||"",""])}):g.push([c,a.title,"","","","",a.startDate||"",a.endDate||"",""])});let h='<table border="1"><thead><tr>';["Folder","Project","Phase","Phase Status","Activity","Activity Status","Start Date","End Date","Participants"].forEach(a=>{h+=`<th style="background-color:#f0f0f0; font-weight:bold;">${a}</th>`}),h+="</tr></thead><tbody>",g.forEach(a=>{h+="<tr>",a.forEach(a=>{h+=`<td>${a||""}</td>`}),h+="</tr>"}),h+="</tbody></table>";let i=new Blob([`
                                                <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
                                                <head>
                                                    <!--[if gte mso 9]>
                                                    <xml>
                                                        <x:ExcelWorkbook>
                                                            <x:ExcelWorksheets>
                                                                <x:ExcelWorksheet>
                                                                    <x:Name>Folder_Structure</x:Name>
                                                                    <x:WorksheetOptions>
                                                                        <x:DisplayGridlines/>
                                                                    </x:WorksheetOptions>
                                                                </x:ExcelWorksheet>
                                                            </x:ExcelWorksheets>
                                                        </x:ExcelWorkbook>
                                                    </xml>
                                                    <![endif]-->
                                                    <meta http-equiv="content-type" content="text/plain; charset=UTF-8"/>
                                                </head>
                                                <body>${h}</body>
                                                </html>
                                            `],{type:"application/vnd.ms-excel"}),j=URL.createObjectURL(i),k=document.createElement("a");k.setAttribute("href",j),k.setAttribute("download",`${c.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_full_structure.xls`),document.body.appendChild(k),k.click(),document.body.removeChild(k)},className:"absolute top-2 right-[76px] p-1.5 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10",title:"Descargar Estructura Carpeta (.xls)",children:(0,b.jsx)(L.DownloadSimple,{size:16})})]}),(0,b.jsx)("div",{className:"flex justify-between items-start mb-3",children:(0,b.jsx)("div",{className:"p-2 rounded-lg transition-colors",style:{backgroundColor:`${c.color||"#3b82f6"}20`,color:c.color||"#3b82f6"},children:(0,b.jsx)(z.Folder,{size:24,weight:"duotone"})})}),(0,b.jsx)("h3",{className:"font-bold text-slate-800 group-hover:text-blue-700 transition-colors",children:c.name}),(c.unit||c.process)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 mb-2",children:[c.unit&&(0,b.jsx)("span",{className:"bg-slate-100 border border-slate-200 px-1.5 py-0.5 rounded text-[9px] font-bold text-slate-600 uppercase tracking-wide",children:c.unit}),c.process&&(0,b.jsxs)("span",{className:"text-[9px] text-slate-400",children:["• ",c.process]})]}),(0,b.jsxs)("p",{className:"text-xs text-slate-500 mt-1 mb-2",children:[e.length," proyectos"]}),(c.startDate||c.endDate)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-[10px] text-slate-400 mb-3",children:[(0,b.jsx)(n.Calendar,{size:12}),(0,b.jsxs)("span",{children:[c.startDate?new Date(c.startDate).toLocaleDateString():"",c.startDate&&c.endDate?" - ":"",c.endDate?new Date(c.endDate).toLocaleDateString():""]})]}),(0,b.jsxs)("div",{className:"mt-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,b.jsx)("span",{className:"text-[10px] text-slate-400 font-bold tracking-wider uppercase",children:"Avance Promedio"}),(0,b.jsxs)("span",{className:`text-[10px] font-bold ${100===f?"text-green-600":"text-slate-600"}`,children:[f,"%"]})]}),(0,b.jsx)("div",{className:"h-1.5 w-full bg-slate-200 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full rounded-full transition-all duration-500 ${100===f?"bg-green-500":"bg-blue-500"}`,style:{width:`${f}%`}})})]})]},c.id)}),E.map(a=>(0,b.jsxs)("div",{onClick:()=>h(a),className:`bg-white rounded-xl border p-5 cursor-pointer hover:shadow-lg transition-all group relative ${i===a.id?"border-purple-500 ring-1 ring-purple-500":"border-slate-200 hover:border-purple-300"}`,children:[v&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),confirm("¿Seguro que deseas eliminar este proyecto?")&&o(a.id)},className:"absolute top-2 right-2 p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10",title:"Eliminar Proyecto",children:(0,b.jsx)(A.Trash,{size:16})}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),r(a.id)},className:"absolute top-2 right-9 p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10 mr-1",title:"Duplicar Proyecto",children:(0,b.jsx)(J.Copy,{size:16})}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation();let c=[];a.phases&&0!==a.phases.length?a.phases.forEach(b=>{b.activities&&0!==b.activities.length?b.activities.forEach(d=>{let e=d.participants?d.participants.map(a=>"object"==typeof a?a.userId:a).join("; "):"";c.push([a.title,b.name,b.status,d.name,d.status||"NOT_STARTED",d.startDate||"",d.endDate||"",e])}):c.push([a.title,b.name,b.status,"","",b.startDate||"",b.endDate||"",""])}):c.push([a.title,"","","","",a.startDate||"",a.endDate||"",""]);let d='<table border="1"><thead><tr>';["Project","Phase","Phase Status","Activity","Activity Status","Start Date","End Date","Participants"].forEach(a=>{d+=`<th style="background-color:#f0f0f0; font-weight:bold;">${a}</th>`}),d+="</tr></thead><tbody>",c.forEach(a=>{d+="<tr>",a.forEach(a=>{d+=`<td>${a||""}</td>`}),d+="</tr>"}),d+="</tbody></table>";let e=new Blob([`
                                            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
                                            <head>
                                                <!--[if gte mso 9]>
                                                <xml>
                                                    <x:ExcelWorkbook>
                                                        <x:ExcelWorksheets>
                                                            <x:ExcelWorksheet>
                                                                <x:Name>Structure</x:Name>
                                                                <x:WorksheetOptions>
                                                                    <x:DisplayGridlines/>
                                                                </x:WorksheetOptions>
                                                            </x:ExcelWorksheet>
                                                        </x:ExcelWorksheets>
                                                    </x:ExcelWorkbook>
                                                </xml>
                                                <![endif]-->
                                                <meta http-equiv="content-type" content="text/plain; charset=UTF-8"/>
                                            </head>
                                            <body>${d}</body>
                                            </html>
                                        `],{type:"application/vnd.ms-excel"}),f=URL.createObjectURL(e),g=document.createElement("a");g.setAttribute("href",f),g.setAttribute("download",`${a.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_structure.xls`),document.body.appendChild(g),g.click(),document.body.removeChild(g)},className:"absolute top-2 right-[76px] p-1.5 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10",title:"Descargar Estructura (.xls)",children:(0,b.jsx)(L.DownloadSimple,{size:16})})]}),(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg transition-colors",style:{backgroundColor:`${a.color||"#9333ea"}20`,color:a.color||"#9333ea"},children:(0,b.jsx)(y.Briefcase,{size:24,weight:"duotone"})}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase ${"ACTIVE"===a.status?"bg-emerald-50 text-emerald-600":"bg-slate-100 text-slate-500"}`,children:a.status})]}),(0,b.jsxs)("div",{className:"mb-3 mt-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,b.jsx)("span",{className:"text-[10px] text-slate-400 font-bold tracking-wider uppercase",children:"Progreso"}),(0,b.jsxs)("span",{className:"text-[10px] font-bold text-slate-600",children:[eL(a),"%"]})]}),(0,b.jsx)("div",{className:"h-1.5 w-full bg-slate-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full rounded-full transition-all",style:{width:`${eL(a)}%`,backgroundColor:a.color||"#9333ea"}})})]}),(0,b.jsx)("h3",{className:"font-bold text-slate-800 mb-1 transition-colors",style:{color:i===a.id?a.color||"#9333ea":void 0},children:a.title}),(0,b.jsx)("p",{className:"text-xs text-slate-500 line-clamp-2 mb-4 h-8",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-xs text-slate-400 border-t border-slate-100 pt-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(n.Calendar,{size:14}),(0,b.jsx)("span",{children:a.startDate?new Date(a.startDate).toLocaleDateString():"-"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.User,{size:14}),(0,b.jsx)("span",{children:a.participants.length})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 ml-auto",children:[(0,b.jsx)(z.Folder,{size:14}),(0,b.jsxs)("span",{children:[a.phases.length," Fases"]})]})]})]},a.id)),0===E.length&&0===F.length&&(0,b.jsxs)("div",{className:"col-span-full text-center py-20 opacity-60",children:[(0,b.jsx)(y.Briefcase,{size:48,className:"mx-auto text-slate-300 mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-slate-700",children:"No hay proyectos"}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Crea un proyecto para comenzar a gestionar fases y documentos."})]})]}),w&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 animate-fadeIn",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl animate-scaleIn",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Editar Carpeta"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Nombre"}),(0,b.jsx)("input",{className:"w-full mt-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 font-bold text-slate-700",value:B.name,onChange:a=>C({...B,name:a.target.value}),autoFocus:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Ubicación"}),(0,b.jsxs)("select",{className:"w-full mt-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium text-slate-700",value:B.parentId||"",onChange:a=>C({...B,parentId:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Raíz (Primer Nivel)"}),(0,b.jsx)("optgroup",{label:"Carpetas Existentes",children:d.filter(a=>!a.parentId&&a.id!==w.id).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Unidad"}),(0,b.jsxs)("select",{className:"w-full mt-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium text-slate-700",value:B.unit||"",onChange:a=>C({...B,unit:a.target.value,process:""}),children:[(0,b.jsx)("option",{value:"",children:"Seleccionar..."}),g.DB.units.filter(a=>a.tenantId===t?.tenantId&&"UNIT"===a.type).map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Proceso"}),(0,b.jsxs)("select",{className:"w-full mt-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium text-slate-700 disabled:bg-slate-100",value:B.process||"",onChange:a=>C({...B,process:a.target.value}),disabled:!B.unit,children:[(0,b.jsx)("option",{value:"",children:"Seleccionar..."}),B.unit&&g.DB.units.filter(a=>a.tenantId===t?.tenantId&&"PROCESS"===a.type&&g.DB.units.find(b=>b.id===a.parentId)?.name===B.unit).map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Color"}),(0,b.jsx)("div",{className:"flex gap-2 mt-2 flex-wrap",children:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#6366f1","#64748b"].map(a=>(0,b.jsx)("button",{onClick:()=>C({...B,color:a}),className:`w-8 h-8 rounded-full border-2 transition-all ${B.color===a?"border-slate-800 scale-110 shadow-md":"border-transparent hover:scale-110"}`,style:{backgroundColor:a}},a))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Inicio"}),(0,b.jsx)("input",{type:"date",className:"w-full mt-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium text-slate-700",value:B.startDate,onChange:a=>C({...B,startDate:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Fin"}),(0,b.jsx)("input",{type:"date",className:"w-full mt-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium text-slate-700",value:B.endDate,onChange:a=>C({...B,endDate:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,b.jsx)("button",{onClick:()=>x(null),className:"px-4 py-2 text-slate-500 hover:text-slate-800 font-bold text-sm",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>{B.name.trim()&&(q(w.id,{name:B.name,color:B.color,startDate:B.startDate,endDate:B.endDate,parentId:B.parentId||void 0,unit:B.unit,process:B.process}),x(null))},className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 shadow-lg shadow-blue-500/30 text-sm",children:"Guardar"})]})]})]})})]})}function eU({project:a,folders:d,onClose:f,onSave:g,currentUser:h,active:j,onRequestAddDoc:k,onRequestAddMember:o,onRequestWorkOnDoc:p}){let{updateProject:q}=(0,e.useApp)(),[r,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(a),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(null);if((0,c.useEffect)(()=>{v(a),a.phases.length>0&&x(a.phases[0].id)},[a]),!j)return null;let B=h?.role==="ADMIN"||h?.role==="superadmin"||h?.role==="Admin Global"||h?.level===1,F=eL(u);return(0,b.jsxs)("div",{className:"w-[700px] bg-white border-l border-slate-200 shadow-2xl flex flex-col overflow-hidden animate-slideLeft z-20 h-full",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-slate-100 bg-slate-50/50 flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsx)("div",{className:"flex-1 mr-4",children:r?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("input",{className:"w-full font-bold text-xl bg-white border border-slate-300 rounded px-2 py-1 outline-none focus:ring-2 focus:ring-purple-500",value:u.title,onChange:a=>v({...u,title:a.target.value})}),(0,b.jsx)("textarea",{className:"w-full text-xs text-slate-600 bg-white border border-slate-300 rounded px-2 py-1 outline-none focus:ring-2 focus:ring-purple-500",rows:2,value:u.description,onChange:a=>v({...u,description:a.target.value})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Carpeta:"}),(0,b.jsxs)("select",{className:"text-xs bg-white border border-slate-300 rounded px-2 py-1 outline-none focus:ring-2 focus:ring-purple-500",value:u.folderId||"",onChange:a=>v({...u,folderId:a.target.value||void 0}),children:[(0,b.jsx)("option",{value:"",children:"-- Sin Carpeta (Raíz) --"}),d.filter(a=>!a.parentId).map(a=>{let c=d.filter(b=>b.parentId===a.id);return(0,b.jsxs)("optgroup",{label:a.name,children:[(0,b.jsxs)("option",{value:a.id,children:[a.name," (Nivel 1)"]}),c.map(a=>(0,b.jsxs)("option",{value:a.id,children:["  └ ",a.name," (Nivel 2)"]},a.id))]},a.id)})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-2 border-t border-slate-100 pt-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-[10px] font-bold text-slate-500 uppercase mb-1",children:"Color de Tarjeta"}),(0,b.jsx)("div",{className:"flex gap-1.5 flex-wrap",children:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#6366f1","#64748b"].map(a=>(0,b.jsx)("button",{onClick:()=>v({...u,color:a}),className:`w-5 h-5 rounded-full border border-slate-200 transition-all ${u.color===a?"ring-2 ring-offset-1 ring-slate-400 scale-110":"hover:scale-110"}`,style:{backgroundColor:a}},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-1",children:"Inicio"}),(0,b.jsx)("input",{type:"date",className:"text-xs bg-white border border-slate-300 rounded px-2 py-1 outline-none focus:ring-2 focus:ring-purple-500 w-full",value:u.startDate?u.startDate.substring(0,10):"",onChange:a=>v({...u,startDate:a.target.value})})]}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-1",children:"Fin"}),(0,b.jsx)("input",{type:"date",className:"text-xs bg-white border border-slate-300 rounded px-2 py-1 outline-none focus:ring-2 focus:ring-purple-500 w-full",value:u.endDate?u.endDate.substring(0,10):"",onChange:a=>v({...u,endDate:a.target.value})})]})]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900 leading-snug",children:u.title}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:u.description})]})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[B&&!r&&(0,b.jsx)("button",{onClick:()=>t(!0),className:"px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-xs font-bold hover:bg-purple-200 transition-colors",children:"Editar"}),r&&(0,b.jsx)("button",{onClick:()=>{q(u.id,u),t(!1),g&&g()},className:"px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-xs font-bold hover:bg-emerald-600 transition-colors shadow-md",children:"Guardar"}),(0,b.jsx)("button",{onClick:f,className:"p-1.5 rounded-full hover:bg-slate-200 transition-colors",children:(0,b.jsx)(l.XCircle,{size:24,className:"text-slate-400"})})]})]}),(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,b.jsx)("span",{className:"font-bold text-slate-500",children:"Progreso Total"}),(0,b.jsxs)("span",{className:"font-bold text-slate-700",children:[F,"%"]})]}),(0,b.jsx)("div",{className:"h-2 w-full bg-slate-200 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-purple-500 to-indigo-500 transition-all duration-500",style:{width:`${F}%`}})})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 bg-slate-50/30",children:[(0,b.jsxs)("section",{children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsxs)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[(0,b.jsx)(i.Kanban,{size:14})," Estructura del Proyecto"]}),r&&(0,b.jsx)("button",{onClick:()=>{let a={id:`ph-${Date.now()}`,name:`Nueva Fase ${u.phases.length+1}`,order:u.phases.length+1,status:"NOT_STARTED",activities:[]};v({...u,phases:[...u.phases,a]}),x(a.id)},className:"text-xs text-purple-600 font-bold hover:underline",children:"+ Agregar Fase"})]}),(0,b.jsx)("div",{className:"space-y-4",children:u.phases.map((a,c)=>{let d=eK(a);return(0,b.jsxs)("div",{className:"bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm",children:[(0,b.jsxs)("div",{className:"bg-slate-50 px-4 py-3 border-b border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-100",onClick:()=>x(w===a.id?null:a.id),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)("div",{className:"w-5 h-5 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-[10px] font-bold",children:c+1}),r?(0,b.jsx)("input",{className:"bg-white border border-slate-300 rounded px-2 py-0.5 text-sm font-bold text-slate-700 outline-none w-48 focus:ring-1 focus:ring-purple-500",value:a.name,onClick:a=>a.stopPropagation(),onChange:a=>{let b=u.phases.map((b,d)=>d===c?{...b,name:a.target.value}:b);v({...u,phases:b})}}):(0,b.jsx)("span",{className:"font-bold text-slate-700 text-sm",children:a.name})]}),(0,b.jsx)("div",{className:"flex items-center gap-4 mr-4",children:(0,b.jsxs)("div",{className:"w-24",children:[(0,b.jsx)("div",{className:"flex justify-between text-[9px] mb-0.5 text-slate-400 font-bold",children:(0,b.jsxs)("span",{children:[d,"%"]})}),(0,b.jsx)("div",{className:"h-1.5 w-full bg-slate-200 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full transition-all duration-500 ${100===d?"bg-green-500":"bg-blue-500"}`,style:{width:`${d}%`}})})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-[10px] text-slate-400 px-2 border-r border-slate-200",children:[a.activities.length," Actividades"]}),(0,b.jsx)(s.CaretRight,{size:14,className:`text-slate-400 transition-transform ${w===a.id?"rotate-90":""}`})]})]}),w===a.id&&(0,b.jsxs)("div",{className:"p-4 bg-slate-50/50 space-y-3",children:[r&&(0,b.jsx)("div",{className:"flex justify-end mb-2",children:(0,b.jsx)("button",{onClick:()=>{var b;let c,d;return b=a.id,c={id:`act-${Date.now()}`,name:"Nueva Actividad",status:"NOT_STARTED",participants:[],documents:[]},d=u.phases.map(a=>a.id===b?{...a,activities:[...a.activities,c]}:a),void(v({...u,phases:d}),z(c.id))},className:"text-[10px] bg-white border border-dashed border-purple-300 text-purple-600 px-3 py-1 rounded-lg hover:bg-purple-50 font-bold",children:"+ Nueva Actividad"})}),a.activities.map((d,e)=>(0,b.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-3 hover:border-blue-300 transition-colors",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[r?(0,b.jsx)("input",{className:"flex-1 font-bold text-sm text-slate-800 bg-transparent border-b border-transparent hover:border-slate-200 outline-none focus:border-purple-500 mr-2",value:d.name,onChange:a=>{let b=u.phases.map((b,d)=>{if(d===c){let c=b.activities.map((b,c)=>c===e?{...b,name:a.target.value}:b);return{...b,activities:c}}return b});v({...u,phases:b})}}):(0,b.jsx)("h4",{className:"flex-1 font-bold text-sm text-slate-800",children:d.name}),r?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("select",{className:"text-[10px] bg-white border border-slate-200 rounded px-1 py-0.5 outline-none focus:border-purple-500 cursor-pointer max-w-[100px]",value:d.status||"NOT_STARTED",onChange:a=>{let b=u.phases.map((b,d)=>{if(d===c){let c=b.activities.map((b,c)=>c===e?{...b,status:a.target.value}:b);return{...b,activities:c}}return b});v({...u,phases:b})},onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("option",{value:"NOT_STARTED",children:"Sin iniciar"}),(0,b.jsx)("option",{value:"IN_PROGRESS",children:"En proceso"}),(0,b.jsx)("option",{value:"COMPLETED",children:"Finalizado"}),(0,b.jsx)("option",{value:"IN_REVIEW",children:"En revisión (QA)"}),(0,b.jsx)("option",{value:"DELIVERED",children:"Entregado"}),(0,b.jsx)("option",{value:"VALIDATED",children:"Validado"})]}),(0,b.jsx)("button",{onClick:()=>{if(confirm("¿Estás seguro de eliminar esta actividad?")){let a=u.phases.map((a,b)=>{if(b===c){let b=a.activities.filter((a,b)=>b!==e);return{...a,activities:b}}return a});v({...u,phases:a})}},className:"text-slate-400 hover:text-rose-500 transition-colors p-1 rounded hover:bg-rose-50",title:"Eliminar Actividad",children:(0,b.jsx)(A.Trash,{size:14})})]}):(0,b.jsx)("span",{className:`text-[9px] px-2 py-0.5 rounded border font-medium whitespace-nowrap
                                                            ${"IN_PROGRESS"===d.status?"bg-blue-50 text-blue-600 border-blue-100":""}
                                                            ${"COMPLETED"===d.status?"bg-green-50 text-green-600 border-green-100":""}
                                                            ${"NOT_STARTED"===d.status||!d.status?"bg-slate-100 text-slate-500 border-slate-200":""}
                                                            ${"IN_REVIEW"===d.status?"bg-amber-50 text-amber-600 border-amber-100":""}
                                                            ${"DELIVERED"===d.status?"bg-teal-50 text-teal-600 border-teal-100":""}
                                                            ${"VALIDATED"===d.status?"bg-purple-50 text-purple-600 border-purple-100":""}
                                                        `,children:d.status&&"NOT_STARTED"!==d.status?"IN_PROGRESS"===d.status?"En proceso":"COMPLETED"===d.status?"Finalizado":"IN_REVIEW"===d.status?"En revisión (QA)":"DELIVERED"===d.status?"Entregado":"VALIDATED"===d.status?"Validado":d.status:"Sin iniciar"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-3 border-b border-slate-50 pb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[(0,b.jsx)(n.Calendar,{size:12}),r?(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("input",{type:"date",className:"w-20 border rounded px-1",value:d.startDate||"",onChange:a=>{let b=u.phases.map((b,d)=>{if(d===c){let c=b.activities.map((b,c)=>c===e?{...b,startDate:a.target.value}:b);return{...b,activities:c}}return b});v({...u,phases:b})}}),(0,b.jsx)("span",{children:"-"}),(0,b.jsx)("input",{type:"date",className:"w-20 border rounded px-1",value:d.endDate||"",onChange:a=>{let b=u.phases.map((b,d)=>{if(d===c){let c=b.activities.map((b,c)=>c===e?{...b,endDate:a.target.value}:b);return{...b,activities:c}}return b});v({...u,phases:b})}})]}):(0,b.jsx)("span",{children:d.startDate?`${new Date(d.startDate).toLocaleDateString()} - ${d.endDate?new Date(d.endDate).toLocaleDateString():"..."}`:"Sin fechas"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 ml-auto",children:[(0,b.jsx)(m.User,{size:12}),(0,b.jsx)("span",{children:d.participants.length}),r&&(0,b.jsx)("button",{onClick:()=>{o({type:"ACTIVITY",phaseId:a.id,activityId:d.id})},className:"text-blue-500 hover:underline ml-1",children:"+ Asignar"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[d.documents.map((f,g)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-slate-50 rounded border border-slate-100",children:[(0,b.jsx)("div",{className:"text-purple-600",children:"URL"===f.type?(0,b.jsx)(E.Link,{size:14}):"EMBED"===f.type?(0,b.jsx)(D.YoutubeLogo,{size:14}):(0,b.jsx)(C.FileText,{size:14})}),(0,b.jsx)("span",{className:"text-xs text-slate-700 flex-1 truncate",children:f.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>p(a.id,d.id,f.id,"VIEW"),className:"text-[10px] text-blue-500 hover:underline",children:"Ver"}),(0,b.jsx)("button",{onClick:()=>p(a.id,d.id,f.id,"WORK"),className:"text-[10px] text-purple-600 hover:text-purple-800 font-bold hover:underline",children:"Trabajar"}),r&&(0,b.jsx)("button",{onClick:()=>{let a=u.phases.map((a,b)=>{if(b===c){let b=a.activities.map((a,b)=>b===e?{...a,documents:a.documents.filter((a,b)=>b!==g)}:a);return{...a,activities:b}}return a});v({...u,phases:a})},className:"text-rose-400 hover:text-rose-600",children:(0,b.jsx)(A.Trash,{size:12})})]})]},f.id)),(0,b.jsx)("button",{onClick:()=>k(a.id,d.id),className:"w-full py-1 text-[10px] text-slate-400 border border-dashed border-slate-200 rounded hover:border-blue-400 hover:text-blue-600 transition-colors",children:"+ Agregar Documento"})]})]},d.id)),0===a.activities.length&&(0,b.jsx)("p",{className:"text-xs text-slate-400 italic text-center py-2",children:"No hay actividades en esta fase."})]})]},a.id)})})]}),(0,b.jsxs)("section",{children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsxs)("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[(0,b.jsx)(m.User,{size:14})," Equipo Global del Proyecto"]}),r&&(0,b.jsx)("button",{onClick:()=>{o({type:"GLOBAL"})},className:"text-xs text-purple-600 font-bold hover:underline",children:"+ Agregar Miembro"})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:u.participants.map((a,c)=>{let d="object"==typeof a?a.userId:a,e="object"==typeof a&&a.role||"Member";return(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-white border border-slate-200 px-3 py-1.5 rounded-full shadow-sm",children:[(0,b.jsx)("span",{className:"w-6 h-6 bg-gradient-to-br from-purple-100 to-indigo-100 text-purple-700 rounded-full flex items-center justify-center text-[10px] font-bold border border-white shadow-sm",children:e.charAt(0)}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("span",{className:"text-[10px] font-bold text-slate-700 leading-tight",children:["User ",d.split("-").pop()]}),(0,b.jsx)("span",{className:"text-[9px] text-slate-400 leading-tight",children:e})]})]},c)})})]})]})]})}function eV({onClose:a,onCreate:d,tenantId:e,folders:f}){let[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)(""),[k,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)("#3b82f6"),[r,s]=(0,c.useState)("");return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden animate-scaleIn flex flex-col max-h-[90vh]",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Nuevo Proyecto"}),(0,b.jsx)("button",{onClick:a,className:"text-slate-400 hover:text-slate-800",children:(0,b.jsx)(l.XCircle,{size:24})})]}),(0,b.jsxs)("div",{className:"p-8 space-y-4 overflow-y-auto",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Nombre del Proyecto"}),(0,b.jsx)("input",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-purple-500",value:g,onChange:a=>h(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Descripción"}),(0,b.jsx)("textarea",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-purple-500",rows:3,value:i,onChange:a=>j(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Ubicación"}),(0,b.jsxs)("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-purple-500 text-sm",value:r,onChange:a=>s(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Carpeta Raíz (Primer Nivel)"}),f.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Color de Tarjeta"}),(0,b.jsx)("div",{className:"flex gap-2 items-center h-[38px]",children:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"].map(a=>(0,b.jsx)("button",{onClick:()=>q(a),className:`w-6 h-6 rounded-full border transition-all ${p===a?"ring-2 ring-offset-1 ring-slate-400 scale-110":"hover:scale-110"}`,style:{backgroundColor:a}},a))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Fecha Inicio"}),(0,b.jsx)("input",{type:"date",className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none",value:k,onChange:a=>m(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Fecha Fin"}),(0,b.jsx)("input",{type:"date",className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none",value:n,onChange:a=>o(a.target.value)})]})]})]}),(0,b.jsxs)("div",{className:"p-6 border-t border-slate-100 bg-slate-50 flex justify-end gap-2",children:[(0,b.jsx)("button",{onClick:a,className:"px-4 py-2 text-slate-500 hover:text-slate-800 font-bold text-sm",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>{d({title:g,description:i,startDate:k,endDate:n,color:p,phases:[{id:"ph-init",name:"Fase 1: Planificación",order:1,status:"NOT_STARTED",activities:[{id:"act-init",name:"Actividad Inicial",status:"NOT_STARTED",participants:[],documents:[]}]}],participants:[],folderId:r||void 0})},className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-bold text-sm shadow-lg shadow-purple-600/20 active:scale-95 transition-all",children:"Crear Proyecto"})]})]})})}function eW({onClose:a,onCreate:d,folders:e}){let[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("#3b82f6"),[q,r]=(0,c.useState)("");return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scaleIn flex flex-col",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Nueva Carpeta"}),(0,b.jsx)("button",{onClick:a,className:"text-slate-400 hover:text-slate-800",children:(0,b.jsx)(l.XCircle,{size:24})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4 overflow-y-auto",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Nombre"}),(0,b.jsx)("input",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:a=>g(a.target.value),autoFocus:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Descripción"}),(0,b.jsx)("textarea",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500",rows:2,value:h,onChange:a=>i(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Ubicación"}),(0,b.jsxs)("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500 text-sm",value:q,onChange:a=>r(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Nivel Principal (Raíz)"}),(0,b.jsx)("optgroup",{label:"Carpetas Existentes",children:e.filter(a=>!a.parentId).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsx)("p",{className:"text-[10px] text-slate-400 mt-1",children:"Selecciona 'Raíz' para primer nivel o una carpeta para segundo nivel."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Color"}),(0,b.jsx)("div",{className:"flex gap-2 items-center flex-wrap",children:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#6366f1","#64748b"].map(a=>(0,b.jsx)("button",{onClick:()=>p(a),className:`w-8 h-8 rounded-full border transition-all ${o===a?"ring-2 ring-offset-1 ring-slate-400 scale-110 shadow-md":"hover:scale-110"}`,style:{backgroundColor:a}},a))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Fecha Inicio"}),(0,b.jsx)("input",{type:"date",className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none",value:j,onChange:a=>k(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Fecha Fin"}),(0,b.jsx)("input",{type:"date",className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-2 outline-none",value:m,onChange:a=>n(a.target.value)})]})]})]}),(0,b.jsxs)("div",{className:"p-6 border-t border-slate-100 bg-slate-50 flex justify-end gap-2",children:[(0,b.jsx)("button",{onClick:a,className:"px-4 py-2 text-slate-500 hover:text-slate-800 font-bold text-sm",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>{f.trim()&&d({name:f,description:h,startDate:j,endDate:m,color:o,parentId:q||void 0})},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-600/20 active:scale-95 transition-all",children:"Crear Carpeta"})]})]})})}function eX({onClose:a,onAdd:e,tenantId:f}){let h=g.DB.tenants.find(a=>a.id===f)?.storageConfig,[i,k]=(0,c.useState)("REPO"),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)({url:"",name:""}),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(""),w=(0,c.useMemo)(()=>g.DB.docs.filter(a=>a.tenantId===f&&"APPROVED"===a.status&&a.title.toLowerCase().includes(m.toLowerCase())),[f,m]),y=()=>{let a={id:`pdoc-${Date.now()}`},b=null;if("REPO"===i){if(!o)return;b={...a,name:o.title,type:"URL",content:`repo://${o.id}`}}else if("URL"===i){if(!q.name||!q.url)return;b={...a,name:q.name,type:"URL",content:q.url}}else if("UPLOAD"===i){if(!s)return;let c=new FileReader;c.onload=c=>{let d=c.target?.result;e(b={...a,name:s.name,type:"FILE",content:d})},c.readAsDataURL(s);return}else if("EMBED"===i){if(!u)return;let c=u.match(/src="([^"]+)"/),d=c?c[1]:u;b={...a,name:"Recurso Embebido",type:"EMBED",content:d}}else"STORAGE"===i&&(b={...a,name:`Cloud Doc - ${h?.provider||"Storage"}`,type:"URL",content:`cloud://${h?.provider||"storage"}/ref`});b&&e(b)};return"undefined"==typeof document?null:(0,d.createPortal)((0,b.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden animate-scaleIn",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"font-bold text-slate-800",children:"Agregar Evidencia / Documento"}),(0,b.jsx)("button",{onClick:a,children:(0,b.jsx)(l.XCircle,{size:24,className:"text-slate-400 hover:text-slate-700"})})]}),(0,b.jsxs)("div",{className:"flex border-b border-slate-100",children:[(0,b.jsx)("button",{onClick:()=>k("REPO"),className:`flex-1 py-3 text-xs font-bold ${"REPO"===i?"text-blue-600 border-b-2 border-blue-600":"text-slate-500 hover:bg-slate-50"}`,children:"Repositorio"}),(0,b.jsx)("button",{onClick:()=>k("URL"),className:`flex-1 py-3 text-xs font-bold ${"URL"===i?"text-blue-600 border-b-2 border-blue-600":"text-slate-500 hover:bg-slate-50"}`,children:"Enlace Externo"}),(0,b.jsx)("button",{onClick:()=>k("UPLOAD"),className:`flex-1 py-3 text-xs font-bold ${"UPLOAD"===i?"text-blue-600 border-b-2 border-blue-600":"text-slate-500 hover:bg-slate-50"}`,children:"Cargar Archivo"}),(0,b.jsx)("button",{onClick:()=>k("EMBED"),className:`flex-1 py-3 text-xs font-bold ${"EMBED"===i?"text-blue-600 border-b-2 border-blue-600":"text-slate-500 hover:bg-slate-50"}`,children:"Embed / Iframe"}),h&&h.enabled&&(0,b.jsx)("button",{onClick:()=>k("STORAGE"),className:`flex-1 py-3 text-xs font-bold ${"STORAGE"===i?"text-blue-600 border-b-2 border-blue-600":"text-slate-500 hover:bg-slate-50"}`,children:h.provider.replace("_"," ")})]}),(0,b.jsxs)("div",{className:"p-6 h-[300px] overflow-y-auto",children:["REPO"===i&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(x.MagnifyingGlass,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{className:"w-full pl-9 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Buscar documento aprobado...",value:m,onChange:a=>n(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[w.map(a=>(0,b.jsxs)("div",{onClick:()=>p(a),className:`p-3 rounded-lg border cursor-pointer transition-all flex items-center gap-3 ${o?.id===a.id?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-300"}`,children:[(0,b.jsx)("div",{className:"p-2 bg-white rounded shadow-sm text-blue-600",children:(0,b.jsx)(C.FileText,{weight:"duotone"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-bold text-slate-800 truncate",children:a.title}),(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:[a.type," • ",a.unit]})]}),o?.id===a.id&&(0,b.jsx)(j.CheckCircle,{weight:"fill",className:"text-blue-600"})]},a.id)),0===w.length&&(0,b.jsx)("div",{className:"text-center text-xs text-slate-400 py-4",children:"No se encontraron documentos"})]})]}),"URL"===i&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Nombre del Recurso"}),(0,b.jsx)("input",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm",placeholder:"Ej: Reporte Financiero Q3",value:q.name,onChange:a=>r({...q,name:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"URL / Enlace"}),(0,b.jsx)("input",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm",placeholder:"https://...",value:q.url,onChange:a=>r({...q,url:a.target.value})})]})]}),"UPLOAD"===i&&(0,b.jsxs)("div",{className:"h-full flex flex-col items-center justify-center border-2 border-dashed border-slate-300 rounded-xl hover:border-blue-400 hover:bg-blue-50/30 transition-all",children:[(0,b.jsx)("input",{type:"file",className:"hidden",id:"file-upload",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif",onChange:a=>t(a.target.files?.[0]||null)}),(0,b.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-center p-6 w-full",children:[(0,b.jsx)(B.Upload,{size:32,className:`mx-auto mb-2 ${s?"text-blue-600":"text-slate-400"}`}),(0,b.jsx)("span",{className:"block text-sm font-bold text-slate-600 mb-1",children:s?s.name:"Haz clic para cargar"}),s?(0,b.jsxs)("span",{className:"block text-xs text-blue-600",children:[(s.size/1024/1024).toFixed(2)," MB"]}):(0,b.jsx)("span",{className:"block text-xs text-slate-400",children:"PDF, DOCX, XLSX, Imágenes (Max 10MB)"})]})]}),"EMBED"===i&&(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Código Embed o URL Embebible"}),(0,b.jsx)("textarea",{className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm h-32 font-mono text-xs outline-none focus:ring-2 focus:ring-blue-500",placeholder:'<iframe src="https://..." ...></iframe> o https://...',value:u,onChange:a=>v(a.target.value)}),(0,b.jsx)("p",{className:"text-[10px] text-slate-400 mt-2",children:"Pega el código completo del iframe (YouTube, Vimeo, Maps, etc.) o la URL directa."})]})}),"STORAGE"===i&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600",children:(0,b.jsx)(M.CloudArrowUp,{size:32})}),(0,b.jsxs)("h3",{className:"text-sm font-bold text-slate-800 mb-1",children:["Importar Evidencia desde ",h?.provider.replace("_"," ")]}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-6 px-8",children:"Selecciona archivos directamente de tu almacenamiento corporativo para vincularlos como entregables."}),(0,b.jsxs)("button",{onClick:y,className:"bg-white border border-slate-200 hover:border-blue-300 hover:text-blue-600 px-6 py-2.5 rounded-lg text-xs font-bold transition-all shadow-sm",children:["Abrir Selector de ",h?.provider.replace("_"," ")]})]})]}),(0,b.jsxs)("div",{className:"p-4 bg-slate-50 border-t border-slate-200 flex justify-end gap-2",children:[(0,b.jsx)("button",{onClick:a,className:"px-4 py-2 text-slate-600 font-bold text-xs hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),(0,b.jsx)("button",{onClick:y,className:"px-6 py-2 bg-blue-600 text-white font-bold text-xs rounded-lg hover:bg-blue-700 transition-colors shadow-lg shadow-blue-600/20 active:scale-95",disabled:"REPO"===i&&!o||"URL"===i&&(!q.name||!q.url)||"UPLOAD"===i&&!s||"EMBED"===i&&!u,children:"Agregar"})]})]})}),document.body)}function eY({onClose:a,onAdd:e,tenantId:f}){let[h,i]=(0,c.useState)(""),[k,m]=(0,c.useState)("ALL"),[n,o]=(0,c.useState)(null),p=(0,c.useMemo)(()=>Array.from(new Set(g.DB.users.filter(a=>a.tenantId===f).map(a=>a.unit))),[f]),q=(0,c.useMemo)(()=>g.DB.users.filter(a=>a.tenantId===f&&"ACTIVE"===a.status&&("ALL"===k||a.unit===k)&&(a.name.toLowerCase().includes(h.toLowerCase())||a.role.toLowerCase().includes(h.toLowerCase()))),[f,h,k]);return"undefined"==typeof document?null:(0,d.createPortal)((0,b.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-xl shadow-2xl overflow-hidden animate-scaleIn flex flex-col max-h-[80vh]",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"font-bold text-slate-800",children:"Agregar Miembro"}),(0,b.jsx)("button",{onClick:a,children:(0,b.jsx)(l.XCircle,{size:24,className:"text-slate-400 hover:text-slate-700"})})]}),(0,b.jsxs)("div",{className:"p-4 border-b border-slate-100 bg-slate-50 space-y-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(x.MagnifyingGlass,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{className:"w-full pl-9 pr-3 py-2 bg-white border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Buscar por nombre o rol...",value:h,onChange:a=>i(a.target.value)})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v.Funnel,{className:"text-slate-400",size:16}),(0,b.jsxs)("select",{className:"flex-1 bg-white border border-slate-200 rounded-lg py-1.5 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500",value:k,onChange:a=>m(a.target.value),children:[(0,b.jsx)("option",{value:"ALL",children:"Todas las Áreas"}),p.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[q.map(a=>(0,b.jsxs)("div",{onClick:()=>o(a),className:`p-3 rounded-lg border cursor-pointer flex items-center gap-3 transition-colors ${n?.id===a.id?"bg-blue-50 border-blue-500":"bg-white border-slate-100 hover:bg-slate-50"}`,children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-600",children:a.initials}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-bold text-slate-800",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-slate-500",children:[a.role," • ",a.unit]})]}),n?.id===a.id&&(0,b.jsx)(j.CheckCircle,{weight:"fill",className:"text-blue-600",size:20})]},a.id)),0===q.length&&(0,b.jsx)("p",{className:"text-center text-xs text-slate-400 py-8",children:"No se encontraron usuarios."})]}),(0,b.jsxs)("div",{className:"p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-2",children:[(0,b.jsx)("button",{onClick:a,className:"px-4 py-2 text-slate-600 font-bold text-xs hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>n&&e(n),disabled:!n,className:"px-6 py-2 bg-blue-600 text-white font-bold text-xs rounded-lg hover:bg-blue-700 transition-colors shadow-lg shadow-blue-600/20 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:"Agregar"})]})]})}),document.body)}function eZ({project:a,target:f,onClose:g,onUpdate:h}){let[i,m]=(0,c.useState)("WORK"===f.mode),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),[s,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(null),[D,E]=(0,c.useState)(null),[F,H]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)("UPLOAD"),[P,Q]=(0,c.useState)(""),{currentUser:R}=(0,e.useApp)(),S=R?.id||"anonymous",[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(null);(0,c.useEffect)(()=>{D&&(m(!0),setTimeout(()=>{document.getElementById(`comment-${D}`)?.scrollIntoView({behavior:"smooth",block:"center"})},100))},[D]);let[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),_=a.phases.find(a=>a.id===f.phaseId),aa=_?.activities.find(a=>a.id===f.activityId),ab=aa?.documents.find(a=>a.id===f.docId);if(!ab||!_||!aa)return null;(0,c.useEffect)(()=>{U(ab.content||""),W(null)},[ab.content]);let ac=b=>{let c={...ab,comments:ab.comments?.map(a=>a.id===b?{...a,resolved:!a.resolved}:a)},d={...a},e=d.phases.findIndex(a=>a.id===_.id),f=d.phases[e].activities.findIndex(a=>a.id===aa.id),g=d.phases[e].activities[f].documents.findIndex(a=>a.id===ab.id);d.phases[e].activities[f].documents[g]=c,h(d),h(d)},ad=async()=>{try{let a=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}),b=document.createElement("video");b.srcObject=a,b.play(),setTimeout(()=>{let c=document.createElement("canvas");c.width=b.videoWidth,c.height=b.videoHeight,c.getContext("2d")?.drawImage(b,0,0),H(c.toDataURL("image/png")),m(!0),a.getTracks().forEach(a=>a.stop())},300)}catch(a){console.error("Screen capture skipped",a)}},ae=()=>{if(!s.trim()&&!F)return;let b={id:`c-${Date.now()}`,userId:R?.id||"anonymous",userName:R?.name||"Usuario",authorId:R?.id||"anonymous",authorName:R?.name||"Usuario",createdAt:new Date().toISOString(),content:s,reference:w||(y?`P\xe1g ${y.page}`:"General"),position:y||void 0,date:new Date().toISOString(),likes:0,attachment:F||void 0},c={...ab,comments:[...ab.comments||[],b]},d={...a},e=d.phases.findIndex(a=>a.id===_.id),f=d.phases[e].activities.findIndex(a=>a.id===aa.id),g=d.phases[e].activities[f].documents.findIndex(a=>a.id===ab.id);d.phases[e].activities[f].documents[g]=c,h(d),v(""),x(""),z(null),H(null)},af=b=>{let c=a.phases.map(a=>{if(a.id===_.id){let c=a.activities.map(a=>a.id===aa.id?{...a,documents:a.documents.map(a=>a.id===ab.id?b:a)}:a);return{...a,activities:c}}return a});h({...a,phases:c})},ag=T.startsWith("http"),ah=T.startsWith("data:"),ai=ag&&(T.toLowerCase().endsWith(".pdf")||T.includes(".pdf"))||ah&&T.startsWith("data:application/pdf")||ab.name.toLowerCase().endsWith(".pdf");return"undefined"==typeof document?null:(0,d.createPortal)((0,b.jsxs)("div",{className:"fixed inset-0 z-[200] flex flex-col bg-slate-900 animate-fadeIn h-screen w-screen overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-white border-b border-slate-200 px-4 py-2 flex justify-between items-center shadow-sm z-30",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("button",{onClick:g,className:"p-2 hover:bg-slate-100 rounded-full text-slate-500",children:(0,b.jsx)(r.ArrowRight,{size:20,className:"rotate-180"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,b.jsx)(C.FileText,{weight:"duotone",className:"text-blue-600"}),ab.name]}),(0,b.jsxs)("p",{className:"text-[10px] text-slate-500",children:["WORK"===f.mode?"Editando en línea":"Visualizando documento"," • v",ab.versions?.length||0]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["WORK"===f.mode&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:ad,title:"Capturar Pantalla y Comentar",className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg flex items-center gap-2 transition-colors mr-2 border border-slate-200",children:[(0,b.jsx)(G,{size:18,className:"text-purple-600"}),(0,b.jsx)("span",{className:"text-xs font-bold text-purple-700 hidden sm:inline",children:"Capturar"})]}),(0,b.jsxs)("button",{onClick:()=>M(!0),className:"px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 bg-purple-100 text-purple-700 hover:bg-purple-200",children:[(0,b.jsx)(I.Bell,{size:16})," Notificar"]})]}),(0,b.jsxs)("button",{onClick:()=>o(!n),className:`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 ${n?"bg-purple-100 text-purple-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[(0,b.jsx)(k.Clock,{size:16})," Historial"]}),"WORK"===f.mode&&(0,b.jsxs)("button",{onClick:()=>m(!i),className:`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 ${i?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[(0,b.jsx)(t.ChatCircle,{size:16})," Comentarios"]}),(0,b.jsx)("button",{onClick:()=>{if(ah){let a=document.createElement("a");a.href=ab.content||"",a.download=ab.name,a.click()}else window.open(ab.content||"","_blank")},className:"px-3 py-1.5 bg-slate-800 text-white rounded-lg text-xs font-bold hover:bg-black transition-colors",children:ah?"Descargar":"Abrir Original"})]})]}),(0,b.jsxs)("div",{className:"flex-1 flex overflow-hidden relative",children:[(0,b.jsxs)("div",{className:"flex-1 bg-slate-100 relative overflow-hidden flex flex-col items-center justify-center",children:[null!==V&&(0,b.jsxs)("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[50] bg-yellow-100 text-yellow-800 px-4 py-1.5 rounded-full text-xs font-bold border border-yellow-200 shadow-sm flex items-center gap-2",children:[(0,b.jsx)(k.Clock,{})," Viendo versión histórica ",V,(0,b.jsx)("button",{onClick:()=>{U(ab.content||""),W(null)},className:"ml-2 hover:underline",children:"Volver a actual"})]}),ai?(0,b.jsx)(eJ,{url:T,comments:ab.comments||[],onCommentClick:E,selectedCommentId:D||void 0,onCanvasClick:a=>{z(a),i||m(!0)},pendingMarker:y}):(()=>{if(T.startsWith("data:image/")||ag&&T.match(/\.(jpg|jpeg|png|gif|webp)$/i))return(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center p-8",children:(0,b.jsx)("img",{src:T,alt:ab.name,className:"max-w-full max-h-full object-contain shadow-2xl rounded-lg"})});if(ab.name.match(/\.(pptx|docx|xlsx|doc|ppt|xls)$/i)||T.match(/\.(pptx|docx|xlsx|doc|ppt|xls)$/i)){let a=T;if(T.startsWith("data:")||T.startsWith("blob:")||!T.startsWith("http")){let b=ab.name.toLowerCase();a=b.includes("doc")||b.includes("word")?"https://www.filesampleshub.com/download/document/docx/sample1.docx":b.includes("xls")||b.includes("sheet")?"https://www.filesampleshub.com/download/document/xlsx/sample1.xlsx":"https://www.filesampleshub.com/download/document/pptx/sample1.pptx"}return(0,b.jsx)("iframe",{src:`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(a)}`,className:"w-full h-full bg-white shadow-2xl",title:"Office Document Preview"})}return ag&&!T.startsWith("data:")?(0,b.jsx)("iframe",{src:T,className:"w-full h-full bg-white shadow-2xl",title:"Document Preview"}):(0,b.jsxs)("div",{className:"text-center p-10 max-w-md",children:[(0,b.jsx)(C.FileText,{size:64,className:"mx-auto text-slate-300 mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-slate-600",children:"Vista previa no disponible"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mb-6",children:"Este archivo no se puede previsualizar aquí. Usa el botón de descarga."}),(0,b.jsx)("a",{href:T,download:ab.name,target:"_blank",rel:"noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold",children:"Descargar Archivo"})]})})()]}),i&&(0,b.jsxs)("div",{className:"w-[350px] bg-slate-50 border-l border-slate-200 flex flex-col shadow-xl z-20 animate-slideLeft",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-slate-200 bg-white flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"font-bold text-slate-700 text-sm",children:"Comentarios"}),(0,b.jsx)("span",{className:"text-xs bg-slate-100 px-2 py-1 rounded-full text-slate-500",children:ab.comments?.length||0})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(!ab.comments||0===ab.comments.length)&&(0,b.jsxs)("div",{className:"text-center py-20 text-slate-400",children:[(0,b.jsx)("p",{className:"text-sm",children:"No hay comentarios aún."}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Selecciona texto o escribe abajo para comentar."})]}),ab.comments?.map(a=>(0,b.jsxs)("div",{id:`comment-${a.id}`,className:`group relative rounded-xl p-4 transition-all duration-300 cursor-pointer
                                            ${D===a.id?"bg-blue-50 border-2 border-blue-500 ring-4 ring-blue-100 shadow-xl scale-[1.02] z-10":"bg-white border border-slate-200 shadow-sm hover:shadow-md hover:border-blue-300"}
                                            ${a.resolved?"opacity-60 grayscale":"border-l-4 border-l-blue-500"}
                                        `,onClick:()=>E(a.id),children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white flex items-center justify-center text-[10px] font-bold",children:a.userName.substring(0,1)}),(0,b.jsx)("span",{className:"text-xs font-bold text-slate-800",children:a.userName}),a.resolved&&(0,b.jsx)("span",{className:"text-[9px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded-full uppercase font-bold",children:"Resuelto"})]}),(0,b.jsx)("span",{className:"text-[10px] text-slate-400",children:new Date(a.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),a.reference&&"General"!==a.reference&&(0,b.jsxs)("div",{className:"mb-2 px-2 py-1 bg-yellow-50 border-l-2 border-yellow-400 text-[10px] text-slate-600 italic",children:['"',a.reference,'"']}),(0,b.jsx)("p",{className:"text-sm text-slate-700 leading-relaxed",children:a.content}),a.attachment&&(0,b.jsx)("div",{className:"mt-2 group/img relative inline-block",children:(0,b.jsx)("img",{src:a.attachment,alt:"Adjunto",onClick:b=>{b.stopPropagation(),K(a.attachment)},className:"max-w-full h-auto rounded border border-slate-200 shadow-sm cursor-zoom-in hover:brightness-95 transition-all"})}),!a.resolved&&(0,b.jsxs)("div",{className:"mt-3 pt-2 border-t border-slate-50 flex justify-between items-center opacity-60 group-hover:opacity-100 transition-opacity",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:b=>{var c;b.stopPropagation(),c=a.userName,v(`@${c} `)},className:"text-[10px] text-slate-500 hover:text-blue-600 font-bold flex items-center gap-1",children:"Responder"}),(0,b.jsxs)("button",{onClick:b=>{b.stopPropagation(),ac(a.id)},className:"text-[10px] text-slate-500 hover:text-green-600 font-bold flex items-center gap-1 ml-2",children:[(0,b.jsx)(j.CheckCircle,{size:12})," Resolver"]})]}),a.userId===S&&(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),(a=>{if(!confirm("¿Estás seguro de eliminar este comentario?"))return;let b=ab.comments?.filter(b=>b.id!==a)||[];af({...ab,comments:b}),D===a&&E(null)})(a.id)},className:"text-[10px] text-slate-400 hover:text-red-600",title:"Eliminar comentario",children:(0,b.jsx)(A.Trash,{size:12,weight:"bold"})})]}),a.resolved&&(0,b.jsx)("div",{className:"mt-2 pt-2 border-t border-slate-100 text-right",children:(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),ac(a.id)},className:"text-[10px] text-slate-400 hover:text-slate-600",children:"Reabrir hilo"})})]},a.id))]}),(0,b.jsxs)("div",{className:"p-4 bg-white border-t border-slate-200 space-y-2",children:[y&&(0,b.jsxs)("div",{className:"px-3 py-2 bg-blue-50 border border-blue-100 text-blue-700 text-xs rounded-lg flex justify-between items-center",children:[(0,b.jsxs)("span",{children:["Agregando marcador en ",(0,b.jsxs)("strong",{children:["Pag ",y.page]})]}),(0,b.jsx)("button",{onClick:()=>z(null),children:(0,b.jsx)(l.XCircle,{size:16})})]}),(0,b.jsx)("input",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs outline-none focus:ring-1 focus:ring-blue-500",placeholder:y?"Referencia (automática)":"Referencia (ej: Pág 2)...",value:w,onChange:a=>x(a.target.value),disabled:!!y}),F&&(0,b.jsxs)("div",{className:"relative mb-2 inline-block group",children:[(0,b.jsx)("img",{src:F,className:"h-20 rounded border border-slate-300 object-cover"}),(0,b.jsx)("button",{onClick:()=>H(null),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-md hover:bg-red-600 transition-colors",children:(0,b.jsx)(l.XCircle,{size:12,weight:"fill"})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("textarea",{className:"w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm outline-none focus:ring-1 focus:ring-blue-500 pr-10 resize-none",rows:2,placeholder:"Escribe un comentario...",value:s,onChange:a=>v(a.target.value),onPaste:a=>{for(let b of a.clipboardData.items)if(0===b.type.indexOf("image")){let a=b.getAsFile(),c=new FileReader;c.onload=a=>{H(a.target?.result)},c.readAsDataURL(a)}},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),ae())}}),(0,b.jsx)("button",{onClick:ae,className:`absolute right-2 bottom-2 p-1.5 ${s.trim()||F?"bg-blue-600 hover:bg-blue-700":"bg-slate-300 cursor-not-allowed"} text-white rounded-lg transition-colors`,disabled:!s.trim()&&!F,children:(0,b.jsx)(u.Paperclip,{size:16})})]})]})]})]}),n&&(0,b.jsxs)("div",{className:"absolute top-14 right-4 w-80 bg-white rounded-xl shadow-2xl border border-slate-200 z-50 animate-scaleIn origin-top-right",children:[(0,b.jsxs)("div",{className:"p-3 border-b border-slate-100 bg-slate-50 flex justify-between items-center",children:[(0,b.jsx)("h4",{className:"font-bold text-xs text-slate-700 uppercase",children:"Historial de Versiones"}),(0,b.jsx)("button",{onClick:()=>o(!1),children:(0,b.jsx)(l.XCircle,{size:16,className:"text-slate-400"})})]}),(0,b.jsxs)("div",{className:"max-h-60 overflow-y-auto p-2",children:[ab.versions?.map((a,c)=>(0,b.jsxs)("div",{onClick:()=>{U(a.content),W(a.version)},className:`mb-4 pb-4 border-b border-slate-100 last:border-0 last:pb-0 cursor-pointer p-2 rounded-lg transition-colors
                                            ${V===a.version?"bg-yellow-50 border border-yellow-200":"hover:bg-slate-50"}
                                        `,children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-bold text-xs text-slate-700",children:["Versión ",a.version]}),(0,b.jsx)("p",{className:"text-[10px] text-slate-400",children:new Date(a.date).toLocaleString()})]}),(0,b.jsx)("span",{className:"text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-500",children:a.author})]}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:a.changeLog})]},c)),(!ab.versions||0===ab.versions.length)&&(0,b.jsx)("p",{className:"text-xs text-slate-400 text-center py-4",children:"Versión inicial"})]}),"WORK"===f.mode&&(0,b.jsx)("button",{onClick:()=>q(!0),className:"w-full mt-4 p-2 bg-purple-600 text-white text-[10px] font-bold rounded-lg hover:bg-purple-700 transition-all shadow-sm",children:"+ Cargar Nueva Versión"})]}),p&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/50 z-[60] flex items-center justify-center animate-fadeIn",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-sm rounded-xl shadow-2xl p-6 animate-scaleIn",children:[(0,b.jsx)("h3",{className:"font-bold text-lg text-slate-800 mb-4",children:"Cargar Nueva Versión"}),(0,b.jsxs)("div",{className:"flex border-b border-slate-200 mb-4",children:[(0,b.jsx)("button",{onClick:()=>O("UPLOAD"),className:`flex-1 py-2 text-xs font-bold border-b-2 transition-colors ${"UPLOAD"===N?"border-purple-600 text-purple-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:"Subir Archivo"}),(0,b.jsx)("button",{onClick:()=>O("LINK"),className:`flex-1 py-2 text-xs font-bold border-b-2 transition-colors ${"LINK"===N?"border-purple-600 text-purple-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:"Enlace Externo"}),(0,b.jsx)("button",{onClick:()=>O("EMBED"),className:`flex-1 py-2 text-xs font-bold border-b-2 transition-colors ${"EMBED"===N?"border-purple-600 text-purple-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:"Embed / Iframe"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:["UPLOAD"===N&&(0,b.jsxs)("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-6 text-center hover:bg-slate-50 transition-colors relative",children:[(0,b.jsx)("input",{type:"file",accept:".pdf,image/*,.doc,.docx,.xls,.xlsx",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:a=>{let b=a.target.files?.[0];if(b){let a=new FileReader;a.onload=a=>{Y(a.target?.result)},a.readAsDataURL(b)}}}),(0,b.jsx)(B.Upload,{size:32,className:"mx-auto text-slate-400 mb-2"}),(0,b.jsx)("p",{className:"text-sm font-bold text-slate-600",children:X&&X.startsWith("data:")?"Archivo seleccionado":"Haz clic para subir un archivo"}),(0,b.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"PDF, Imágenes, Office"})]}),"LINK"===N&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500",children:"Nuevo Enlace / URL"}),(0,b.jsx)("input",{className:"w-full mt-1 border border-slate-300 rounded-lg px-3 py-2 text-sm",placeholder:"https://...",value:X,onChange:a=>Y(a.target.value)})]}),"EMBED"===N&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500",children:"Código Embed / Iframe"}),(0,b.jsx)("textarea",{className:"w-full mt-1 border border-slate-300 rounded-lg px-3 py-2 text-sm font-mono text-xs",placeholder:'<iframe src="..."></iframe>',rows:3,value:P,onChange:a=>Q(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-bold text-slate-500",children:"Notas de Cambio"}),(0,b.jsx)("textarea",{className:"w-full mt-1 border border-slate-300 rounded-lg px-3 py-2 text-sm",placeholder:"Descripción de cambios...",rows:2,value:Z,onChange:a=>$(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,b.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 text-slate-500 text-xs font-bold hover:bg-slate-100 rounded-lg",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>{let a="";if("LINK"===N){if(!X)return;a=X}else if("EMBED"===N){if(!P)return;let b=P.match(/src="([^"]+)"/);a=b?b[1]:P}else if("UPLOAD"===N){if(!X)return;a=X}if(!a)return;let b={version:(ab.versions?.length||0)+1,content:a,date:new Date().toISOString(),author:R?.name||"Admin User",changeLog:Z||"Actualización de documento"};af({...ab,content:a,type:"EMBED"===N?"EMBED":ab.type,versions:[b,...ab.versions||[]]}),q(!1),Y(""),Q(""),$("")},className:"px-4 py-2 bg-purple-600 text-white text-xs font-bold rounded-lg hover:bg-purple-700",children:"Guardar Versión"})]})]})}),L&&(0,d.createPortal)((0,b.jsx)("div",{className:"fixed inset-0 z-[400] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-scaleIn",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-purple-50",children:[(0,b.jsxs)("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,b.jsx)(I.Bell,{className:"text-purple-600",weight:"fill"})," Notificar Novedad"]}),(0,b.jsx)("button",{onClick:()=>M(!1),className:"text-slate-400 hover:text-slate-600",children:(0,b.jsx)(l.XCircle,{size:20})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Destinatario (Equipo)"}),(0,b.jsxs)("select",{className:"w-full text-sm bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-purple-500",children:[(0,b.jsx)("option",{value:"",children:"Seleccionar miembro..."}),(0,b.jsx)("option",{value:"1",children:"Javier User (Diseñador)"}),(0,b.jsx)("option",{value:"2",children:"Maria Lead (Project Manager)"}),(0,b.jsx)("option",{value:"3",children:"Carlos Dev (Desarrollador)"}),(0,b.jsx)("option",{value:"all",children:"Todo el equipo"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Mensaje"}),(0,b.jsx)("textarea",{className:"w-full text-sm bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-purple-500 h-24 resize-none",placeholder:"Escribe la novedad sobre el flujo o documento..."})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,b.jsx)("button",{onClick:()=>M(!1),className:"px-4 py-2 text-sm text-slate-500 hover:bg-slate-50 rounded-lg font-medium",children:"Cancelar"}),(0,b.jsx)("button",{onClick:()=>{M(!1),alert("Notificación enviada con éxito")},className:"px-4 py-2 text-sm bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 shadow-md shadow-purple-200",children:"Enviar"})]})]})]})}),document.body),J&&(0,d.createPortal)((0,b.jsxs)("div",{className:"fixed inset-0 z-[300] bg-black/90 flex items-center justify-center p-10 animate-fadeIn",onClick:()=>K(null),children:[(0,b.jsx)("button",{onClick:()=>K(null),className:"absolute top-5 right-5 text-white/50 hover:text-white transition-colors",children:(0,b.jsx)(l.XCircle,{size:40})}),(0,b.jsx)("img",{src:J,className:"max-w-full max-h-full rounded-lg shadow-2xl animate-scaleIn object-contain",onClick:a=>a.stopPropagation()})]}),document.body)]}),document.body)}a.s(["default",()=>eM],72668)}];

//# sourceMappingURL=_ba6e38b3._.js.map