{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/proxy.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nconst PUBLIC_PATHS = [\n  '/',\n  '/features',\n  '/pricing',\n  '/login',\n  '/api/tenants',\n  '/api/auth',\n  '/api/health',\n];\n\nconst PUBLIC_PATH_PREFIXES = [\n  '/_next',\n  '/static',\n  '/favicon',\n  '/api/',\n];\n\nfunction isPublicPath(pathname: string): boolean {\n  if (PUBLIC_PATHS.includes(pathname)) return true;\n  if (PUBLIC_PATH_PREFIXES.some(prefix => pathname.startsWith(prefix))) return true;\n  if (pathname.match(/^\\/(demo|alpha|beta|[a-z0-9-]+)$/)) return true;\n  return false;\n}\n\nfunction extractTenantSlug(pathname: string): string | null {\n  const match = pathname.match(/^\\/([a-z0-9-]+)\\//);\n  if (match && !['dashboard', 'admin', 'api', '_next', 'static', 'features', 'pricing', 'login', 'auth'].includes(match[1])) {\n    return match[1];\n  }\n  return null;\n}\n\nexport default function proxy(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const host = request.headers.get('host') || '';\n  \n  const response = NextResponse.next();\n  \n  const tenantSlug = extractTenantSlug(pathname);\n  if (tenantSlug) {\n    response.headers.set('x-tenant-slug', tenantSlug);\n  }\n  \n  const isMainDomain = host.includes('maturity.online') || host.includes('localhost') || host.includes('replit');\n  response.headers.set('x-is-main-domain', isMainDomain ? 'true' : 'false');\n  \n  if (isPublicPath(pathname)) {\n    return response;\n  }\n  \n  const sessionCookie = request.cookies.get('m360_session');\n  if (!sessionCookie?.value) {\n    if (pathname.startsWith('/dashboard') || pathname.startsWith('/admin')) {\n      const loginUrl = new URL('/login', request.url);\n      loginUrl.searchParams.set('redirect', pathname);\n      return NextResponse.redirect(loginUrl);\n    }\n  }\n  \n  return response;\n}\n\nexport const config = {\n  matcher: [\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp|ico|css|js|woff|woff2|ttf|eot)$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,MAAM,eAAe;IACnB;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,MAAM,uBAAuB;IAC3B;IACA;IACA;IACA;CACD;AAED,SAAS,aAAa,QAAgB;IACpC,IAAI,aAAa,QAAQ,CAAC,WAAW,OAAO;IAC5C,IAAI,qBAAqB,IAAI,CAAC,CAAA,SAAU,SAAS,UAAU,CAAC,UAAU,OAAO;IAC7E,IAAI,SAAS,KAAK,CAAC,qCAAqC,OAAO;IAC/D,OAAO;AACT;AAEA,SAAS,kBAAkB,QAAgB;IACzC,MAAM,QAAQ,SAAS,KAAK,CAAC;IAC7B,IAAI,SAAS,CAAC;QAAC;QAAa;QAAS;QAAO;QAAS;QAAU;QAAY;QAAW;QAAS;KAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,GAAG;QACzH,OAAO,KAAK,CAAC,EAAE;IACjB;IACA,OAAO;AACT;AAEe,SAAS,MAAM,OAAoB;IAChD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAE5C,MAAM,WAAW,8IAAY,CAAC,IAAI;IAElC,MAAM,aAAa,kBAAkB;IACrC,IAAI,YAAY;QACd,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACxC;IAEA,MAAM,eAAe,KAAK,QAAQ,CAAC,sBAAsB,KAAK,QAAQ,CAAC,gBAAgB,KAAK,QAAQ,CAAC;IACrG,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB,eAAe,SAAS;IAEjE,IAAI,aAAa,WAAW;QAC1B,OAAO;IACT;IAEA,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC1C,IAAI,CAAC,eAAe,OAAO;QACzB,IAAI,SAAS,UAAU,CAAC,iBAAiB,SAAS,UAAU,CAAC,WAAW;YACtE,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;YACtC,OAAO,8IAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}