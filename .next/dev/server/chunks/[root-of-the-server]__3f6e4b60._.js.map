{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/shared/schema.ts"],"sourcesContent":["import { pgTable, text, varchar, integer, timestamp, boolean, json, serial } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\n\nexport const tenants = pgTable(\"tenants\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  name: text(\"name\").notNull(),\n  slug: varchar(\"slug\", { length: 255 }).notNull().unique(),\n  domains: json(\"domains\").$type<string[]>().default([]),\n  status: varchar(\"status\", { length: 50 }).notNull().default(\"ACTIVE\"),\n  timezone: varchar(\"timezone\", { length: 100 }).default(\"UTC\"),\n  locale: varchar(\"locale\", { length: 20 }).default(\"es\"),\n  branding: json(\"branding\").$type<Record<string, unknown>>().default({}),\n  policies: json(\"policies\").$type<Record<string, unknown>>().default({}),\n  ssoConfig: json(\"sso_config\").$type<Record<string, unknown>>(),\n  storageConfig: json(\"storage_config\").$type<Record<string, unknown>>(),\n  integrations: json(\"integrations\").$type<Record<string, unknown>[]>().default([]),\n  features: json(\"features\").$type<string[]>().default([]),\n  sector: varchar(\"sector\", { length: 255 }),\n  contactName: varchar(\"contact_name\", { length: 255 }),\n  contactEmail: varchar(\"contact_email\", { length: 255 }),\n  contactPhone: varchar(\"contact_phone\", { length: 100 }),\n  users: integer(\"users\").default(0),\n  storage: varchar(\"storage\", { length: 50 }).default(\"0 GB\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  name: text(\"name\").notNull(),\n  email: varchar(\"email\", { length: 255 }),\n  role: varchar(\"role\", { length: 100 }).notNull(),\n  level: integer(\"level\").default(1),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  unit: varchar(\"unit\", { length: 255 }),\n  initials: varchar(\"initials\", { length: 10 }),\n  bio: text(\"bio\"),\n  phone: varchar(\"phone\", { length: 50 }),\n  location: varchar(\"location\", { length: 255 }),\n  jobTitle: varchar(\"job_title\", { length: 255 }),\n  language: varchar(\"language\", { length: 20 }).default(\"es\"),\n  timezone: varchar(\"timezone\", { length: 100 }),\n  status: varchar(\"status\", { length: 50 }).notNull().default(\"ACTIVE\"),\n  avatar: text(\"avatar\"),\n  password: text(\"password\"),\n  mustChangePassword: boolean(\"must_change_password\").default(false),\n  inviteSentAt: timestamp(\"invite_sent_at\"),\n  inviteExpiresAt: timestamp(\"invite_expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const units = pgTable(\"units\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  name: text(\"name\").notNull(),\n  parentId: varchar(\"parent_id\", { length: 255 }),\n  managerId: varchar(\"manager_id\", { length: 255 }),\n  level: integer(\"level\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  title: text(\"title\").notNull(),\n  content: text(\"content\"),\n  category: varchar(\"category\", { length: 255 }),\n  unitId: varchar(\"unit_id\", { length: 255 }),\n  ownerId: varchar(\"owner_id\", { length: 255 }),\n  status: varchar(\"status\", { length: 50 }).default(\"DRAFT\"),\n  version: integer(\"version\").default(1),\n  tags: json(\"tags\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const conversations = pgTable(\"conversations\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  type: varchar(\"type\", { length: 20 }).notNull().default(\"dm\"),\n  name: text(\"name\"),\n  title: text(\"title\"),\n  participants: json(\"participants\").$type<string[]>().default([]),\n  lastMessage: text(\"last_message\"),\n  lastMessageAt: timestamp(\"last_message_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  conversationId: varchar(\"conversation_id\", { length: 255 }).notNull().references(() => conversations.id),\n  senderId: varchar(\"sender_id\", { length: 255 }).notNull(),\n  body: text(\"body\").notNull(),\n  bodyType: varchar(\"body_type\", { length: 50 }).default(\"text\"),\n  attachments: json(\"attachments\").$type<Record<string, unknown>[]>().default([]),\n  readBy: json(\"read_by\").$type<string[]>().default([]),\n  replyToMessageId: varchar(\"reply_to_message_id\", { length: 255 }),\n  reactions: json(\"reactions\").$type<Record<string, unknown>[]>().default([]),\n  deletedAt: timestamp(\"deleted_at\"),\n  editedAt: timestamp(\"edited_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const workflows = pgTable(\"workflows\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  status: varchar(\"status\", { length: 50 }).default(\"DRAFT\"),\n  ownerId: varchar(\"owner_id\", { length: 255 }),\n  steps: json(\"steps\").$type<Record<string, unknown>[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const surveys = pgTable(\"surveys\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull().references(() => tenants.id),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  status: varchar(\"status\", { length: 50 }).default(\"DRAFT\"),\n  questions: json(\"questions\").$type<Record<string, unknown>[]>().default([]),\n  responses: json(\"responses\").$type<Record<string, unknown>[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const tenantEmailConfigs = pgTable(\"tenant_email_configs\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }),\n  provider: varchar(\"provider\", { length: 50 }).notNull().default(\"SMTP\"),\n  smtpHost: varchar(\"smtp_host\", { length: 255 }),\n  smtpPort: integer(\"smtp_port\").default(587),\n  smtpUser: varchar(\"smtp_user\", { length: 255 }),\n  smtpPasswordEncrypted: text(\"smtp_password_encrypted\"),\n  smtpSecure: boolean(\"smtp_secure\").default(false),\n  fromName: varchar(\"from_name\", { length: 255 }),\n  fromEmail: varchar(\"from_email\", { length: 255 }),\n  replyToEmail: varchar(\"reply_to_email\", { length: 255 }),\n  isEnabled: boolean(\"is_enabled\").default(false),\n  lastTestedAt: timestamp(\"last_tested_at\"),\n  lastTestResult: boolean(\"last_test_result\"),\n  lastTestError: text(\"last_test_error\"),\n  createdBy: varchar(\"created_by\", { length: 255 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: serial(\"id\").primaryKey(),\n  tenantId: varchar(\"tenant_id\", { length: 255 }).notNull(),\n  userId: varchar(\"user_id\", { length: 255 }),\n  action: varchar(\"action\", { length: 255 }).notNull(),\n  resource: varchar(\"resource\", { length: 255 }),\n  resourceId: varchar(\"resource_id\", { length: 255 }),\n  details: json(\"details\").$type<Record<string, unknown>>(),\n  ipAddress: varchar(\"ip_address\", { length: 50 }),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const platformAdmins = pgTable(\"platform_admins\", {\n  id: varchar(\"id\", { length: 255 }).primaryKey(),\n  name: text(\"name\").notNull(),\n  email: varchar(\"email\", { length: 255 }).notNull().unique(),\n  password: text(\"password\").notNull(),\n  role: varchar(\"role\", { length: 50 }).notNull().default(\"SUPER_ADMIN\"),\n  avatar: text(\"avatar\"),\n  lastLogin: timestamp(\"last_login\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const tenantsRelations = relations(tenants, ({ many }) => ({\n  users: many(users),\n  units: many(units),\n  documents: many(documents),\n  conversations: many(conversations),\n  workflows: many(workflows),\n  surveys: many(surveys),\n}));\n\nexport const usersRelations = relations(users, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [users.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const unitsRelations = relations(units, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [units.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const documentsRelations = relations(documents, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [documents.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\nexport const conversationsRelations = relations(conversations, ({ one, many }) => ({\n  tenant: one(tenants, {\n    fields: [conversations.tenantId],\n    references: [tenants.id],\n  }),\n  messages: many(messages),\n}));\n\nexport const messagesRelations = relations(messages, ({ one }) => ({\n  tenant: one(tenants, {\n    fields: [messages.tenantId],\n    references: [tenants.id],\n  }),\n  conversation: one(conversations, {\n    fields: [messages.conversationId],\n    references: [conversations.id],\n  }),\n}));\n\nexport type Tenant = typeof tenants.$inferSelect;\nexport type InsertTenant = typeof tenants.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = typeof users.$inferInsert;\nexport type Unit = typeof units.$inferSelect;\nexport type InsertUnit = typeof units.$inferInsert;\nexport type Document = typeof documents.$inferSelect;\nexport type InsertDocument = typeof documents.$inferInsert;\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversation = typeof conversations.$inferInsert;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = typeof messages.$inferInsert;\nexport type Workflow = typeof workflows.$inferSelect;\nexport type InsertWorkflow = typeof workflows.$inferInsert;\nexport type Survey = typeof surveys.$inferSelect;\nexport type InsertSurvey = typeof surveys.$inferInsert;\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type InsertAuditLog = typeof auditLogs.$inferInsert;\nexport type PlatformAdmin = typeof platformAdmins.$inferSelect;\nexport type InsertPlatformAdmin = typeof platformAdmins.$inferInsert;\nexport type TenantEmailConfig = typeof tenantEmailConfigs.$inferSelect;\nexport type InsertTenantEmailConfig = typeof tenantEmailConfigs.$inferInsert;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 469, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/server/db.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,EAAE,IAAI,EAAE,GAAG,+GAAE;AAEnB,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MACR;AAEJ;AAEO,MAAM,OAAO,IAAI,KAAK;IAAE,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAAC;AACnE,MAAM,KAAK,IAAA,yKAAO,EAAC,MAAM;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 509, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/services/userService.ts"],"sourcesContent":["import { db } from '@/server/db';\nimport { users, tenants } from '@/shared/schema';\nimport { eq, and } from 'drizzle-orm';\nimport bcrypt from 'bcryptjs';\n\nconst SALT_ROUNDS = 12;\n\nexport interface CreateUserInput {\n  name: string;\n  email: string;\n  password?: string;\n  role: string;\n  tenantId: string;\n  unit?: string;\n  jobTitle?: string;\n  phone?: string;\n  status?: 'ACTIVE' | 'PENDING_INVITE' | 'SUSPENDED';\n  sendInvite?: boolean;\n}\n\nexport interface UserOutput {\n  id: string;\n  name: string;\n  email: string | null;\n  role: string;\n  tenantId: string;\n  unit: string | null;\n  jobTitle: string | null;\n  phone: string | null;\n  status: string;\n  createdAt: Date | null;\n}\n\nfunction generateId(): string {\n  return `user-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nfunction generateTempPassword(): string {\n  const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%';\n  let password = '';\n  for (let i = 0; i < 12; i++) {\n    password += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return password;\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\nexport async function createUser(input: CreateUserInput): Promise<{ success: boolean; user?: UserOutput; tempPassword?: string; error?: string }> {\n  try {\n    const existingUser = await db.select().from(users).where(eq(users.email, input.email));\n    if (existingUser.length > 0) {\n      return { success: false, error: 'Ya existe un usuario con este correo electrónico' };\n    }\n\n    const tempPassword = input.password || generateTempPassword();\n    const hashedPassword = await hashPassword(tempPassword);\n\n    const userId = generateId();\n    const initials = input.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n\n    await db.insert(users).values({\n      id: userId,\n      name: input.name,\n      email: input.email,\n      password: hashedPassword,\n      role: input.role,\n      tenantId: input.tenantId,\n      unit: input.unit || null,\n      jobTitle: input.jobTitle || null,\n      phone: input.phone || null,\n      initials,\n      status: input.status || 'PENDING_INVITE',\n      mustChangePassword: !input.password,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n\n    const [newUser] = await db.select().from(users).where(eq(users.id, userId));\n\n    return {\n      success: true,\n      user: {\n        id: newUser.id,\n        name: newUser.name,\n        email: newUser.email,\n        role: newUser.role,\n        tenantId: newUser.tenantId,\n        unit: newUser.unit,\n        jobTitle: newUser.jobTitle,\n        phone: newUser.phone,\n        status: newUser.status,\n        createdAt: newUser.createdAt,\n      },\n      tempPassword: !input.password ? tempPassword : undefined,\n    };\n  } catch (error: any) {\n    console.error('Error creating user:', error);\n    return { success: false, error: 'Error al crear usuario' };\n  }\n}\n\nexport async function getUsersByTenant(tenantId: string): Promise<UserOutput[]> {\n  try {\n    const result = await db.select().from(users).where(eq(users.tenantId, tenantId));\n    return result.map(u => ({\n      id: u.id,\n      name: u.name,\n      email: u.email,\n      role: u.role,\n      tenantId: u.tenantId,\n      unit: u.unit,\n      jobTitle: u.jobTitle,\n      phone: u.phone,\n      status: u.status,\n      createdAt: u.createdAt,\n    }));\n  } catch (error) {\n    console.error('Error fetching users:', error);\n    return [];\n  }\n}\n\nexport async function getUserById(userId: string): Promise<UserOutput | null> {\n  try {\n    const [user] = await db.select().from(users).where(eq(users.id, userId));\n    if (!user) return null;\n    return {\n      id: user.id,\n      name: user.name,\n      email: user.email,\n      role: user.role,\n      tenantId: user.tenantId,\n      unit: user.unit,\n      jobTitle: user.jobTitle,\n      phone: user.phone,\n      status: user.status,\n      createdAt: user.createdAt,\n    };\n  } catch (error) {\n    console.error('Error fetching user:', error);\n    return null;\n  }\n}\n\nexport async function authenticateUser(email: string, password: string, tenantId?: string): Promise<{ success: boolean; user?: UserOutput; error?: string }> {\n  try {\n    let query;\n    if (tenantId) {\n      query = await db.select().from(users).where(\n        and(eq(users.email, email), eq(users.tenantId, tenantId))\n      );\n    } else {\n      query = await db.select().from(users).where(eq(users.email, email));\n    }\n\n    if (query.length === 0) {\n      return { success: false, error: 'Credenciales inválidas' };\n    }\n\n    const user = query[0];\n\n    if (user.status === 'SUSPENDED') {\n      return { success: false, error: 'Tu cuenta ha sido suspendida' };\n    }\n\n    if (!user.password) {\n      return { success: false, error: 'Credenciales inválidas' };\n    }\n\n    const isValid = await verifyPassword(password, user.password);\n    if (!isValid) {\n      return { success: false, error: 'Credenciales inválidas' };\n    }\n\n    return {\n      success: true,\n      user: {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n        tenantId: user.tenantId,\n        unit: user.unit,\n        jobTitle: user.jobTitle,\n        phone: user.phone,\n        status: user.status,\n        createdAt: user.createdAt,\n      },\n    };\n  } catch (error: any) {\n    console.error('Error authenticating user:', error);\n    return { success: false, error: 'Error de autenticación' };\n  }\n}\n\nexport async function updateUserPassword(userId: string, newPassword: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    const hashedPassword = await hashPassword(newPassword);\n    await db.update(users).set({\n      password: hashedPassword,\n      mustChangePassword: false,\n      updatedAt: new Date(),\n    }).where(eq(users.id, userId));\n    return { success: true };\n  } catch (error: any) {\n    console.error('Error updating password:', error);\n    return { success: false, error: 'Error al actualizar contraseña' };\n  }\n}\n\nexport async function updateUser(userId: string, updates: Partial<{\n  name: string;\n  email: string;\n  role: string;\n  unit: string;\n  jobTitle: string;\n  phone: string;\n  status: string;\n}>): Promise<{ success: boolean; error?: string }> {\n  try {\n    await db.update(users).set({\n      ...updates,\n      updatedAt: new Date(),\n    }).where(eq(users.id, userId));\n    return { success: true };\n  } catch (error: any) {\n    console.error('Error updating user:', error);\n    return { success: false, error: 'Error al actualizar usuario' };\n  }\n}\n\nexport async function deleteUser(userId: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    await db.delete(users).where(eq(users.id, userId));\n    return { success: true };\n  } catch (error: any) {\n    console.error('Error deleting user:', error);\n    return { success: false, error: 'Error al eliminar usuario' };\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 768, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { authenticateUser } from '@/lib/services/userService';\nimport { db } from '@/server/db';\nimport { platformAdmins } from '@/shared/schema';\nimport { eq } from 'drizzle-orm';\nimport bcrypt from 'bcryptjs';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { email, password, tenantId, isSuperAdmin } = body;\n\n    if (!email || !password) {\n      return NextResponse.json({ \n        success: false, \n        error: 'Email y contraseña son requeridos' \n      }, { status: 400 });\n    }\n\n    if (isSuperAdmin) {\n      const [admin] = await db.select().from(platformAdmins).where(eq(platformAdmins.email, email));\n      \n      if (!admin) {\n        return NextResponse.json({ \n          success: false, \n          error: 'Credenciales inválidas' \n        }, { status: 401 });\n      }\n\n      const isValid = await bcrypt.compare(password, admin.password);\n      if (!isValid) {\n        return NextResponse.json({ \n          success: false, \n          error: 'Credenciales inválidas' \n        }, { status: 401 });\n      }\n\n      await db.update(platformAdmins).set({\n        lastLogin: new Date(),\n      }).where(eq(platformAdmins.id, admin.id));\n\n      return NextResponse.json({\n        success: true,\n        user: {\n          id: admin.id,\n          name: admin.name,\n          email: admin.email,\n          role: admin.role,\n          isSuperAdmin: true,\n        },\n      });\n    }\n\n    const result = await authenticateUser(email, password, tenantId);\n\n    if (!result.success) {\n      return NextResponse.json({ \n        success: false, \n        error: result.error \n      }, { status: 401 });\n    }\n\n    return NextResponse.json({\n      success: true,\n      user: result.user,\n    });\n  } catch (error: any) {\n    console.error('Error during login:', error?.message || error);\n    return NextResponse.json({ \n      success: false, \n      error: 'Error en el servidor'\n    }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG;QAEpD,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,IAAI,cAAc;YAChB,MAAM,CAAC,MAAM,GAAG,MAAM,oHAAE,CAAC,MAAM,GAAG,IAAI,CAAC,oIAAc,EAAE,KAAK,CAAC,IAAA,0KAAE,EAAC,oIAAc,CAAC,KAAK,EAAE;YAEtF,IAAI,CAAC,OAAO;gBACV,OAAO,gJAAY,CAAC,IAAI,CAAC;oBACvB,SAAS;oBACT,OAAO;gBACT,GAAG;oBAAE,QAAQ;gBAAI;YACnB;YAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,MAAM,QAAQ;YAC7D,IAAI,CAAC,SAAS;gBACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;oBACvB,SAAS;oBACT,OAAO;gBACT,GAAG;oBAAE,QAAQ;gBAAI;YACnB;YAEA,MAAM,oHAAE,CAAC,MAAM,CAAC,oIAAc,EAAE,GAAG,CAAC;gBAClC,WAAW,IAAI;YACjB,GAAG,KAAK,CAAC,IAAA,0KAAE,EAAC,oIAAc,CAAC,EAAE,EAAE,MAAM,EAAE;YAEvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,MAAM;oBACJ,IAAI,MAAM,EAAE;oBACZ,MAAM,MAAM,IAAI;oBAChB,OAAO,MAAM,KAAK;oBAClB,MAAM,MAAM,IAAI;oBAChB,cAAc;gBAChB;YACF;QACF;QAEA,MAAM,SAAS,MAAM,IAAA,oJAAgB,EAAC,OAAO,UAAU;QAEvD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO,OAAO,KAAK;YACrB,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,OAAO,IAAI;QACnB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB,OAAO,WAAW;QACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;QACT,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}