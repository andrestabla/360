module.exports=[98263,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(82665),e=a.i(50944);let f=(0,c.createContext)(void 0);function g({children:g}){let[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(0),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(0),v=(0,e.useRouter)(),w=l&&d.DB.tenants.find(a=>a.id===l)||null;(0,c.useEffect)(()=>{},[]),(0,c.useEffect)(()=>{},[h,l,n,j,r]);let x=async()=>{if(!h||!l)return void u(0);try{let{ChatService:b}=await a.A(11508),c=(await b.getConversations(h.id,l)).data.reduce((a,b)=>a+(b.unreadCount||0),0);u(c)}catch(a){console.error("Failed to refresh unread count",a)}};(0,c.useEffect)(()=>{x();let a=setInterval(x,1e4);return()=>clearInterval(a)},[h,l]),(0,c.useEffect)(()=>{let a=window.location.hostname,b=a.split("."),c="";b.length>(a.includes("localhost")?1:2)&&(c=b[0]),c&&l&&c.toLowerCase()!==l.toLowerCase()&&(console.warn(`Security: User for ${l} detected on ${c}. Logging out.`),y()),c&&n&&!l&&console.warn("Security: Super Admin detected on Tenant Domain.")},[h,l,n]),(0,c.useEffect)(()=>{if(w&&w.branding){let a=document.documentElement;a.style.setProperty("--primary",w.branding.primary_color),a.style.setProperty("--primary-dark",w.branding.accent_color)}else{let a=document.documentElement;a.style.removeProperty("--primary"),a.style.removeProperty("--primary-dark")}},[w]);let y=()=>{i(null),k(null),m(null),o(!1),v.push("/")};return(0,b.jsx)(f.Provider,{value:{currentUser:h,currentTenantId:l,currentTenant:w,isSuperAdmin:n,version:p,originalSession:j,impersonateUser:(a,b)=>{if(!n||!h)return;let c=d.DB.users.find(c=>c.id===a&&c.tenantId===b);c&&(console.log(`Starting impersonation of ${c.email} by ${h.email}`),k(h),i(c),m(b),o(!1),v.push("/dashboard"),d.DB.platformAudit.unshift({id:`evt-${Date.now()}`,event_type:"IMPERSONATION_STARTED",actor_id:h.id,actor_name:h.name,target_tenant_id:b,target_user_id:a,metadata:{reason:"Support Action"},ip:"127.0.0.1",created_at:new Date().toISOString()}))},stopImpersonation:()=>{j&&(console.log("Stopping impersonation, returning to Superadmin"),i(j),o(!0),m(null),k(null),v.push("/dashboard/tenants"),d.DB.platformAudit.unshift({id:`evt-${Date.now()}`,event_type:"IMPERSONATION_ENDED",actor_id:j.id,actor_name:j.name,metadata:{},ip:"127.0.0.1",created_at:new Date().toISOString()}))},login:(a,b,c)=>{if("superadmin"===a)o(!0),i({name:"Super Admin",role:"Platform Owner",initials:"SA",id:"superadmin",level:0,tenantId:"global",unit:"Global",bio:"Super Admin",email:c||"proyectos@algoritmot.com",phone:"",location:"",jobTitle:"Admin",language:"Es",timezone:"GMT-5",status:"ACTIVE"}),m(null),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"LOGIN_SUCCESS",actor_id:"superadmin",actor_name:"Super Admin",metadata:{role:"SUPER_ADMIN"},ip:"127.0.0.1",created_at:new Date().toISOString()}),v.push("/dashboard/tenants");else if(b){let e;if(o(!1),m(b),c&&(e=d.DB.users.find(a=>a.tenantId===b&&a.email?.toLowerCase()===c.toLowerCase())),e||(e=d.DB.users.find(c=>c.tenantId===b&&("admin"===a?1===c.level:c.level>1))),e){if("SUSPENDED"===e.status)return void d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"LOGIN_FAILED",actor_id:e.id||"unknown",actor_name:e.name||"Unknown",target_tenant_id:b,metadata:{reason:"Account Suspended"},ip:"127.0.0.1",created_at:new Date().toISOString()});if("DELETED"===e.status)return;i(e),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"LOGIN_SUCCESS",actor_id:e.id,actor_name:e.name,target_tenant_id:b,metadata:{role:e.role,level:e.level},ip:"127.0.0.1",created_at:new Date().toISOString()}),v.push("/dashboard")}else console.error("User not found for login simulation")}},logout:y,updateUser:a=>{if(h){let b={...h,...a};i(b);let c=d.DB.users.findIndex(a=>a.id===h.id);c>=0&&(d.DB.users[c]=b,d.DB.save())}},createTenant:a=>{let b=`T${d.DB.tenants.length+1}`,c=new Date().toISOString(),e={id:b,name:a.name||"New Tenant",slug:a.slug||`tenant-${b}`,domains:a.domains||[],status:"ACTIVE",timezone:a.timezone||"America/Bogota",locale:a.locale||"es-CO",branding:{app_title:a.name||"New Tenant",primary_color:"#2563eb",accent_color:"#1d4ed8",updated_at:c,...a.branding},policies:{max_failed_logins:3,lock_minutes:15,file_max_size_bytes:0xa00000,allowed_mime_types:["application/pdf"],audit_retention_days:90,sso_enabled:!1,updated_at:c,...a.policies},roleTemplates:{1:Object.values(d.PERMISSIONS),2:["MANAGE_UNITS","VIEW_ALL_DOCS","UPLOAD_DOCS"],3:["VIEW_ALL_DOCS","UPLOAD_DOCS"],4:["VIEW_ALL_DOCS"],5:["VIEW_ALL_DOCS"],6:[]},users:1,storage:"0 GB",created_at:c,features:a.features||["DASHBOARD","WORKFLOWS","REPOSITORY","CHAT","ANALYTICS"],sector:a.sector,contactName:a.contactName,contactEmail:a.contactEmail,contactPhone:a.contactPhone};d.DB.tenants.push(e);let f=`u-adm-${b}`,g=a.contactEmail||`admin@${e.slug}.com`;return d.DB.users.push({id:f,name:a.contactName||`Admin ${e.name}`,email:g,role:"Admin Global",level:1,tenantId:b,unit:"Root",initials:"AD",bio:"Initial Admin",phone:a.contactPhone||"",location:"Main",jobTitle:"Administrator",language:e.locale,timezone:e.timezone,status:"ACTIVE"}),d.DB.emailOutbox.unshift({id:`email-${Date.now()}`,to:g,subject:"Bienvenido a Maturity360 - Credenciales de Acceso",body:`Hola ${a.contactName||"Admin"},

Tu organizaci\xf3n ${e.name} ha sido registrada exitosamente.

Tus credenciales de acceso son:
URL: https://maturity360.com/login
Usuario: ${g}
Contrase\xf1a Temporal: Temp123!`,status:"SENT",sentAt:c}),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"TENANT_CREATED",actor_id:h?.id||"system",actor_name:h?.name||"System",target_tenant_id:b,metadata:{name:e.name,slug:e.slug,adminEmail:g},ip:"127.0.0.1",created_at:new Date().toISOString()}),d.DB.save(),console.log("Tenant Created:",e),e},updateTenant:(a,b)=>{let c=d.DB.tenants.findIndex(b=>b.id===a);if(c>=0){let e=d.DB.tenants[c],f=Object.keys(b).filter(a=>"branding"!==a&&"policies"!==a);b.branding&&f.push("branding"),b.policies&&f.push("policies"),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:b.status?`TENANT_${b.status}`:"TENANT_UPDATED",actor_id:h?.id||"system",actor_name:h?.name||"System",target_tenant_id:a,metadata:{changes:f,updates:b},ip:"127.0.0.1",created_at:new Date().toISOString()}),d.DB.tenants[c]={...e,...b,branding:b.branding?{...e.branding,...b.branding}:e.branding,policies:b.policies?{...e.policies,...b.policies}:e.policies},d.DB.save()}},deleteTenant:a=>{let b=d.DB.tenants.findIndex(b=>b.id===a);if(b<0)return;let c=d.DB.tenants[b];for(let b=d.DB.users.length-1;b>=0;b--)d.DB.users[b].tenantId===a&&d.DB.users.splice(b,1);for(let b=d.DB.docs.length-1;b>=0;b--)d.DB.docs[b].tenantId===a&&d.DB.docs.splice(b,1);for(let b=d.DB.projects.length-1;b>=0;b--)d.DB.projects[b].tenantId===a&&d.DB.projects.splice(b,1);for(let b=d.DB.posts.length-1;b>=0;b--)d.DB.posts[b].tenantId===a&&d.DB.posts.splice(b,1);for(let b=d.DB.workflowCases.length-1;b>=0;b--)d.DB.workflowCases[b].tenantId===a&&d.DB.workflowCases.splice(b,1);d.DB.tenants.splice(b,1),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"TENANT_DELETED",actor_id:h?.id||"system",actor_name:h?.name||"System",target_tenant_id:a,metadata:{name:c.name,slug:c.slug},ip:"127.0.0.1",created_at:new Date().toISOString()}),q(a=>a+1)},createUnit:a=>{if(!l)return;let b={id:`U-${l}-${Math.floor(1e4*Math.random())}`,tenantId:l,name:a.name||"New Unit",depth:a.depth||0,code:a.code,parentId:a.parentId,ownerId:a.ownerId,description:a.description,members:a.members||[],type:a.type||"UNIT"};d.DB.units.push(b),d.DB.save()},updateUnit:(a,b)=>{let c=d.DB.units.findIndex(b=>b.id===a);c>=0&&(d.DB.units[c]={...d.DB.units[c],...b},d.DB.save())},deleteUnit:a=>{let b=d.DB.units.findIndex(b=>b.id===a);b>=0&&d.DB.units.splice(b,1)},updateLevelPermissions:(a,b)=>{if(!w)return;let c=d.DB.tenants.findIndex(a=>a.id===l);if(c>=0){let e=d.DB.tenants[c];e.roleTemplates={...e.roleTemplates,[a]:b}}},adminCheckEmailUnique:a=>!d.DB.users.some(b=>b.email?.toLowerCase()===a.toLowerCase()),adminCreateUser:(a,b={})=>{let c=`u-${Date.now()}`,e={id:c,tenantId:a.tenantId||l||"global",password:b.customPassword,name:a.name||"Usuario Nuevo",email:a.email,role:a.role||"Analista",level:a.level||6,unit:a.unit||"",initials:(a.name||"U").substring(0,2).toUpperCase(),bio:a.bio||"",phone:a.phone||"",location:a.location||"",jobTitle:a.jobTitle||"Empleado",language:"Es",timezone:"GMT-5",status:a.status||"ACTIVE",mustChangePassword:!0,inviteSentAt:b.sendNotification?new Date().toISOString():void 0,inviteExpiresAt:b.sendNotification?new Date(Date.now()+2592e5).toISOString():void 0};d.DB.users.push(e),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"USER_CREATED",actor_id:h?.id||"system",actor_name:h?.name||"System",target_user_id:c,target_tenant_id:e.tenantId,metadata:{...e,notificationSent:b.sendNotification},ip:"127.0.0.1",created_at:new Date().toISOString()}),d.DB.save(),b.sendNotification&&e.email&&(d.DB.emailOutbox.unshift({id:`email-${Date.now()}`,to:e.email,subject:`Bienvenido a Maturity360 - ${"global"!==e.tenantId?"Tenant Invitation":"Platform Access"}`,body:`Hola ${e.name},

Tu cuenta ha sido creada. Tu contrase\xf1a temporal es: Temp123!
Ingresa en: https://${e.tenantId}.maturity360.com`,status:"SENT",sentAt:new Date().toISOString()}),console.log(`[MockEmail] Sent to ${e.email}`))},adminResendInvite:a=>{let b=d.DB.users.findIndex(b=>b.id===a);if(b>=0){let a=d.DB.users[b],c={...a,inviteSentAt:new Date().toISOString(),inviteExpiresAt:new Date(Date.now()+2592e5).toISOString()};d.DB.users[b]=c,a.email&&d.DB.emailOutbox.unshift({id:`email-${Date.now()}`,to:a.email,subject:"Resend: Bienvenido a Maturity360",body:`Hola ${a.name},

Aqui tienes tu enlace de acceso: https://${a.tenantId}.maturity360.com
Credenciales temporales: Temp123!`,status:"SENT",sentAt:new Date().toISOString()}),d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"USER_INVITE_RESENT",actor_id:h?.id||"system",actor_name:h?.name||"System",target_user_id:a.id,target_tenant_id:a.tenantId,metadata:{email:a.email},ip:"127.0.0.1",created_at:new Date().toISOString()}),d.DB.save()}},adminUpdateUser:(a,b)=>{let c=d.DB.users.findIndex(b=>b.id===a);if(c>=0){let e=d.DB.users[c],f=[];b.role&&b.role!==e.role&&f.push(`Role change: ${e.role} -> ${b.role}`),b.tenantId&&b.tenantId!==e.tenantId&&f.push(`Tenant transfer: ${e.tenantId} -> ${b.tenantId}`),b.status&&b.status!==e.status&&f.push(`Status change: ${e.status} -> ${b.status}`),b.email&&b.email!==e.email&&f.push(`Email update: ${e.email} -> ${b.email}`),b.password&&f.push("Password manually updated"),void 0!==b.mustChangePassword&&b.mustChangePassword!==e.mustChangePassword&&f.push(`Force Password Change: ${b.mustChangePassword?"Enabled":"Disabled"}`),f.length>0&&d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"USER_UPDATED",actor_id:h?.id||"system",actor_name:h?.name||"System",target_user_id:a,target_tenant_id:e.tenantId,metadata:{changes:f,updates:b},ip:"127.0.0.1",created_at:new Date().toISOString()}),d.DB.users[c]={...e,...b},d.DB.save()}},adminDeleteUser:a=>{let b=d.DB.users.findIndex(b=>b.id===a);if(b>=0){let c=d.DB.users[b];if(1===c.level&&"DELETED"!==c.status&&0===d.DB.users.filter(b=>b.tenantId===c.tenantId&&1===b.level&&b.id!==a&&"ACTIVE"===b.status).length)return;let e=c.status;d.DB.users[b]={...c,status:"DELETED"},d.DB.platformAudit.unshift({id:`audit-${Date.now()}`,event_type:"USER_DELETED",actor_id:h?.id||"system",actor_name:h?.name||"System",target_user_id:a,target_tenant_id:c.tenantId,metadata:{previous_status:e},ip:"127.0.0.1",created_at:new Date().toISOString()})}},adminCreatePost:a=>{let b={...a,id:`P-${l}-${Date.now()}`,date:"Ahora",likes:0,commentsCount:0};d.DB.posts.unshift(b),d.DB.save(),q(a=>a+1)},adminUpdatePost:(a,b)=>{let c=d.DB.posts.find(b=>b.id===a);c&&(Object.assign(c,b),d.DB.save(),q(a=>a+1))},adminDeletePost:a=>{let b=d.DB.posts.findIndex(b=>b.id===a);-1!==b&&(d.DB.posts.splice(b,1),d.DB.save(),q(a=>a+1))},adminCreateWorkflow:a=>{if(!l)return;let b={id:`WF-${Date.now()}`,tenantId:l,title:a.title||"Nuevo Proceso",description:a.description||"",unit:a.unit||"",ownerId:a.ownerId,icon:a.icon||"FileText",schema:a.schema||{fields:[]},slaHours:a.slaHours||24,active:!0};d.DB.workflowDefinitions.unshift(b),d.DB.save(),q(a=>a+1)},uploadDoc:a=>{let b={id:`DOC-${l}-${Date.now()}`,date:new Date().toISOString().split("T")[0],likes:0,commentsCount:0,...a};d.DB.docs.unshift(b),d.DB.save(),q(a=>a+1)},updateDoc:(a,b)=>{let c=d.DB.docs.find(b=>b.id===a);c&&(Object.assign(c,b),d.DB.save(),q(a=>a+1))},deleteDoc:a=>{let b=d.DB.docs.findIndex(b=>b.id===a);b>=0&&(d.DB.docs.splice(b,1),d.DB.save(),q(a=>a+1))},toggleDocLike:a=>{let b=d.DB.docs.find(b=>b.id===a);b&&(b.likes>0?b.likes--:b.likes++,d.DB.save(),q(a=>a+1))},addDocComment:(a,b)=>{let c={id:`c-${Date.now()}`,docId:a,authorId:h?.id||"anon",authorName:h?.name||"AnÃ³nimo",content:b,createdAt:new Date().toISOString()};d.DB.publicComments.push(c);let e=d.DB.docs.find(b=>b.id===a);e&&(e.commentsCount=(e.commentsCount||0)+1),d.DB.save(),q(a=>a+1)},createProject:a=>{if(!l)return;let b={id:`PROJ-${Date.now()}`,tenantId:l,title:a.title||"Nuevo Proyecto",description:a.description||"",startDate:a.startDate||new Date().toISOString(),endDate:a.endDate||new Date().toISOString(),status:"PLANNING",creatorId:h?.id||"sys",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),participants:a.participants||[],phases:a.phases||[],folderId:a.folderId,color:a.color};d.DB.projects.unshift(b),d.DB.save(),q(a=>a+1)},updateProject:(a,b)=>{let c=d.DB.projects.findIndex(b=>b.id===a);c>=0&&(d.DB.projects[c]={...d.DB.projects[c],...b,updatedAt:new Date().toISOString()},d.DB.save(),q(a=>a+1))},deleteProject:a=>{let b=d.DB.projects.findIndex(b=>b.id===a);b>=0&&(d.DB.projects.splice(b,1),d.DB.save(),q(a=>a+1))},duplicateProject:a=>{let b=d.DB.projects.find(b=>b.id===a);if(b&&l){let a=Date.now(),c={...b,id:`PROJ-${a}`,title:`${b.title} (Copia)`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"PLANNING",phases:b.phases.map((b,c)=>({...b,id:`ph-${a}-${c}`,status:"NOT_STARTED",activities:b.activities.map((b,d)=>({...b,id:`act-${a}-${c}-${d}`,status:"NOT_STARTED",documents:[]}))}))};d.DB.projects.unshift(c),d.DB.save(),q(a=>a+1)}},createProjectFolder:(a,b)=>{if(!l)return;let c={id:`fld-${l}-${Date.now()}`,tenantId:l,name:a,createdAt:new Date().toISOString(),parentId:b};d.DB.projectFolders.push(c),d.DB.save(),q(a=>a+1)},updateProjectFolder:(a,b)=>{let c=d.DB.projectFolders.findIndex(b=>b.id===a);c>=0&&(d.DB.projectFolders[c]={...d.DB.projectFolders[c],...b},d.DB.save(),q(a=>a+1))},deleteProjectFolder:a=>{let b=d.DB.projectFolders.findIndex(b=>b.id===a);b>=0&&(d.DB.projects.forEach(b=>{b.folderId===a&&delete b.folderId}),d.DB.projectFolders.splice(b,1),d.DB.save(),q(a=>a+1))},isSidebarCollapsed:r,toggleSidebar:()=>s(a=>!a),unreadChatCount:t,refreshUnreadCount:x,updatePlatformSettings:a=>{Object.assign(d.DB.platformSettings,a),d.DB.save(),q(a=>a+1)},createRepoFolder:a=>{if(!l)return;let b={id:`RF-${l}-${Date.now()}`,tenantId:l,name:a.name||"Nueva Carpeta",description:a.description,parentId:a.parentId||void 0,level:a.level||1,unit:a.unit||"General",process:a.process,color:a.color||"#3b82f6",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};d.DB.repoFolders.push(b),d.DB.save(),q(a=>a+1)},updateRepoFolder:(a,b)=>{let c=d.DB.repoFolders.findIndex(b=>b.id===a);c>=0&&(d.DB.repoFolders[c]={...d.DB.repoFolders[c],...b,updatedAt:new Date().toISOString()},d.DB.save(),q(a=>a+1))},deleteRepoFolder:a=>{let b=d.DB.repoFolders.findIndex(b=>b.id===a);b>=0&&(d.DB.repoFolders.splice(b,1),d.DB.save(),q(a=>a+1))}},children:g})}function h(){let a=(0,c.useContext)(f);if(void 0===a)throw Error("useApp must be used within an AppProvider");return a}a.s(["AppProvider",()=>g,"useApp",()=>h],98263)}];

//# sourceMappingURL=context_AppContext_tsx_7f06e64b._.js.map