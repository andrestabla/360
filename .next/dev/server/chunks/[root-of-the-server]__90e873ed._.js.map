{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/services/sessionToken.edge.ts"],"sourcesContent":["export interface SessionPayload {\n  email: string;\n  isSuperAdmin: boolean;\n  tenantId?: string;\n  tenantSlug?: string;\n  timestamp: number;\n}\n\nfunction getSessionSecret(): string {\n  const secret = process.env.SESSION_SECRET || process.env.EMAIL_ENCRYPTION_KEY;\n  if (!secret) {\n    return 'dev-secret-key-do-not-use-in-production';\n  }\n  return secret;\n}\n\nasync function hmacSign(data: string, secret: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n  const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(data));\n  return Array.from(new Uint8Array(signature))\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('');\n}\n\nexport async function verifySessionTokenEdge(token: string): Promise<SessionPayload | null> {\n  try {\n    const [payloadBase64, signature] = token.split('.');\n    \n    if (!payloadBase64 || !signature) {\n      return null;\n    }\n\n    const secret = getSessionSecret();\n    const expectedSignature = await hmacSign(payloadBase64, secret);\n    \n    if (signature !== expectedSignature) {\n      return null;\n    }\n\n    const decoded = atob(payloadBase64);\n    const payload = JSON.parse(decoded) as SessionPayload;\n    \n    const sessionAge = Date.now() - payload.timestamp;\n    const MAX_SESSION_AGE = 24 * 60 * 60 * 1000;\n    if (sessionAge > MAX_SESSION_AGE) {\n      return null;\n    }\n\n    return payload;\n  } catch {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;AAQA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc,IAAI,QAAQ,GAAG,CAAC,oBAAoB;IAC7E,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IACA,OAAO;AACT;AAEA,eAAe,SAAS,IAAY,EAAE,MAAc;IAClD,MAAM,UAAU,IAAI;IACpB,MAAM,MAAM,MAAM,OAAO,MAAM,CAAC,SAAS,CACvC,OACA,QAAQ,MAAM,CAAC,SACf;QAAE,MAAM;QAAQ,MAAM;IAAU,GAChC,OACA;QAAC;KAAO;IAEV,MAAM,YAAY,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,KAAK,QAAQ,MAAM,CAAC;IACvE,OAAO,MAAM,IAAI,CAAC,IAAI,WAAW,YAC9B,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MACpC,IAAI,CAAC;AACV;AAEO,eAAe,uBAAuB,KAAa;IACxD,IAAI;QACF,MAAM,CAAC,eAAe,UAAU,GAAG,MAAM,KAAK,CAAC;QAE/C,IAAI,CAAC,iBAAiB,CAAC,WAAW;YAChC,OAAO;QACT;QAEA,MAAM,SAAS;QACf,MAAM,oBAAoB,MAAM,SAAS,eAAe;QAExD,IAAI,cAAc,mBAAmB;YACnC,OAAO;QACT;QAEA,MAAM,UAAU,KAAK;QACrB,MAAM,UAAU,KAAK,KAAK,CAAC;QAE3B,MAAM,aAAa,KAAK,GAAG,KAAK,QAAQ,SAAS;QACjD,MAAM,kBAAkB,KAAK,KAAK,KAAK;QACvC,IAAI,aAAa,iBAAiB;YAChC,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}}]
}