{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/services/chatService.ts"],"sourcesContent":["import { DB, Conversation, ChatMessage, User } from '../data';\n\nexport interface ChatServiceResponse<T> {\n  success: boolean;\n  data: T;\n  error?: string;\n}\n\nexport const ChatService = {\n  getConversations: async (userId: string, tenantId: string): Promise<ChatServiceResponse<Conversation[]>> => {\n    const conversations = DB.conversations.filter(\n      c => c.tenant_id === tenantId && c.participants.includes(userId)\n    );\n    return { success: true, data: conversations };\n  },\n\n  getConversation: async (conversationId: string): Promise<ChatServiceResponse<Conversation | null>> => {\n    const conversation = DB.conversations.find(c => c.id === conversationId) || null;\n    return { success: true, data: conversation };\n  },\n\n  getMessages: async (conversationId: string): Promise<ChatServiceResponse<ChatMessage[]>> => {\n    const messages = DB.messages.filter(m => m.conversation_id === conversationId);\n    return { success: true, data: messages };\n  },\n\n  sendMessage: async (\n    conversationId: string,\n    senderId: string,\n    body: string,\n    bodyType: 'text' | 'image' | 'file' | 'voice' = 'text'\n  ): Promise<ChatServiceResponse<ChatMessage>> => {\n    const sender = DB.users.find(u => u.id === senderId);\n    const conversation = DB.conversations.find(c => c.id === conversationId);\n    \n    const message: ChatMessage = {\n      id: `msg-${Date.now()}`,\n      tenant_id: conversation?.tenant_id || '',\n      conversation_id: conversationId,\n      sender_id: senderId,\n      body,\n      body_type: bodyType,\n      created_at: new Date().toISOString(),\n      senderName: sender?.name || 'Unknown'\n    };\n\n    DB.messages.push(message);\n\n    if (conversation) {\n      conversation.lastMessage = body;\n      conversation.lastMessageAt = message.created_at;\n    }\n\n    DB.save();\n    return { success: true, data: message };\n  },\n\n  createConversation: async (\n    tenantId: string,\n    type: 'dm' | 'group',\n    participants: string[],\n    name?: string\n  ): Promise<ChatServiceResponse<Conversation>> => {\n    const conversation: Conversation = {\n      id: `conv-${Date.now()}`,\n      tenant_id: tenantId,\n      type,\n      name,\n      participants,\n      createdAt: new Date().toISOString(),\n      unreadCount: 0\n    };\n\n    DB.conversations.push(conversation);\n    DB.save();\n    return { success: true, data: conversation };\n  },\n\n  markAsRead: async (conversationId: string, userId: string): Promise<ChatServiceResponse<boolean>> => {\n    const conversation = DB.conversations.find(c => c.id === conversationId);\n    if (conversation) {\n      conversation.unreadCount = 0;\n    }\n    DB.save();\n    return { success: true, data: true };\n  },\n\n  getUsers: async (tenantId: string): Promise<ChatServiceResponse<User[]>> => {\n    const users = DB.users.filter(u => u.tenantId === tenantId && u.status === 'ACTIVE');\n    return { success: true, data: users };\n  }\n};\n"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,cAAc;IACzB,kBAAkB,OAAO,QAAgB;QACvC,MAAM,gBAAgB,oHAAE,CAAC,aAAa,CAAC,MAAM,CAC3C,CAAA,IAAK,EAAE,SAAS,KAAK,YAAY,EAAE,YAAY,CAAC,QAAQ,CAAC;QAE3D,OAAO;YAAE,SAAS;YAAM,MAAM;QAAc;IAC9C;IAEA,iBAAiB,OAAO;QACtB,MAAM,eAAe,oHAAE,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,mBAAmB;QAC5E,OAAO;YAAE,SAAS;YAAM,MAAM;QAAa;IAC7C;IAEA,aAAa,OAAO;QAClB,MAAM,WAAW,oHAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,eAAe,KAAK;QAC/D,OAAO;YAAE,SAAS;YAAM,MAAM;QAAS;IACzC;IAEA,aAAa,OACX,gBACA,UACA,MACA,WAAgD,MAAM;QAEtD,MAAM,SAAS,oHAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAC3C,MAAM,eAAe,oHAAE,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAEzD,MAAM,UAAuB;YAC3B,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;YACvB,WAAW,cAAc,aAAa;YACtC,iBAAiB;YACjB,WAAW;YACX;YACA,WAAW;YACX,YAAY,IAAI,OAAO,WAAW;YAClC,YAAY,QAAQ,QAAQ;QAC9B;QAEA,oHAAE,CAAC,QAAQ,CAAC,IAAI,CAAC;QAEjB,IAAI,cAAc;YAChB,aAAa,WAAW,GAAG;YAC3B,aAAa,aAAa,GAAG,QAAQ,UAAU;QACjD;QAEA,oHAAE,CAAC,IAAI;QACP,OAAO;YAAE,SAAS;YAAM,MAAM;QAAQ;IACxC;IAEA,oBAAoB,OAClB,UACA,MACA,cACA;QAEA,MAAM,eAA6B;YACjC,IAAI,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;YACxB,WAAW;YACX;YACA;YACA;YACA,WAAW,IAAI,OAAO,WAAW;YACjC,aAAa;QACf;QAEA,oHAAE,CAAC,aAAa,CAAC,IAAI,CAAC;QACtB,oHAAE,CAAC,IAAI;QACP,OAAO;YAAE,SAAS;YAAM,MAAM;QAAa;IAC7C;IAEA,YAAY,OAAO,gBAAwB;QACzC,MAAM,eAAe,oHAAE,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QACzD,IAAI,cAAc;YAChB,aAAa,WAAW,GAAG;QAC7B;QACA,oHAAE,CAAC,IAAI;QACP,OAAO;YAAE,SAAS;YAAM,MAAM;QAAK;IACrC;IAEA,UAAU,OAAO;QACf,MAAM,QAAQ,oHAAE,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,YAAY,EAAE,MAAM,KAAK;QAC3E,OAAO;YAAE,SAAS;YAAM,MAAM;QAAM;IACtC;AACF"}}]
}