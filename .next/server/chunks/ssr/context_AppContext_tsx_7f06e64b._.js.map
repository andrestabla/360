{"version":3,"sources":["../../../../context/AppContext.tsx","../../../../seed_attachments.ts"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { DB, User, Tenant, TenantBranding, TenantPolicy, Unit, PERMISSIONS, Post, Doc, Project, ProjectFolder, RepoFolder, WorkflowDefinition, PlatformSettings } from '@/lib/data';\nimport { seedAttachments } from '@/seed_attachments'; // Import seeder\nimport { useRouter } from 'next/navigation';\n\ninterface AppContextType {\n    currentUser: User | null;\n    currentTenantId: string | null;\n    currentTenant: Tenant | null;\n    version: number;\n    isSuperAdmin: boolean;\n    originalSession: User | null; // For Impersonation\n    impersonateUser: (userId: string, tenantId: string) => void;\n    stopImpersonation: () => void;\n    login: (role: string, tenantId?: string, email?: string) => void;\n    logout: () => void;\n    updateUser: (updates: Partial<User>) => void;\n    createTenant: (data: Omit<Partial<Tenant>, 'branding' | 'policies'> & { branding?: Partial<TenantBranding>, policies?: Partial<TenantPolicy> }) => void;\n    updateTenant: (id: string, updates: Partial<Tenant>) => void;\n    deleteTenant: (id: string) => void;\n    createUnit: (data: Partial<Unit>) => void;\n    updateUnit: (id: string, updates: Partial<Unit>) => void;\n    deleteUnit: (id: string) => void;\n    updateLevelPermissions: (level: number, permissions: string[]) => void;\n    adminCheckEmailUnique: (email: string) => boolean;\n    adminCreateUser: (userData: Partial<User>, options?: { sendNotification?: boolean, customPassword?: string }) => void;\n    adminResendInvite: (userId: string) => void;\n    adminUpdateUser: (userId: string, updates: Partial<User>) => void;\n    adminDeleteUser: (userId: string) => void;\n    // Post Management\n    adminCreatePost: (post: Omit<Post, 'id' | 'date' | 'likes' | 'comments'>) => void;\n    adminUpdatePost: (id: string, updates: Partial<Post>) => void;\n    adminDeletePost: (id: string) => void;\n    // Doc Management (Repository)\n    uploadDoc: (doc: Omit<Doc, 'id' | 'date' | 'likes' | 'commentsCount'>) => void;\n    updateDoc: (id: string, updates: Partial<Doc>) => void;\n    deleteDoc: (id: string) => void;\n    // Social\n    toggleDocLike: (docId: string) => void;\n    addDocComment: (docId: string, content: string) => void;\n    // Projects\n    createProject: (data: Partial<Project>) => void;\n    updateProject: (id: string, updates: Partial<Project>) => void;\n    deleteProject: (id: string) => void;\n    duplicateProject: (id: string) => void;\n    createProjectFolder: (name: string, parentId?: string) => void;\n    updateProjectFolder: (id: string, updates: Partial<ProjectFolder>) => void;\n    deleteProjectFolder: (id: string) => void;\n    // Repo Folders (Repository)\n    createRepoFolder: (data: Partial<RepoFolder>) => void;\n    updateRepoFolder: (id: string, updates: Partial<RepoFolder>) => void;\n    deleteRepoFolder: (id: string) => void;\n    isSidebarCollapsed: boolean;\n    toggleSidebar: () => void;\n    unreadChatCount: number;\n    refreshUnreadCount: () => Promise<void>;\n    adminCreateWorkflow: (data: Partial<WorkflowDefinition>) => void;\n    updatePlatformSettings: (settings: Partial<PlatformSettings>) => void;\n}\n\nconst AppContext = createContext<AppContextType | undefined>(undefined);\n\nexport function AppProvider({ children }: { children: React.ReactNode }) {\n    const [currentUser, setCurrentUser] = useState<User | null>(null);\n    const [originalSession, setOriginalSession] = useState<User | null>(null); // Superadmin backup\n    const [currentTenantId, setCurrentTenantId] = useState<string | null>(null);\n    const [isSuperAdmin, setIsSuperAdmin] = useState(false);\n    const [forceUpdate, setForceUpdate] = useState(0);\n    const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);\n    const [unreadChatCount, setUnreadChatCount] = useState(0);\n    const router = useRouter();\n\n    const currentTenant = currentTenantId ? DB.tenants.find(t => t.id === currentTenantId) || null : null;\n\n    // 1. Persistence: Load from LocalStorage\n    useEffect(() => {\n        if (typeof window !== 'undefined') {\n            const storedUser = localStorage.getItem('m360_user');\n            const storedTenantId = localStorage.getItem('m360_tenant_id');\n            const storedIsSuperAdmin = localStorage.getItem('m360_is_super_admin');\n            const storedOriginalSession = localStorage.getItem('m360_original_session');\n\n            if (storedUser) setCurrentUser(JSON.parse(storedUser));\n            if (storedTenantId) setCurrentTenantId(storedTenantId);\n            if (storedIsSuperAdmin) setIsSuperAdmin(storedIsSuperAdmin === 'true');\n            if (storedOriginalSession) setOriginalSession(JSON.parse(storedOriginalSession));\n\n            const storedSidebar = localStorage.getItem('m360_sidebar_collapsed');\n            if (storedSidebar) setIsSidebarCollapsed(storedSidebar === 'true');\n        }\n    }, []);\n\n    // 2. Persistence: Save to LocalStorage\n    useEffect(() => {\n        if (typeof window !== 'undefined') {\n            if (currentUser) localStorage.setItem('m360_user', JSON.stringify(currentUser));\n            else localStorage.removeItem('m360_user');\n\n            if (currentTenantId) localStorage.setItem('m360_tenant_id', currentTenantId);\n            else localStorage.removeItem('m360_tenant_id');\n\n            if (isSuperAdmin) localStorage.setItem('m360_is_super_admin', 'true');\n            else localStorage.removeItem('m360_is_super_admin');\n\n            if (originalSession) localStorage.setItem('m360_original_session', JSON.stringify(originalSession));\n            else localStorage.removeItem('m360_original_session');\n\n            localStorage.setItem('m360_sidebar_collapsed', isSidebarCollapsed.toString());\n        }\n    }, [currentUser, currentTenantId, isSuperAdmin, originalSession, isSidebarCollapsed]);\n\n    // 3. Unread Chat Count Logic\n    const refreshUnreadCount = async () => {\n        if (!currentUser || !currentTenantId) {\n            setUnreadChatCount(0);\n            return;\n        }\n        try {\n            const { ChatService } = await import('@/lib/services/chatService');\n            const res = await ChatService.getConversations(currentUser.id, currentTenantId);\n            const total = res.data.reduce((sum, conv) => sum + (conv.unreadCount || 0), 0);\n            setUnreadChatCount(total);\n        } catch (e) {\n            console.error(\"Failed to refresh unread count\", e);\n        }\n    };\n\n    useEffect(() => {\n        refreshUnreadCount();\n        const interval = setInterval(refreshUnreadCount, 10000); // Poll every 10s\n        return () => clearInterval(interval);\n    }, [currentUser, currentTenantId]);\n\n\n    // 3. Security: Cross-Domain Validation\n    useEffect(() => {\n        // Load initial state (Mock: Get first tenant/user)\n        // In real app, this comes from Auth provider / API\n\n        // AUTO-SEED FOR VERIFICATION\n        if (typeof window !== 'undefined' && !(window as any).hasSeeded) {\n            console.log('Running Auto-Seeder...');\n            seedAttachments();\n            (window as any).hasSeeded = true;\n        }\n\n        const host = window.location.hostname;\n        const parts = host.split('.');\n        let subdomain = '';\n        if (parts.length > (host.includes('localhost') ? 1 : 2)) {\n            subdomain = parts[0];\n        }\n\n        // Case A: Tenant User on Main Domain -> Invalid\n        // RELAXED FOR PROTOTYPE/DEMO: Allow simulated tenant login on main domain if DNS/Hosts not setup\n        // if (!subdomain && currentTenantId) {\n        //    console.warn('Security: Tenant User detected on Main Domain. Logging out.');\n        //    logout();\n        // }\n\n        // Case B: Tenant User on Wrong Tenant Domain -> Invalid\n        // This is still valid to enforce separation if subdomains ARE used.\n        if (subdomain && currentTenantId && subdomain.toLowerCase() !== currentTenantId.toLowerCase()) {\n            console.warn(`Security: User for ${currentTenantId} detected on ${subdomain}. Logging out.`);\n            logout();\n        }\n\n        // Case C: Super Admin on Tenant Domain (without Impersonation) -> Invalid\n        if (subdomain && isSuperAdmin && !currentTenantId) {\n            // If I am strictly Super Admin (no tenant context) but on a subdomain, \n            // ideally I should be redirected to main, or allowed to login as tenant admin.\n            // For now, warn but maybe don't kill session to prevent loops during dev.\n            console.warn('Security: Super Admin detected on Tenant Domain.');\n            // logout(); // Disabled for smoother dev experience\n        }\n    }, [currentUser, currentTenantId, isSuperAdmin]);\n\n    // Apply Branding\n    useEffect(() => {\n        if (currentTenant && currentTenant.branding) {\n            const root = document.documentElement;\n            root.style.setProperty('--primary', currentTenant.branding.primary_color);\n            root.style.setProperty('--primary-dark', currentTenant.branding.accent_color);\n        } else {\n            const root = document.documentElement;\n            root.style.removeProperty('--primary');\n            root.style.removeProperty('--primary-dark');\n        }\n    }, [currentTenant]);\n\n    const login = (role: string, tenantId?: string, email?: string) => {\n        if (role === 'superadmin') {\n            setIsSuperAdmin(true);\n            const adminUser: User = {\n                name: 'Super Admin',\n                role: 'Platform Owner',\n                initials: 'SA',\n                id: 'superadmin',\n                level: 0,\n                tenantId: 'global',\n                unit: 'Global',\n                bio: 'Super Admin',\n                email: email || 'proyectos@algoritmot.com',\n                phone: '',\n                location: '',\n                jobTitle: 'Admin',\n                language: 'Es',\n                timezone: 'GMT-5',\n                status: 'ACTIVE'\n            };\n            setCurrentUser(adminUser);\n            setCurrentTenantId(null);\n\n            // Audit Log\n            DB.platformAudit.unshift({\n                id: `audit-${Date.now()}`,\n                event_type: 'LOGIN_SUCCESS',\n                actor_id: 'superadmin',\n                actor_name: 'Super Admin',\n                metadata: { role: 'SUPER_ADMIN' },\n                ip: '127.0.0.1',\n                created_at: new Date().toISOString()\n            });\n\n            router.push('/dashboard/tenants');\n        } else if (tenantId) {\n            setIsSuperAdmin(false);\n            setCurrentTenantId(tenantId);\n\n            let user;\n            // 1. Try finding by Email (Exact Match)\n            if (email) {\n                user = DB.users.find(u => u.tenantId === tenantId && u.email?.toLowerCase() === email.toLowerCase());\n            }\n\n            // 2. Fallback to Role-based simulation\n            if (!user) {\n                user = DB.users.find(u => u.tenantId === tenantId && (role === 'admin' ? u.level === 1 : u.level > 1));\n            }\n\n            if (user) {\n                if (user.status === 'SUSPENDED') {\n                    if (typeof window !== 'undefined') alert('Access Denied: Your account has been suspended.');\n\n                    // Audit Log (Failed)\n                    DB.platformAudit.unshift({\n                        id: `audit-${Date.now()}`,\n                        event_type: 'LOGIN_FAILED',\n                        actor_id: user.id || 'unknown',\n                        actor_name: user.name || 'Unknown',\n                        target_tenant_id: tenantId,\n                        metadata: { reason: 'Account Suspended' },\n                        ip: '127.0.0.1',\n                        created_at: new Date().toISOString()\n                    });\n\n                    return;\n                }\n                if (user.status === 'DELETED') {\n                    if (typeof window !== 'undefined') alert('Access Denied: Account not found.');\n                    // console.error('Attempt to login to deleted account');\n                    return;\n                }\n                setCurrentUser(user);\n\n                // Audit Log (Success)\n                DB.platformAudit.unshift({\n                    id: `audit-${Date.now()}`,\n                    event_type: 'LOGIN_SUCCESS',\n                    actor_id: user.id,\n                    actor_name: user.name,\n                    target_tenant_id: tenantId,\n                    metadata: { role: user.role, level: user.level },\n                    ip: '127.0.0.1',\n                    created_at: new Date().toISOString()\n                });\n\n                router.push('/dashboard');\n            } else {\n                console.error('User not found for login simulation');\n            }\n        }\n    };\n\n    const impersonateUser = (userId: string, tenantId: string) => {\n        if (!isSuperAdmin || !currentUser) return;\n\n        const targetUser = DB.users.find(u => u.id === userId && u.tenantId === tenantId);\n        if (targetUser) {\n            console.log(`Starting impersonation of ${targetUser.email} by ${currentUser.email}`);\n            setOriginalSession(currentUser);\n            setCurrentUser(targetUser);\n            setCurrentTenantId(tenantId);\n            setIsSuperAdmin(false); // Temporarily act as regular user\n            router.push('/dashboard');\n\n            // Audit Log\n            DB.platformAudit.unshift({\n                id: `evt-${Date.now()}`,\n                event_type: 'IMPERSONATION_STARTED',\n                actor_id: currentUser.id,\n                actor_name: currentUser.name,\n                target_tenant_id: tenantId,\n                target_user_id: userId,\n                metadata: { reason: 'Support Action' },\n                ip: '127.0.0.1',\n                created_at: new Date().toISOString()\n            });\n        }\n    };\n\n    const stopImpersonation = () => {\n        if (originalSession) {\n            console.log('Stopping impersonation, returning to Superadmin');\n            setCurrentUser(originalSession);\n            setIsSuperAdmin(true);\n            setCurrentTenantId(null);\n            setOriginalSession(null);\n            router.push('/dashboard/tenants');\n\n            // Audit Log\n            DB.platformAudit.unshift({\n                id: `evt-${Date.now()}`,\n                event_type: 'IMPERSONATION_ENDED',\n                actor_id: originalSession.id,\n                actor_name: originalSession.name,\n                metadata: {},\n                ip: '127.0.0.1',\n                created_at: new Date().toISOString()\n            });\n        }\n    };\n\n    const logout = () => {\n        setCurrentUser(null);\n        setOriginalSession(null);\n        setCurrentTenantId(null);\n        setIsSuperAdmin(false);\n        if (typeof window !== 'undefined') {\n            localStorage.removeItem('m360_user');\n            localStorage.removeItem('m360_tenant_id');\n            localStorage.removeItem('m360_is_super_admin');\n            localStorage.removeItem('m360_original_session');\n        }\n        router.push('/');\n    };\n\n    const updateUser = (updates: Partial<User>) => {\n        if (currentUser) {\n            const updated = { ...currentUser, ...updates };\n            setCurrentUser(updated);\n            // Also update in DB\n            const dbIdx = DB.users.findIndex(u => u.id === currentUser.id);\n            if (dbIdx >= 0) {\n                DB.users[dbIdx] = updated;\n                DB.save();\n            }\n        }\n    };\n\n    const createTenant = (data: Omit<Partial<Tenant>, 'branding' | 'policies'> & { branding?: Partial<TenantBranding>, policies?: Partial<TenantPolicy> }) => {\n        const newId = `T${DB.tenants.length + 1}`;\n        const timestamp = new Date().toISOString();\n        const newTenant: Tenant = {\n            id: newId,\n            name: data.name || 'New Tenant',\n            slug: data.slug || `tenant-${newId}`,\n            domains: data.domains || [],\n            status: 'ACTIVE',\n            timezone: data.timezone || 'America/Bogota',\n            locale: data.locale || 'es-CO',\n            branding: {\n                app_title: data.name || 'New Tenant',\n                primary_color: '#2563eb',\n                accent_color: '#1d4ed8',\n                updated_at: timestamp,\n                ...data.branding\n            },\n            policies: {\n                max_failed_logins: 3,\n                lock_minutes: 15,\n                file_max_size_bytes: 10 * 1024 * 1024,\n                allowed_mime_types: ['application/pdf'],\n                audit_retention_days: 90,\n                sso_enabled: false,\n                updated_at: timestamp,\n                ...data.policies\n            },\n            roleTemplates: {\n                1: Object.values(PERMISSIONS),\n                2: ['MANAGE_UNITS', 'VIEW_ALL_DOCS', 'UPLOAD_DOCS'],\n                3: ['VIEW_ALL_DOCS', 'UPLOAD_DOCS'],\n                4: ['VIEW_ALL_DOCS'],\n                5: ['VIEW_ALL_DOCS'],\n                6: []\n            },\n            users: 1, // Only admin initially\n            storage: '0 GB',\n            created_at: timestamp,\n            features: data.features || ['DASHBOARD', 'WORKFLOWS', 'REPOSITORY', 'CHAT', 'ANALYTICS'],\n            sector: data.sector, // Add Sector\n            contactName: data.contactName,\n            contactEmail: data.contactEmail,\n            contactPhone: data.contactPhone\n        };\n\n        DB.tenants.push(newTenant);\n\n        // Generate Initial Admin\n        const adminId = `u-adm-${newId}`;\n        const adminEmail = data.contactEmail || `admin@${newTenant.slug}.com`; // Default if not provided\n        DB.users.push({\n            id: adminId,\n            name: data.contactName || `Admin ${newTenant.name}`,\n            email: adminEmail,\n            role: 'Admin Global',\n            level: 1,\n            tenantId: newId,\n            unit: 'Root',\n            initials: 'AD',\n            bio: 'Initial Admin',\n            phone: data.contactPhone || '',\n            location: 'Main',\n            jobTitle: 'Administrator',\n            language: newTenant.locale,\n            timezone: newTenant.timezone,\n            status: 'ACTIVE'\n        });\n\n        // Email Notification to Admin\n        DB.emailOutbox.unshift({\n            id: `email-${Date.now()}`,\n            to: adminEmail,\n            subject: 'Bienvenido a Maturity360 - Credenciales de Acceso',\n            body: `Hola ${data.contactName || 'Admin'},\\n\\nTu organización ${newTenant.name} ha sido registrada exitosamente.\\n\\nTus credenciales de acceso son:\\nURL: https://maturity360.com/login\\nUsuario: ${adminEmail}\\nContraseña Temporal: Temp123!`,\n            status: 'SENT',\n            sentAt: timestamp\n        });\n\n        // Audit Log\n        DB.platformAudit.unshift({\n            id: `audit-${Date.now()}`,\n            event_type: 'TENANT_CREATED',\n            actor_id: currentUser?.id || 'system',\n            actor_name: currentUser?.name || 'System',\n            target_tenant_id: newId,\n            metadata: { name: newTenant.name, slug: newTenant.slug, adminEmail },\n            ip: '127.0.0.1',\n            created_at: new Date().toISOString()\n        });\n        DB.save();\n\n        console.log('Tenant Created:', newTenant);\n        return newTenant;\n    };\n\n    const updateTenant = (id: string, updates: Omit<Partial<Tenant>, 'branding' | 'policies'> & { branding?: Partial<TenantBranding>, policies?: Partial<TenantPolicy> }) => {\n        const idx = DB.tenants.findIndex(t => t.id === id);\n        if (idx >= 0) {\n            const current = DB.tenants[idx];\n\n            // Audit Log\n            const changes = Object.keys(updates).filter(k => k !== 'branding' && k !== 'policies');\n            if (updates.branding) changes.push('branding');\n            if (updates.policies) changes.push('policies');\n\n            DB.platformAudit.unshift({\n                id: `audit-${Date.now()}`,\n                event_type: updates.status ? `TENANT_${updates.status}` : 'TENANT_UPDATED',\n                actor_id: currentUser?.id || 'system',\n                actor_name: currentUser?.name || 'System',\n                target_tenant_id: id,\n                metadata: { changes, updates },\n                ip: '127.0.0.1',\n                created_at: new Date().toISOString()\n            });\n\n            DB.tenants[idx] = {\n                ...current,\n                ...updates,\n                branding: updates.branding ? { ...current.branding, ...updates.branding } : current.branding,\n                policies: updates.policies ? { ...current.policies, ...updates.policies } : current.policies\n            };\n\n            if (currentTenantId === id) {\n                // Force re-render if needed (though layout update helps)\n            }\n            DB.save();\n        }\n    };\n\n    const deleteTenant = (id: string) => {\n        const idx = DB.tenants.findIndex(t => t.id === id);\n        if (idx < 0) return;\n\n        const tenant = DB.tenants[idx];\n\n        // Cascade Delete\n        // 1. Users\n        for (let i = DB.users.length - 1; i >= 0; i--) {\n            if (DB.users[i].tenantId === id) DB.users.splice(i, 1);\n        }\n        // 2. Docs\n        for (let i = DB.docs.length - 1; i >= 0; i--) {\n            if (DB.docs[i].tenantId === id) DB.docs.splice(i, 1);\n        }\n        // 3. Projects\n        for (let i = DB.projects.length - 1; i >= 0; i--) {\n            if (DB.projects[i].tenantId === id) DB.projects.splice(i, 1);\n        }\n        // 4. Posts\n        for (let i = DB.posts.length - 1; i >= 0; i--) {\n            if (DB.posts[i].tenantId === id) DB.posts.splice(i, 1);\n        }\n        // 5. Workflows\n        for (let i = DB.workflowCases.length - 1; i >= 0; i--) {\n            if (DB.workflowCases[i].tenantId === id) DB.workflowCases.splice(i, 1);\n        }\n\n        // Delete Tenant\n        DB.tenants.splice(idx, 1);\n\n        // Audit Log\n        DB.platformAudit.unshift({\n            id: `audit-${Date.now()}`,\n            event_type: 'TENANT_DELETED',\n            actor_id: currentUser?.id || 'system',\n            actor_name: currentUser?.name || 'System',\n            target_tenant_id: id,\n            metadata: { name: tenant.name, slug: tenant.slug },\n            ip: '127.0.0.1',\n            created_at: new Date().toISOString()\n        });\n\n        setForceUpdate(n => n + 1);\n    };\n\n    const createUnit = (data: Partial<Unit>) => {\n        if (!currentTenantId) return;\n        const newUnit: Unit = {\n            id: `U-${currentTenantId}-${Math.floor(Math.random() * 10000)}`,\n            tenantId: currentTenantId,\n            name: data.name || 'New Unit',\n            depth: data.depth || 0,\n            code: data.code,\n            parentId: data.parentId,\n            ownerId: data.ownerId,\n            description: data.description,\n            members: data.members || [],\n            type: data.type || 'UNIT'\n        };\n        DB.units.push(newUnit);\n        DB.save();\n    };\n\n    const updateUnit = (id: string, updates: Partial<Unit>) => {\n        const idx = DB.units.findIndex(u => u.id === id);\n        if (idx >= 0) {\n            DB.units[idx] = { ...DB.units[idx], ...updates };\n            DB.save();\n        }\n    };\n\n    const deleteUnit = (id: string) => {\n        const idx = DB.units.findIndex(u => u.id === id);\n        if (idx >= 0) {\n            DB.units.splice(idx, 1);\n        }\n    };\n\n    const updateLevelPermissions = (level: number, permissions: string[]) => {\n        if (!currentTenant) return;\n\n        // Update in DB (in memory reference)\n        // Since currentTenant is a reference to DB object (if retrieved via find), modifying it updates DB?\n        // Let's modify DB directly to be safe\n        const idx = DB.tenants.findIndex(t => t.id === currentTenantId);\n        if (idx >= 0) {\n            const tenant = DB.tenants[idx];\n            tenant.roleTemplates = {\n                ...tenant.roleTemplates,\n                [level]: permissions\n            };\n            // Force re-render not needed immediately as we don't display permissions in sidebar yet,\n            // but page will use it.\n        }\n    };\n\n    const adminCheckEmailUnique = (email: string) => {\n        return !DB.users.some(u => u.email?.toLowerCase() === email.toLowerCase());\n    };\n\n    const adminCreateUser = (userData: Partial<User>, options: { sendNotification?: boolean, customPassword?: string } = {}) => {\n        // if (!currentTenantId) return; // Allow if explicit tenantId is passed\n        const userId = `u-${Date.now()}`;\n        const newUser: User = {\n            id: userId,\n            tenantId: userData.tenantId || currentTenantId || 'global',\n            password: options.customPassword, // Explicitly set if manual\n            name: userData.name || 'Usuario Nuevo',\n            email: userData.email,\n            role: userData.role || 'Analista',\n            level: userData.level || 6,\n            unit: userData.unit || '',\n            initials: (userData.name || 'U').substring(0, 2).toUpperCase(),\n            bio: userData.bio || '',\n            phone: userData.phone || '',\n            location: userData.location || '',\n            jobTitle: userData.jobTitle || 'Empleado',\n            language: 'Es',\n            timezone: 'GMT-5',\n            status: userData.status || 'ACTIVE',\n            mustChangePassword: true,\n            inviteSentAt: options.sendNotification ? new Date().toISOString() : undefined,\n            inviteExpiresAt: options.sendNotification ? new Date(Date.now() + 72 * 3600 * 1000).toISOString() : undefined\n        };\n        DB.users.push(newUser);\n\n        // Audit Log\n        DB.platformAudit.unshift({\n            id: `audit-${Date.now()}`,\n            event_type: 'USER_CREATED',\n            actor_id: currentUser?.id || 'system',\n            actor_name: currentUser?.name || 'System',\n            target_user_id: userId,\n            target_tenant_id: newUser.tenantId,\n            metadata: { ...newUser, notificationSent: options.sendNotification },\n            ip: '127.0.0.1',\n            created_at: new Date().toISOString()\n        });\n        DB.save();\n\n        // Email Notification\n        if (options.sendNotification && newUser.email) {\n            DB.emailOutbox.unshift({\n                id: `email-${Date.now()}`,\n                to: newUser.email,\n                subject: `Bienvenido a Maturity360 - ${newUser.tenantId !== 'global' ? 'Tenant Invitation' : 'Platform Access'}`,\n                body: `Hola ${newUser.name},\\n\\nTu cuenta ha sido creada. Tu contraseña temporal es: Temp123!\\nIngresa en: https://${newUser.tenantId}.maturity360.com`,\n                status: 'SENT',\n                sentAt: new Date().toISOString()\n            });\n            console.log(`[MockEmail] Sent to ${newUser.email}`);\n        }\n    };\n\n    const adminUpdateUser = (userId: string, updates: Partial<User>) => {\n        const idx = DB.users.findIndex(u => u.id === userId);\n        if (idx >= 0) {\n            const oldUser = DB.users[idx];\n\n            // Audit Check\n            const auditChanges: string[] = [];\n            if (updates.role && updates.role !== oldUser.role) auditChanges.push(`Role change: ${oldUser.role} -> ${updates.role}`);\n            if (updates.tenantId && updates.tenantId !== oldUser.tenantId) auditChanges.push(`Tenant transfer: ${oldUser.tenantId} -> ${updates.tenantId}`);\n            if (updates.status && updates.status !== oldUser.status) auditChanges.push(`Status change: ${oldUser.status} -> ${updates.status}`);\n            if (updates.email && updates.email !== oldUser.email) auditChanges.push(`Email update: ${oldUser.email} -> ${updates.email}`);\n            if (updates.password) auditChanges.push('Password manually updated');\n            if (updates.mustChangePassword !== undefined && updates.mustChangePassword !== oldUser.mustChangePassword) {\n                auditChanges.push(`Force Password Change: ${updates.mustChangePassword ? 'Enabled' : 'Disabled'}`);\n            }\n\n            if (auditChanges.length > 0) {\n                DB.platformAudit.unshift({\n                    id: `audit-${Date.now()}`,\n                    event_type: 'USER_UPDATED',\n                    actor_id: currentUser?.id || 'system',\n                    actor_name: currentUser?.name || 'System',\n                    target_user_id: userId,\n                    target_tenant_id: oldUser.tenantId, // Log under original context\n                    metadata: { changes: auditChanges, updates },\n                    ip: '127.0.0.1',\n                    created_at: new Date().toISOString()\n                });\n            }\n\n            DB.users[idx] = { ...oldUser, ...updates };\n            DB.save();\n        }\n    };\n\n    const adminDeleteUser = (userId: string) => {\n        const idx = DB.users.findIndex(u => u.id === userId);\n        if (idx >= 0) {\n            const user = DB.users[idx];\n\n            // Integrity Check: Prevent deleting last admin\n            if (user.level === 1 && user.status !== 'DELETED') {\n                const otherAdmins = DB.users.filter(u =>\n                    u.tenantId === user.tenantId &&\n                    u.level === 1 &&\n                    u.id !== userId &&\n                    u.status === 'ACTIVE'\n                );\n                if (otherAdmins.length === 0) {\n                    if (typeof window !== 'undefined') alert('Integrity Error: Cannot delete the last active Admin for this tenant.');\n                    return;\n                }\n            }\n\n            // Soft Delete\n            const oldStatus = user.status;\n            DB.users[idx] = { ...user, status: 'DELETED' };\n\n            // Audit\n            DB.platformAudit.unshift({\n                id: `audit-${Date.now()}`,\n                event_type: 'USER_DELETED',\n                actor_id: currentUser?.id || 'system',\n                actor_name: currentUser?.name || 'System',\n                target_user_id: userId,\n                target_tenant_id: user.tenantId,\n                metadata: { previous_status: oldStatus },\n                ip: '127.0.0.1',\n                created_at: new Date().toISOString()\n            });\n        }\n    };\n\n    const adminResendInvite = (userId: string) => {\n        const idx = DB.users.findIndex(u => u.id === userId);\n        if (idx >= 0) {\n            const user = DB.users[idx];\n            // Update invite data\n            const updated = {\n                ...user,\n                inviteSentAt: new Date().toISOString(),\n                inviteExpiresAt: new Date(Date.now() + 72 * 3600 * 1000).toISOString()\n            };\n            DB.users[idx] = updated;\n\n            // Email Log\n            if (user.email) {\n                DB.emailOutbox.unshift({\n                    id: `email-${Date.now()}`,\n                    to: user.email,\n                    subject: `Resend: Bienvenido a Maturity360`,\n                    body: `Hola ${user.name},\\n\\nAqui tienes tu enlace de acceso: https://${user.tenantId}.maturity360.com\\nCredenciales temporales: Temp123!`,\n                    status: 'SENT',\n                    sentAt: new Date().toISOString()\n                });\n            }\n\n            // Audit\n            DB.platformAudit.unshift({\n                id: `audit-${Date.now()}`,\n                event_type: 'USER_INVITE_RESENT',\n                actor_id: currentUser?.id || 'system',\n                actor_name: currentUser?.name || 'System',\n                target_user_id: user.id,\n                target_tenant_id: user.tenantId,\n                metadata: { email: user.email },\n                ip: '127.0.0.1',\n                created_at: new Date().toISOString()\n            });\n            DB.save();\n        }\n    };\n\n    const adminDeletePost = (id: string) => {\n        const idx = DB.posts.findIndex(p => p.id === id);\n        if (idx !== -1) {\n            DB.posts.splice(idx, 1);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const adminCreatePost = (postData: Omit<Post, 'id' | 'date' | 'likes' | 'commentsCount'>) => {\n        const newPost: Post = {\n            ...postData,\n            id: `P-${currentTenantId}-${Date.now()}`,\n            date: 'Ahora',\n            likes: 0,\n            commentsCount: 0\n        };\n        DB.posts.unshift(newPost);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const adminUpdatePost = (id: string, updates: Partial<Post>) => {\n        const post = DB.posts.find(p => p.id === id);\n        if (post) {\n            Object.assign(post, updates);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n\n    const adminCreateWorkflow = (data: Partial<WorkflowDefinition>) => {\n        if (!currentTenantId) return;\n        const newWorkflow: WorkflowDefinition = {\n            id: `WF-${Date.now()}`,\n            tenantId: currentTenantId,\n            title: data.title || 'Nuevo Proceso',\n            description: data.description || '',\n            unit: data.unit || '',\n            ownerId: data.ownerId,\n            icon: data.icon || 'FileText',\n            schema: data.schema || { fields: [] },\n            slaHours: data.slaHours || 24,\n            active: true\n        };\n        DB.workflowDefinitions.unshift(newWorkflow);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const createProjectFolder = (name: string, parentId?: string) => {\n        if (!currentTenantId) return;\n        const newFolder: ProjectFolder = {\n            id: `fld-${currentTenantId}-${Date.now()}`,\n            tenantId: currentTenantId,\n            name,\n            createdAt: new Date().toISOString(),\n            parentId\n        };\n        DB.projectFolders.push(newFolder);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const createRepoFolder = (data: Partial<RepoFolder>) => {\n        if (!currentTenantId) return;\n        const newFolder: RepoFolder = {\n            id: `RF-${currentTenantId}-${Date.now()}`,\n            tenantId: currentTenantId,\n            name: data.name || 'Nueva Carpeta',\n            description: data.description,\n            parentId: data.parentId || undefined,\n            level: data.level || 1,\n            unit: data.unit || 'General',\n            process: data.process,\n            color: data.color || '#3b82f6',\n            createdAt: new Date().toISOString(),\n            updatedAt: new Date().toISOString()\n        };\n        DB.repoFolders.push(newFolder);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const updateRepoFolder = (id: string, updates: Partial<RepoFolder>) => {\n        const idx = DB.repoFolders.findIndex(f => f.id === id);\n        if (idx >= 0) {\n            DB.repoFolders[idx] = { ...DB.repoFolders[idx], ...updates, updatedAt: new Date().toISOString() };\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const deleteRepoFolder = (id: string) => {\n        const idx = DB.repoFolders.findIndex(f => f.id === id);\n        if (idx >= 0) {\n            DB.repoFolders.splice(idx, 1);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const uploadDoc = (docData: Omit<Doc, 'id' | 'date' | 'likes' | 'commentsCount'>) => {\n        const newDoc: Doc = {\n            id: `DOC-${currentTenantId}-${Date.now()}`,\n            date: new Date().toISOString().split('T')[0],\n            likes: 0,\n            commentsCount: 0,\n            ...docData\n        };\n        DB.docs.unshift(newDoc);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const updateDoc = (id: string, updates: Partial<Doc>) => {\n        const doc = DB.docs.find(d => d.id === id);\n        if (doc) {\n            Object.assign(doc, updates);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const deleteDoc = (id: string) => {\n        const idx = DB.docs.findIndex(d => d.id === id);\n        if (idx >= 0) {\n            DB.docs.splice(idx, 1);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const toggleDocLike = (docId: string) => {\n        const doc = DB.docs.find(d => d.id === docId);\n        if (doc) {\n            if (doc.likes > 0) {\n                doc.likes--;\n            } else {\n                doc.likes++;\n            }\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const addDocComment = (docId: string, content: string) => {\n        const newComment = {\n            id: `c-${Date.now()}`,\n            docId: docId,\n            authorId: currentUser?.id || 'anon',\n            authorName: currentUser?.name || 'Anónimo',\n            content: content,\n            createdAt: new Date().toISOString()\n        };\n        DB.publicComments.push(newComment);\n\n        const doc = DB.docs.find(d => d.id === docId);\n        if (doc) doc.commentsCount = (doc.commentsCount || 0) + 1;\n\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const createProject = (projectData: Partial<Project>) => {\n        if (!currentTenantId) return;\n        const newProject: Project = {\n            id: `PROJ-${Date.now()}`,\n            tenantId: currentTenantId,\n            title: projectData.title || 'Nuevo Proyecto',\n            description: projectData.description || '',\n            startDate: projectData.startDate || new Date().toISOString(),\n            endDate: projectData.endDate || new Date().toISOString(),\n            status: 'PLANNING',\n            creatorId: currentUser?.id || 'sys',\n            createdAt: new Date().toISOString(),\n            updatedAt: new Date().toISOString(),\n            participants: projectData.participants || [],\n            phases: projectData.phases || [],\n            folderId: projectData.folderId,\n            color: projectData.color\n        };\n        DB.projects.unshift(newProject);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    const updateProject = (id: string, updates: Partial<Project>) => {\n        const idx = DB.projects.findIndex(p => p.id === id);\n        if (idx >= 0) {\n            DB.projects[idx] = { ...DB.projects[idx], ...updates, updatedAt: new Date().toISOString() };\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const deleteProject = (id: string) => {\n        const idx = DB.projects.findIndex(p => p.id === id);\n        if (idx >= 0) {\n            DB.projects.splice(idx, 1);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const duplicateProject = (id: string) => {\n        const original = DB.projects.find(p => p.id === id);\n        if (original && currentTenantId) {\n            const timestamp = Date.now();\n            const newProject: Project = {\n                ...original,\n                id: `PROJ-${timestamp}`,\n                title: `${original.title} (Copia)`,\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString(),\n                status: 'PLANNING',\n                phases: original.phases.map((ph, i) => ({\n                    ...ph,\n                    id: `ph-${timestamp}-${i}`,\n                    status: 'NOT_STARTED',\n                    activities: ph.activities.map((act, j) => ({\n                        ...act,\n                        id: `act-${timestamp}-${i}-${j}`,\n                        status: 'NOT_STARTED',\n                        documents: []\n                    }))\n                }))\n            };\n            DB.projects.unshift(newProject);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const updateProjectFolder = (id: string, updates: Partial<ProjectFolder>) => {\n        const idx = DB.projectFolders.findIndex(f => f.id === id);\n        if (idx >= 0) {\n            DB.projectFolders[idx] = { ...DB.projectFolders[idx], ...updates };\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const deleteProjectFolder = (id: string) => {\n        const idx = DB.projectFolders.findIndex(f => f.id === id);\n        if (idx >= 0) {\n            DB.projects.forEach(p => {\n                if (p.folderId === id) delete p.folderId;\n            });\n            DB.projectFolders.splice(idx, 1);\n            DB.save();\n            setForceUpdate(n => n + 1);\n        }\n    };\n\n    const toggleSidebar = () => setIsSidebarCollapsed(v => !v);\n\n    const updatePlatformSettings = (settings: Partial<PlatformSettings>) => {\n        Object.assign(DB.platformSettings, settings);\n        DB.save();\n        setForceUpdate(n => n + 1);\n    };\n\n    return (\n        <AppContext.Provider value={{\n            currentUser, currentTenantId, currentTenant, isSuperAdmin, version: forceUpdate,\n            originalSession, impersonateUser, stopImpersonation,\n            login, logout, updateUser, createTenant, updateTenant, deleteTenant,\n            createUnit, updateUnit, deleteUnit, updateLevelPermissions,\n            adminCheckEmailUnique, adminCreateUser, adminResendInvite, adminUpdateUser, adminDeleteUser,\n            adminCreatePost, adminUpdatePost, adminDeletePost,\n            adminCreateWorkflow,\n            uploadDoc, updateDoc, deleteDoc,\n            toggleDocLike, addDocComment,\n            createProject, updateProject, deleteProject, duplicateProject, createProjectFolder,\n            updateProjectFolder,\n            deleteProjectFolder,\n            isSidebarCollapsed, toggleSidebar,\n            unreadChatCount, refreshUnreadCount,\n            updatePlatformSettings,\n            createRepoFolder,\n            updateRepoFolder,\n            deleteRepoFolder\n        }}>{children}</AppContext.Provider>\n    );\n}\n\nexport function useApp() {\n    const context = useContext(AppContext);\n    if (context === undefined) {\n        throw new Error('useApp must be used within an AppProvider');\n    }\n    return context;\n}\n","import { DB } from '@/lib/data';\n\n// Helper to seed a conversation with attachments to verify rendering\nexport const seedAttachments = () => {\n    const convo = DB.conversations.find(c => c.type === 'dm');\n    if (!convo) return console.log('No DM found to seed');\n    \n    console.log('Seeding attachments to conversation:', convo.id);\n\n    // 1. Image Message\n    DB.messages.push({\n        id: 'MSG-IMG-TEST',\n        tenant_id: 'T1',\n        conversation_id: convo.id,\n        sender_id: convo.participants?.[0] || 'system', // Use first participant\n        body: 'Mira esta imagen',\n        body_type: 'image',\n        created_at: new Date().toISOString(),\n        senderName: 'Test Bot',\n        attachments: [{\n            id: 'ATT-1',\n            tenant_id: 'T1',\n            message_id: 'MSG-IMG-TEST',\n            file_name: 'demo-image.jpg',\n            mime_type: 'image/jpeg',\n            size: 1024 * 500,\n            storage_key: 'mock',\n            url: 'https://picsum.photos/400/300', // External image for verification\n            created_at: new Date().toISOString()\n        }]\n    });\n\n    // 2. File Message\n    DB.messages.push({\n        id: 'MSG-FILE-TEST',\n        tenant_id: 'T1',\n        conversation_id: convo.id,\n        sender_id: convo.participants?.[0] || 'system',\n        body: 'Aquí tienes el reporte',\n        body_type: 'file',\n        created_at: new Date().toISOString(),\n        senderName: 'Test Bot',\n        attachments: [{\n            id: 'ATT-2',\n            tenant_id: 'T1',\n            message_id: 'MSG-FILE-TEST',\n            file_name: 'reporte-anual.pdf',\n            mime_type: 'application/pdf',\n            size: 1024 * 1024 * 2.5,\n            storage_key: 'mock',\n            url: '#', \n            created_at: new Date().toISOString()\n        }]\n    });\n    \n    console.log('Seeded 2 messages with attachments.');\n};\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAyDA,IAAM,EAAa,CAAA,EAAA,EAAA,aAAA,AAAa,OAA6B,GAEtD,SAAS,EAAY,UAAE,CAAQ,CAAiC,EACnE,GAAM,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACtD,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MAC9D,CADqE,AACpE,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAwB,AADyB,MAEzF,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC3C,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,GACzC,CAAC,EAAoB,EAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACvD,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,GACjD,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAElB,EAAgB,GAAkB,EAAA,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,IAAoB,KAG1F,CAAA,CAHiG,CAGjG,EAAA,SAAA,AAAS,EAAC,KAeV,EAAG,EAAE,EAGL,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KAgBV,EAAG,CAAC,EAAa,EAAiB,EAAc,EAAiB,EAAmB,EAGpF,IAAM,EAAqB,UACvB,GAAI,CAAC,GAAe,CAAC,EAAiB,YAClC,EAAmB,GAGvB,GAAI,CACA,GAAM,aAAE,CAAW,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,OAElB,EAAQ,CADF,MAAM,EAAY,gBAAgB,CAAC,EAAY,EAAE,CAAE,EAAA,EAC7C,IAAI,CAAC,MAAM,CAAC,CAAC,EAAK,IAAS,GAAO,EAAK,CAAN,UAAiB,GAAI,CAAC,CAAG,GAC5E,EAAmB,EACvB,CAAE,MAAO,EAAG,CACR,QAAQ,KAAK,CAAC,iCAAkC,EACpD,CACJ,EAEA,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KACN,IACA,IAAM,EAAW,YAAY,EAAoB,KACjD,GADyD,GAClD,IAAM,UAD6D,IAC/C,EAC/B,EAAG,CAAC,EAAa,EAAgB,EAIjC,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAWN,IAAM,EAAO,OAAO,QAAQ,CAAC,QAAQ,CAC/B,EAAQ,EAAK,KAAK,CAAC,KACrB,EAAY,EACZ,GAAM,MAAM,EAAI,CAAD,CAAM,QAAQ,CAAC,aAAe,GAAI,CAAC,GAAG,AACrD,EAAY,CAAK,CAAC,EAAA,AAAE,EAYpB,GAAa,GAAmB,EAAU,WAAW,KAAO,EAAgB,WAAW,IAAI,CAC3F,QAAQ,IAAI,CAAC,CAAC,mBAAmB,EAAE,EAAgB,aAAa,EAAE,EAAU,cAAc,CAAC,EAC3F,KAIA,GAAa,GAAgB,CAAC,GAI9B,QAAQ,IAAI,CAAC,CAJkC,kDAOvD,EAAG,CAAC,EAAa,EAAiB,EAAa,EAG/C,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACN,GAAI,GAAiB,EAAc,QAAQ,CAAE,CACzC,IAAM,EAAO,SAAS,eAAe,CACrC,EAAK,KAAK,CAAC,WAAW,CAAC,YAAa,EAAc,QAAQ,CAAC,aAAa,EACxE,EAAK,KAAK,CAAC,WAAW,CAAC,iBAAkB,EAAc,QAAQ,CAAC,YAAY,CAChF,KAAO,CACH,IAAM,EAAO,SAAS,eAAe,CACrC,EAAK,KAAK,CAAC,cAAc,CAAC,aAC1B,EAAK,KAAK,CAAC,cAAc,CAAC,iBAC9B,CACJ,EAAG,CAAC,EAAc,EAiJlB,IAAM,EAAS,KACX,EAAe,MACf,EAAmB,MACnB,EAAmB,MACnB,GAAgB,GAOhB,EAAO,IAAI,CAAC,IAChB,EAsqBA,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAW,QAAQ,CAAA,CAAC,MAAO,aACxB,kBAAa,gBAAiB,eAAe,EAAc,QAAS,kBACpE,EAAiB,gBAtuBD,CAAC,EAAgB,KACrC,GAAI,CAAC,GAAgB,CAAC,EAAa,OAEnC,IAAM,EAAa,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,GAAU,EAAE,QAAQ,GAAK,GACpE,IACA,QADY,AACJ,GAAG,CAAC,CAAC,0BAA0B,EAAE,EAAW,KAAK,CAAC,IAAI,EAAE,EAAY,KAAK,CAAA,CAAE,EACnF,EAAmB,GACnB,EAAe,GACf,EAAmB,GACnB,GAAgB,GAChB,EAAO,GADiB,CACb,CAAC,cAGZ,EAAA,EAAE,CAAC,aAJuD,AAI1C,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAA,CAAI,CACvB,WAAY,wBACZ,SAAU,EAAY,EAAE,CACxB,WAAY,EAAY,IAAI,CAC5B,iBAAkB,EAClB,eAAgB,EAChB,SAAU,CAAE,OAAQ,gBAAiB,EACrC,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAER,EA6sB0C,kBA3sBhB,KAClB,IACA,QAAQ,GAAG,CAAC,CADK,kDAEjB,EAAe,GACf,GAAgB,GAChB,EAAmB,MACnB,EAAmB,MACnB,EAAO,IAAI,CAAC,sBAGZ,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAA,CAAI,CACvB,WAAY,sBACZ,SAAU,EAAgB,EAAE,CAC5B,WAAY,EAAgB,IAAI,CAChC,SAAU,CAAC,EACX,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAER,EAwrBQ,MAr0BM,CAAC,EAAc,EAAmB,KAC5C,GAAI,AAAS,cAAc,GACvB,EAAgB,IAkBhB,EAjBwB,CACpB,KAAM,OAgBK,OAfX,KAAM,iBACN,SAAU,KACV,GAAI,aACJ,MAAO,EACP,SAAU,SACV,KAAM,SACN,IAAK,cACL,MAAO,GAAS,2BAChB,MAAO,GACP,SAAU,GACV,SAAU,QACV,SAAU,KACV,SAAU,QACV,OAAQ,QACZ,GAEA,EAAmB,MAGnB,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,gBACZ,SAAU,aACV,WAAY,cACZ,SAAU,CAAE,KAAM,aAAc,EAChC,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAEA,EAAO,IAAI,CAAC,2BACT,GAAI,EAAU,KAIb,EAWJ,GAdA,GAAgB,GAChB,EAAmB,GAIf,IACA,EAAO,CADA,CACA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,EAAE,QAAQ,GAAK,GAAY,EAAE,KAAK,EAAE,gBAAkB,EAAM,WAAW,GAAA,EAIjG,AAAC,GACD,GADO,AACA,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,EAAE,QAAQ,GAAK,IAAsB,QAAV,EAAC,EAA+B,IAAZ,EAAE,KAAK,CAAS,EAAE,KAAK,EAAG,CAAC,CAAA,EAGpG,EAAM,CACN,GAAoB,cAAhB,EAAK,MAAM,CAAkB,YAI7B,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,eACZ,SAAU,EAAK,EAAE,EAAI,UACrB,WAAY,EAAK,IAAI,EAAI,UACzB,iBAAkB,EAClB,SAAU,CAAE,OAAQ,mBAAoB,EACxC,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAIJ,GAAoB,YAAhB,EAAK,MAAM,CAAgB,OAK/B,EAAe,GAGf,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,gBACZ,SAAU,EAAK,EAAE,CACjB,WAAY,EAAK,IAAI,CACrB,iBAAkB,EAClB,SAAU,CAAE,KAAM,EAAK,IAAI,CAAE,MAAO,EAAK,KAAK,AAAC,EAC/C,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAEA,EAAO,IAAI,CAAC,aAChB,MACI,CADG,OACK,KAAK,CAAC,sCAEtB,CACJ,SAyuBe,EAAQ,WAxqBJ,AAAC,IAChB,GAAI,EAAa,CACb,IAAM,EAAU,CAAE,GAAG,CAAW,CAAE,GAAG,CAAQ,AAAD,EAC5C,EAAe,GAEf,IAAM,EAAQ,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,EAAY,EAAE,EACzD,GAAS,GAAG,CACZ,EAAA,EAAE,CAAC,KAAK,CAAC,EAAM,CAAG,EAClB,EAAA,EAAE,CAAC,IAAI,GAEf,CACJ,EA6pBmC,aA3pBd,AAAC,IAClB,IAAM,EAAQ,CAAC,CAAC,EAAE,EAAA,EAAE,CAAC,OAAO,CAAC,MAAM,CAAG,EAAA,CAAG,CACnC,EAAY,IAAI,OAAO,WAAW,GAClC,EAAoB,CACtB,GAAI,EACJ,KAAM,EAAK,IAAI,EAAI,aACnB,KAAM,EAAK,IAAI,EAAI,CAAC,OAAO,EAAE,EAAA,CAAO,CACpC,QAAS,EAAK,OAAO,EAAI,EAAE,CAC3B,OAAQ,SACR,SAAU,EAAK,QAAQ,EAAI,iBAC3B,OAAQ,EAAK,MAAM,EAAI,QACvB,SAAU,CACN,UAAW,EAAK,IAAI,EAAI,aACxB,cAAe,UACf,aAAc,UACd,WAAY,EACZ,GAAG,EAAK,QAAQ,AACpB,EACA,SAAU,CACN,kBAAmB,EACnB,aAAc,GACd,oBAAqB,KAAK,IAC1B,GADiC,gBACb,CAAC,kBAAkB,CACvC,qBAAsB,GACtB,YAAa,GACb,WAAY,EACZ,GAAG,EAAK,QAAQ,AACpB,EACA,cAAe,CACX,EAAG,OAAO,MAAM,CAAC,EAAA,WAAW,EAC5B,EAAG,CAAC,eAAgB,gBAAiB,cAAc,CACnD,EAAG,CAAC,gBAAiB,cAAc,CACnC,EAAG,CAAC,gBAAgB,CACpB,EAAG,CAAC,gBAAgB,CACpB,EAAG,EAAE,AACT,EACA,MAAO,EACP,QAAS,OACT,WAAY,EACZ,SAAU,EAAK,QAAQ,EAAI,CAAC,YAAa,YAAa,aAAc,OAAQ,YAAY,CACxF,OAAQ,EAAK,MAAM,CACnB,YAAa,EAAK,WAAW,CAC7B,aAAc,EAAK,YAAY,CAC/B,aAAc,EAAK,YAAY,AACnC,EAEA,EAAA,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,GAGhB,IAAM,EAAU,CAAC,MAAM,EAAE,EAAA,CAAO,CAC1B,EAAa,EAAK,YAAY,EAAI,CAAC,MAAM,EAAE,EAAU,IAAI,CAAC,IAAI,CAAC,CA2CrE,CA3CuE,MACvE,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CACV,GAAI,AAFyF,EAG7F,KAAM,EAAK,WAAW,EAAI,CAAC,MAAM,EAAE,EAAU,IAAI,CAAA,CAAE,CACnD,MAAO,EACP,KAAM,eACN,MAAO,EACP,SAAU,EACV,KAAM,OACN,SAAU,KACV,IAAK,gBACL,MAAO,EAAK,YAAY,EAAI,GAC5B,SAAU,OACV,SAAU,gBACV,SAAU,EAAU,MAAM,CAC1B,SAAU,EAAU,QAAQ,CAC5B,OAAQ,QACZ,GAGA,EAAA,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CACnB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,GAAI,EACJ,QAAS,oDACT,KAAM,CAAC,KAAK,EAAE,EAAK,WAAW,EAAI,QAAQ;AAAA;AAAA,mBAAqB,EAAE,EAAU,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,SAAmH,EAAE,WAAW;AAAA,gCAA+B,CAAC,CAChP,OAAQ,OACR,OAAQ,CACZ,GAGA,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,iBACZ,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,iBAAkB,EAClB,SAAU,CAAE,KAAM,EAAU,IAAI,CAAE,KAAM,EAAU,IAAI,CAAE,YAAW,EACnE,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GACA,EAAA,EAAE,CAAC,IAAI,GAEP,QAAQ,GAAG,CAAC,kBAAmB,GACxB,CACX,EA6jBiD,aA3jB5B,CAAC,EAAY,KAC9B,IAAM,EAAM,EAAA,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC/C,GAAI,GAAO,EAAG,CACV,IAAM,EAAU,EAAA,EAAE,CAAC,OAAO,CAAC,EAAI,CAGzB,EAAU,OAAO,IAAI,CAAC,GAAS,MAAM,CAAC,GAAW,aAAN,GAA0B,AAAN,gBACjE,EAAQ,QAAQ,EAAE,EAAQ,IAAI,CAAC,YAC/B,EAAQ,QAAQ,EAAE,EAAQ,IAAI,CAAC,YAEnC,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,EAAQ,MAAM,CAAG,CAAC,OAAO,EAAE,EAAQ,MAAM,CAAA,CAAE,CAAG,iBAC1D,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,iBAAkB,EAClB,SAAU,SAAE,UAAS,CAAQ,EAC7B,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAEA,EAAA,EAAE,CAAC,OAAO,CAAC,EAAI,CAAG,CACd,GAAG,CAAO,CACV,GAAG,CAAO,CACV,SAAU,EAAQ,QAAQ,CAAG,CAAE,GAAG,EAAQ,QAAQ,CAAE,GAAG,EAAQ,QAAQ,AAAC,EAAI,EAAQ,QAAQ,CAC5F,SAAU,EAAQ,QAAQ,CAAG,CAAE,GAAG,EAAQ,QAAQ,CAAE,GAAG,EAAQ,QAAQ,AAAC,EAAI,EAAQ,QAAQ,AAChG,EAKA,EAAA,EAAE,CAAC,IAAI,EACX,CACJ,EA0hB+D,aAxhB1C,AAAC,IAClB,IAAM,EAAM,EAAA,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC/C,GAAI,EAAM,EAAG,OAEb,IAAM,EAAS,EAAA,EAAE,CAAC,OAAO,CAAC,EAAI,CAI9B,IAAK,IAAI,EAAI,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAG,EAAG,GAAK,EAAG,IAAK,AACvC,EAAA,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,GAAK,GAAI,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,EAAG,GAGxD,IAAK,IAAI,EAAI,EAAA,EAAE,CAAC,IAAI,CAAC,MAAM,CAAG,EAAG,GAAK,EAAG,IAAK,AACtC,EAAA,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,GAAK,GAAI,EAAA,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,EAAG,GAGtD,IAAK,IAAI,EAAI,EAAA,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAG,EAAG,GAAK,EAAG,IAAK,AAC1C,EAAA,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,GAAK,GAAI,EAAA,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAG,GAG9D,IAAK,IAAI,EAAI,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAG,EAAG,GAAK,EAAG,IAAK,AACvC,EAAA,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,GAAK,GAAI,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,EAAG,GAGxD,IAAK,IAAI,EAAI,EAAA,EAAE,CAAC,aAAa,CAAC,MAAM,CAAG,EAAG,GAAK,EAAG,IAAK,AAC/C,EAAA,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,QAAQ,GAAK,GAAI,EAAA,EAAE,CAAC,aAAa,CAAC,MAAM,CAAC,EAAG,GAIxE,EAAA,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,EAAK,GAGvB,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,iBACZ,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,iBAAkB,EAClB,SAAU,CAAE,KAAM,EAAO,IAAI,CAAE,KAAM,EAAO,IAAI,AAAC,EACjD,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAEA,EAAe,GAAK,EAAI,EAC5B,EA6eQ,WA3eW,AAAC,IAChB,GAAI,CAAC,EAAiB,OACtB,IAAM,EAAgB,CAClB,GAAI,CAAC,EAAE,EAAE,EAAgB,CAAC,EAAE,KAAK,KAAK,CAAiB,IAAhB,KAAK,MAAM,IAAK,CAAQ,CAC/D,SAAU,EACV,KAAM,EAAK,IAAI,EAAI,WACnB,MAAO,EAAK,KAAK,EAAI,EACrB,KAAM,EAAK,IAAI,CACf,SAAU,EAAK,QAAQ,CACvB,QAAS,EAAK,OAAO,CACrB,YAAa,EAAK,WAAW,CAC7B,QAAS,EAAK,OAAO,EAAI,EAAE,CAC3B,KAAM,EAAK,IAAI,EAAI,MACvB,EACA,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GACd,EAAA,EAAE,CAAC,IAAI,EACX,EA2doB,WAzdD,CAAC,EAAY,KAC5B,IAAM,EAAM,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GACzC,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAAG,CAAE,GAAG,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAAE,GAAG,CAAO,AAAC,EAC/C,EAAA,EAAE,CAAC,IAAI,GAEf,EAmdgC,WAjdZ,AAAD,IACf,IAAM,EAAM,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GACzC,GAAO,GAAG,AACV,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,EAAK,EAE7B,EA4c4C,uBA1cb,CAAC,EAAe,KAC3C,GAAI,CAAC,EAAe,OAKpB,IAAM,EAAM,EAAA,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC/C,GAAI,GAAO,EAAG,CACV,IAAM,EAAS,EAAA,EAAE,CAAC,OAAO,CAAC,EAAI,CAC9B,EAAO,aAAa,CAAG,CACnB,GAAG,EAAO,aAAa,CACvB,CAAC,EAAM,CAAE,CACb,CAGJ,CACJ,EA2bQ,sBAzbsB,AAAC,GACpB,CAAC,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,EAAE,KAAK,EAAE,gBAAkB,EAAM,WAAW,IAwb5C,gBArbP,CAAC,EAAyB,EAAmE,CAAC,CAAC,IAEnH,IAAM,EAAS,CAAC,EAAE,EAAE,KAAK,GAAG,GAAA,CAAI,CAC1B,EAAgB,CAClB,GAAI,EACJ,SAAU,EAAS,QAAQ,EAAI,GAAmB,SAClD,SAAU,EAAQ,cAAc,CAChC,KAAM,EAAS,IAAI,EAAI,gBACvB,MAAO,EAAS,KAAK,CACrB,KAAM,EAAS,IAAI,EAAI,WACvB,MAAO,EAAS,KAAK,EAAI,EACzB,KAAM,EAAS,IAAI,EAAI,GACvB,SAAU,CAAC,EAAS,IAAI,EAAI,GAAA,CAAG,CAAE,SAAS,CAAC,EAAG,GAAG,WAAW,GAC5D,IAAK,EAAS,GAAG,EAAI,GACrB,MAAO,EAAS,KAAK,EAAI,GACzB,SAAU,EAAS,QAAQ,EAAI,GAC/B,SAAU,EAAS,QAAQ,EAAI,WAC/B,SAAU,KACV,SAAU,QACV,OAAQ,EAAS,MAAM,EAAI,SAC3B,oBAAoB,EACpB,aAAc,EAAQ,gBAAgB,CAAG,IAAI,OAAO,WAAW,QAAK,EACpE,gBAAiB,EAAQ,gBAAgB,CAAG,IAAI,KAAK,KAAK,GAAG,GAAK,KAAK,GAAa,IAAN,OAAiB,QAAK,CACxG,EACA,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAGd,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,eACZ,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,eAAgB,EAChB,iBAAkB,EAAQ,QAAQ,CAClC,SAAU,CAAE,GAAG,CAAO,CAAE,iBAAkB,EAAQ,gBAAgB,AAAC,EACnE,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GACA,EAAA,EAAE,CAAC,IAAI,GAGH,EAAQ,gBAAgB,EAAI,EAAQ,KAAK,EAAE,CAC3C,EAAA,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CACnB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,GAAI,EAAQ,KAAK,CACjB,QAAS,CAAC,2BAA2B,EAAuB,WAArB,EAAQ,QAAQ,CAAgB,oBAAsB,kBAAA,CAAmB,CAChH,KAAM,CAAC,KAAK,EAAE,EAAQ,IAAI,CAAC;AAAA;AAAA;AAAA,oBAAwF,EAAE,EAAQ,QAAQ,CAAC,gBAAgB,CAAC,CACvJ,OAAQ,OACR,OAAQ,IAAI,OAAO,WAAW,EAClC,GACA,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,EAAQ,KAAK,CAAA,CAAE,EAE1D,EAiYgD,kBAtTtB,AAAC,IACvB,IAAM,EAAM,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC7C,GAAI,GAAO,EAAG,CACV,IAAM,EAAO,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAEpB,EAAU,CACZ,GAAG,CAAI,CACP,aAAc,IAAI,OAAO,WAAW,GACpC,gBAAiB,IAAI,KAAK,KAAK,GAAG,GAAK,KAAK,GAAa,IAAN,OAAiB,EACxE,EACA,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAAG,EAGZ,EAAK,KAAK,EACV,AADY,EACZ,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CACnB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,GAAI,EAAK,KAAK,CACd,QAAS,CAAC,gCAAgC,CAAC,CAC3C,KAAM,CAAC,KAAK,EAAE,EAAK,IAAI,CAAC;AAAA;AAAA,yCAA8C,EAAE,EAAK,QAAQ,CAAC;AAAA,iCAAmD,CAAC,CAC1I,OAAQ,OACR,OAAQ,IAAI,OAAO,WAAW,EAClC,GAIJ,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,qBACZ,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,eAAgB,EAAK,EAAE,CACvB,iBAAkB,EAAK,QAAQ,CAC/B,SAAU,CAAE,MAAO,EAAK,KAAK,AAAC,EAC9B,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GACA,EAAA,EAAE,CAAC,IAAI,EACX,CACJ,EAgRmE,gBA/X3C,CAAC,EAAgB,KACrC,IAAM,EAAM,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC7C,GAAI,GAAO,EAAG,CACV,IAAM,EAAU,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAGvB,EAAyB,EAAE,CAC7B,EAAQ,IAAI,EAAI,EAAQ,IAAI,GAAK,EAAQ,IAAI,EAAE,EAAa,IAAI,CAAC,CAAC,aAAa,EAAE,EAAQ,IAAI,CAAC,IAAI,EAAE,EAAQ,IAAI,CAAA,CAAE,EAClH,EAAQ,QAAQ,EAAI,EAAQ,QAAQ,GAAK,EAAQ,QAAQ,EAAE,EAAa,IAAI,CAAC,CAAC,iBAAiB,EAAE,EAAQ,QAAQ,CAAC,IAAI,EAAE,EAAQ,QAAQ,CAAA,CAAE,EAC1I,EAAQ,MAAM,EAAI,EAAQ,MAAM,GAAK,EAAQ,MAAM,EAAE,EAAa,IAAI,CAAC,CAAC,eAAe,EAAE,EAAQ,MAAM,CAAC,IAAI,EAAE,EAAQ,MAAM,CAAA,CAAE,EAC9H,EAAQ,KAAK,EAAI,EAAQ,KAAK,GAAK,EAAQ,KAAK,EAAE,EAAa,IAAI,CAAC,CAAC,cAAc,EAAE,EAAQ,KAAK,CAAC,IAAI,EAAE,EAAQ,KAAK,CAAA,CAAE,EACxH,EAAQ,QAAQ,EAAE,EAAa,IAAI,CAAC,kCACL,IAA/B,EAAQ,kBAAkB,EAAkB,EAAQ,kBAAkB,GAAK,EAAQ,kBAAkB,EAAE,AACvG,EAAa,IAAI,CAAC,CAAC,uBAAuB,EAAE,EAAQ,kBAAkB,CAAG,UAAY,WAAA,CAAY,EAGjG,EAAa,MAAM,CAAG,GAAG,AACzB,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,eACZ,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,eAAgB,EAChB,iBAAkB,EAAQ,QAAQ,CAClC,SAAU,CAAE,QAAS,UAAc,CAAQ,EAC3C,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,GAGJ,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAAG,CAAE,GAAG,CAAO,CAAE,GAAG,CAAO,AAAC,EACzC,EAAA,EAAE,CAAC,IAAI,EACX,CACJ,EA8VoF,gBA5V5D,AAAC,IACrB,IAAM,EAAM,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC7C,GAAI,GAAO,EAAG,CACV,IAAM,EAAO,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAG1B,GAAmB,IAAf,EAAK,KAAK,EAA0B,WAAW,CAA3B,EAAK,MAAM,EAOJ,IAAvB,AANgB,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,GAChC,EAAE,QAAQ,GAAK,EAAK,QAAQ,EAChB,IAAZ,EAAE,KAAK,EACP,EAAE,EAAE,GAAK,GACI,WAAb,EAAE,MAAM,EAEI,MAAM,CAAQ,OAOlC,IAAM,EAAY,EAAK,MAAM,CAC7B,EAAA,EAAE,CAAC,KAAK,CAAC,EAAI,CAAG,CAAE,GAAG,CAAI,CAAE,OAAQ,SAAU,EAG7C,EAAA,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CACrB,GAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAA,CAAI,CACzB,WAAY,eACZ,SAAU,GAAa,IAAM,SAC7B,WAAY,GAAa,MAAQ,SACjC,eAAgB,EAChB,iBAAkB,EAAK,QAAQ,CAC/B,SAAU,CAAE,gBAAiB,CAAU,EACvC,GAAI,YACJ,WAAY,IAAI,OAAO,WAAW,EACtC,EACJ,CACJ,EAyTQ,gBAtQgB,AAAC,IACrB,IAAM,EAAgB,CAClB,GAAG,CAAQ,CACX,GAAI,CAAC,EAAE,EAAE,EAAgB,CAAC,EAAE,KAAK,GAAG,GAAA,CAAI,CACxC,KAAM,QACN,MAAO,EACP,cAAe,CACnB,EACA,EAAA,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,GACjB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EA2PyB,gBAzPD,CAAC,EAAY,KACjC,IAAM,EAAO,EAAA,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,GACrC,IACA,EADM,KACC,MAAM,CAAC,EAAM,GACpB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAkP0C,gBA/QlB,AAAC,IACrB,IAAM,EAAM,EAAA,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GACjC,CAAC,GAAG,CAAZ,IACA,EAAA,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,EAAK,GACrB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAyQQ,oBAhPoB,AAAC,IACzB,GAAI,CAAC,EAAiB,OACtB,IAAM,EAAkC,CACpC,GAAI,CAAC,GAAG,EAAE,KAAK,GAAG,GAAA,CAAI,CACtB,SAAU,EACV,MAAO,EAAK,KAAK,EAAI,gBACrB,YAAa,EAAK,WAAW,EAAI,GACjC,KAAM,EAAK,IAAI,EAAI,GACnB,QAAS,EAAK,OAAO,CACrB,KAAM,EAAK,IAAI,EAAI,WACnB,OAAQ,EAAK,MAAM,EAAI,CAAE,OAAQ,EAAE,AAAC,EACpC,SAAU,EAAK,QAAQ,EAAI,GAC3B,QAAQ,CACZ,EACA,EAAA,EAAE,CAAC,mBAAmB,CAAC,OAAO,CAAC,GAC/B,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EAgOQ,UA1KU,AAAC,IACf,IAAM,EAAc,CAChB,GAAI,CAAC,IAAI,EAAE,EAAgB,CAAC,EAAE,KAAK,GAAG,GAAA,CAAI,CAC1C,KAAM,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAC5C,MAAO,EACP,cAAe,EACf,GAAG,CAAO,AACd,EACA,EAAA,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,GAChB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EA+JmB,UA7JD,CAAC,EAAY,KAC3B,IAAM,EAAM,EAAA,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,GACnC,IACA,CADK,MACE,MAAM,CAAC,EAAK,GACnB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAsJ8B,UApJZ,AAAC,IACf,IAAM,EAAM,EAAA,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GACxC,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,EAAK,GACpB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EA8IQ,cA5Ic,AAAC,IACnB,IAAM,EAAM,EAAA,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,GACnC,IACI,CADC,CACG,KAAK,CAAG,EACZ,CADe,CACX,KAAK,GAET,EAAI,KAAK,GAEb,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAiIuB,cA/HD,CAAC,EAAe,KAClC,IAAM,EAAa,CACf,GAAI,CAAC,EAAE,EAAE,KAAK,GAAG,GAAA,CAAI,CACrB,MAAO,EACP,SAAU,GAAa,IAAM,OAC7B,WAAY,GAAa,MAAQ,UACjC,QAAS,EACT,UAAW,IAAI,OAAO,WAAW,EACrC,EACA,EAAA,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,GAEvB,IAAM,EAAM,EAAA,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,GACnC,IAAK,EAAI,aAAa,CAAG,CAAC,EAAI,aAAa,GAAI,CAAC,EAAI,EAExD,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EAgHQ,cA9Gc,AAAC,IACnB,GAAI,CAAC,EAAiB,OACtB,IAAM,EAAsB,CACxB,GAAI,CAAC,KAAK,EAAE,KAAK,GAAG,GAAA,CAAI,CACxB,SAAU,EACV,MAAO,EAAY,KAAK,EAAI,iBAC5B,YAAa,EAAY,WAAW,EAAI,GACxC,UAAW,EAAY,SAAS,EAAI,IAAI,OAAO,WAAW,GAC1D,QAAS,EAAY,OAAO,EAAI,IAAI,OAAO,WAAW,GACtD,OAAQ,WACR,UAAW,GAAa,IAAM,MAC9B,UAAW,IAAI,OAAO,WAAW,GACjC,UAAW,IAAI,OAAO,WAAW,GACjC,aAAc,EAAY,YAAY,EAAI,EAAE,CAC5C,OAAQ,EAAY,MAAM,EAAI,EAAE,CAChC,SAAU,EAAY,QAAQ,CAC9B,MAAO,EAAY,KAAK,AAC5B,EACA,EAAA,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,GACpB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EAyFuB,cAvFD,CAAC,EAAY,KAC/B,IAAM,EAAM,EAAA,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC5C,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,QAAQ,CAAC,EAAI,CAAG,CAAE,GAAG,EAAA,EAAE,CAAC,QAAQ,CAAC,EAAI,CAAE,GAAG,CAAO,CAAE,UAAW,IAAI,OAAO,WAAW,EAAG,EAC1F,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAgFsC,cA9EhB,AAAC,IACnB,IAAM,EAAM,EAAA,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC5C,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAK,GACxB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAuEqD,iBArE5B,AAAC,IACtB,IAAM,EAAW,EAAA,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAK,EAAE,EAAE,GAAK,GAChD,GAAI,GAAY,EAAiB,CAC7B,IAAM,EAAY,KAAK,GAAG,GACpB,EAAsB,CACxB,GAAG,CAAQ,CACX,GAAI,CAAC,KAAK,EAAE,EAAA,CAAW,CACvB,MAAO,CAAA,EAAG,EAAS,KAAK,CAAC,QAAQ,CAAC,CAClC,UAAW,IAAI,OAAO,WAAW,GACjC,UAAW,IAAI,OAAO,WAAW,GACjC,OAAQ,WACR,OAAQ,EAAS,MAAM,CAAC,GAAG,CAAC,CAAC,EAAI,IAAM,CAAC,CACpC,GAAG,CAAE,CACL,GAAI,CAAC,GAAG,EAAE,EAAU,CAAC,EAAE,EAAA,CAAG,CAC1B,OAAQ,cACR,WAAY,EAAG,UAAU,CAAC,GAAG,CAAC,CAAC,EAAK,IAAM,CAAC,CACvC,GAAG,CAAG,CACN,GAAI,CAAC,IAAI,EAAE,EAAU,CAAC,EAAE,EAAE,CAAC,EAAE,EAAA,CAAG,CAChC,OAAQ,cACR,UAAW,EAAE,CACjB,CAAC,EACL,CAAC,CACL,EACA,EAAA,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,GACpB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,CACJ,EA0CuE,oBAhO3C,CAAC,EAAc,KACvC,GAAI,CAAC,EAAiB,OACtB,IAAM,EAA2B,CAC7B,GAAI,CAAC,IAAI,EAAE,EAAgB,CAAC,EAAE,KAAK,GAAG,GAAA,CAAI,CAC1C,SAAU,OACV,EACA,UAAW,IAAI,OAAO,WAAW,GACjC,UACJ,EACA,EAAA,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,GACvB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EAqNQ,oBAzCoB,CAAC,EAAY,KACrC,IAAM,EAAM,EAAA,EAAE,CAAC,cAAc,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAClD,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,cAAc,CAAC,EAAI,CAAG,CAAE,GAAG,EAAA,EAAE,CAAC,cAAc,CAAC,EAAI,CAAE,GAAG,CAAO,AAAC,EACjE,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EAmCQ,oBAjCoB,AAAC,IACzB,IAAM,EAAM,EAAA,EAAE,CAAC,cAAc,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAClD,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,IACZ,EAAE,QAAQ,GAAK,GAAI,OAAO,EAAE,QAAQ,AAC5C,GACA,EAAA,EAAE,CAAC,cAAc,CAAC,MAAM,CAAC,EAAK,GAC9B,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,qBAwBQ,EAAoB,cAtBN,IAAM,EAAsB,GAAK,CAAC,mBAuBhD,qBAAiB,EACjB,uBAtBuB,AAAC,IAC5B,OAAO,MAAM,CAAC,EAAA,EAAE,CAAC,gBAAgB,CAAE,GACnC,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EAmBQ,iBAxNiB,AAAC,IACtB,GAAI,CAAC,EAAiB,OACtB,IAAM,EAAwB,CAC1B,GAAI,CAAC,GAAG,EAAE,EAAgB,CAAC,EAAE,KAAK,GAAG,GAAA,CAAI,CACzC,SAAU,EACV,KAAM,EAAK,IAAI,EAAI,gBACnB,YAAa,EAAK,WAAW,CAC7B,SAAU,EAAK,QAAQ,OAAI,EAC3B,MAAO,EAAK,KAAK,EAAI,EACrB,KAAM,EAAK,IAAI,EAAI,UACnB,QAAS,EAAK,OAAO,CACrB,MAAO,EAAK,KAAK,EAAI,UACrB,UAAW,IAAI,OAAO,WAAW,GACjC,UAAW,IAAI,OAAO,WAAW,EACrC,EACA,EAAA,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,GACpB,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,EAC5B,EAuMQ,iBArMiB,CAAC,EAAY,KAClC,IAAM,EAAM,EAAA,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC/C,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,WAAW,CAAC,EAAI,CAAG,CAAE,GAAG,EAAA,EAAE,CAAC,WAAW,CAAC,EAAI,CAAE,GAAG,CAAO,CAAE,UAAW,IAAI,OAAO,WAAW,EAAG,EAChG,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,EA+LQ,iBA7LiB,AAAC,IACtB,IAAM,EAAM,EAAA,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,GAAK,EAAE,EAAE,GAAK,GAC/C,GAAO,GAAG,CACV,EAAA,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,EAAK,GAC3B,EAAA,EAAE,CAAC,IAAI,GACP,EAAe,GAAK,EAAI,GAEhC,CAuLI,WAAI,GAEZ,CAEO,SAAS,IACZ,IAAM,EAAU,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,GAC3B,GAAI,KAAY,MACZ,KADuB,CACjB,AAAI,MAAM,6CAEpB,OAAO,CACX"}